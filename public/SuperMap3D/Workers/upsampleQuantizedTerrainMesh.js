define(["./AttributeCompression-2ece5912","./buildModuleUrl-c0836874","./Cartesian2-c4c2a8f9","./Cartesian4-442405e6","./Cartographic-2cfa3a3a","./when-b60132fc","./TerrainEncoding-87399e4c","./IndexDatatype-a3f4b187","./Math-3024ab74","./OrientedBoundingBox-24d03d3b","./createTaskProcessorWorker","./WebGLConstants-aba9fc67","./FeatureDetection-caf5f946","./EllipsoidTangentPlane-1a9db025","./Plane-6b2f5e52","./Transforms-04c4d562"],(function(e,t,i,n,s,r,h,u,o,a,p,d,f,l,c,g){"use strict";var m={clipTriangleAtAxisAlignedThreshold:function(e,t,i,n,s,h){var u,o,a;r.defined(h)?h.length=0:h=[],t?(u=i<e,o=n<e,a=s<e):(u=i>e,o=n>e,a=s>e);var p,d,f,l,c,g,m=u+o+a;return 1===m?u?(p=(e-i)/(n-i),d=(e-i)/(s-i),h.push(1),h.push(2),1!==d&&(h.push(-1),h.push(0),h.push(2),h.push(d)),1!==p&&(h.push(-1),h.push(0),h.push(1),h.push(p))):o?(f=(e-n)/(s-n),l=(e-n)/(i-n),h.push(2),h.push(0),1!==l&&(h.push(-1),h.push(1),h.push(0),h.push(l)),1!==f&&(h.push(-1),h.push(1),h.push(2),h.push(f))):a&&(c=(e-s)/(i-s),g=(e-s)/(n-s),h.push(0),h.push(1),1!==g&&(h.push(-1),h.push(2),h.push(1),h.push(g)),1!==c&&(h.push(-1),h.push(2),h.push(0),h.push(c))):2===m?u||i===e?o||n===e?a||s===e||(d=(e-i)/(s-i),f=(e-n)/(s-n),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(d),h.push(-1),h.push(1),h.push(2),h.push(f)):(g=(e-s)/(n-s),p=(e-i)/(n-i),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(g),h.push(-1),h.push(0),h.push(1),h.push(p)):(l=(e-n)/(i-n),c=(e-s)/(i-s),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(l),h.push(-1),h.push(2),h.push(0),h.push(c)):3!==m&&(h.push(0),h.push(1),h.push(2)),h},computeBarycentricCoordinates:function(e,t,i,s,h,u,o,a,p){var d=i-o,f=o-h,l=u-a,c=s-a,g=1/(l*d+f*c),m=t-a,x=e-o,v=(l*x+f*m)*g,w=(-c*x+d*m)*g,C=1-v-w;return r.defined(p)?(p.x=v,p.y=w,p.z=C,p):new n.Cartesian3(v,w,C)},computeLineSegmentLineSegmentIntersection:function(e,t,n,s,h,u,o,a,p){var d=(a-u)*(n-e)-(o-h)*(s-t);if(0!==d){var f=((o-h)*(t-u)-(a-u)*(e-h))/d,l=((n-e)*(t-u)-(s-t)*(e-h))/d;return f>=0&&f<=1&&l>=0&&l<=1?(r.defined(p)||(p=new i.Cartesian2),p.x=e+f*(n-e),p.y=t+f*(s-t),p):void 0}}},x=32767,v=16383,w=[],C=[],y=[],B=new s.Cartographic,I=new n.Cartesian3,b=[],A=[],T=[],z=[],M=[],N=new n.Cartesian3,V=new t.BoundingSphere,H=new a.OrientedBoundingBox,E=new i.Cartesian2,R=new n.Cartesian3;function O(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}O.prototype.clone=function(e){return r.defined(e)||(e=new O),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},O.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},O.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},O.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},O.prototype.isIndexed=function(){return r.defined(this.index)},O.prototype.getH=function(e,t){if(r.defined(this.index))return this.heightBuffer[this.index];var i=this.first.getH(e,t),n=this.second.getH(e,t);return 0===t+i/x*e||0===t+n/x*e?0:o.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},O.prototype.getU=function(){return r.defined(this.index)?this.uBuffer[this.index]:o.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},O.prototype.getV=function(){return r.defined(this.index)?this.vBuffer[this.index]:o.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var U=new i.Cartesian2,F=-1,S=[new n.Cartesian3,new n.Cartesian3],P=[new n.Cartesian3,new n.Cartesian3];function D(t,i){++F;var s=S[F],r=P[F];return s=e.AttributeCompression.octDecode(t.first.getNormalX(),t.first.getNormalY(),s),r=e.AttributeCompression.octDecode(t.second.getNormalX(),t.second.getNormalY(),r),I=n.Cartesian3.lerp(s,r,t.ratio,I),n.Cartesian3.normalize(I,I),e.AttributeCompression.octEncode(I,i),--F,i}O.prototype.getNormalX=function(){return r.defined(this.index)?this.normalBuffer[2*this.index]:(U=D(this,U)).x},O.prototype.getNormalY=function(){return r.defined(this.index)?this.normalBuffer[2*this.index+1]:(U=D(this,U)).y};var W=[];function X(e,t,i,n,s,h,u,o,a,p,d){if(0!==u.length){for(var f=0,l=0;l<u.length;)l=W[f++].initializeFromClipResult(u,l,o);for(var c=0;c<f;++c){var g=W[c];if(g.isIndexed())g.newIndex=h[g.index],g.uBuffer=e,g.vBuffer=t,g.heightBuffer=i,a&&(g.normalBuffer=n);else{var m=g.getKey();if(r.defined(h[m]))g.newIndex=h[m];else{var x=e.length;e.push(g.getU()),t.push(g.getV()),i.push(g.getH(p,d)),a&&(n.push(g.getNormalX()),n.push(g.getNormalY())),g.newIndex=x,h[m]=x}}}3===f?(s.push(W[0].newIndex),s.push(W[1].newIndex),s.push(W[2].newIndex)):4===f&&(s.push(W[0].newIndex),s.push(W[1].newIndex),s.push(W[2].newIndex),s.push(W[0].newIndex),s.push(W[2].newIndex),s.push(W[3].newIndex))}}return W.push(new O),W.push(new O),W.push(new O),W.push(new O),p((function(e,i){var s=e.isEastChild,r=e.isNorthChild,p=s?v:0,d=s?x:v,f=r?v:0,l=r?x:v,c=b,g=A,U=T,F=M;c.length=0,g.length=0,U.length=0,F.length=0;var S=z;S.length=0;var P={},D=e.vertices,W=e.indices;W=W.subarray(0,e.indexCountWithoutSkirts);var k,K,L,Y,_,G=h.TerrainEncoding.clone(e.encoding),J=G.hasVertexNormals,Z=e.exaggeration,j=0,q=e.vertexCountWithoutSkirts,Q=e.minimumHeight,$=e.maximumHeight,ee=new Array(q),te=new Array(q),ie=new Array(q),ne=J?new Array(2*q):void 0;for(K=0,L=0;K<q;++K,L+=2){var se=G.decodeTextureCoordinates(D,K,E);if(k=G.decodeHeight(D,K)/Z,Y=o.CesiumMath.clamp(se.x*x|0,0,x),_=o.CesiumMath.clamp(se.y*x|0,0,x),ie[K]=o.CesiumMath.clamp((k-Q)/($-Q)*x|0,0,x),Y<20&&(Y=0),_<20&&(_=0),x-Y<20&&(Y=x),x-_<20&&(_=x),ee[K]=Y,te[K]=_,J){var re=G.getOctEncodedNormal(D,K,R);ne[L]=re.x,ne[L+1]=re.y}(s&&Y>=v||!s&&Y<=v)&&(r&&_>=v||!r&&_<=v)&&(P[K]=j,c.push(Y),g.push(_),U.push(ie[K]),J&&(F.push(ne[L]),F.push(ne[L+1])),++j)}var he=[];he.push(new O),he.push(new O),he.push(new O);var ue,oe=[];for(oe.push(new O),oe.push(new O),oe.push(new O),K=0;K<W.length;K+=3){var ae=W[K],pe=W[K+1],de=W[K+2],fe=ee[ae],le=ee[pe],ce=ee[de];he[0].initializeIndexed(ee,te,ie,ne,ae),he[1].initializeIndexed(ee,te,ie,ne,pe),he[2].initializeIndexed(ee,te,ie,ne,de);var ge=m.clipTriangleAtAxisAlignedThreshold(v,s,fe,le,ce,w);(ue=0)>=ge.length||((ue=oe[0].initializeFromClipResult(ge,ue,he))>=ge.length||(ue=oe[1].initializeFromClipResult(ge,ue,he))>=ge.length||(ue=oe[2].initializeFromClipResult(ge,ue,he),X(c,g,U,F,S,P,m.clipTriangleAtAxisAlignedThreshold(v,r,oe[0].getV(),oe[1].getV(),oe[2].getV(),C),oe,J,$,Q),ue<ge.length&&(oe[2].clone(oe[1]),oe[2].initializeFromClipResult(ge,ue,he),X(c,g,U,F,S,P,m.clipTriangleAtAxisAlignedThreshold(v,r,oe[0].getV(),oe[1].getV(),oe[2].getV(),C),oe,J,$,Q))))}var me=s?-32767:0,xe=r?-32767:0,ve=[],we=[],Ce=[],ye=[],Be=Number.MAX_VALUE,Ie=-Be,be=y;be.length=0;var Ae=t.Ellipsoid.clone(e.ellipsoid),Te=t.Rectangle.clone(e.childRectangle),ze=Te.north,Me=Te.south,Ne=Te.east,Ve=Te.west;for(Ne<Ve&&(Ne+=o.CesiumMath.TWO_PI),K=0;K<c.length;++K)(Y=Math.round(c[K]))<=p?(ve.push(K),Y=0):Y>=d?(Ce.push(K),Y=x):Y=2*Y+me,c[K]=Y,(_=Math.round(g[K]))<=f?(we.push(K),_=0):_>=l?(ye.push(K),_=x):_=2*_+xe,g[K]=_,(k=o.CesiumMath.lerp(Q,$,U[K]/x))<Be&&(Be=k),k>Ie&&(Ie=k),U[K]=k,B.longitude=o.CesiumMath.lerp(Ve,Ne,Y/x),B.latitude=o.CesiumMath.lerp(Me,ze,_/x),B.height=k,Ae.cartographicToCartesian(B,I),be.push(I.x),be.push(I.y),be.push(I.z);var He=t.BoundingSphere.fromVertices(be,n.Cartesian3.ZERO,3,V),Ee=a.OrientedBoundingBox.fromRectangle(Te,Be,Ie,Ae,H),Re=new h.EllipsoidalOccluder(Ae).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(He.center,be,3,He.center,Be,N),Oe=Ie-Be,Ue=new Uint16Array(c.length+g.length+U.length);for(K=0;K<c.length;++K)Ue[K]=c[K];var Fe=c.length;for(K=0;K<g.length;++K)Ue[Fe+K]=g[K];for(Fe+=g.length,K=0;K<U.length;++K)Ue[Fe+K]=x*(U[K]-Be)/Oe;var Se,Pe=u.IndexDatatype.createTypedArray(c.length,S);if(J){var De=new Uint8Array(F);i.push(Ue.buffer,Pe.buffer,De.buffer),Se=De.buffer}else i.push(Ue.buffer,Pe.buffer);return{vertices:Ue.buffer,encodedNormals:Se,indices:Pe.buffer,minimumHeight:Be,maximumHeight:Ie,westIndices:ve,southIndices:we,eastIndices:Ce,northIndices:ye,boundingSphere:He,orientedBoundingBox:Ee,horizonOcclusionPoint:Re}}))}));
