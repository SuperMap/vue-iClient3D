define(["./Cartesian4-442405e6","./Cartographic-2cfa3a3a","./when-b60132fc","./Math-3024ab74","./createTaskProcessorWorker"],(function(r,a,e,t,n){"use strict";var i=new r.Cartesian4(1,1/255,1/65025,1/160581375),s=new r.Cartesian4,o=1024;function f(a,e,n,f,u,h,c){var C=a.longitude,v=a.latitude,g=a.height;if(C=t.CesiumMath.toDegrees(C),v=t.CesiumMath.toDegrees(v),C<e[0]||C>e[2]||v<e[1]||v>e[3])return-1;for(var d=!1,l=0,p=.1*f,b=0;b<=n;b+=f){if(Math.abs(u+b-g)<p){d=!0;break}l++}if(!d)return-1;if(h.length<0)return-1;d=!1;for(var m=0;m<h.length;m+=2){var w=r.Cartesian3.fromDegrees(C,v,g),D=r.Cartesian3.fromDegrees(h[m+0],h[m+1],g);if(r.Cartesian3.distance(w,D)<p){d=!0;break}}if(!d)return-1;var M=e[2]-e[0],k=(g=e[3]-e[1],e[0]-.025*M),x=e[1]-.025*g;M+=.05*M,g+=.05*g;var y=parseInt((C-k)/M*o),I=parseInt((v-x)/g*o);y=y<1?1:y,I=I<1?1:I;var P=c[l],z=0;for(m=-1;m<2;m++)for(var A=-1;A<2;A++){var B=4*(o*(I+A)+(y+m));s.x=P[B],s.y=P[B+1],s.z=P[B+2],s.w=P[B+3],r.Cartesian4.divideByScalar(s,255,s),z=Math.max(z,r.Cartesian4.dot(s,i))}return z=z>.999?1:z}return n((function(e,t){for(var n=e.points,i=e.enuPoints,s=e.bounds,o=e.extend,u=e.spacing,h=e.bottom,c=e.pixelsArray,C=[],v=0,g=n.length;v<g;v++){var d=n[v],l=f(a.Cartographic.fromCartesian(d),s,o,u,h,i,c);C.push({position:r.Cartesian3.clone(d),shadowRatio:l})}return{resultData:C}}))}));
