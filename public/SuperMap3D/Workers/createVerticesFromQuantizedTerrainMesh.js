define(["./AttributeCompression-2ece5912","./EllipsoidTangentPlane-1a9db025","./buildModuleUrl-c0836874","./Cartesian2-c4c2a8f9","./Cartesian4-442405e6","./Cartographic-2cfa3a3a","./when-b60132fc","./TerrainEncoding-87399e4c","./IndexDatatype-a3f4b187","./Math-3024ab74","./OrientedBoundingBox-24d03d3b","./Transforms-04c4d562","./WebMercatorProjection-daa60ae8","./createTaskProcessorWorker","./Plane-6b2f5e52","./WebGLConstants-aba9fc67","./FeatureDetection-caf5f946"],(function(e,t,r,n,i,o,a,s,d,c,u,h,l,I,m,g,f){"use strict";function T(){c.DeveloperError.throwInstantiationError()}Object.defineProperties(T.prototype,{errorEvent:{get:c.DeveloperError.throwInstantiationError},credit:{get:c.DeveloperError.throwInstantiationError},tilingScheme:{get:c.DeveloperError.throwInstantiationError},ready:{get:c.DeveloperError.throwInstantiationError},readyPromise:{get:c.DeveloperError.throwInstantiationError},hasWaterMask:{get:c.DeveloperError.throwInstantiationError},hasVertexNormals:{get:c.DeveloperError.throwInstantiationError},availability:{get:c.DeveloperError.throwInstantiationError}});var p=[];T.getRegularGridIndices=function(e,t){var r=p[e];a.defined(r)||(p[e]=r=[]);var n=r[t];return a.defined(n)||w(e,t,n=e*t<c.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6+3*(e+t-2)):r[t]=new Uint32Array((e-1)*(t-1)*6+3*(e+t-2)),0),n},T.getRegularGridIndicesForReproject=function(e,t){var r=p[e];a.defined(r)||(p[e]=r=[]);var n=r[t];return a.defined(n)||w(e,t,n=e*t<c.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),0),n};var v=[];T.getRegularGridIndicesAndEdgeIndices=function(e,t){var r=v[e];a.defined(r)||(v[e]=r=[]);var n=r[t];if(!a.defined(n)){var i=T.getRegularGridIndices(e,t),o=y(e,t),s=o.westIndicesSouthToNorth,d=o.southIndicesEastToWest,c=o.eastIndicesNorthToSouth,u=o.northIndicesWestToEast;n=r[t]={indices:i,westIndicesSouthToNorth:s,southIndicesEastToWest:d,eastIndicesNorthToSouth:c,northIndicesWestToEast:u}}return n};var E=[];function y(e,t){var r,n=new Array(t),i=new Array(e),o=new Array(t),a=new Array(e);for(r=0;r<e;++r)a[r]=r,i[r]=e*t-1-r;for(r=0;r<t;++r)o[r]=(r+1)*e-1,n[r]=(t-r-1)*e;return{westIndicesSouthToNorth:n,southIndicesEastToWest:i,eastIndicesNorthToSouth:o,northIndicesWestToEast:a}}function w(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i,d=s+e,c=d+1,u=s+1;r[n++]=s,r[n++]=d,r[n++]=u,r[n++]=u,r[n++]=d,r[n++]=c,++i}++i}var h=(t-1)/2,l=(e-1)/2;i=0;for(a=0;a<l;a++)r[n++]=i,r[n++]=i+1,r[n++]=i+2,i+=2;i=e*(t-1);for(a=0;a<l;a++)r[n++]=i+1,r[n++]=i,r[n++]=i+2,i+=2;i=0;for(a=0;a<h;a++)r[n++]=i+e,r[n++]=i,r[n++]=i+2*e,i+=2*e;i=e-1;for(a=0;a<h;a++)r[n++]=i,r[n++]=i+e,r[n++]=i+2*e,i+=2*e}function N(e,t,r,n,i){for(var o=a.defined(i),s=e[0],d=e.length,c=1;c<d;++c){var u=e[c];!o||i[s+"_"+u]?(r[n++]=s,r[n++]=u,r[n++]=t,r[n++]=t,r[n++]=u,r[n++]=t+1,s=u,++t):(s=u,++t)}return n}T.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){var r=E[e];a.defined(r)||(E[e]=r=[]);var n=r[t];if(!a.defined(n)){var i=e*t,o=(e-1)*(t-1)*6,s=2*e+2*t,c=i+s,u=3*(e+t-2),h=o+6*Math.max(0,s-4)+u,l=y(e,t),I=l.westIndicesSouthToNorth,m=l.southIndicesEastToWest,g=l.eastIndicesNorthToSouth,f=l.northIndicesWestToEast,p=d.IndexDatatype.createTypedArray(c,h);w(e,t,p,0),T.addSkirtIndices(I,m,g,f,i,p,o+u),n=r[t]={indices:p,westIndicesSouthToNorth:I,southIndicesEastToWest:m,eastIndicesNorthToSouth:g,northIndicesWestToEast:f,indexCountWithoutSkirts:o}}return n},T.addSkirtIndices=function(e,t,r,n,i,o,a,s){var d=i;a=N(e,d,o,a,s),a=N(t,d+=e.length,o,a,s),a=N(r,d+=t.length,o,a,s),N(n,d+=r.length,o,a,s)},T.heightmapTerrainQuality=.25,T.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*T.heightmapTerrainQuality/(t*r)},T.prototype.requestTileGeometry=c.DeveloperError.throwInstantiationError,T.prototype.getLevelMaximumGeometricError=c.DeveloperError.throwInstantiationError,T.prototype.getTileDataAvailable=c.DeveloperError.throwInstantiationError,T.prototype.loadTileDataAvailability=c.DeveloperError.throwInstantiationError;var x=32767,M=new i.Cartesian3,C=new i.Cartesian3,b=new i.Cartesian3,S=new o.Cartographic,A=new n.Cartesian2,P=new i.Cartesian3,W=new n.Matrix4,_=new n.Matrix4;function F(e,t,r,o,a,s,d,u,h){var l=Number.POSITIVE_INFINITY,I=a.north,m=a.south,g=a.east,f=a.west;g<f&&(g+=c.CesiumMath.TWO_PI);for(var T=e.length,p=0;p<T;++p){var v=e[p],E=r[v],y=o[v];S.longitude=c.CesiumMath.lerp(f,g,y.x),S.latitude=c.CesiumMath.lerp(m,I,y.y),S.height=E-t;var w=s.cartographicToCartesian(S,M);n.Matrix4.multiplyByPoint(d,w,w),i.Cartesian3.minimumByComponent(w,u,u),i.Cartesian3.maximumByComponent(w,h,h),l=Math.min(l,S.height)}return l}function B(t,r,o,s,d,u,I,m,g,f,T,p,v,E,y){var w=a.defined(I),N=g.north,x=g.south,C=g.east,b=g.west;C<b&&(C+=c.CesiumMath.TWO_PI);for(var F=o.length,B=0;B<F;++B){var D=o[B],k=d[D],V=u[D];S.longitude=c.CesiumMath.lerp(b,C,V.x)+E,S.latitude=c.CesiumMath.lerp(x,N,V.y)+y,S.height=k-f;var O,Y=m.cartographicToCartesian(S,M);if(w){var G=2*D;if(A.x=I[G],A.y=I[G+1],1!==T){var H=e.AttributeCompression.octDecode(A.x,A.y,P),R=h.Transforms.eastNorthUpToFixedFrame(M,m,_),U=n.Matrix4.inverseTransformation(R,W);n.Matrix4.multiplyByPointAsVector(U,H,H),H.z*=T,i.Cartesian3.normalize(H,H),n.Matrix4.multiplyByPointAsVector(R,H,H),i.Cartesian3.normalize(H,H),e.AttributeCompression.octEncode(H,A)}}s.hasWebMercatorT&&(O=(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(S.latitude)-p)*v),r=s.encode(t,r,Y,V,S.height,A,O)}}function D(e,t){var r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),a.defined(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}return I((function(o,I){var m,g,f=o.quantizedVertices,p=f.length/3,v=o.octEncodedNormals,E=o.westIndices.length+o.eastIndices.length+o.southIndices.length+o.northIndices.length,y=o.includeWebMercatorT,w=r.Rectangle.clone(o.rectangle),N=w.west,k=w.south,V=w.east,O=w.north,Y=r.Ellipsoid.clone(o.ellipsoid),G=o.exaggeration,H=o.minimumHeight*G,R=o.maximumHeight*G,U=o.relativeToCenter,z=h.Transforms.eastNorthUpToFixedFrame(U,Y),L=n.Matrix4.inverseTransformation(z,new n.Matrix4);y&&(m=l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(k),g=1/(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(O)-m));var j=f.subarray(0,p),q=f.subarray(p,2*p),K=f.subarray(2*p,3*p),Q=a.defined(v),X=new Array(p),Z=new Array(p),J=new Array(p),$=y?new Array(p):[],ee=C;ee.x=Number.POSITIVE_INFINITY,ee.y=Number.POSITIVE_INFINITY,ee.z=Number.POSITIVE_INFINITY;var te=b;te.x=Number.NEGATIVE_INFINITY,te.y=Number.NEGATIVE_INFINITY,te.z=Number.NEGATIVE_INFINITY;for(var re=Number.POSITIVE_INFINITY,ne=Number.NEGATIVE_INFINITY,ie=Number.POSITIVE_INFINITY,oe=Number.NEGATIVE_INFINITY,ae=0;ae<p;++ae){var se=j[ae],de=q[ae],ce=se/x,ue=de/x,he=c.CesiumMath.lerp(H,R,K[ae]/x);S.longitude=c.CesiumMath.lerp(N,V,ce),S.latitude=c.CesiumMath.lerp(k,O,ue),S.height=he,re=Math.min(S.longitude,re),ne=Math.max(S.longitude,ne),ie=Math.min(S.latitude,ie),oe=Math.max(S.latitude,oe);var le=Y.cartographicToCartesian(S);X[ae]=new n.Cartesian2(ce,ue),Z[ae]=he,J[ae]=le,y&&($[ae]=(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(S.latitude)-m)*g),n.Matrix4.multiplyByPoint(L,le,M),i.Cartesian3.minimumByComponent(M,ee,ee),i.Cartesian3.maximumByComponent(M,te,te)}var Ie,me,ge,fe=D(o.westIndices,(function(e,t){return X[e].y-X[t].y})),Te=D(o.eastIndices,(function(e,t){return X[t].y-X[e].y})),pe=D(o.southIndices,(function(e,t){return X[t].x-X[e].x})),ve=D(o.northIndices,(function(e,t){return X[e].x-X[t].x}));me=r.BoundingSphere.fromPoints(J),Ie=u.OrientedBoundingBox.fromRectangle(w,H,R,Y),(1!==G||H<0)&&(ge=new s.EllipsoidalOccluder(Y).computeHorizonCullingPointPossiblyUnderEllipsoid(U,J,H));var Ee=H;Ee=Math.min(Ee,F(o.westIndices,o.westSkirtHeight,Z,X,w,Y,L,ee,te)),Ee=Math.min(Ee,F(o.southIndices,o.southSkirtHeight,Z,X,w,Y,L,ee,te)),Ee=Math.min(Ee,F(o.eastIndices,o.eastSkirtHeight,Z,X,w,Y,L,ee,te)),Ee=Math.min(Ee,F(o.northIndices,o.northSkirtHeight,Z,X,w,Y,L,ee,te));for(var ye=new t.AxisAlignedBoundingBox(ee,te,U),we=new s.TerrainEncoding(ye,Ee,R,z,Q,y),Ne=we.getStride(),xe=new Float32Array(p*Ne+E*Ne),Me=0,Ce=0;Ce<p;++Ce){if(Q){var be=2*Ce;if(A.x=v[be],A.y=v[be+1],1!==G){var Se=e.AttributeCompression.octDecode(A.x,A.y,P),Ae=h.Transforms.eastNorthUpToFixedFrame(J[Ce],Y,_),Pe=n.Matrix4.inverseTransformation(Ae,W);n.Matrix4.multiplyByPointAsVector(Pe,Se,Se),Se.z*=G,i.Cartesian3.normalize(Se,Se),n.Matrix4.multiplyByPointAsVector(Ae,Se,Se),i.Cartesian3.normalize(Se,Se),e.AttributeCompression.octEncode(Se,A)}}Me=we.encode(xe,Me,J[Ce],X[Ce],Z[Ce],A,$[Ce])}var We=Math.max(0,2*(E-4)),_e=o.indices.length+3*We,Fe=d.IndexDatatype.createTypedArray(p+E,_e);Fe.set(o.indices,0);var Be=1e-4,De=(ne-re)*Be,ke=(oe-ie)*Be,Ve=-De,Oe=De,Ye=ke,Ge=-ke,He=p*Ne;B(xe,He,fe,we,Z,X,v,Y,w,o.westSkirtHeight,G,m,g,Ve,0),B(xe,He+=o.westIndices.length*Ne,pe,we,Z,X,v,Y,w,o.southSkirtHeight,G,m,g,0,Ge),B(xe,He+=o.southIndices.length*Ne,Te,we,Z,X,v,Y,w,o.eastSkirtHeight,G,m,g,Oe,0),B(xe,He+=o.eastIndices.length*Ne,ve,we,Z,X,v,Y,w,o.northSkirtHeight,G,m,g,0,Ye);var Re=function(e,t,r,n){if(n<12)return;for(var i={},o=e.length,a=0;a<o;a+=3){var s=e[a],d=e[a+1],c=e[a+2];(t[s]===x&&t[d]===x||0===t[s]&&0===t[d]||r[s]===x&&r[d]===x||0===r[s]&&0===r[d])&&(i[s+"_"+d]=1,i[d+"_"+s]=1),(t[d]===x&&t[c]===x||0===t[d]&&0===t[c]||r[d]===x&&r[c]===x||0===r[d]&&0===r[c])&&(i[d+"_"+c]=1,i[c+"_"+d]=1),(t[c]===x&&t[s]===x||0===t[c]&&0===t[s]||r[c]===x&&r[s]===x||0===r[c]&&0===r[s])&&(i[c+"_"+s]=1,i[s+"_"+c]=1)}return i}(o.indices,j,q,o.level);return T.addSkirtIndices(fe,pe,Te,ve,p,Fe,o.indices.length,Re),I.push(xe.buffer,Fe.buffer),{vertices:xe.buffer,indices:Fe.buffer,westIndicesSouthToNorth:fe,southIndicesEastToWest:pe,eastIndicesNorthToSouth:Te,northIndicesWestToEast:ve,vertexStride:Ne,center:U,minimumHeight:H,maximumHeight:R,boundingSphere:me,orientedBoundingBox:Ie,occludeePointInScaledSpace:ge,encoding:we,indexCountWithoutSkirts:o.indices.length}}))}));
