define(["./createTaskProcessorWorker","./Math-3024ab74","./FeatureDetection-caf5f946","./when-b60132fc","./Cartesian2-c4c2a8f9","./Cartesian4-442405e6","./Color-276cc288","./S3MPixelFormat-b12ad0e9","./buildModuleUrl-c0836874","./pako_inflate-f73548c4","./unzip-7fd7fbf8","./arrayFill-1179ff06","./PixelFormat-4f95fc60","./WebGLConstants-aba9fc67","./Cartographic-2cfa3a3a","./IndexDatatype-a3f4b187","./PrimitiveType-ebb8c588","./BoundingRectangle-d0552dc9","./Buffer-f78085d8"],(function(e,t,r,n,a,i,o,s,E,y,f,u,p,d,c,l,A,T,v){"use strict";function m(e,t,n){if("function"==typeof e.slice)return e.slice(t,n);for(var a=Array.prototype.slice.call(e,t,n),i=r.FeatureDetection.typedArrayTypes,o=i.length,s=0;s<o;++s)if(e instanceof i[s]){a=new i[s](a);break}return a}var _,g=Object.freeze({SVC_Vertex:1,SVC_Normal:2,SVC_VertexColor:4,SVC_SecondColor:8,SVC_TexutreCoord:16,SVC_TexutreCoordIsW:32});function B(){}function b(e,t,a){var i,o=e.num_points(),s=a.num_components(),E=new _.AttributeQuantizationTransform;if(E.InitFromAttribute(a)){for(var y=new Array(s),f=0;f<s;++f)y[f]=E.min_value(f);i={quantizationBits:E.quantization_bits(),minValues:y,range:E.range(),octEncoded:!1}}_.destroy(E),(E=new _.AttributeOctahedronTransform).InitFromAttribute(a)&&(i={quantizationBits:E.quantization_bits(),octEncoded:!0}),_.destroy(E);var u,p=o*s;u=n.defined(i)?function(e,t,r,n,a){var i,o;n.quantizationBits<=8?(o=new _.DracoUInt8Array,i=new Uint8Array(a),t.GetAttributeUInt8ForAllPoints(e,r,o)):(o=new _.DracoUInt16Array,i=new Uint16Array(a),t.GetAttributeUInt16ForAllPoints(e,r,o));for(var s=0;s<a;++s)i[s]=o.GetValue(s);return _.destroy(o),i}(e,t,a,i,p):function(e,t,r,n){var a,i;switch(r.data_type()){case 1:case 11:i=new _.DracoInt8Array,a=new Int8Array(n),t.GetAttributeInt8ForAllPoints(e,r,i);break;case 2:i=new _.DracoUInt8Array,a=new Uint8Array(n),t.GetAttributeUInt8ForAllPoints(e,r,i);break;case 3:i=new _.DracoInt16Array,a=new Int16Array(n),t.GetAttributeInt16ForAllPoints(e,r,i);break;case 4:i=new _.DracoUInt16Array,a=new Uint16Array(n),t.GetAttributeUInt16ForAllPoints(e,r,i);break;case 5:case 7:i=new _.DracoInt32Array,a=new Int32Array(n),t.GetAttributeInt32ForAllPoints(e,r,i);break;case 6:case 8:i=new _.DracoUInt32Array,a=new Uint32Array(n),t.GetAttributeUInt32ForAllPoints(e,r,i);break;case 9:case 10:i=new _.DracoFloat32Array,a=new Float32Array(n),t.GetAttributeFloatForAllPoints(e,r,i)}for(var o=0;o<n;++o)a[o]=i.GetValue(o);return _.destroy(i),a}(e,t,a,p);var d=r.ComponentDatatype.fromTypedArray(u);return{array:u,data:{componentsPerAttribute:s,componentDatatype:d,byteOffset:a.byte_offset(),byteStride:r.ComponentDatatype.getSizeInBytes(d)*s,normalized:a.normalized(),quantization:i}}}function h(e,t,r,o){var s=r.vertexAttributes,E=r.attrLocation;if(r.nCompressOptions=0,n.defined(o.posUniqueID)&&o.posUniqueID>=0){r.nCompressOptions|=g.SVC_Vertex;var y=t.GetAttribute(e,o.posUniqueID),f=b(e,t,y),u=f.data.componentsPerAttribute;r.verticesCount=f.array.length/u,r.vertCompressConstant=f.data.quantization.range/(1<<f.data.quantization.quantizationBits);var p=f.data.quantization.minValues;r.minVerticesValue=new i.Cartesian4(p[0],p[1],p[2],1),u>3&&(r.minVerticesValue.w=p[3]),E.aPosition=s.length,s.push({index:E.aPosition,typedArray:f.array,componentsPerAttribute:u,componentDatatype:f.data.componentDatatype,offsetInBytes:f.data.byteOffset,strideInBytes:f.data.byteStride,normalize:f.data.normalized})}if(n.defined(o.normalUniqueID)&&o.normalUniqueID>=0){r.nCompressOptions|=g.SVC_Normal;var d=t.GetAttribute(e,o.normalUniqueID),c=b(e,t,d),l=c.data.quantization;r.normalRangeConstant=(1<<l.quantizationBits)-1,E.aNormal=s.length,s.push({index:E.aNormal,typedArray:c.array,componentsPerAttribute:c.data.componentsPerAttribute,componentDatatype:c.data.componentDatatype,offsetInBytes:c.data.byteOffset,strideInBytes:c.data.byteStride,normalize:c.data.normalized})}if(n.defined(o.colorUniqueID)&&o.colorUniqueID>=0){r.nCompressOptions|=g.SVC_VertexColor;var A=t.GetAttribute(e,o.colorUniqueID),T=b(e,t,A);E.aColor=s.length,s.push({index:E.aColor,typedArray:T.array,componentsPerAttribute:T.data.componentsPerAttribute,componentDatatype:T.data.componentDatatype,offsetInBytes:T.data.byteOffset,strideInBytes:T.data.byteStride,normalize:T.data.normalized})}for(var v=0;v<o.texCoordUniqueIDs.length;v++){r.texCoordCompressConstant=[],r.minTexCoordValue=[];var m=o.texCoordUniqueIDs[v];if(!(m<0)){var _=t.GetAttribute(e,m),B=b(e,t,_);if(n.defined(B.data.quantization)){r.nCompressOptions|=g.SVC_TexutreCoord,r.texCoordCompressConstant.push(B.data.quantization.range/(1<<B.data.quantization.quantizationBits));p=B.data.quantization.minValues;r.minTexCoordValue.push(new a.Cartesian2(p[0],p[1]))}var h="aTexCoord"+v;E[h]=s.length,s.push({index:E[h],typedArray:B.array,componentsPerAttribute:B.data.componentsPerAttribute,componentDatatype:B.data.componentDatatype,offsetInBytes:B.data.byteOffset,strideInBytes:B.data.byteStride,normalize:B.data.normalized})}}}B.dracoDecodePointCloud=function(e,t,r,n,a){for(var i=new(_=e).Decoder,o=["POSITION","NORMAL","COLOR"],s=0;s<o.length;++s)i.SkipAttributeTransform(_[o[s]]);var E=new _.DecoderBuffer;if(E.Init(t,r),i.GetEncodedGeometryType(E)!==_.POINT_CLOUD)throw new d.RuntimeError("Draco geometry type must be POINT_CLOUD.");var y=new _.PointCloud,f=i.DecodeBufferToPointCloud(E,y);if(!f.ok()||0===y.ptr)throw new d.RuntimeError("Error decoding draco point cloud: "+f.error_msg());_.destroy(E),h(y,i,n,a),_.destroy(y),_.destroy(i)},B.dracoDecodeMesh=function(e,t,r,n,a,i){for(var o=new(_=e).Decoder,s=["POSITION","NORMAL","COLOR","TEX_COORD"],E=0;E<s.length;++E)o.SkipAttributeTransform(_[s[E]]);var y=new _.DecoderBuffer;if(y.Init(t,r),o.GetEncodedGeometryType(y)!==_.TRIANGULAR_MESH)throw new d.RuntimeError("Unsupported draco mesh geometry type.");var f=new _.Mesh,u=o.DecodeBufferToMesh(y,f);if(!u.ok()||0===f.ptr)throw new d.RuntimeError("Error decoding draco mesh geometry: "+u.error_msg());_.destroy(y),h(f,o,n,i);var p=function(e,t){for(var r=e.num_points(),n=e.num_faces(),a=new _.DracoInt32Array,i=3*n,o=l.IndexDatatype.createTypedArray(r,i),s=0,E=0;E<n;++E)t.GetFaceFromMesh(e,E,a),o[s+0]=a.GetValue(0),o[s+1]=a.GetValue(1),o[s+2]=a.GetValue(2),s+=3;var y=l.IndexDatatype.UNSIGNED_SHORT;return o instanceof Uint32Array&&(y=l.IndexDatatype.UNSIGNED_INT),_.destroy(a),{typedArray:o,numberOfIndices:i,indexDataType:y}}(f,o);a.indicesTypedArray=p.typedArray,a.indicesCount=p.numberOfIndices,a.indexType=p.indexDataType,a.primitiveType=A.PrimitiveType.TRIANGLES,_.destroy(f),_.destroy(o)};var P=2,x=5,C=13;function L(){}function S(e){var t=new E.BoundingSphere,r=e.instanceBounds;if(!n.defined(r))return t;var a=new i.Cartesian3(r[0],r[1],r[2]),o=new i.Cartesian3(r[3],r[4],r[5]),s=i.Cartesian3.lerp(a,o,.5,new i.Cartesian3),y=i.Cartesian3.distance(s,a);return t.center=s,t.radius=y,t}function U(e){var t,r,a=new E.BoundingSphere,o=new i.Cartesian3,s=e.vertexAttributes[0],y=s.componentsPerAttribute,f=n.defined(e.nCompressOptions)&&(e.nCompressOptions&g.SVC_Vertex)===g.SVC_Vertex,u=1;f?(u=e.vertCompressConstant,t=new i.Cartesian3(e.minVerticesValue.x,e.minVerticesValue.y,e.minVerticesValue.z),r=new Uint16Array(s.typedArray.buffer,s.typedArray.byteOffset,s.typedArray.byteLength/2)):r=new Float32Array(s.typedArray.buffer,s.typedArray.byteOffset,s.typedArray.byteLength/4);for(var p=[],d=0;d<e.verticesCount;d++)i.Cartesian3.fromArray(r,y*d,o),f&&(o=i.Cartesian3.multiplyByScalar(o,u,o),o=i.Cartesian3.add(o,t,o)),p.push(i.Cartesian3.clone(o));return E.BoundingSphere.fromPoints(p,a),p.length=0,a}function N(e){var t,r,a=new E.BoundingSphere,o=new i.Cartesian3,s=n.defined(e.nCompressOptions)&&(e.nCompressOptions&g.SVC_Vertex)===g.SVC_Vertex,y=e.vertexAttributes[0],f=y.componentsPerAttribute,u=1;s?(u=e.vertCompressConstant,r=new i.Cartesian3(e.minVerticesValue.x,e.minVerticesValue.y,e.minVerticesValue.z),t=new Uint16Array(y.typedArray.buffer,y.typedArray.byteOffset,y.typedArray.byteLength/2)):t=new Float32Array(y.typedArray.buffer,y.typedArray.byteOffset,y.typedArray.byteLength/4);for(var p=[],d=0;d<e.verticesCount;d++)i.Cartesian3.fromArray(t,f*d,o),s&&(o=i.Cartesian3.multiplyByScalar(o,u,o),o=i.Cartesian3.add(o,r,o)),p.push(i.Cartesian3.clone(o));return E.BoundingSphere.fromPoints(p,a),p.length=0,a}function M(e){var t,r,a=n.defined(e.nCompressOptions)&&(e.nCompressOptions&g.SVC_Vertex)===g.SVC_Vertex,o=new E.BoundingSphere,s=new i.Cartesian3,y=new i.Cartesian3,f=e.vertexAttributes[0],u=f.componentsPerAttribute,p=e.attrLocation.aPosition,d=e.vertexAttributes[p],c=e.attrLocation.aTexCoord5,l=e.vertexAttributes[c],A=l.componentsPerAttribute;a?(u=3,A=3,t=R(e,d),r=function(e,t,r){for(var n,a,o,s=t.componentsPerAttribute,E=e.texCoordCompressConstant[r],y=new i.Cartesian4(e.minTexCoordValue[r].x,e.minTexCoordValue[r].y,e.minTexCoordValue[r].z,e.minTexCoordValue[r].w),f=new Uint16Array(t.typedArray.buffer,t.typedArray.byteOffset,t.typedArray.byteLength/2),u=new Float32Array(3*e.verticesCount),p=0;p<e.verticesCount;p++)n=f[s*p]*E+y.x,a=f[s*p+1]*E+y.y,o=f[s*p+2]*E+y.z,u[3*p]=n,u[3*p+1]=a,u[3*p+2]=o;return u}(e,l,5)):(t=new Float32Array(f.typedArray.buffer,f.typedArray.byteOffset,f.typedArray.byteLength/4),r=new Float32Array(l.typedArray.buffer,l.typedArray.byteOffset,l.typedArray.byteLength/4));for(var T=[],v=0;v<e.verticesCount;v++)i.Cartesian3.fromArray(t,u*v,s),i.Cartesian3.fromArray(r,A*v,y),i.Cartesian3.add(s,y,s),T.push(i.Cartesian3.clone(s));return E.BoundingSphere.fromPoints(T,o),T.length=0,o}function I(e){var t=A.PrimitiveType.TRIANGLES;switch(e){case 1:t=A.PrimitiveType.POINTS;break;case 2:t=A.PrimitiveType.LINES;break;case 3:t=A.PrimitiveType.LINE_STRIP;break;case 4:t=A.PrimitiveType.TRIANGLES}return t}function R(e,t){for(var r,n,a,o=t.componentsPerAttribute,s=e.vertCompressConstant,E=new i.Cartesian3(e.minVerticesValue.x,e.minVerticesValue.y,e.minVerticesValue.z),y=new Uint16Array(t.typedArray.buffer,t.typedArray.byteOffset,t.typedArray.byteLength/2),f=new Float32Array(3*e.verticesCount),u=0;u<e.verticesCount;u++)r=y[o*u]*s+E.x,n=y[o*u+1]*s+E.y,a=y[o*u+2]*s+E.z,f[3*u]=r,f[3*u+1]=n,f[3*u+2]=a;return f}function D(){}L.calcBoundingSphereInWorker=function(e,t){return t.instanceIndex>-1?S(t):n.defined(t.clampRegionEdge)?M(t):e>=P&&e<=x?N(t):e==C?M(t):U(t)},L.calcBoundingSphere=function(e,t,r){var a,i=e._fileType;return a=t.instanceIndex>-1?S(t):n.defined(t.clampRegionEdge)?M(t):i>=P&&i<=x?N(t):i==C?M(t):U(t),E.BoundingSphere.transform(a,r,a),a},L.calcBoundingRectangle=function(e,t){var r;return e._fileType===P&&(r=function(e){var t,r,o=n.defined(e.nCompressOptions)&&(e.nCompressOptions&g.SVC_Vertex)===g.SVC_Vertex,s=new T.BoundingRectangle,E=e.vertexAttributes[0],y=E.componentsPerAttribute,f=1;o?(f=e.vertCompressConstant,r=new i.Cartesian3(e.minVerticesValue.x,e.minVerticesValue.y,e.minVerticesValue.z),t=new Uint16Array(E.typedArray.buffer,E.typedArray.byteOffset,E.typedArray.byteLength/2)):t=new Float32Array(E.typedArray.buffer,E.typedArray.byteOffset,E.typedArray.byteLength/4);for(var u=[],p=0;p<e.verticesCount;p++){var d=t[y*p],c=t[y*p+1];o&&(d=f*d+r.x,c=f*c+r.y),u.push(new a.Cartesian2(d,c))}return T.BoundingRectangle.fromPoints(u,s),u.length=0,s}(t)),r},L.createEdge=function(e,t){if(!(t.length<1)){var a=function(e){for(var t=[],r=e.length,n=0;n<r;n++){var a=I(e[n].primitiveType);a!==A.PrimitiveType.LINES&&a!==A.PrimitiveType.LINE_STRIP||t.push(e[n])}return t}(t);if(0!=a.length){var o,s=function(e){for(var t=0,r=e.length,n=0;n<r;n++){var a=e[n],i=I(a.primitiveType);i==A.PrimitiveType.LINES?t+=a.indicesCount/2:i==A.PrimitiveType.LINE_STRIP&&t++}return t}(a),E=e.attrLocation.aPosition,y=e.vertexAttributes[E],f=n.defined(e.nCompressOptions)&&(e.nCompressOptions&g.SVC_Vertex)===g.SVC_Vertex,u=y.componentsPerAttribute;f?(u=3,o=R(e,y)):o=new Float32Array(y.typedArray.buffer,y.typedArray.byteOffset,y.typedArray.byteLength/4);for(var p=function(e){for(var t=0,r=e.length,n=0;n<r;n++)t+=e[n].indicesCount;return t}(a),d=function(e,t,r){for(var n,a=[],o=r.length,s=0;s<o;s++){var E,y=r[s];E=0===y.indexType?new Uint16Array(y.indicesTypedArray.buffer,y.indicesTypedArray.byteOffset,y.indicesTypedArray.byteLength/2):new Uint32Array(y.indicesTypedArray.buffer,y.indicesTypedArray.byteOffset,y.indicesTypedArray.byteLength/4);var f=I(y.primitiveType);if(f==A.PrimitiveType.LINES)for(n=0;n<y.indicesCount;n+=2){var u=[],p=new i.Cartesian3;p.x=e[E[n]*t],p.y=e[E[n]*t+1],p.z=e[E[n]*t+2],u.push(p);var d=new i.Cartesian3;d.x=e[E[n+1]*t],d.y=e[E[n+1]*t+1],d.z=e[E[n+1]*t+2],u.push(d),a.push(u)}else if(f==A.PrimitiveType.LINE_STRIP){for(u=[],n=0;n<y.indicesCount;n++){var c=new i.Cartesian3;c.x=e[E[n]*t],c.y=e[E[n]*t+1],c.z=e[E[n]*t+2],u.push(c)}a.push(u)}}return a}(o,u,a),c=4*p-4*s,l=new Float32Array(3*c),T=new Float32Array(3*c),v=new Float32Array(3*c),m=new Int8Array(2*c),_=0,B=0;B<s;B++){for(var b=d[B].length,h=0;h<b;h++){var P=4*_-4*B,x=3*P+12*h,C=d[B][h];0!=h&&(l[x-6]=C.x,l[x-5]=C.y,l[x-4]=C.z,l[x-3]=C.x,l[x-2]=C.y,l[x-1]=C.z),h!=b-1&&(l[x]=C.x,l[x+1]=C.y,l[x+2]=C.z,l[x+3]=C.x,l[x+4]=C.y,l[x+5]=C.z);var L=C;h+1<b&&(L=d[B][h+1]),0!=h&&(v[x-6]=L.x,v[x-5]=L.y,v[x-4]=L.z,v[x-3]=L.x,v[x-2]=L.y,v[x-1]=L.z),h!=b-1&&(v[x]=L.x,v[x+1]=L.y,v[x+2]=L.z,v[x+3]=L.x,v[x+4]=L.y,v[x+5]=L.z);var S=C;h>=1&&(S=d[B][h-1]),0!=h&&(T[x-6]=S.x,T[x-5]=S.y,T[x-4]=S.z,T[x-3]=S.x,T[x-2]=S.y,T[x-1]=S.z),h!=b-1&&(T[x]=S.x,T[x+1]=S.y,T[x+2]=S.z,T[x+3]=S.x,T[x+4]=S.y,T[x+5]=S.z),x=2*P+8*h,0!=h&&(m[x-4]=-1,m[x-3]=-1,m[x-2]=1,m[x-1]=-1),h!=b-1&&(m[x]=-1,m[x+1]=1,m[x+2]=1,m[x+3]=1)}_+=d[B].length}var U={vertexAttributes:[],attrLocation:{}},N=U.vertexAttributes,M=U.attrLocation;U.instanceCount=0,U.instanceMode=0,M.aPosition=0,N.push({index:M.aPosition,typedArray:l,componentsPerAttribute:3,componentDatatype:r.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:3*Float32Array.BYTES_PER_ELEMENT,normalize:!1}),M.aNormal=1,N.push({index:M.aNormal,typedArray:T,componentsPerAttribute:3,componentDatatype:r.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:3*Float32Array.BYTES_PER_ELEMENT,normalize:!1}),M.aTexCoord0=2,N.push({index:M.aTexCoord0,typedArray:v,componentsPerAttribute:3,componentDatatype:r.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:3*Float32Array.BYTES_PER_ELEMENT,normalize:!1}),M.aTexCoord1=3,N.push({index:M.aTexCoord1,typedArray:m,componentsPerAttribute:2,componentDatatype:r.ComponentDatatype.BYTE,offsetInBytes:0,strideInBytes:2*Int8Array.BYTES_PER_ELEMENT,normalize:!1});for(var D=[],w=0;w<d.length;w++)D.push(d[w].length);var F=function(e,t,r,n){var a,i={};i.indicesCount=6*(e-t),i.indexType=n>65535?1:0,i.primitiveType=A.PrimitiveType.TRIANGLES,a=0===i.indexType?new Uint16Array(i.indicesCount):new Uint32Array(i.indicesCount);for(var o=0,s=0;s<t;s++){for(var E=0;E<r[s]-1;E++)a[6*(o-s+E)]=4*(o-s+E),a[6*(o-s+E)+1]=4*(o-s+E)+2,a[6*(o-s+E)+2]=4*(o-s+E)+1,a[6*(o-s+E)+3]=4*(o-s+E)+1,a[6*(o-s+E)+4]=4*(o-s+E)+2,a[6*(o-s+E)+5]=4*(o-s+E)+3;o+=r[s]}return i.indicesTypedArray=a,i}(p,s,D,c);return{vertexPackage:U,indexPackage:F}}}},D.computeNeighbors=function(e,t){for(var r=e.length/3,n=new Uint32Array(t+1),a=new Uint32Array(t+1),i=function(e,t){e<t?n[e+1]++:a[t+1]++},o=0;o<r;o++){var s=e[3*o],E=e[3*o+1],y=e[3*o+2];i(s,E),i(E,y),i(y,s)}for(o=E=s=0;o<t;o++)y=n[o+1],i=a[o+1],n[o+1]=s,a[o+1]=E,s+=y,E+=i;var f=new Uint32Array(6*r),u=n[t];for(i=function(e,t,r){if(e<t){var i=n[e+1]++;f[2*i]=t,f[2*i+1]=r}else i=a[t+1]++,f[2*u+2*i]=e,f[2*u+2*i+1]=r},o=0;o<r;o++)s=e[3*o],E=e[3*o+1],y=e[3*o+2],i(s,E,o),i(E,y,o),i(y,s,o);for(s=function(e,t){var r=2*e;for(e=t-e,t=1;t<e;t++){for(var n=f[r+2*t],a=f[r+2*t+1],i=t-1;0<=i&&f[r+2*i]>n;i--)f[r+2*i+2]=f[r+2*i],f[r+2*i+3]=f[r+2*i+1];f[r+2*i+2]=n,f[r+2*i+3]=a}},o=0;o<t;o++)s(n[o],n[o+1]),s(u+a[o],u+a[o+1]);var p=new Int32Array(3*r),d=function(t,r){return t===e[3*r]?0:t===e[3*r+1]?1:t===e[3*r+2]?2:-1};for(r=function(e,t){e=d(e,t),p[3*t+e]=-1},s=function(e,t,r,n){e=d(e,t),p[3*t+e]=n,r=d(r,n),p[3*n+r]=t},o=0;o<t;o++){E=n[o],y=n[o+1],i=a[o];for(var c=a[o+1];E<y&&i<c;){var l=f[2*E],A=f[2*u+2*i];l===A?(s(o,f[2*E+1],A,f[2*u+2*i+1]),E++,i++):l<A?(r(o,f[2*E+1]),E++):(r(A,f[2*u+2*i+1]),i++)}for(;E<y;)r(o,f[2*E+1]),E++;for(;i<c;)r(A=f[2*u+2*i],f[2*u+2*i+1]),i++}return p};var w=null;function F(){}function Y(e){return e*Math.PI/180}D.deduplicate=function(e,t,r,n,a){void 0===r&&(r=0),void 0===n&&(n=0),void 0===a&&(a=e.byteLength/(4*t)),e=new Uint32Array(e,n,a*t),n=new Uint32Array(a);var i=Math.floor(1.1*a)+1;(null==w||w.length<2*i)&&(w=new Uint32Array(function(e){--e;for(var t=1;32>t;t<<=1)e|=e>>t;return e+1}(2*i)));for(var o=0;o<2*i;o++)w[o]=0;var s=0,E=0!==r?Math.ceil(7.84*1.96/(r*r)*r*(1-r)):a;for(o=0;o<a;o++){if(o===E){if((f=1-s/o)+1.96*Math.sqrt(f*(1-f)/o)<r)return null;E*=2}for(var y,f=o*t,u=y=0;u<t;u++)y=(y=e[f+u]+y|0)+(y<<11)+(y>>>2)|0;u=(y>>>=0)%i;for(var p=s;0!==w[2*u+1];){if(w[2*u]===y){var d=w[2*u+1]-1,c=d*t;e:{for(var l=0;l<t;l++)if(e[f+l]!==e[c+l]){c=!1;break e}c=!0}if(c){p=n[d];break}}++u>=i&&(u-=i)}p===s&&(w[2*u]=y,w[2*u+1]=o+1,s++),n[o]=p}if(0!==r&&1-s/a<r)return null;for(r=new Uint32Array(t*s),o=s=0;o<a;o++)if(n[o]===s){for(i=e,E=o*t,f=r,y=s*t,u=t,p=0;p<u;p++)f[y+p]=i[E+p];s++}return{buffer:r.buffer,indices:n,uniqueCount:s}};var O=Y(4),z=Y(35),V=Math.cos(z),k=Math.cos(O);var q={position0:new i.Cartesian3,position1:new i.Cartesian3,faceNormal0:new i.Cartesian3,faceNormal1:new i.Cartesian3,cosAngle:0},G=new i.Cartesian3,H=new i.Cartesian3;function W(e,t){var r,n=(r=e.cosAngle,Math.acos(1<r?1:-1>r?-1:r));return function(e,t,r){var n=r.x-t.x,a=r.y-t.y;(r=n*n+a*a+(t=r.z-t.z)*t)?(r=1/Math.sqrt(r),e.x=n*r,e.y=a*r,e.z=t*r):(e.x=0,e.y=0,e.z=0)}(H,e.position1,e.position0),i.Cartesian3.cross(e.faceNormal0,e.faceNormal1,G),n*(0<i.Cartesian3.dot(G,H)?-1:1)>t}var X=new i.Cartesian3,Z=new i.Cartesian3,j=new i.Cartesian3;function J(e){var t=e.x*e.x+e.y*e.y+e.z*e.z;t>0&&(t=1/Math.sqrt(t),e.x*=t,e.y*=t,e.z*=t)}function Q(e){}function K(e){if(n.defined(e.cachedSidenessVertexBuffer))return e.cachedSidenessVertexBuffer;var t=new Float32Array(8),r=0;return t[r++]=0,t[r++]=0,t[r++]=0,t[r++]=1,t[r++]=1,t[r++]=1,t[r++]=1,t[r++]=0,e.cachedSidenessVertexBuffer=v.Buffer.createVertexBuffer({context:e,typedArray:t,usage:v.BufferUsage.STATIC_DRAW}),e.cachedSidenessVertexBuffer.vertexArrayDestroyable=!1,e.cachedSidenessVertexBuffer}function $(e,t){for(var r,n,a,o=t.componentsPerAttribute,s=e.vertCompressConstant,E=new i.Cartesian3(e.minVerticesValue.x,e.minVerticesValue.y,e.minVerticesValue.z),y=new Uint16Array(t.typedArray.buffer,t.typedArray.byteOffset,t.typedArray.byteLength/2),f=new Float32Array(3*e.verticesCount),u=0;u<e.verticesCount;u++)r=y[o*u]*s+E.x,n=y[o*u+1]*s+E.y,a=y[o*u+2]*s+E.z,f[3*u]=r,f[3*u+1]=n,f[3*u+2]=a;return f}F.extractEdges=function(e){var t=e.vertices,r=e.dim,n=q,a=n.position0,o=n.position1,s=n.faceNormal0,E=n.faceNormal1,y=function(e){for(var t=e.faces.length/3,r=e.vertices,n=e.dim,a=e.faces,o=new Float32Array(3*t),s=0;s<t;s++){var E=a[3*s+0],y=a[3*s+1],f=a[3*s+2];X.x=r[n*E],X.y=r[n*E+1],X.z=r[n*E+2],Z.x=r[n*y],Z.y=r[n*y+1],Z.z=r[n*y+2],j.x=r[n*f],j.y=r[n*f+1],j.z=r[n*f+2],i.Cartesian3.subtract(Z,X,Z),i.Cartesian3.subtract(j,X,j),i.Cartesian3.cross(Z,j,X),J(X),o[3*s+0]=X.x,o[3*s+1]=X.y,o[3*s+2]=X.z}return o}(e),f=function(e){var t=e.faces.length/3,r=e.faces,n=e.neighbors,a=0,i=0;for(i=0;i<t;i++){var o=n[3*i+0],s=n[3*i+1],E=n[3*i+2],y=r[3*i+0],f=r[3*i+1],u=r[3*i+2];a+=-1===o||y<f?1:0,a+=-1===s||f<u?1:0,a+=-1===E||u<y?1:0}var p=new Int32Array(4*a),d=0;for(i=0;i<t;i++)o=n[3*i+0],s=n[3*i+1],E=n[3*i+2],y=r[3*i+0],f=r[3*i+1],u=r[3*i+2],(-1===o||y<f)&&(p[d++]=y,p[d++]=f,p[d++]=i,p[d++]=o),(-1===s||f<u)&&(p[d++]=f,p[d++]=u,p[d++]=i,p[d++]=s),(-1===E||u<y)&&(p[d++]=u,p[d++]=y,p[d++]=i,p[d++]=E);return p}(e),u=f.length/4,p=new Float32Array(9*u),d=0,c=new Float32Array(12*u),l=0,A=0,T=0,v=function(e,t){0===t&&(t=e,e=0);for(var r=Array(t-e),n=e;n<t;n++)r[n-e]=n;return r}(0,u),m=new Float32Array(u);m.forEach((function(e,n,s){var E=f[4*n+0],y=f[4*n+1];a.x=t[E*r],a.y=t[E*r+1],a.z=t[E*r+2],o.x=t[y*r],o.y=t[y*r+1],o.z=t[y*r+2],s[n]=i.Cartesian3.distance(a,o)})),v.sort((function(e,t){return m[t]-m[e]}));for(var _=[],g=[],B=0;B<u;B++){var b=v[B],h=m[b],P=f[4*b+0],x=f[4*b+1],C=f[4*b+2],L=f[4*b+3],S=-1===L;if(a.x=t[P*r],a.y=t[P*r+1],a.z=t[P*r+2],o.x=t[x*r],o.y=t[x*r+1],o.z=t[x*r+2],S)s.x=y[3*C],s.y=y[3*C+1],s.z=y[3*C+2],E.x=s.x,E.y=s.y,E.z=s.z,n.cosAngle=i.Cartesian3.dot(s,E);else if(s.x=y[3*C],s.y=y[3*C+1],s.z=y[3*C+2],E.x=y[3*L],E.y=y[3*L+1],E.z=y[3*L+2],n.cosAngle=i.Cartesian3.dot(s,E),n.cosAngle>k)continue;A+=h,T++,S||n.cosAngle<V?(p[d++]=n.position0.x,p[d++]=n.position0.y,p[d++]=n.position0.z,p[d++]=n.position1.x,p[d++]=n.position1.y,p[d++]=n.position1.z,p[d++]=n.faceNormal0.x,p[d++]=n.faceNormal0.y,p[d++]=n.faceNormal0.z,_.push(h)):W(n,O)&&(c[l++]=n.position0.x,c[l++]=n.position0.y,c[l++]=n.position0.z,c[l++]=n.position1.x,c[l++]=n.position1.y,c[l++]=n.position1.z,c[l++]=n.faceNormal0.x,c[l++]=n.faceNormal0.y,c[l++]=n.faceNormal0.z,c[l++]=n.faceNormal1.x,c[l++]=n.faceNormal1.y,c[l++]=n.faceNormal1.z,g.push(h))}p=p.slice(0,d),c=c.slice(0,l);var U=A/T,N=_.length,M=g.length;return{regular:{instancesData:p,instanceCount:N,edgeLength:N*U},silhouette:{instancesData:c,instanceCount:M,edgeLength:M*U},averageEdgeLength:U}},Q.RegularInstanceStride=11,Q.createEdgeData=function(e,t,r){if(0==t.length)return null;var a,i=t[0];a=0===i.indexType?new Uint16Array(i.indicesTypedArray.buffer,i.indicesTypedArray.byteOffset,i.indicesTypedArray.byteLength/2):new Uint32Array(i.indicesTypedArray.buffer,i.indicesTypedArray.byteOffset,i.indicesTypedArray.byteLength/4);var o=Q.extractEdgeInformation(e,!1,a),s=F.extractEdges(o);return n.defined(r)&&(n.defined(s.regular.instancesData)&&r.push(s.regular.instancesData.buffer),n.defined(s.silhouette.instancesData)&&r.push(s.silhouette.instancesData.buffer)),s},Q.createIndexBuffer=function(e){return n.defined(e.cachedSidenessIndexBuffer)||(e.cachedSidenessIndexBuffer=v.Buffer.createIndexBuffer({context:e,typedArray:(t=new Uint16Array(6),r=0,t[r++]=2,t[r++]=1,t[r++]=0,t[r++]=3,t[r++]=2,t[r++]=0,t),usage:v.BufferUsage.STATIC_DRAW,indexDatatype:l.IndexDatatype.UNSIGNED_SHORT}),e.cachedSidenessIndexBuffer.vertexArrayDestroyable=!1),e.cachedSidenessIndexBuffer;var t,r},Q.createRegularEdgeAttributes=function(e,t){if(n.defined(t.instancesData)&&0!=t.instancesData.length){var a={},i=[];t.attributeLocations=a,t.attributes=i;var o=v.Buffer.createVertexBuffer({context:e,typedArray:t.instancesData,usage:v.BufferUsage.STATIC_DRAW});t.instancesData=null;var s=r.ComponentDatatype.getSizeInBytes(r.ComponentDatatype.FLOAT),E=K(e),y=0;a.aSideness=y++,i.push({index:a.aSideness,vertexBuffer:E,componentsPerAttribute:2,componentDatatype:r.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:2*r.ComponentDatatype.getSizeInBytes(r.ComponentDatatype.FLOAT),normalize:!1});var f=Q.RegularInstanceStride,u=0;a.aPosition0=y++,i.push({index:a.aPosition0,vertexBuffer:o,componentsPerAttribute:3,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:s*u,strideInBytes:s*f,instanceDivisor:1}),u+=3,a.aPosition1=y++,i.push({index:a.aPosition1,vertexBuffer:o,componentsPerAttribute:3,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:s*u,strideInBytes:s*f,instanceDivisor:1}),u+=3,a.aNormal=y++,i.push({index:a.aNormal,vertexBuffer:o,componentsPerAttribute:3,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!0,offsetInBytes:s*u,strideInBytes:s*f,instanceDivisor:1}),u+=3,a.aVariantStroke=y++,i.push({index:a.aVariantStroke,vertexBuffer:o,componentsPerAttribute:1,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!0,offsetInBytes:s*u,strideInBytes:s*f,instanceDivisor:1}),u+=1,a.aVariantExtension=y++,i.push({index:a.aVariantExtension,vertexBuffer:o,componentsPerAttribute:1,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!0,offsetInBytes:s*u,strideInBytes:s*f,instanceDivisor:1}),u+=1}},Q.createSilhouetteEdgeAttributes=function(e,t){if(n.defined(t.instancesData)&&0!=t.instancesData.length){var a={},i=[];t.attributeLocations=a,t.attributes=i;var o=v.Buffer.createVertexBuffer({context:e,typedArray:t.instancesData,usage:v.BufferUsage.STATIC_DRAW});t.instancesData=null;var s=r.ComponentDatatype.getSizeInBytes(r.ComponentDatatype.FLOAT),E=0;a.aSideness=E++,i.push({index:a.aSideness,vertexBuffer:K(e),componentsPerAttribute:2,componentDatatype:r.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:2*s,normalize:!1});var y=14,f=0;a.aPosition0=E++,i.push({index:a.aPosition0,vertexBuffer:o,componentsPerAttribute:3,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:s*f,strideInBytes:s*y,instanceDivisor:1}),f+=3,a.aPosition1=E++,i.push({index:a.aPosition1,vertexBuffer:o,componentsPerAttribute:3,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:s*f,strideInBytes:s*y,instanceDivisor:1}),f+=3,a.aNormalA=E++,i.push({index:a.aNormalA,vertexBuffer:o,componentsPerAttribute:3,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!0,offsetInBytes:s*f,strideInBytes:s*y,instanceDivisor:1}),f+=3,a.aNormalB=E++,i.push({index:a.aNormalB,vertexBuffer:o,componentsPerAttribute:3,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!0,offsetInBytes:s*f,strideInBytes:s*y,instanceDivisor:1}),f+=3,a.aVariantStroke=E++,i.push({index:a.aVariantStroke,vertexBuffer:o,componentsPerAttribute:1,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!0,offsetInBytes:s*f,strideInBytes:s*y,instanceDivisor:1}),f+=1,a.aVariantExtension=E++,i.push({index:a.aVariantExtension,vertexBuffer:o,componentsPerAttribute:1,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!0,offsetInBytes:s*f,strideInBytes:s*y,instanceDivisor:1}),f+=1}},Q.extractEdgeInformation=function(e,t,r){var a,i=e.attrLocation.aPosition,o=e.vertexAttributes[i],s=n.defined(e.nCompressOptions)&&(e.nCompressOptions&g.SVC_Vertex)===g.SVC_Vertex,E=o.componentsPerAttribute;s?(E=3,a=$(e,o)):a=new Float32Array(o.typedArray.buffer,o.typedArray.byteOffset,o.typedArray.byteLength/4);var y=a.length/E;if(t&&r)return{faces:r,neighbors:D.computeNeighbors(r,y),vertices:a,dim:E};var f,u=o.typedArray.buffer;f=s?a.buffer:u.slice(o.typedArray.byteOffset,o.typedArray.byteOffset+o.typedArray.byteLength);var p=D.deduplicate(f,E),d=Q.selectIndexData(p.indices,r);return{faces:d,neighbors:D.computeNeighbors(d,p.uniqueCount),vertices:new Float32Array(p.buffer),dim:E}},Q.selectIndexData=function(e,t){if(t){t=t.slice();for(var r=0;r<t.length;r++)t[r]=e[t[r]];return t}return e};var ee=new i.Cartesian3,te=new i.Cartesian3,re=new i.Cartesian3,ne=new i.Cartesian3,ae=new i.Cartesian3,ie=new i.Cartesian3,oe=new i.Cartesian3,se=new i.Cartesian3;function Ee(e,t){function r(e,t,r){var n=48217*e%2147483647,a=t+n/2147483647*(r-=t);return{seed:n,result:Math.round(a)}}var a=function(e,t){var r=new Float32Array(6),n=new Uint32Array(r.buffer),a=new Uint32Array(1);r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=t.x,r[4]=t.y,r[5]=t.z,a[0]=5381;for(var i=0;i<n.length;i++)a[0]=31*a[0]+n[i];return a[0]}(e,t);n.defined(a)||(a=2147483647*Math.random());var i=r(a,0,255);a=i.seed,i.result,a=(i=r(a,0,5)).seed;var o=i.result;i=function(e){var t=48217*e%2147483647;return{seed:t,result:t/2147483646}}(a),a=i.seed;var s=i.result;return s=-(1-Math.min(s/.7,1))+Math.max(0,s-.7)/(1-.7),{variantStroke:o,variantExtension:s=255*(Math.abs(s)**1.2*(0>s?-1:1)*.5+.5)}}Q.createEdgeDataByIndices=function(e,t){var r,a,o=e.attrLocation.aPosition,s=e.vertexAttributes[o],E=n.defined(e.nCompressOptions)&&(e.nCompressOptions&g.SVC_Vertex)===g.SVC_Vertex,y=s.componentsPerAttribute;E?(y=3,r=$(e,s)):r=new Float32Array(s.typedArray.buffer,s.typedArray.byteOffset,s.typedArray.byteLength/4);for(var f=[],u=[],p=(a=0===t.indexType?new Uint16Array(t.indicesTypedArray.buffer,t.indicesTypedArray.byteOffset,t.indicesTypedArray.byteLength/2):new Uint32Array(t.indicesTypedArray.buffer,t.indicesTypedArray.byteOffset,t.indicesTypedArray.byteLength/4)).length,d=0,c=0,l=4*Math.floor(p/4);c<l;c+=4){var A=a[c],T=a[c+1],v=a[c+2],m=a[c+3];if(ee.x=r[y*A],ee.y=r[y*A+1],ee.z=r[y*A+2],te.x=r[y*T],te.y=r[y*T+1],te.z=r[y*T+2],re.x=r[y*v],re.y=r[y*v+1],re.z=r[y*v+2],ne.x=r[y*m],ne.y=r[y*m+1],ne.z=r[y*m+2],!(i.Cartesian3.equals(te,re)||i.Cartesian3.equals(te,ne)||i.Cartesian3.equals(te,ee)||i.Cartesian3.equals(re,ee)||i.Cartesian3.equals(ne,ee))){if(v===m){if(i.Cartesian3.subtract(te,ee,ae),i.Cartesian3.subtract(re,ee,ie),i.Cartesian3.cross(ae,ie,ae),i.Cartesian3.equals(ae,i.Cartesian3.ZERO))continue;i.Cartesian3.normalize(ae,ae),f.push(ee.x),f.push(ee.y),f.push(ee.z),f.push(te.x),f.push(te.y),f.push(te.z),f.push(ae.x),f.push(ae.y),f.push(ae.z);var _=(b=Ee(ee,te)).variantStroke,B=b.variantExtension;f.push(_),f.push(B)}else{if(i.Cartesian3.subtract(te,ee,ae),i.Cartesian3.subtract(re,ee,ie),i.Cartesian3.cross(ae,ie,ae),i.Cartesian3.equals(ae,i.Cartesian3.ZERO))continue;if(i.Cartesian3.normalize(ae,ae),i.Cartesian3.subtract(te,ee,oe),i.Cartesian3.subtract(ne,ee,se),i.Cartesian3.cross(oe,se,oe),i.Cartesian3.equals(oe,i.Cartesian3.ZERO))continue;i.Cartesian3.normalize(oe,oe),u.push(ee.x),u.push(ee.y),u.push(ee.z),u.push(te.x),u.push(te.y),u.push(te.z),u.push(ae.x),u.push(ae.y),u.push(ae.z),u.push(oe.x),u.push(oe.y),u.push(oe.z);var b;_=(b=Ee(ee,te)).variantStroke,B=b.variantExtension;u.push(_),u.push(B)}d+=i.Cartesian3.distance(ee,te)}}var h=d/(p/4),P=f.length/Q.RegularInstanceStride,x=u.length/12;return{regular:{instancesData:new Float32Array(f),instanceCount:P,edgeLength:P*h},silhouette:{instancesData:new Float32Array(u),instanceCount:x,edgeLength:x},averageEdgeLength:h}};var ye,fe,ue=1,pe=14,de=1,ce=2,le={};le[0]=p.PixelFormat.RGB_DXT1,le[de]=p.PixelFormat.RGBA_DXT3,le[ce]=p.PixelFormat.RGBA_DXT5;var Ae,Te=0,ve=!1;function me(e,t){var r=e.data,a=r.byteLength,i=new Uint8Array(r),o=Ae._malloc(a);!function(e,t,r,n){var a,i=r/4,o=n%4,s=new Uint32Array(e.buffer,0,(n-o)/4),E=new Uint32Array(t.buffer);for(a=0;a<s.length;a++)E[i+a]=s[a];for(a=n-o;a<n;a++)t[r+a]=e[a]}(i,Ae.HEAPU8,o,a);var s=Ae._crn_get_dxt_format(o,a),E=le[s];if(!n.defined(E))throw new d.RuntimeError("Unsupported compressed format.");var y,f=Ae._crn_get_levels(o,a),u=Ae._crn_get_width(o,a),c=Ae._crn_get_height(o,a),l=0;for(y=0;y<f;++y)l+=p.PixelFormat.compressedTextureSizeInBytes(E,u>>y,c>>y);if(Te<l&&(n.defined(ye)&&Ae._free(ye),ye=Ae._malloc(l),fe=new Uint8Array(Ae.HEAPU8.buffer,ye,l),Te=l),Ae._crn_decompress(o,a,ye,l,0,f),Ae._free(o),n.defaultValue(e.bMipMap,!1)){var A=fe.slice(0,l);return t.push(A.buffer),new p.CompressedTextureBuffer(E,u,c,A)}var T=p.PixelFormat.compressedTextureSizeInBytes(E,u,c),v=fe.subarray(0,T),m=new Uint8Array(T);return m.set(v,0),t.push(m.buffer),new p.CompressedTextureBuffer(E,u,c,m)}var _e,ge=1,Be=1,be=2,he=3,Pe=new o.Color,xe=!1;if(n.defined(f.unzip)){f.unzip.onRuntimeInitialized=function(){xe=!0};var Ce=f.unzip.cwrap("unzip","number",["number","number","number","number"]),Le=f.unzip.cwrap("freePointer",null,["number"])}function Se(e,t,r,n,a,i){this.left=e,this.bottom=t,this.right=r,this.top=n,this.minHeight=a,this.maxHeight=i,this.width=r-e,this.length=n-t,this.height=i-a}function Ue(e,t,r){var n=r,a=e.getUint32(n,!0),i=n+=Uint32Array.BYTES_PER_ELEMENT,o=new Uint8Array(t,n,a);return{dataViewByteOffset:i,byteOffset:n+=a*Uint8Array.BYTES_PER_ELEMENT,buffer:o}}function Ne(e,t,r,n){var a=e.getUint32(n+t,!0);n+=Uint32Array.BYTES_PER_ELEMENT;var i=r.subarray(n,n+a);return{string:s.getStringFromTypedArray(i),bytesOffset:n+=a}}function Me(e,t,n,a,i,o){var s=n,E=e.getUint16(n+a,!0);s+=Uint16Array.BYTES_PER_ELEMENT,o||(s+=Uint16Array.BYTES_PER_ELEMENT);for(var y=0;y<E;y++){var f=e.getUint32(s+a,!0);s+=Uint32Array.BYTES_PER_ELEMENT;var u=e.getUint16(s+a,!0);if(s+=Uint16Array.BYTES_PER_ELEMENT,e.getUint16(s+a,!0),s+=Uint16Array.BYTES_PER_ELEMENT,20==u||35==u);else{var p=f*u*Float32Array.BYTES_PER_ELEMENT,d=t.subarray(s,s+p);s+=p;var c="aTexCoord"+y,l=i.vertexAttributes,A=i.attrLocation;A[c]=l.length,l.push({index:A[c],typedArray:d,componentsPerAttribute:u,componentDatatype:r.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:u*Float32Array.BYTES_PER_ELEMENT,normalize:!1})}}return{bytesOffset:s}}function Ie(e,t,n,a,i){var o=n,s=e.getUint16(o+a,!0);o+=Uint16Array.BYTES_PER_ELEMENT,o+=Uint16Array.BYTES_PER_ELEMENT;for(var E=i.vertexAttributes,y=i.attrLocation,f=0;f<s;f++){var u=e.getUint32(o+a,!0);o+=Uint32Array.BYTES_PER_ELEMENT;var p=e.getUint16(o+a,!0);if(o+=Uint16Array.BYTES_PER_ELEMENT,16===p){o-=Uint16Array.BYTES_PER_ELEMENT;var d=u*(p*Float32Array.BYTES_PER_ELEMENT+Uint16Array.BYTES_PER_ELEMENT),c=t.subarray(o,o+d);o+=d;var l=new Uint8Array(Float32Array.BYTES_PER_ELEMENT*p*u);i.instanceCount=u,i.instanceMode=p,i.instanceBuffer=l,i.instanceIndex=1;for(var A=Float32Array.BYTES_PER_ELEMENT*p+Uint16Array.BYTES_PER_ELEMENT,T=0;T<u;T++){var v=T*A+Uint16Array.BYTES_PER_ELEMENT,m=c.subarray(v,v+A);l.set(m,T*(A-Uint16Array.BYTES_PER_ELEMENT))}_=16*Float32Array.BYTES_PER_ELEMENT,y.uv2=E.length,E.push({index:y.uv2,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:_,instanceDivisor:1}),y.uv3=E.length,E.push({index:y.uv3,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:_,instanceDivisor:1}),y.uv4=E.length,E.push({index:y.uv4,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:_,instanceDivisor:1}),y.secondary_colour=E.length,E.push({index:y.secondary_colour,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:_,instanceDivisor:1})}else{e.getUint16(o+a,!0),o+=Uint16Array.BYTES_PER_ELEMENT;d=u*p*Float32Array.BYTES_PER_ELEMENT;if(17===p||29===p){var _;l=t.subarray(o,o+d);i.instanceCount=u,i.instanceMode=p,i.instanceBuffer=l,i.instanceIndex=1,17===p?(_=17*Float32Array.BYTES_PER_ELEMENT,y.uv2=E.length,E.push({index:y.uv2,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:_,instanceDivisor:1}),y.uv3=E.length,E.push({index:y.uv3,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:_,instanceDivisor:1}),y.uv4=E.length,E.push({index:y.uv4,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:_,instanceDivisor:1}),y.secondary_colour=E.length,E.push({index:y.secondary_colour,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:_,instanceDivisor:1}),y.uv6=E.length,E.push({index:y.uv6,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.UNSIGNED_BYTE,normalize:!0,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:_,instanceDivisor:1})):29===p&&(_=29*Float32Array.BYTES_PER_ELEMENT,y.uv1=E.length,E.push({index:y.uv1,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:_,instanceDivisor:1,byteLength:d}),y.uv2=E.length,E.push({index:y.uv2,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:_,instanceDivisor:1}),y.uv3=E.length,E.push({index:y.uv3,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:_,instanceDivisor:1}),y.uv4=E.length,E.push({index:y.uv4,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:_,instanceDivisor:1}),y.uv5=E.length,E.push({index:y.uv5,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:_,instanceDivisor:1}),y.uv6=E.length,E.push({index:y.uv6,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:20*Float32Array.BYTES_PER_ELEMENT,strideInBytes:_,instanceDivisor:1}),y.uv7=E.length,E.push({index:y.uv7,componentsPerAttribute:3,componentDatatype:r.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:24*Float32Array.BYTES_PER_ELEMENT,strideInBytes:_,instanceDivisor:1}),y.secondary_colour=E.length,E.push({index:y.secondary_colour,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.UNSIGNED_BYTE,normalize:!0,offsetInBytes:27*Float32Array.BYTES_PER_ELEMENT,strideInBytes:_,instanceDivisor:1}),y.uv9=E.length,E.push({index:y.uv9,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.UNSIGNED_BYTE,normalize:!0,offsetInBytes:28*Float32Array.BYTES_PER_ELEMENT,strideInBytes:_,instanceDivisor:1}))}else{var g=u*p;i.instanceBounds=new Float32Array(g);for(var B=0;B<g;B++)i.instanceBounds[B]=e.getFloat32(o+a+B*Float32Array.BYTES_PER_ELEMENT,!0)}o+=d}}return{bytesOffset:o}}function Re(e,t,o,s,E,y){var f=s,u=t.getUint32(f+o,!0);if(E.verticesCount=u,f+=Uint32Array.BYTES_PER_ELEMENT,u<=0)return{bytesOffset:f};var p=t.getUint16(f+o,!0);f+=Uint16Array.BYTES_PER_ELEMENT;var d=t.getUint16(f+o,!0);d=p*Float32Array.BYTES_PER_ELEMENT,f+=Uint16Array.BYTES_PER_ELEMENT;var l=u*p*Float32Array.BYTES_PER_ELEMENT,A=e.subarray(f,f+l);if(f+=l,3===p&&n.defined(y)){for(var T=new i.Cartesian3,v=new i.Cartesian3,m=new Float32Array(A.buffer,A.byteOffset,A.byteLength/4),_=new Float32Array(A.byteLength/4+u),g=m.length,B=0,b=0;B<g;B+=3,b+=4)_[b]=m[B],_[b+1]=m[B+1],_[b+2]=m[B+2],a.Matrix4.multiplyByPoint(y,i.Cartesian3.fromElements(_[b],_[b+1],_[b+2],T),v),_[b+3]=c.Cartographic.fromCartesian(v).height;A=_,d=(p=4)*Float32Array.BYTES_PER_ELEMENT}var h=E.vertexAttributes,P=E.attrLocation;return P.aPosition=h.length,h.push({index:P.aPosition,typedArray:A,componentsPerAttribute:p,componentDatatype:r.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:d,normalize:!1}),{bytesOffset:f}}function De(e,t,n,a,i){var o=a,s=t.getUint32(o+n,!0);if(o+=Uint32Array.BYTES_PER_ELEMENT,s<=0)return{bytesOffset:o};var E=t.getUint16(o+n,!0);o+=Uint16Array.BYTES_PER_ELEMENT;var y=t.getUint16(o+n,!0);o+=Uint16Array.BYTES_PER_ELEMENT;var f=s*E*Float32Array.BYTES_PER_ELEMENT,u=e.subarray(o,o+f);if(o+=f,!i.ignoreNormal){var p=i.vertexAttributes,d=i.attrLocation;d.aNormal=p.length,p.push({index:d.aNormal,typedArray:u,componentsPerAttribute:E,componentDatatype:r.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:y,normalize:!1})}return{bytesOffset:o}}function we(e,t,n,a,i){var o,s=a,E=t.getUint32(s+n,!0);if(s+=Uint32Array.BYTES_PER_ELEMENT,i.verticesCount,E>0){t.getUint16(s+n,!0),s+=Uint16Array.BYTES_PER_ELEMENT,s+=2*Uint8Array.BYTES_PER_ELEMENT;var y=E*Uint8Array.BYTES_PER_ELEMENT*4;o=m(e,s,s+y),s+=y;var f=i.vertexAttributes,u=i.attrLocation;u.aColor=f.length,f.push({index:u.aColor,typedArray:o,componentsPerAttribute:4,componentDatatype:r.ComponentDatatype.UNSIGNED_BYTE,offsetInBytes:0,strideInBytes:4,normalize:!0})}return{bytesOffset:s}}function Fe(e,t,r,n,a){var i=n,o=t.getUint32(i+r,!0);return i+=Uint32Array.BYTES_PER_ELEMENT,o<=0?{bytesOffset:i}:(t.getUint16(i+r,!0),i+=Uint16Array.BYTES_PER_ELEMENT,i+=2*Uint8Array.BYTES_PER_ELEMENT,{bytesOffset:i+=o*Uint8Array.BYTES_PER_ELEMENT*4})}function Ye(e,t,r,n){var a=n,i=[],o=t.getUint32(a+r,!0);a+=Uint32Array.BYTES_PER_ELEMENT;for(var s=0;s<o;s++){var E={},y=t.getUint32(a+r,!0);a+=Uint32Array.BYTES_PER_ELEMENT;var f=t.getUint8(a+r,!0);a+=Uint8Array.BYTES_PER_ELEMENT,t.getUint8(a+r,!0),a+=Uint8Array.BYTES_PER_ELEMENT;var u=t.getUint8(a+r,!0);if(a+=Uint8Array.BYTES_PER_ELEMENT,a+=Uint8Array.BYTES_PER_ELEMENT,y>0){var p=0,d=null;1===f||3===f?(p=y*Uint32Array.BYTES_PER_ELEMENT,d=e.subarray(a,a+p)):(p=y*Uint16Array.BYTES_PER_ELEMENT,d=e.subarray(a,a+p),y%2!=0&&(p+=2)),E.indicesTypedArray=d,a+=p}E.indicesCount=y,E.indexType=f,E.primitiveType=u;var c=[],l=t.getUint32(a+r,!0);a+=Uint32Array.BYTES_PER_ELEMENT;for(var A=0;A<l;A++){var T=Ne(t,r,e,a),v=T.string;a=T.bytesOffset,c.push(v),E.materialCode=v}if(i.push(E),0!==a%4)a+=4-a%4}return{bytesOffset:a,arrIndexPackage:i}}function Oe(e,t,n,a,o,s,E){var y,f=a,u=t.getUint32(f+n,!0);return o.nCompressOptions=u,f+=Uint32Array.BYTES_PER_ELEMENT,(u&g.SVC_Vertex)==g.SVC_Vertex?(y=function(e,t,n,a,o){var s=a,E=t.getUint32(s+n,!0);if(o.verticesCount=E,s+=Uint32Array.BYTES_PER_ELEMENT,E<=0)return{bytesOffset:s};var y=t.getUint16(s+n,!0);s+=Uint16Array.BYTES_PER_ELEMENT;var f=t.getUint16(s+n,!0);f=y*Int16Array.BYTES_PER_ELEMENT,s+=Uint16Array.BYTES_PER_ELEMENT;var u=t.getFloat32(s+n,!0);s+=Float32Array.BYTES_PER_ELEMENT;var p=new i.Cartesian4;p.x=t.getFloat32(s+n,!0),s+=Float32Array.BYTES_PER_ELEMENT,p.y=t.getFloat32(s+n,!0),s+=Float32Array.BYTES_PER_ELEMENT,p.z=t.getFloat32(s+n,!0),s+=Float32Array.BYTES_PER_ELEMENT,p.w=t.getFloat32(s+n,!0),s+=Float32Array.BYTES_PER_ELEMENT,o.vertCompressConstant=u,o.minVerticesValue=p;var d=E*y*Int16Array.BYTES_PER_ELEMENT,c=e.subarray(s,s+d);s+=d;var l=o.vertexAttributes,A=o.attrLocation;return A.aPosition=l.length,l.push({index:A.aPosition,typedArray:c,componentsPerAttribute:y,componentDatatype:r.ComponentDatatype.SHORT,offsetInBytes:0,strideInBytes:f,normalize:!1}),{bytesOffset:s}}(e,t,n,f,o),f=y.bytesOffset):f=(y=Re(e,t,n,f,o,E)).bytesOffset,(u&g.SVC_Normal)==g.SVC_Normal?(y=function(e,t,n,a,i){var o=a,s=t.getUint32(o+n,!0);if(o+=Uint32Array.BYTES_PER_ELEMENT,s<=0)return{bytesOffset:o};t.getUint16(o+n,!0),o+=Uint16Array.BYTES_PER_ELEMENT;var E=t.getUint16(o+n,!0);o+=Uint16Array.BYTES_PER_ELEMENT;var y=2*s*Int16Array.BYTES_PER_ELEMENT,f=e.subarray(o,o+y);if(o+=y,!i.ignoreNormal){var u=i.vertexAttributes,p=i.attrLocation;p.aNormal=u.length,u.push({index:p.aNormal,typedArray:f,componentsPerAttribute:2,componentDatatype:r.ComponentDatatype.SHORT,offsetInBytes:0,strideInBytes:E,normalize:!1})}return{bytesOffset:o}}(e,t,n,f,o),f=y.bytesOffset):f=(y=De(e,t,n,f,o)).bytesOffset,f=(y=Fe(0,t,n,f=(y=we(e,t,n,f,o)).bytesOffset)).bytesOffset,(u&g.SVC_TexutreCoord)==g.SVC_TexutreCoord?(y=function(e,t,n,a,o){o.texCoordCompressConstant=[],o.minTexCoordValue=[];var s=n,E=e.getUint16(n+a,!0);s+=Uint16Array.BYTES_PER_ELEMENT,s+=Uint16Array.BYTES_PER_ELEMENT;for(var y=0,f=0;f<E;f++){var u=e.getUint8(s+a,!0);s+=Uint8Array.BYTES_PER_ELEMENT,s+=3*Uint8Array.BYTES_PER_ELEMENT;var p=e.getUint32(s+a,!0);s+=Uint32Array.BYTES_PER_ELEMENT;var d=e.getUint16(s+a,!0);s+=Uint16Array.BYTES_PER_ELEMENT,e.getUint16(s+a,!0),s+=Uint16Array.BYTES_PER_ELEMENT;var c=e.getFloat32(s+a,!0);s+=Float32Array.BYTES_PER_ELEMENT,o.texCoordCompressConstant.push(c);var l=new i.Cartesian4;l.x=e.getFloat32(s+a,!0),s+=Float32Array.BYTES_PER_ELEMENT,l.y=e.getFloat32(s+a,!0),s+=Float32Array.BYTES_PER_ELEMENT,l.z=e.getFloat32(s+a,!0),s+=Float32Array.BYTES_PER_ELEMENT,l.w=e.getFloat32(s+a,!0),s+=Float32Array.BYTES_PER_ELEMENT,o.minTexCoordValue.push(l);var A=p*d*Int16Array.BYTES_PER_ELEMENT,T=t.subarray(s,s+A),v=(s+=A)%4;0!==v&&(s+=4-v);var m="aTexCoord"+y,_=o.vertexAttributes,g=o.attrLocation;if(g[m]=_.length,_.push({index:g[m],typedArray:T,componentsPerAttribute:d,componentDatatype:r.ComponentDatatype.SHORT,offsetInBytes:0,strideInBytes:d*Int16Array.BYTES_PER_ELEMENT,normalize:!1}),u){A=p*Float32Array.BYTES_PER_ELEMENT;var B=t.subarray(s,s+A);s+=A,o.texCoordZMatrix=!0,g[m="aTexCoordZ"+y]=_.length,_.push({index:g[m],typedArray:B,componentsPerAttribute:1,componentDatatype:r.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:Float32Array.BYTES_PER_ELEMENT,normalize:!1})}y++}return{bytesOffset:s}}(t,e,f,n,o),f=y.bytesOffset):f=(y=Me(t,e,f,n,o,s)).bytesOffset,(u&g.SVC_TexutreCoordIsW)==g.SVC_TexutreCoordIsW&&(o.textureCoordIsW=!0),{bytesOffset:f=(y=Ie(t,e,f,n,o)).bytesOffset}}function ze(e,t,r,n,a,i,o){var s=n;return{bytesOffset:s=Ie(t,e,s=Me(t,e,s=Fe(0,t,r,s=we(e,t,r,s=De(e,t,r,s=Re(e,t,r,s,a,o).bytesOffset,a).bytesOffset,a).bytesOffset).bytesOffset,r,a,i).bytesOffset,r,a).bytesOffset}}function Ve(e){return 0!==e.length&&"ClampGroundAndObjectLinePass"===e[0].materialCode}function ke(e,t,r,o,s,E,y,f,u,p){var d=e,c=0,l=t.getUint32(c+r,!0);c+=Uint32Array.BYTES_PER_ELEMENT,p=n.defaultValue(p,n.defaultValue.EMPTY_OBJECT);for(var A=void 0,T=0;T<l;T++){var v=Ne(t,r,d,c),_=v.string;if(n.defined(u)){var g=n.defaultValue(p[_],a.Matrix4.IDENTITY);A=new a.Matrix4,a.Matrix4.multiply(u,g,A)}var b=(c=v.bytesOffset)%4;0!==b&&(c+=4-b);var h;if(h=t.getUint32(c+r,!0),c+=Int32Array.BYTES_PER_ELEMENT,(re={vertexAttributes:[],attrLocation:{},instanceCount:0,instanceMode:0,instanceIndex:-1}).ignoreNormal=o.ignoreNormal,h==he){f>=2&&(t.getInt32(c+r,!0),c+=Int32Array.BYTES_PER_ELEMENT);var P={};P.posUniqueID=t.getInt32(c+r,!0),c+=Int32Array.BYTES_PER_ELEMENT,P.normalUniqueID=t.getInt32(c+r,!0),c+=Int32Array.BYTES_PER_ELEMENT,P.colorUniqueID=t.getInt32(c+r,!0),c+=Int32Array.BYTES_PER_ELEMENT,P.secondColorUniqueID=t.getInt32(c+r,!0),c+=Int32Array.BYTES_PER_ELEMENT;var x=t.getUint16(c+r,!0);c+=Int16Array.BYTES_PER_ELEMENT;for(var C=[],L=0;L<x;L++){var S=t.getInt32(c+r,!0);C.push(S),c+=Int32Array.BYTES_PER_ELEMENT}P.texCoordUniqueIDs=C;var U=t.getInt32(c+r,!0);c+=Int32Array.BYTES_PER_ELEMENT;var N=[],M={};if(U>0){var I=Ne(t,r,d,c),R=I.string;c=I.bytesOffset,M.materialCode=R,N.push(M)}var D=t.getUint32(c+r,!0),w=m(d,c+=Int32Array.BYTES_PER_ELEMENT,c+D);U>0?B.dracoDecodeMesh(_e,w,D,re,M,P):B.dracoDecodePointCloud(_e,w,D,re,P),c+=D,o[_]={vertexPackage:re,arrIndexPackage:N}}else{var F;h==Be?c=(v=ze(d,t,r,c,re,s,A)).bytesOffset:h==be&&(c=(v=Oe(d,t,r,c,re,s,A)).bytesOffset),Ve(N=(v=Ye(d,t,r,c)).arrIndexPackage)&&(re.clampRegionEdge=!0),2===N.length&&13===N[1].primitiveType&&N[1].indicesCount>=3&&(F=Q.createEdgeDataByIndices(re,N[1],E)),c=v.bytesOffset,o[_]={vertexPackage:re,arrIndexPackage:N,edgeGeometry:F}}if(n.defined(y)&&y){var Y=t.getUint16(c+r,!0);if(c+=Uint16Array.BYTES_PER_ELEMENT,1===Y){var O=t.getUint32(c+r,!0);c+=Uint32Array.BYTES_PER_ELEMENT;var z,V=t.getUint32(c+r,!0);c+=Uint32Array.BYTES_PER_ELEMENT,t.getFloat32(c+r,!0),c+=Float32Array.BYTES_PER_ELEMENT;var k=new Array(O),q=new Array(O),G=new Array(O),H=new Array(O);for(z=0;z<O;z++){var W=t.getFloat32(c+r,!0);c+=Float32Array.BYTES_PER_ELEMENT,k[z]=W;var X=t.getUint16(c+r,!0);c+=Uint16Array.BYTES_PER_ELEMENT,q[z]=X;var Z=t.getUint16(c+r,!0);c+=Uint16Array.BYTES_PER_ELEMENT,G[z]=Z;for(var j=Z*V,J=new Array(j),K=0;K<j;K++){var $=t.getFloat32(c+r,!0);c+=Float32Array.BYTES_PER_ELEMENT,J[K]=$}H[z]=J}}var ee=new i.Cartesian3,te=new i.Cartesian3;ee.x=t.getFloat64(c+r,!0),c+=Float64Array.BYTES_PER_ELEMENT,ee.y=t.getFloat64(c+r,!0),c+=Float64Array.BYTES_PER_ELEMENT,ee.z=t.getFloat64(c+r,!0),c+=Float64Array.BYTES_PER_ELEMENT,te.x=t.getFloat64(c+r,!0),c+=Float64Array.BYTES_PER_ELEMENT,te.y=t.getFloat64(c+r,!0),c+=Float64Array.BYTES_PER_ELEMENT,te.z=t.getFloat64(c+r,!0),c+=Float64Array.BYTES_PER_ELEMENT,o[_].min=ee,o[_].max=te;var re=o[_].vertexPackage;n.defined(re.instanceBuffer)&&2===f&&(re.instanceBounds=new Float32Array(6),i.Cartesian3.pack(ee,re.instanceBounds,0),i.Cartesian3.pack(te,re.instanceBounds,3))}}}function qe(e,t,r,i,o){var s={},E=[],y=new a.Matrix4,f=e;o=n.defaultValue(o,{});for(var u=0;u<16;u++)y[u]=t.getFloat64(r+i,!0),r+=Float64Array.BYTES_PER_ELEMENT;s.matrix=y,s.skeletonNames=E;var p=t.getUint32(r+i,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(var d=0;d<p;d++){var c=Ne(t,i,f,r),l=c.string;r=c.bytesOffset,E.push(l),o[l]=y}return{byteOffset:r,geode:s}}function Ge(e){var t=e.indexOf("Geometry");if(-1===t)return e;var r=e.substring(t,e.length);return e.replace(r,"")}function He(e,t,r,n,a){var o={},s=t.getFloat32(r+n,!0);r+=Float32Array.BYTES_PER_ELEMENT;var y=t.getUint16(r+n,!0);r+=Uint16Array.BYTES_PER_ELEMENT,o.rangeMode=y,o.rangeList=s;var f=new i.Cartesian3;f.x=t.getFloat64(r+n,!0),r+=Float64Array.BYTES_PER_ELEMENT,f.y=t.getFloat64(r+n,!0),r+=Float64Array.BYTES_PER_ELEMENT,f.z=t.getFloat64(r+n,!0),r+=Float64Array.BYTES_PER_ELEMENT;var u=t.getFloat64(r+n,!0);r+=Float64Array.BYTES_PER_ELEMENT,o.boundingSphere=new E.BoundingSphere(f,u);var p=(l=Ne(t,n,e,r)).string;r=l.bytesOffset,p=Ge(p=p.replace(/(\.s3mblock)|(\.s3mbz)|(\.s3mb)/gi,"")),o.childTile=p,o.geodes=[];var d=t.getUint32(r+n,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(var c=0;c<d;c++){var l;r=(l=qe(e,t,r,n,a)).byteOffset,o.geodes.push(l.geode)}return{pageLOD:o,bytesOffset:r}}function We(e,t,r,n){var a=0,i={},o=[],s=t.getUint32(a+r,!0);a+=Uint32Array.BYTES_PER_ELEMENT;for(var E=0;E<s;E++){var y=He(e,t,a,r,n);a=y.bytesOffset,o.push(y.pageLOD)}return i.pageLods=o,i}function Xe(e,t,n){var a=e.vertexAttributes,i=e.attrLocation,o=a.length;i["aTextureBatchId"+n]=o,a.push({index:o,typedArray:t,componentsPerAttribute:1,componentDatatype:r.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:0})}function Ze(e,t,r,a){for(var i=r.length,o=0;o<i;o++)for(var s=r[o],E=s.subName.split("_")[0],y=s.subVertexOffsetArr,f=0;f<y.length;f++){var p=y[f],d=p.geoName,c=p.offset,l=p.count,A=p.texUnitIndex,T=t[d].vertexPackage.verticesCount,v=a[d];n.defined(v)||(v=a[d]={});var m=v[A];n.defined(m)||(m=v[A]=new Float32Array(T),u.arrayFill(m,-1));var _=n.defined(e)?e[E]:o;u.arrayFill(m,_,c,c+l)}}function je(e,t,n){var a=e.vertexAttributes,i=e.attrLocation,o=a.length;i[1===n?"instanceId":"batchId"]=o,a.push({index:o,typedArray:t,componentsPerAttribute:1,componentDatatype:r.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:0,instanceDivisor:n})}function Je(e,t,r,n,a){var i=0,s=e,E=t.getUint32(i+r,!0);i+=Uint32Array.BYTES_PER_ELEMENT;for(var y=0;y<E;y++){var f=Ne(t,r,s,i),p=f.string;i=f.bytesOffset;var d=t.getUint32(i+r,!0);i+=Uint32Array.BYTES_PER_ELEMENT;var c={};if(n[p].pickInfo=c,-1==n[p].vertexPackage.instanceIndex){for(var l=new Float32Array(n[p].vertexPackage.verticesCount),A=0;A<d;A++){var T=t.getUint32(i+r,!0);i+=Uint32Array.BYTES_PER_ELEMENT;var v=t.getUint32(i+r,!0);i+=Uint32Array.BYTES_PER_ELEMENT;var m=0,_=0;c[T]={batchId:A};for(var g=0;g<v;g++)_=t.getUint32(i+r,!0),i+=Uint32Array.BYTES_PER_ELEMENT,m=t.getUint32(i+r,!0),i+=Uint32Array.BYTES_PER_ELEMENT,u.arrayFill(l,A,_,_+m);c[T].vertexColorOffset=_,c[T].vertexCount=m}je(n[p].vertexPackage,l,void 0)}else{var B=n[p].vertexPackage.instanceCount,b=n[p].vertexPackage.instanceBuffer,h=n[p].vertexPackage.instanceMode,P=new Float32Array(B),x=17===h?16:28;x*=Float32Array.BYTES_PER_ELEMENT;var C=0;for(A=0;A<d;A++){var L=t.getUint32(i+r,!0);if(i+=Uint32Array.BYTES_PER_ELEMENT,2!==a){var S=C*h*Float32Array.BYTES_PER_ELEMENT+x;o.Color.unpack(b,S,Pe),L=Pe.red+256*Pe.green+65536*Pe.blue}v=t.getUint32(i+r,!0);i+=Uint32Array.BYTES_PER_ELEMENT;for(g=0;g<v;g++){var U=t.getUint32(i+r,!0);if(i+=Uint32Array.BYTES_PER_ELEMENT,P[C]=C,void 0===c[L]&&(c[L]={vertexColorCount:1,instanceIds:[],vertexColorOffset:C}),c[L].instanceIds.push(U),C++,3===a){m=t.getUint32(i+r,!0);i+=Uint32Array.BYTES_PER_ELEMENT}}}je(n[p].vertexPackage,P,1)}}}function Qe(e){return e<1e-10&&e>-1e-10}function Ke(e,t,r,a,i,o,E,f){var u=new DataView(e),p=new Uint8Array(e),d=u.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;var c=s.getStringFromTypedArray(p,r,d);c=c.replace(/(\.s3mblock)|(\.s3mbz)|(\.s3mb)/gi,""),r+=d;var l=u.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(var A=0;A<l;A++){var T={},v=u.getFloat32(r,!0);r+=Float32Array.BYTES_PER_ELEMENT;var m=u.getUint16(r,!0);r+=Uint16Array.BYTES_PER_ELEMENT,T.rangeMode=m,T.rangeList=v;var _={};_.x=u.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,_.y=u.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT,_.z=u.getFloat64(r,!0),r+=Float64Array.BYTES_PER_ELEMENT;var g=u.getFloat64(r,!0);r+=Float64Array.BYTES_PER_ELEMENT,T.boundingSphere={center:_,radius:g},d=u.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT;var B=s.getStringFromTypedArray(p,r,d);r+=d,B=Ge(B=B.replace(/(\.s3mblock)|(\.s3mbz)|(\.s3mb)/gi,"")),T.childTile=B}var b={},h=u.getFloat32(r,!0);r+=Float32Array.BYTES_PER_ELEMENT;u.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT;var P=u.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;var x=new Uint8Array(e,r,P),C=r+P,S=y.pako.inflate(x).buffer;f.push(S),u=new DataView(S);p=new Uint8Array(S);r=0;var U=u.getUint32(r,!0),N=Ue(u,S,r+=Uint32Array.BYTES_PER_ELEMENT),M=N.buffer;r=N.byteOffset;var I=We(M,u,N.dataViewByteOffset),R=r%4;0!==R&&(r+=4-R),ke((N=Ue(u,S,r)).buffer,u,N.dataViewByteOffset,b,!1),(N=Ue(u,S,r=N.byteOffset)).buffer;var D={};!function(e,t,r,a,i,o,E,y,f,u){var p=y,d=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;for(var c={},l=0;l<d;l++){var A=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var T=s.getStringFromTypedArray(o,p-y,A),v=(p+=A)%4;0!==v&&(p+=4-v),E.getUint32(p,!0),p+=Uint32Array.BYTES_PER_ELEMENT,E.getUint8(p,!0),p+=Uint8Array.BYTES_PER_ELEMENT;var m=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var _=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var g=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var B=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var b,h=E.getUint32(p,!0);if(p+=Uint32Array.BYTES_PER_ELEMENT,a){var P=p-y;b=o.subarray(P,P+B),p+=B}var x=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;for(var C=[],L=0;L<x;L++){A=E.getUint32(p,!0),p+=Uint32Array.BYTES_PER_ELEMENT;var S=s.getStringFromTypedArray(o,p-y,A);p+=A,C.push(S),r[S]=T}var U=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var N=[];for(L=0;L<U;L++){A=E.getUint32(p,!0),p+=Uint32Array.BYTES_PER_ELEMENT;var M=s.getStringFromTypedArray(o,p-y,A);p+=A,N.push(M)}var I=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var R=[],D=void 0,w=T;if(a)D=t[T]={};else{var F=r[T];for(w=F;n.defined(F);)w=F,F=r[F];n.defined(w)&&(D=t[w])}var Y=0;for(L=0;L<I;L++){A=E.getUint32(p,!0),p+=Uint32Array.BYTES_PER_ELEMENT;var O=s.getStringFromTypedArray(o,p-y,A);if(p+=A,a){var z=O.split("_")[0];n.defined(D[z])?Y++:D[z]=L-Y}var V=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var k=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var q=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var G=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var H=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;for(var W=[],X=0;X<H;X++){A=E.getUint32(p,!0),p+=Uint32Array.BYTES_PER_ELEMENT;var Z=s.getStringFromTypedArray(o,p-y,A);p+=A;var j=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var J=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var Q=E.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT,W.push({geoName:Z,offset:j,count:J,texUnitIndex:Q})}R.push({subName:O,offsetX:V,offsetY:k,width:q,height:G,subVertexOffsetArr:W})}Ze(D,e,R,c),n.defined(b)&&g===s.S3MPixelFormat.CRN_DXT5&&ve&&(b=me({data:b},u).bufferView),f[T]={id:T,rootTextureName:w,width:m,height:_,compressType:g,size:B,format:h,textureData:b,subTexInfos:R,requestNames:N}}for(var Z in c)if(c.hasOwnProperty(Z)){var K=e[Z].vertexPackage,$=c[Z];for(var Q in $)$.hasOwnProperty(Q)&&Xe(K,$[Q],Q)}}(b,a,i,o,0,(N=Ue(u,S,r=N.byteOffset)).buffer,u,N.dataViewByteOffset,D,f),r=N.byteOffset;var w=u.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;var F=p.subarray(r,r+w),Y=s.getStringFromTypedArray(F);r+=w;var O=JSON.parse(Y);(U&ge)==ge&&(Je((N=Ue(u,S,r)).buffer,u,N.dataViewByteOffset,b,h),r=N.byteOffset);var z=I.pageLods,V=!0;for(A=0;A<z.length;A++){var k=z[A];V=""===k.childTile;for(var q=k.geodes,G=0;G<q.length;G++)for(var H=q[G].skeletonNames,W=0;W<H.length;W++){var X=H[W];if(V){var Z=b[X].vertexPackage;Z.boundingSphere=L.calcBoundingSphereInWorker(1,Z)}}}E[c]={result:!0,groupNode:I,geoPackage:b,matrials:O,texturePackage:D,version:ue,rootBatchIdMap:a,ancestorMap:i},C<t&&Ke(e,t,C,a,i,!1,E,f)}function $e(e,t){var r=e.buffer,a=e.isS3MZ,i=e.fileType,o=e.supportCompressType,E=e.bVolume,u=e.isS3MBlock,p=e.modelMatrix,d=e.materialType,c=null,l=null,A=null;if(E&&e.volbuffer.byteLength<8&&(E=!1),E){var T=e.volbuffer,v=new Uint8Array(T,8),m=y.pako.inflate(v).buffer,_=new Float64Array(m,0,1),g=new Uint32Array(m,48,1);if(0===_[0]||3200===g[0]||3201===g[0]){var B=0;0==_[0]&&(B=8),t.push(m);var b=new Float64Array(m,B,6),h=b[0],P=b[1],x=b[2],C=b[3],S=b[4]<b[5]?b[4]:b[5],U=b[4]>b[5]?b[4]:b[5];l={left:h,top:P,right:x,bottom:C,minHeight:S,maxHeight:U,width:(c=new Se(h,C,x,P,S,U)).width,length:c.length,height:c.height};var N=new Uint32Array(m,48+B,7),M=N[0],I=N[1],R=N[2],D=N[3];A={nFormat:M,nSideBlockCount:I,nBlockLength:R,nLength:D,nWidth:N[4],nHeight:N[5],nDepth:N[6],imageArray:new Uint8Array(m,76+B,D*D*4)}}}var w=0,F={};F.ignoreNormal=e.ignoreNormal;var Y=e.rootBatchIdMap||{},O=e.ancestorMap||{},z={},V=new DataView(r),k=V.getFloat32(w,!0);if(w+=Float32Array.BYTES_PER_ELEMENT,k>2.2)return{result:!1};if(u)return V.getUint32(w,!0),w+=Uint32Array.BYTES_PER_ELEMENT,Ke(r,r.byteLength,w,Y,O,e.isRoot,z,t),z;var q,G=!1;if(k>=2&&(q=V.getUint32(w,!0),w+=Uint32Array.BYTES_PER_ELEMENT),Qe(k-1)||Qe(k-2)||k>2.09&&k<2.11){var H=V.getUint32(w,!0);w+=Uint32Array.BYTES_PER_ELEMENT;var W=new Uint8Array(r,w,H);r=!0===xe?function(e,t){var r=t||4*e.length,n=f.unzip._malloc(Uint8Array.BYTES_PER_ELEMENT*r),a=new Uint8Array(r);f.unzip.HEAPU8.set(a,n/Uint8Array.BYTES_PER_ELEMENT);var i,o=f.unzip._malloc(Uint8Array.BYTES_PER_ELEMENT*e.length);for(f.unzip.HEAPU8.set(e,o/Uint8Array.BYTES_PER_ELEMENT);0==(i=Ce(n,r,o,e.length));)Le(n),r*=4,n=f.unzip._malloc(Uint8Array.BYTES_PER_ELEMENT*r),a=new Uint8Array(r),f.unzip.HEAPU8.set(a,n/Uint8Array.BYTES_PER_ELEMENT);var s=new Uint8Array(f.unzip.HEAPU8.buffer,n,i);e=null,a=null;var E=new Uint8Array(s).buffer;return Le(n),Le(o),E}(W,q):y.pako.inflate(W).buffer,t.push(r),V=new DataView(r),w=0}else if(k>1.199&&k<1.201){H=V.getUint32(w,!0);w+=Uint32Array.BYTES_PER_ELEMENT,t.push(r)}else{G=!0,w=0;H=V.getInt32(w,!0);if(w+=Int32Array.BYTES_PER_ELEMENT,w+=Uint8Array.BYTES_PER_ELEMENT*H,a){V.getUint32(w,!0),w+=Uint32Array.BYTES_PER_ELEMENT;v=new Uint8Array(r,w);r=y.pako.inflate(v).buffer,t.push(r),V=new DataView(r),w=0}}var X=V.getUint32(w,!0),Z=Ue(V,r,w+=Uint32Array.BYTES_PER_ELEMENT),j=Z.buffer;w=Z.byteOffset;var J={},K=We(j,V,Z.dataViewByteOffset,J),$=w%4;0!==$&&(w+=4-$);var ee=k>2.09;if(ke((Z=Ue(V,r,w)).buffer,V,Z.dataViewByteOffset,F,G,t,ee,k,p,J),w=Z.byteOffset,ee)for(var te=0;te<K.pageLods.length;te++)for(var re=K.pageLods[te],ne=re.geodes,ae=0;ae<ne.length;ae++)for(var ie=ne[ae].skeletonNames,oe=0;oe<ie.length;oe++){var se=ie[oe];n.defined(F[se].max)&&(n.defined(re.max)?(re.max.x=Math.max(F[se].max.x,re.max.x),re.max.y=Math.max(F[se].max.y,re.max.y),re.max.z=Math.max(F[se].max.z,re.max.z),re.min.x=Math.min(F[se].min.x,re.min.x),re.min.y=Math.min(F[se].min.y,re.min.y),re.min.z=Math.min(F[se].min.z,re.min.z)):(re.max=F[se].max,re.min=F[se].min))}(Z=Ue(V,r,w)).buffer;var Ee={};!function(e,t,r,n,a,i){var o=0,E=r.getUint32(o+n,!0);o+=Uint32Array.BYTES_PER_ELEMENT;for(var y=0;y<E;y++){var f=Ne(r,n,t,o),u=f.string,p=(o=f.bytesOffset)%4;0!==p&&(o+=4-p);var d=r.getUint32(o+n,!0);o+=Uint32Array.BYTES_PER_ELEMENT;var c=r.getUint32(o+n,!0);o+=Uint32Array.BYTES_PER_ELEMENT;var l=r.getUint32(o+n,!0);o+=Uint32Array.BYTES_PER_ELEMENT;var A=r.getUint32(o+n,!0);o+=Uint32Array.BYTES_PER_ELEMENT;var T=r.getUint32(o+n,!0);o+=Uint32Array.BYTES_PER_ELEMENT;var v=r.getUint32(o+n,!0);o+=Uint32Array.BYTES_PER_ELEMENT;var m=t.subarray(o,o+T);o+=T;var _=null;A===pe&&1!=e?(s.DXTTextureDecode.decode(_,c,l,m,v),_=v>s.S3MPixelFormat.BGR||v===s.S3MPixelFormat.LUMINANCE_ALPHA?new Uint8Array(c*l*4):new Uint16Array(c*l),s.DXTTextureDecode.decode(_,c,l,m,v),i.push(_.buffer),A=0):_=m,a[u]={id:u,width:c,height:l,compressType:A,nFormat:v,imageBuffer:_,mipmapLevel:d}}}(o,(Z=Ue(V,r,w=Z.byteOffset)).buffer,V,Z.dataViewByteOffset,Ee,t),w=Z.byteOffset;var ye=V.getUint32(w,!0);w+=Uint32Array.BYTES_PER_ELEMENT;var fe=new Uint8Array(r).subarray(w,w+ye),de=s.getStringFromTypedArray(fe);w+=ye,de=de.replace(/\n\0/,"");var ce=JSON.parse(de);(X&ge)==ge&&Je((Z=Ue(V,r,w)).buffer,V,Z.dataViewByteOffset,F,k);var le=K.pageLods,Ae=!0;for(te=0;te<le.length;te++){var Te=le[te];Ae=""===Te.childTile;for(var ve=Te.geodes,me=0;me<ve.length;me++){ie=ve[me].skeletonNames;for(var _e=0;_e<ie.length;_e++){var Be=ie[_e];if(Ae){var be=F[Be].vertexPackage;be.boundingSphere=L.calcBoundingSphereInWorker(i,be)}}}}return"BatchPBR"===d&&function(e,t,r){for(var a in delete e.ignoreNormal,e)if(e.hasOwnProperty(a)){var i=e[a],o=i.arrIndexPackage;if(o.length<1)continue;if(1===o.length||2===o.length&&13===o[1].primitiveType){var s=i.vertexPackage.attrLocation.aTexCoord0;if(void 0!==s){var E=i.vertexPackage.vertexAttributes[s],y=new Float32Array(E.typedArray.buffer,E.typedArray.byteOffset,E.typedArray.byteLength/4);if(3===E.componentsPerAttribute&&y[2]<0)continue}}var f,u,p=0,d={},c=void 0;for(f=0,u=o.length;f<u;f++)13!==o[f].primitiveType?p+=o[f].indicesTypedArray.byteLength:c=o[f],0===f&&(d.indicesCount=0,d.indexType=o[f].indexType,d.primitiveType=o[f].primitiveType,d.materialCode=o[f].materialCode);d.indicesCount=p/2;var l=new Uint8Array(p),A=0;for(f=0,u=o.length;f<u;f++)13!==(L=o[f]).primitiveType&&(l.set(L.indicesTypedArray,A,A+L.indicesTypedArray.byteLength),A+=L.indicesTypedArray.byteLength);d.indicesTypedArray=l,i.arrIndexPackage=[d],n.defined(c)&&(i.arrIndexPackage.push(c),i.edgeGeometry=Q.createEdgeDataByIndices(i.vertexPackage,c));var T=2*o.length*4,v=new Float32Array(T),m={};for(f=0,u=r.material.length;f<u;f++)m[(S=r.material[f].material).id]=S;for(f=0,u=o.length;f<u;f++)if(S=m[(L=o[f]).materialCode]){var _=S.pbrMetallicRoughness;if(_){v[8*f]=_.metallicFactor,v[8*f+1]=_.roughnessFactor,v[8*f+2]=S.alphaCutoff;var g=""===S.alphaMode?0:1,B="none"===S.cullMode?0:1;v[8*f+3]=B|g<<16,v[8*f+4]=_.emissiveFactor.x,v[8*f+5]=_.emissiveFactor.y,v[8*f+6]=_.emissiveFactor.z,v[8*f+7]=0,S.pbrIndex=f}}var b="PBRMaterialParam_"+a;for(f=0,u=r.material.length;f<u;f++)if((S=r.material[f].material).id===d.materialCode){S.textureunitstates.push({textureunitstate:{addressmode:{u:0,v:0,w:0},filteringoption:0,filtermax:2,filtermin:2,id:b,texmodmatrix:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],url:""}});break}var h,P,x=i.vertexPackage,C=x.attrLocation.aTexCoord1;if(void 0!==C){E=x.vertexAttributes[C];h=new Float32Array(2*x.verticesCount),E.typedArray=h}else h=new Float32Array(2*x.verticesCount),C=x.vertexAttributes.length,x.attrLocation.aTexCoord1=C,x.vertexAttributes.push({index:C,typedArray:h,componentsPerAttribute:2,componentDatatype:5126,offsetInBytes:0,strideInBytes:8,normalize:!1});for(void 0!==(C=x.attrLocation.aColor)&&(P=(E=x.vertexAttributes[C]).typedArray),f=0,u=o.length;f<u;f++){var L,S;if((S=m[(L=o[f]).materialCode])&&S.pbrMetallicRoughness)for(var U=S.pbrMetallicRoughness.baseColor,N=void 0!==P,M=S.pbrIndex,I=(l=L.indicesTypedArray,0),R=(l=0===L.indexType?new Uint16Array(l.buffer,l.byteOffset,l.byteLength/2):new Uint32Array(l.buffer,l.byteOffset,l.byteLength/4)).length;I<R;I++){var D=l[I];h[2*D]=M,N&&(P[4*D]=255*U.x,P[4*D+1]=255*U.y,P[4*D+2]=255*U.z,P[4*D+3]=255*U.w)}}t[b]={id:b,width:2*o.length,height:1,compressType:0,nFormat:25,imageBuffer:v,mipmapLevel:0}}}(F,Ee,ce),{result:!0,groupNode:K,geoPackage:F,matrials:ce,texturePackage:Ee,version:ue,volImageBuffer:A,volBounds:l}}function et(){n.defined(Ae)&&n.defined(_e)&&(Ae.onRuntimeInitialized=function(){ve=!0},self.onmessage=e($e),self.postMessage(!0))}return function(t){if("undefined"==typeof WebAssembly)return self.onmessage=e($e),void self.postMessage(!0);var a=t.data.webAssemblyConfig;return n.defined(a)?r.FeatureDetection.isInternetExplorer()?require([E.buildModuleUrl("ThirdParty/Workers/ie-webworker-promise-polyfill.js")],(function(e){return self.Promise=e,-1!==a.modulePath.indexOf("crunch")?require([a.modulePath],(function(e){n.defined(a.wasmBinaryFile)?(n.defined(e)||(e=self.Module),Ae=e,et()):(Ae=e,et())})):require([a.modulePath],(function(e){n.defined(a.wasmBinaryFile)?(n.defined(e)||(e=self.DracoDecoderModule),e(a).then((function(e){_e=e,et()}))):(_e=e(),et())}))})):-1!==a.modulePath.indexOf("crunch")?require([a.modulePath],(function(e){n.defined(a.wasmBinaryFile)?(n.defined(e)||(e=self.Module),Ae=e,et()):(Ae=e,et())})):require([a.modulePath],(function(e){n.defined(a.wasmBinaryFile)?(n.defined(e)||(e=self.DracoDecoderModule),e(a).then((function(e){_e=e,et()}))):(_e=e(),et())})):void 0}}));
