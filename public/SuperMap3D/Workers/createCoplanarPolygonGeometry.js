define(["./EllipsoidRhumbLine-18dee174","./BoundingRectangle-d0552dc9","./buildModuleUrl-c0836874","./Cartesian2-c4c2a8f9","./Cartesian4-442405e6","./Math-3024ab74","./FeatureDetection-caf5f946","./CoplanarPolygonGeometryLibrary-e7aee56f","./when-b60132fc","./GeometryAttribute-eb047ff3","./GeometryAttributes-252e9929","./PolygonGeometryLibrary-ceffc78b","./GeometryPipeline-7ee31a30","./IndexDatatype-a3f4b187","./PrimitiveType-ebb8c588","./Transforms-04c4d562","./VertexFormat-ae18728e","./Cartographic-2cfa3a3a","./WebGLConstants-aba9fc67","./OrientedBoundingBox-24d03d3b","./EllipsoidTangentPlane-1a9db025","./Plane-6b2f5e52","./earcut-2.2.1-20c8012f","./AttributeCompression-2ece5912","./EncodedCartesian3-6a9cfb29"],(function(e,t,a,n,r,o,i,l,s,p,c,y,u,m,d,g,b,v,f,h,C,x,P,w,A){"use strict";var F=new r.Cartesian3,L=new t.BoundingRectangle,G=new n.Cartesian2,E=new n.Cartesian2,T=new r.Cartesian3,D=new r.Cartesian3,_=new r.Cartesian3,V=new r.Cartesian3,k=new r.Cartesian3,R=new r.Cartesian3,M=new g.Quaternion,H=new n.Matrix3,I=new n.Matrix3,B=new r.Cartesian3;function O(e,t,a,l,s,u,b,v){var f=e.positions,h=y.PolygonPipeline.triangulate(e.positions2D,e.holes);h.length<3&&(h=[0,1,2]);var C=m.IndexDatatype.createTypedArray(f.length,h.length);C.set(h);var x=H;if(0!==l){var P=g.Quaternion.fromAxisAngle(u,l,M);if(x=n.Matrix3.fromQuaternion(P,x),t.tangent||t.bitangent){P=g.Quaternion.fromAxisAngle(u,-l,M);var w=n.Matrix3.fromQuaternion(P,I);b=r.Cartesian3.normalize(n.Matrix3.multiplyByVector(w,b,b),b),t.bitangent&&(v=r.Cartesian3.normalize(r.Cartesian3.cross(u,b,v),v))}}else x=n.Matrix3.clone(n.Matrix3.IDENTITY,x);var A=E;t.st&&(A.x=a.x,A.y=a.y);for(var L=f.length,T=3*L,D=new Float64Array(T),_=t.normal?new Float32Array(T):void 0,V=t.tangent?new Float32Array(T):void 0,k=t.bitangent?new Float32Array(T):void 0,R=t.st?new Float32Array(2*L):void 0,B=0,O=0,z=0,S=0,N=0,Q=0;Q<L;Q++){var U=f[Q];if(D[B++]=U.x,D[B++]=U.y,D[B++]=U.z,t.st){var j=s(n.Matrix3.multiplyByVector(x,U,F),G);n.Cartesian2.subtract(j,A,j);var Y=o.CesiumMath.clamp(j.x/a.width,0,1),q=o.CesiumMath.clamp(j.y/a.height,0,1);R[N++]=Y,R[N++]=q}t.normal&&(_[O++]=u.x,_[O++]=u.y,_[O++]=u.z),t.tangent&&(V[S++]=b.x,V[S++]=b.y,V[S++]=b.z),t.bitangent&&(k[z++]=v.x,k[z++]=v.y,k[z++]=v.z)}var J=new c.GeometryAttributes;return t.position&&(J.position=new p.GeometryAttribute({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:D})),t.normal&&(J.normal=new p.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:_})),t.tangent&&(J.tangent=new p.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:V})),t.bitangent&&(J.bitangent=new p.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:k})),t.st&&(J.st=new p.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:R})),new p.Geometry({attributes:J,indices:C,primitiveType:d.PrimitiveType.TRIANGLES})}function z(e){var t=(e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT)).polygonHierarchy,n=s.defaultValue(e.vertexFormat,b.VertexFormat.DEFAULT);this._vertexFormat=b.VertexFormat.clone(n),this._polygonHierarchy=t,this._stRotation=s.defaultValue(e.stRotation,0),this._ellipsoid=a.Ellipsoid.clone(s.defaultValue(e.ellipsoid,a.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=y.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+b.VertexFormat.packedLength+a.Ellipsoid.packedLength+2}z.fromPositions=function(e){return new z({polygonHierarchy:{positions:(e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},z.pack=function(e,t,n){return n=s.defaultValue(n,0),n=y.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,n),a.Ellipsoid.pack(e._ellipsoid,t,n),n+=a.Ellipsoid.packedLength,b.VertexFormat.pack(e._vertexFormat,t,n),n+=b.VertexFormat.packedLength,t[n++]=e._stRotation,t[n]=e.packedLength,t};var S=a.Ellipsoid.clone(a.Ellipsoid.UNIT_SPHERE),N=new b.VertexFormat,Q={polygonHierarchy:{}};return z.unpack=function(e,t,n){t=s.defaultValue(t,0);var r=y.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=r.startingIndex,delete r.startingIndex;var o=a.Ellipsoid.unpack(e,t,S);t+=a.Ellipsoid.packedLength;var i=b.VertexFormat.unpack(e,t,N);t+=b.VertexFormat.packedLength;var l=e[t++],p=e[t];return s.defined(n)||(n=new z(Q)),n._polygonHierarchy=r,n._ellipsoid=a.Ellipsoid.clone(o,n._ellipsoid),n._vertexFormat=b.VertexFormat.clone(i,n._vertexFormat),n._stRotation=l,n.packedLength=p,n},z.createGeometry=function(t){var n=t._vertexFormat,i=t._polygonHierarchy,s=t._stRotation,c=i.positions;if(!((c=e.arrayRemoveDuplicates(c,r.Cartesian3.equalsEpsilon,!0)).length<3)){var d=T,g=D,b=_,v=k,f=R;if(l.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(c,V,v,f)){if(d=r.Cartesian3.cross(v,f,d),d=r.Cartesian3.normalize(d,d),!r.Cartesian3.equalsEpsilon(V,r.Cartesian3.ZERO,o.CesiumMath.EPSILON6)){var h=t._ellipsoid.geodeticSurfaceNormal(V,B);r.Cartesian3.dot(d,h)<0&&(d=r.Cartesian3.negate(d,d),v=r.Cartesian3.negate(v,v))}var C=l.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(V,v,f),x=l.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(V,v,f);n.tangent&&(g=r.Cartesian3.clone(v,g)),n.bitangent&&(b=r.Cartesian3.clone(f,b));var P=y.PolygonGeometryLibrary.polygonsFromHierarchy(i,C,!1),w=P.hierarchy,A=P.polygons;if(0!==w.length){c=w[0].outerRing;for(var F=a.BoundingSphere.fromPoints(c),G=y.PolygonGeometryLibrary.computeBoundingRectangle(d,x,c,s,L),E=[],M=0;M<A.length;M++){var H=new y.GeometryInstance({geometry:O(A[M],n,G,s,x,d,g,b)});E.push(H)}var I=u.GeometryPipeline.combineInstances(E)[0];I.attributes.position.values=new Float64Array(I.attributes.position.values),I.indices=m.IndexDatatype.createTypedArray(I.attributes.position.values.length/3,I.indices);var z=I.attributes;return n.position||delete z.position,new p.Geometry({attributes:z,indices:I.indices,primitiveType:I.primitiveType,boundingSphere:F})}}}},function(e,t){return s.defined(t)&&(e=z.unpack(e,t)),z.createGeometry(e)}}));
