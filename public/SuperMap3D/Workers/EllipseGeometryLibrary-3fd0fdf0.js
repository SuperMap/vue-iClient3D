define(["exports","./Cartographic-9ee1f1bd","./Math-4ffce144","./FeatureDetection-07e177c7","./GeometryAttribute-bf27d0ff"],(function(a,e,r,t,i){"use strict";var n={},s=new e.Cartesian3,o=new e.Cartesian3,l=new i.Quaternion,C=new t.Matrix3;function y(a,r,n,y,u,c,m,h,x,M){var f=a+r;e.Cartesian3.multiplyByScalar(y,Math.cos(f),s),e.Cartesian3.multiplyByScalar(n,Math.sin(f),o),e.Cartesian3.add(s,o,s);var z=Math.cos(a);z*=z;var d=Math.sin(a);d*=d;var _=c/Math.sqrt(m*z+u*d)/h;return i.Quaternion.fromAxisAngle(s,_,l),t.Matrix3.fromQuaternion(l,C),t.Matrix3.multiplyByVector(C,x,M),e.Cartesian3.normalize(M,M),e.Cartesian3.multiplyByScalar(M,h,M),M}var u=new e.Cartesian3,c=new e.Cartesian3,m=new e.Cartesian3,h=new e.Cartesian3;n.raisePositionsToHeight=function(a,r,t){for(var i=r.ellipsoid,n=r.height,s=r.extrudedHeight,o=t?a.length/3*2:a.length/3,l=new Float64Array(3*o),C=a.length,y=t?C:0,x=0;x<C;x+=3){var M=x+1,f=x+2,z=e.Cartesian3.fromArray(a,x,u);i.scaleToGeodeticSurface(z,z);var d=e.Cartesian3.clone(z,c),_=i.geodeticSurfaceNormal(z,h),v=e.Cartesian3.multiplyByScalar(_,n,m);e.Cartesian3.add(z,v,z),t&&(e.Cartesian3.multiplyByScalar(_,s,v),e.Cartesian3.add(d,v,d),l[x+y]=d.x,l[M+y]=d.y,l[f+y]=d.z),l[x]=z.x,l[M]=z.y,l[f]=z.z}return l};var x=new e.Cartesian3,M=new e.Cartesian3,f=new e.Cartesian3;n.computeEllipsePositions=function(a,t,i){var n=a.semiMinorAxis,s=a.semiMajorAxis,o=a.rotation,l=a.center,C=8*a.granularity,h=n*n,z=s*s,d=s*n,_=e.Cartesian3.magnitude(l),v=e.Cartesian3.normalize(l,x),O=e.Cartesian3.cross(e.Cartesian3.UNIT_Z,l,M);O=e.Cartesian3.normalize(O,O);var p=e.Cartesian3.cross(v,O,f),w=1+Math.ceil(r.CesiumMath.PI_OVER_TWO/C),P=r.CesiumMath.PI_OVER_TWO/(w-1),g=r.CesiumMath.PI_OVER_TWO-w*P;g<0&&(w-=Math.ceil(Math.abs(g)/P));var I,T,E,A,V,R=t?new Array(3*(w*(w+2)*2)):void 0,W=0,S=u,B=c,b=4*w*3,G=b-1,Q=0,F=i?new Array(b):void 0;for(S=y(g=r.CesiumMath.PI_OVER_TWO,o,p,O,h,d,z,_,v,S),t&&(R[W++]=S.x,R[W++]=S.y,R[W++]=S.z),i&&(F[G--]=S.z,F[G--]=S.y,F[G--]=S.x),g=r.CesiumMath.PI_OVER_TWO-P,I=1;I<w+1;++I){if(S=y(g,o,p,O,h,d,z,_,v,S),B=y(Math.PI-g,o,p,O,h,d,z,_,v,B),t){for(R[W++]=S.x,R[W++]=S.y,R[W++]=S.z,E=2*I+2,T=1;T<E-1;++T)A=T/(E-1),V=e.Cartesian3.lerp(S,B,A,m),R[W++]=V.x,R[W++]=V.y,R[W++]=V.z;R[W++]=B.x,R[W++]=B.y,R[W++]=B.z}i&&(F[G--]=S.z,F[G--]=S.y,F[G--]=S.x,F[Q++]=B.x,F[Q++]=B.y,F[Q++]=B.z),g=r.CesiumMath.PI_OVER_TWO-(I+1)*P}for(I=w;I>1;--I){if(S=y(-(g=r.CesiumMath.PI_OVER_TWO-(I-1)*P),o,p,O,h,d,z,_,v,S),B=y(g+Math.PI,o,p,O,h,d,z,_,v,B),t){for(R[W++]=S.x,R[W++]=S.y,R[W++]=S.z,E=2*(I-1)+2,T=1;T<E-1;++T)A=T/(E-1),V=e.Cartesian3.lerp(S,B,A,m),R[W++]=V.x,R[W++]=V.y,R[W++]=V.z;R[W++]=B.x,R[W++]=B.y,R[W++]=B.z}i&&(F[G--]=S.z,F[G--]=S.y,F[G--]=S.x,F[Q++]=B.x,F[Q++]=B.y,F[Q++]=B.z)}S=y(-(g=r.CesiumMath.PI_OVER_TWO),o,p,O,h,d,z,_,v,S);var H={};return t&&(R[W++]=S.x,R[W++]=S.y,R[W++]=S.z,H.positions=R,H.numPts=w),i&&(F[G--]=S.z,F[G--]=S.y,F[G--]=S.x,H.outerPositions=F),H},a.EllipseGeometryLibrary=n}));
