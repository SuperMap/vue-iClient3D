define(["exports","./when-b60132fc","./Math-3024ab74","./Cartesian2-c4c2a8f9","./EllipsoidRhumbLine-18dee174","./Cartesian4-442405e6","./Cartographic-2cfa3a3a","./FeatureDetection-caf5f946","./buildModuleUrl-c0836874","./GeometryAttribute-eb047ff3","./GeometryAttributes-252e9929","./GeometryPipeline-7ee31a30","./IndexDatatype-a3f4b187","./earcut-2.2.1-20c8012f","./PrimitiveType-ebb8c588","./WebGLConstants-aba9fc67","./Transforms-04c4d562"],(function(e,t,a,i,r,n,o,s,u,h,l,c,p,d,f,m,y){"use strict";var C={CLOCKWISE:m.WebGLConstants.CW,COUNTER_CLOCKWISE:m.WebGLConstants.CCW,validate:function(e){return e===C.CLOCKWISE||e===C.COUNTER_CLOCKWISE}},g=Object.freeze(C),v=new n.Cartesian3,b=new n.Cartesian3,E={computeArea2D:function(e){for(var t=e.length,a=0,i=t-1,r=0;r<t;i=r++){var n=e[i],o=e[r];a+=n.x*o.y-o.x*n.y}return.5*a},computeWindingOrder2D:function(e){return E.computeArea2D(e)>0?g.COUNTER_CLOCKWISE:g.CLOCKWISE},triangulate:function(e,t){var a=i.Cartesian2.packArray(e);return d.earcut(a,t,2)}},w=new n.Cartesian3,x=new n.Cartesian3,M=new n.Cartesian3,T=new n.Cartesian3,S=new n.Cartesian3,A=new n.Cartesian3,I=new n.Cartesian3;E.computeSubdivision=function(e,i,r,o,u){u=t.defaultValue(u,!1),o=t.defaultValue(o,a.CesiumMath.RADIANS_PER_DEGREE);var l,c=r.slice(0),p=i.length,d=new Array(3*p),m=0;for(l=0;l<p;l++){var y=i[l];d[m++]=y.x,d[m++]=y.y,d[m++]=y.z}for(var C=[],g={},v=e.maximumRadius,b=a.CesiumMath.chordLength(o,v),E=b*b;c.length>0;){var L,G,D=c.pop(),R=c.pop(),_=c.pop(),P=n.Cartesian3.fromArray(d,3*_,w),O=n.Cartesian3.fromArray(d,3*R,x),N=n.Cartesian3.fromArray(d,3*D,M),z=u?P:n.Cartesian3.multiplyByScalar(n.Cartesian3.normalize(P,T),v,T),B=u?O:n.Cartesian3.multiplyByScalar(n.Cartesian3.normalize(O,S),v,S),W=u?N:n.Cartesian3.multiplyByScalar(n.Cartesian3.normalize(N,A),v,A),q=n.Cartesian3.magnitudeSquared(n.Cartesian3.subtract(z,B,I)),V=n.Cartesian3.magnitudeSquared(n.Cartesian3.subtract(B,W,I)),U=n.Cartesian3.magnitudeSquared(n.Cartesian3.subtract(W,z,I)),H=Math.max(q,V,U);H>E?q===H?(l=g[L=Math.min(_,R)+" "+Math.max(_,R)],t.defined(l)||(G=n.Cartesian3.add(P,O,I),n.Cartesian3.multiplyByScalar(G,.5,G),d.push(G.x,G.y,G.z),l=d.length/3-1,g[L]=l),c.push(_,l,D),c.push(l,R,D)):V===H?(l=g[L=Math.min(R,D)+" "+Math.max(R,D)],t.defined(l)||(G=n.Cartesian3.add(O,N,I),n.Cartesian3.multiplyByScalar(G,.5,G),d.push(G.x,G.y,G.z),l=d.length/3-1,g[L]=l),c.push(R,l,_),c.push(l,D,_)):U===H&&(l=g[L=Math.min(D,_)+" "+Math.max(D,_)],t.defined(l)||(G=n.Cartesian3.add(N,P,I),n.Cartesian3.multiplyByScalar(G,.5,G),d.push(G.x,G.y,G.z),l=d.length/3-1,g[L]=l),c.push(D,l,R),c.push(l,_,R)):(C.push(_),C.push(R),C.push(D))}return new h.Geometry({attributes:{position:new h.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d})},indices:C,primitiveType:f.PrimitiveType.TRIANGLES})};var L=new o.Cartographic,G=new o.Cartographic,D=new o.Cartographic,R=new o.Cartographic;function _(){this._array=[],this._offset=0,this._length=0}E.computeRhumbLineSubdivision=function(e,i,o,u){u=t.defaultValue(u,a.CesiumMath.RADIANS_PER_DEGREE);var l,c=o.slice(0),p=i.length,d=new Array(3*p),m=0;for(l=0;l<p;l++){var y=i[l];d[m++]=y.x,d[m++]=y.y,d[m++]=y.z}for(var C=[],g={},v=e.maximumRadius,b=a.CesiumMath.chordLength(u,v),E=new r.EllipsoidRhumbLine(void 0,void 0,e),T=new r.EllipsoidRhumbLine(void 0,void 0,e),S=new r.EllipsoidRhumbLine(void 0,void 0,e);c.length>0;){var A=c.pop(),_=c.pop(),P=c.pop(),O=n.Cartesian3.fromArray(d,3*P,w),N=n.Cartesian3.fromArray(d,3*_,x),z=n.Cartesian3.fromArray(d,3*A,M),B=e.cartesianToCartographic(O,L),W=e.cartesianToCartographic(N,G),q=e.cartesianToCartographic(z,D);E.setEndPoints(B,W);var V=E.surfaceDistance;T.setEndPoints(W,q);var U=T.surfaceDistance;S.setEndPoints(q,B);var H,k,F,K,Y=S.surfaceDistance,Q=Math.max(V,U,Y);Q>b?V===Q?(l=g[H=Math.min(P,_)+" "+Math.max(P,_)],t.defined(l)||(k=E.interpolateUsingFraction(.5,R),F=.5*(B.height+W.height),K=n.Cartesian3.fromRadians(k.longitude,k.latitude,F,e,I),d.push(K.x,K.y,K.z),l=d.length/3-1,g[H]=l),c.push(P,l,A),c.push(l,_,A)):U===Q?(l=g[H=Math.min(_,A)+" "+Math.max(_,A)],t.defined(l)||(k=T.interpolateUsingFraction(.5,R),F=.5*(W.height+q.height),K=n.Cartesian3.fromRadians(k.longitude,k.latitude,F,e,I),d.push(K.x,K.y,K.z),l=d.length/3-1,g[H]=l),c.push(_,l,P),c.push(l,A,P)):Y===Q&&(l=g[H=Math.min(A,P)+" "+Math.max(A,P)],t.defined(l)||(k=S.interpolateUsingFraction(.5,R),F=.5*(q.height+B.height),K=n.Cartesian3.fromRadians(k.longitude,k.latitude,F,e,I),d.push(K.x,K.y,K.z),l=d.length/3-1,g[H]=l),c.push(A,l,_),c.push(l,P,_)):(C.push(P),C.push(_),C.push(A))}return new h.Geometry({attributes:{position:new h.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d})},indices:C,primitiveType:f.PrimitiveType.TRIANGLES})},E.scaleToGeodeticHeight=function(e,a,i,r){i=t.defaultValue(i,u.Ellipsoid.WGS84);var o=v,s=b;if(a=t.defaultValue(a,0),r=t.defaultValue(r,!0),t.defined(e))for(var h=e.length,l=0;l<h;l+=3)n.Cartesian3.fromArray(e,l,s),r&&(s=i.scaleToGeodeticSurface(s,s)),0!==a&&(o=i.geodeticSurfaceNormal(s,o),n.Cartesian3.multiplyByScalar(o,a,o),n.Cartesian3.add(s,o,s)),e[l]=s.x,e[l+1]=s.y,e[l+2]=s.z;return e},Object.defineProperties(_.prototype,{length:{get:function(){return this._length}}}),_.prototype.enqueue=function(e){this._array.push(e),this._length++},_.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,a=e[t];return e[t]=void 0,++t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,a}},_.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},_.prototype.contains=function(e){return-1!==this._array.indexOf(e)},_.prototype.clear=function(){this._array.length=this._offset=this._length=0},_.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var P={computeHierarchyPackedLength:function(e){for(var a=0,i=[e];i.length>0;){var r=i.pop();if(t.defined(r)){a+=2;var o=r.positions,s=r.holes;if(t.defined(o)&&(a+=o.length*n.Cartesian3.packedLength),t.defined(s))for(var u=s.length,h=0;h<u;++h)i.push(s[h])}}return a},packPolygonHierarchy:function(e,a,i){for(var r=[e];r.length>0;){var o=r.pop();if(t.defined(o)){var s=o.positions,u=o.holes;if(a[i++]=t.defined(s)?s.length:0,a[i++]=t.defined(u)?u.length:0,t.defined(s))for(var h=s.length,l=0;l<h;++l,i+=3)n.Cartesian3.pack(s[l],a,i);if(t.defined(u))for(var c=u.length,p=0;p<c;++p)r.push(u[p])}}return i},unpackPolygonHierarchy:function(e,t){for(var a=e[t++],i=e[t++],r=new Array(a),o=i>0?new Array(i):void 0,s=0;s<a;++s,t+=n.Cartesian3.packedLength)r[s]=n.Cartesian3.unpack(e,t);for(var u=0;u<i;++u)o[u]=P.unpackPolygonHierarchy(e,t),t=o[u].startingIndex,delete o[u].startingIndex;return{positions:r,holes:o,startingIndex:t}}},O=new n.Cartesian3;function N(e,t,a,i){return n.Cartesian3.subtract(t,e,O),n.Cartesian3.multiplyByScalar(O,a/i,O),n.Cartesian3.add(e,O,O),[O.x,O.y,O.z]}P.subdivideLineCount=function(e,t,i){var r=n.Cartesian3.distance(e,t)/i,o=Math.max(0,Math.ceil(a.CesiumMath.log2(r)));return Math.pow(2,o)};var z=new o.Cartographic,B=new o.Cartographic,W=new o.Cartographic,q=new n.Cartesian3;P.subdivideRhumbLineCount=function(e,t,i,n){var o=e.cartesianToCartographic(t,z),s=e.cartesianToCartographic(i,B),u=new r.EllipsoidRhumbLine(o,s,e).surfaceDistance/n,h=Math.max(0,Math.ceil(a.CesiumMath.log2(u)));return Math.pow(2,h)},P.subdivideLine=function(e,a,i,r){var o=P.subdivideLineCount(e,a,i),s=n.Cartesian3.distance(e,a),u=s/o;t.defined(r)||(r=[]);var h=r;h.length=3*o;for(var l=0,c=0;c<o;c++){var p=N(e,a,c*u,s);h[l++]=p[0],h[l++]=p[1],h[l++]=p[2]}return h},P.subdivideRhumbLine=function(e,i,n,o,s){var u=e.cartesianToCartographic(i,z),h=e.cartesianToCartographic(n,B),l=new r.EllipsoidRhumbLine(u,h,e),c=l.surfaceDistance/o,p=Math.max(0,Math.ceil(a.CesiumMath.log2(c))),d=Math.pow(2,p),f=l.surfaceDistance/d;t.defined(s)||(s=[]);var m=s;m.length=3*d;for(var y=0,C=0;C<d;C++){var g=l.interpolateUsingSurfaceDistance(C*f,W),v=e.cartographicToCartesian(g,q);m[y++]=v.x,m[y++]=v.y,m[y++]=v.z}return m};var V=new n.Cartesian3,U=new n.Cartesian3,H=new n.Cartesian3,k=new n.Cartesian3;P.scaleToGeodeticHeightExtruded=function(e,a,i,r,o){r=t.defaultValue(r,u.Ellipsoid.WGS84);var s=V,h=U,l=H,c=k;if(t.defined(e)&&t.defined(e.attributes)&&t.defined(e.attributes.position))for(var p=e.attributes.position.values,d=p.length/2,f=0;f<d;f+=3)n.Cartesian3.fromArray(p,f,l),r.geodeticSurfaceNormal(l,s),c=r.scaleToGeodeticSurface(l,c),h=n.Cartesian3.multiplyByScalar(s,i,h),h=n.Cartesian3.add(c,h,h),p[f+d]=h.x,p[f+1+d]=h.y,p[f+2+d]=h.z,o&&(c=n.Cartesian3.clone(l,c)),h=n.Cartesian3.multiplyByScalar(s,a,h),h=n.Cartesian3.add(c,h,h),p[f]=h.x,p[f+1]=h.y,p[f+2]=h.z;return e},P.polygonOutlinesFromHierarchy=function(e,a,i){var o,s,u,h=[],l=new _;for(l.enqueue(e);0!==l.length;){var c=l.dequeue(),p=c.positions;if(a)for(u=p.length,o=0;o<u;o++)i.scaleToGeodeticSurface(p[o],p[o]);if(!((p=r.arrayRemoveDuplicates(p,n.Cartesian3.equalsEpsilon,!0)).length<3)){var d=c.holes?c.holes.length:0;for(o=0;o<d;o++){var f=c.holes[o],m=f.positions;if(a)for(u=m.length,s=0;s<u;++s)i.scaleToGeodeticSurface(m[s],m[s]);if(!((m=r.arrayRemoveDuplicates(m,n.Cartesian3.equalsEpsilon,!0)).length<3)){h.push(m);var y=0;for(t.defined(f.holes)&&(y=f.holes.length),s=0;s<y;s++)l.enqueue(f.holes[s])}}h.push(p)}}return h};var F=new n.Cartesian3(6378137,6378137,6378137);P.polygonsFromHierarchy=function(e,i,o,s){var u=[],h=[],l=new _;for(l.enqueue(e);0!==l.length;){var c,p,d,f=l.dequeue(),m=f.positions,y=f.holes,C=m.slice();if(o)for(p=m.length,c=0;c<p;c++)s.scaleToGeodeticSurface(m[c],C[c]);if(t.defined(s)&&!n.Cartesian3.equals(s._radii,F)&&(d=a.CesiumMath.EPSILON7),!((m=r.arrayRemoveDuplicates(C,n.Cartesian3.equalsEpsilon,!0,d)).length<3)){var v=i(m);if(t.defined(v)){var b=[],w=E.computeWindingOrder2D(v);w===g.CLOCKWISE&&(v.reverse(),m=m.slice().reverse());var x,M=m.slice(),T=t.defined(y)?y.length:0,S=[];for(c=0;c<T;c++){var A=y[c],I=A.positions;if(o)for(p=I.length,x=0;x<p;++x)s.scaleToGeodeticSurface(I[x],I[x]);if(!((I=r.arrayRemoveDuplicates(I,n.Cartesian3.equalsEpsilon,!0,a.CesiumMath.EPSILON7)).length<3)){var L=i(I);if(t.defined(L)){(w=E.computeWindingOrder2D(L))===g.CLOCKWISE&&(L.reverse(),I=I.slice().reverse()),S.push(I),b.push(M.length),M=M.concat(I),v=v.concat(L);var G=0;for(t.defined(A.holes)&&(G=A.holes.length),x=0;x<G;x++)l.enqueue(A.holes[x])}}}u.push({outerRing:m,holes:S}),h.push({positions:M,positions2D:v,holes:b})}}}return{hierarchy:u,polygons:h}};var K=new i.Cartesian2,Y=new n.Cartesian3,Q=new y.Quaternion,j=new i.Matrix3;P.computeBoundingRectangle=function(e,a,r,o,s){for(var u=y.Quaternion.fromAxisAngle(e,o,Q),h=i.Matrix3.fromQuaternion(u,j),l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,p=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,f=r.length,m=0;m<f;++m){var C=n.Cartesian3.clone(r[m],Y);i.Matrix3.multiplyByVector(h,C,C);var g=a(C,K);t.defined(g)&&(l=Math.min(l,g.x),c=Math.max(c,g.x),p=Math.min(p,g.y),d=Math.max(d,g.y))}return s.x=l,s.y=p,s.width=c-l,s.height=d-p,s},P.createGeometryFromPositions=function(e,t,a,i,n,o){var u=E.triangulate(t.positions2D,t.holes);u.length<3&&(u=[0,1,2]);var l=t.positions;if(i){for(var p=l.length,d=new Array(3*p),m=0,y=0;y<p;y++){var C=l[y];d[m++]=C.x,d[m++]=C.y,d[m++]=C.z}var g=new h.Geometry({attributes:{position:new h.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d})},indices:u,primitiveType:f.PrimitiveType.TRIANGLES});return n.normal?c.GeometryPipeline.computeNormal(g):g}return o===r.ArcType.GEODESIC?E.computeSubdivision(e,l,u,a):o===r.ArcType.RHUMB?E.computeRhumbLineSubdivision(e,l,u,a):void 0};var J=[],X=new n.Cartesian3,Z=new n.Cartesian3;P.computeWallGeometry=function(e,t,i,o,u){var c,d,m,y,C,g=e.length,v=0;if(o)for(d=3*g*2,c=new Array(2*d),m=0;m<g;m++)y=e[m],C=e[(m+1)%g],c[v]=c[v+d]=y.x,c[++v]=c[v+d]=y.y,c[++v]=c[v+d]=y.z,c[++v]=c[v+d]=C.x,c[++v]=c[v+d]=C.y,c[++v]=c[v+d]=C.z,++v;else{var b=a.CesiumMath.chordLength(i,t.maximumRadius),E=0;if(u===r.ArcType.GEODESIC)for(m=0;m<g;m++)E+=P.subdivideLineCount(e[m],e[(m+1)%g],b);else if(u===r.ArcType.RHUMB)for(m=0;m<g;m++)E+=P.subdivideRhumbLineCount(t,e[m],e[(m+1)%g],b);for(d=3*(E+g),c=new Array(2*d),m=0;m<g;m++){var w;y=e[m],C=e[(m+1)%g],u===r.ArcType.GEODESIC?w=P.subdivideLine(y,C,b,J):u===r.ArcType.RHUMB&&(w=P.subdivideRhumbLine(t,y,C,b,J));for(var x=w.length,M=0;M<x;++M,++v)c[v]=w[M],c[v+d]=w[M];c[v]=C.x,c[v+d]=C.x,c[++v]=C.y,c[v+d]=C.y,c[++v]=C.z,c[v+d]=C.z,++v}}g=c.length;var T=p.IndexDatatype.createTypedArray(g/3,g-6*e.length),S=0;for(g/=6,m=0;m<g;m++){var A=m,I=A+1,L=A+g,G=L+1;y=n.Cartesian3.fromArray(c,3*A,X),C=n.Cartesian3.fromArray(c,3*I,Z),n.Cartesian3.equalsEpsilon(y,C,a.CesiumMath.EPSILON10,a.CesiumMath.EPSILON10)||(T[S++]=A,T[S++]=L,T[S++]=I,T[S++]=I,T[S++]=L,T[S++]=G)}return new h.Geometry({attributes:new l.GeometryAttributes({position:new h.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:c})}),indices:T,primitiveType:f.PrimitiveType.TRIANGLES})},e.GeometryInstance=function(e){e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT),this.geometry=e.geometry,this.modelMatrix=i.Matrix4.clone(t.defaultValue(e.modelMatrix,i.Matrix4.IDENTITY)),this.id=e.id,this.pickPrimitive=e.pickPrimitive,this.attributes=t.defaultValue(e.attributes,{}),this.westHemisphereGeometry=void 0,this.eastHemisphereGeometry=void 0},e.PolygonGeometryLibrary=P,e.PolygonPipeline=E,e.WindingOrder=g}));
