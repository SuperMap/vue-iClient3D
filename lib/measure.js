import{reactive as e,toRefs as t,watch as r,onBeforeUnmount as n,resolveDirective as a,withDirectives as i,openBlock as o,createBlock as s,createVNode as l,toDisplayString as u,createCommentVNode as c,vModelSelect as p,vModelCheckbox as d,vShow as m}from"vue";function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function S(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function g(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?S(Object(r),!0).forEach((function(t){v(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var M,h,f=function(e){for(var t=[].concat(e),r=[],n=0,a=t.length;n<a;n++){var i=SuperMap3D.Cartographic.fromCartesian(t[n]),o=SuperMap3D.Math.toDegrees(i.longitude),s=SuperMap3D.Math.toDegrees(i.latitude),l=i.height;-1==r.indexOf(o)&&-1==r.indexOf(s)&&(r.push(o),r.push(s),r.push(l))}return r},b=(h=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=h,h).toLowerCase();(M=void 0!==b?b:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||M.startsWith("ja");var y=e({isViewer:!1,changeLayers:0,changeGeometrys:0});function C(a){var i,o,s,l,u,c,p,d=e({measureMode:"Space",clampMode:SuperMap3D.ClampMode.Space,Ellipsoid:null,contourColor:"#ff7d00",isShowDVH:!1,isShowLine:!0,pickPointEnabled:!0});(u=new SuperMap3D.HypsometricSetting).DisplayMode=SuperMap3D.HypsometricSettingEnum.DisplayMode.LINE;var m=new SuperMap3D.ColorTable;u._lineColor=SuperMap3D.Color.fromCssColorString(d.contourColor),u.ColorTable=m,u.Opacity=.6,u.MaxVisibleValue=-100,u.MinVisibleValue=-100;var v=function(){setInterval((function(){console.log("now-state.pickPointEnabled:",d.pickPointEnabled)}),2e3),i=viewer.scene.layers.layerQueue,viewer.scene.globe.HypsometricSetting={hypsometricSetting:u,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_ALL},y.changeLayers&&S(),o=new SuperMap3D.MeasureHandler(viewer,SuperMap3D.MeasureMode.Distance,d.clampMode),s=new SuperMap3D.MeasureHandler(viewer,SuperMap3D.MeasureMode.Area,d.clampMode),l=new SuperMap3D.MeasureHandler(viewer,SuperMap3D.MeasureMode.DVH),o.activeEvt.addEventListener((function(e){1==e?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.scene.pickPointEnabled=d.pickPointEnabled):(viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),viewer.scene.pickPointEnabled=!1)})),o.measureEvt.addEventListener((function(e){var t=Number(e.distance),r=d.measureMode;"CGCS2000"!=r&&"XIAN80"!=r&&"WGS84"!=r||(t=Number(function(e){for(var t=[],r=0;r<e.length;r++){var n=SuperMap3D.Cartographic.fromCartesian(e[r]),a=SuperMap3D.Math.toDegrees(n.longitude),i=SuperMap3D.Math.toDegrees(n.latitude);t.push(a,i)}var o=new SuperMap3D.PolylineGeometry({positions:SuperMap3D.Cartesian3.fromDegreesArray(t)});return scene.globe.computeSurfaceDistance(o,d.Ellipsoid)}(e.positions)));var n=t>1e3?(t/1e3).toFixed(2)+"km":t.toFixed(2)+"m";o.disLabel.text="距离:"+n})),s.activeEvt.addEventListener((function(e){1==e?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.scene.pickPointEnabled=d.pickPointEnabled):(viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),viewer.scene.pickPointEnabled=!1)})),s.measureEvt.addEventListener((function(e){var t=Number(e.area),r=d.measureMode;"CGCS2000"==r||"XIAN80"==r||"WGS84"==r?t=Number(function(e){for(var t=[],r=0;r<e.length;r++){var n=SuperMap3D.Cartographic.fromCartesian(e[r]),a=SuperMap3D.Math.toDegrees(n.longitude),i=SuperMap3D.Math.toDegrees(n.latitude);t.push(a,i)}var o=new SuperMap3D.PolygonGeometry.fromPositions({positions:SuperMap3D.Cartesian3.fromDegreesArray(t)});return scene.globe.computeSurfaceArea(o,d.Ellipsoid)}(e.positions)):"6"==r&&(t=Number(function(e){for(var t=0,r=0;r<e.length;r++){var n=SuperMap3D.Cartographic.fromCartesian(e[r]);t+=SuperMap3D.Math.toDegrees(n.longitude)}for(var a=Math.round((t/e.length+6)/6),i=6*a-3,o=new SuperMap3D.CustomProjection({name:"tmerc",centralMeridian:i,primeMeridian:0,standardParallel_1:0,standardParallel_2:0,eastFalse:5e5,northFalse:0,semimajorAxis:6378137,inverseFlattening:298.257222101}),s=[],l=0;l<e.length;l++){var u=SuperMap3D.Cartographic.fromCartesian(e[l]),c=o.project(u);s.push(c)}return s.push(s[0]),SuperMap3D.getPreciseArea(s,"China2000",i,a,1)}(e.positions)));var n=t>1e6?(t/1e6).toFixed(2)+"km²":t.toFixed(2)+"㎡";s.areaLabel.text="面积:"+n})),l.measureEvt.addEventListener((function(e){var t=e.distance>1e3?(e.distance/1e3).toFixed(2)+"km":e.distance+"m",r=e.verticalHeight>1e3?(e.verticalHeight/1e3).toFixed(2)+"km":e.verticalHeight+"m",n=e.horizontalDistance>1e3?(e.horizontalDistance/1e3).toFixed(2)+"km":e.horizontalDistance+"m";l.disLabel.text="空间距离:"+t,l.vLabel.text="垂直高度:"+r,l.hLabel.text="水平距离:"+n,c=Number(e.endHeight),d.isShowLine&&M(c)})),l.activeEvt.addEventListener((function(e){1==e?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.scene.pickPointEnabled=d.pickPointEnabled):(viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),viewer.scene.pickPointEnabled=!1)}))};function S(){for(var e=0;e<i.length;e++)i[e].hypsometricSetting={hypsometricSetting:u,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_ALL};p=!0}function M(e){if(viewer.scene.globe.HypsometricSetting.hypsometricSetting.MaxVisibleValue=e,viewer.scene.globe.HypsometricSetting.hypsometricSetting.MinVisibleValue=e,p)for(var t=0;t<i.length;t++)i[t].hypsometricSetting.hypsometricSetting?(i[t].hypsometricSetting.hypsometricSetting.MaxVisibleValue=e,i[t].hypsometricSetting.hypsometricSetting.MinVisibleValue=e):S()}function h(e){var t=scene.pickPosition(e.message.position);f(t)[2]}function b(){M(-1e4),viewer.eventManager.removeEventListener("CLICK",h)}function C(){o&&o.deactivate(),s&&s.deactivate(),l&&l.deactivate(),d.isShowDVH=!1,d.Ellipsoid=null,c=-1e4}return y.isViewer&&v(),r((function(){return y.isViewer}),(function(e){e&&v()})),r((function(){return y.changeLayers}),(function(e){S()})),r((function(){return d.isShowLine}),(function(e){M(e?c:-1e4)})),r((function(){return d.pickPointEnabled}),(function(e){viewer.scene.pickPointEnabled=e})),r((function(){return d.measureMode}),(function(e){"Space"==e?(d.clampMode=SuperMap3D.ClampMode.Space,s.clampMode=SuperMap3D.ClampMode.Space,o.clampMode=SuperMap3D.ClampMode.Space):(d.clampMode=SuperMap3D.ClampMode.Ground,s.clampMode=SuperMap3D.ClampMode.Ground,o.clampMode=SuperMap3D.ClampMode.Ground,d.Ellipsoid="XIAN80"==e?SuperMap3D.Ellipsoid.XIAN80:"CGCS2000"==e?SuperMap3D.Ellipsoid.CGCS2000:"WGS84"==e?SuperMap3D.Ellipsoid.WGS84:null)})),n((function(){u.destroy(),i=void 0})),g(g({},t(d)),{},{distanceClk:function(){C(),o&&o.activate()},areaClk:function(){C(),s&&s.activate()},heightClk:function(){p||S(),b(),viewer.eventManager.addEventListener("CLICK",h,!0),C(),d.isShowDVH=!0,l&&l.activate()},clear:function(){C(),o&&o.clear(),s&&s.clear(),l&&l.clear(),b(),viewer.scene.pickPointEnabled=!1}})}var D={name:"Sm3dMeasure",setup:function(e){var t=C();return{measureMode:t.measureMode,isShowDVH:t.isShowDVH,interval:t.interval,isShowLine:t.isShowLine,distanceClk:t.distanceClk,areaClk:t.areaClk,heightClk:t.heightClk,clear:t.clear}}},w={id:"measure-panel",class:"sm-panel"},k={class:"sm-function-module-sub-section",style:{margin:"0"}},L={class:"sm-half-L"},E={class:"label-S"},P={selected:"",value:"Space"},V={value:"Ground"},x=l("option",{selected:"",value:"CGCS2000"},"CGCS2000",-1),G=l("option",{value:"XIAN80"},"XIAN80",-1),H=l("option",{value:"WGS84"},"WGS84",-1),j={value:"null"},O=l("span",{class:"iconfont iconkongjianjuli"},null,-1),A=l("span",{class:"iconfont icongaoduceliang"},null,-1),R=l("span",{class:"iconfont iconkongjianmianji"},null,-1),N=l("span",{class:"iconfont iconqingchu"},null,-1),_={class:"sm-half-L flex-start",style:{"margin-top":"6px"}},F={style:{"margin-left":"10%"}};D.render=function(e,t,r,n,v,S){var g=a("stopdrag"),M=a("drag");return i((o(),s("div",w,[i(l("div",k,[l("div",L,[l("label",E,u(e.Resource.selectMode),1),i(l("select",{class:"sm-select-m","onUpdate:modelValue":t[1]||(t[1]=function(e){return n.measureMode=e})},[l("option",P,u(e.Resource.measureSpace),1),l("option",V,u(e.Resource.measureGround),1),x,G,H,l("option",j,u(e.Resource.planeProjection),1),c(' <option value="2">+ Resource.skylinesectorbody +</option> // 需要iServer910支持 ')],512),[[p,n.measureMode]])]),l("button",{onClick:t[2]||(t[2]=function(){return n.distanceClk&&n.distanceClk.apply(n,arguments)}),class:["sm-btn","null"===n.measureMode?"pointer-events":""],id:"distance",title:e.Resource.measureDistance,type:"button",disabled:"null"===n.measureMode},[O],10,["title","disabled"]),l("button",{onClick:t[3]||(t[3]=function(){return n.heightClk&&n.heightClk.apply(n,arguments)}),class:["sm-btn","Space"!=n.measureMode&&"Ground"!=n.measureMode?"pointer-events":""],id:"height",title:e.Resource.measureHeight,type:"button",disabled:"Space"!=n.measureMode&&"Ground"!=n.measureMode},[A],10,["title","disabled"]),l("button",{onClick:t[4]||(t[4]=function(){return n.areaClk&&n.areaClk.apply(n,arguments)}),class:"sm-btn",id:"area",title:e.Resource.measureSurface,type:"button"},[R],8,["title"]),l("button",{onClick:t[5]||(t[5]=function(){return n.clear&&n.clear.apply(n,arguments)}),class:"sm-btn",id:"clear",title:e.Resource.clear,type:"button"},[N],8,["title"]),i(l("div",_,[i(l("input",{checked:"",id:"showLine",style:{"margin-left":"6px"},type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=function(e){return n.isShowLine=e})},null,512),[[d,n.isShowLine]]),l("span",F,u(e.Resource.showContour),1)],512),[[m,n.isShowDVH]])],512),[[g]])],512)),[[M]])},D.__file="src/components/analysis_3d/measure/measure.vue",D.install=function(e){e.component(D.name,D)};export default D;
