import{reactive as e,toRefs as t,ref as n,onMounted as o,watch as r,onBeforeUnmount as i,resolveDirective as a,openBlock as l,createBlock as s,Fragment as p,withDirectives as d,createVNode as c,vModelCheckbox as u,toDisplayString as w,vShow as y}from"vue";function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var S=function(e,t){if(!e||!t)return!0;var n=!0;if(Object.keys(e).length!=Object.keys(t).length)return!1;for(var o in e)if("object"==f(e[o])){if(!(n=isSame(e[o],t[o])))break}else if(e[o]!=t[o]){n=!1;break}return n},M=function(e){for(var t=[].concat(e),n=[],o=0,r=t.length;o<r;o++){var i=SuperMap3D.Cartographic.fromCartesian(t[o]),a=SuperMap3D.Math.toDegrees(i.longitude),l=SuperMap3D.Math.toDegrees(i.latitude),s=i.height;-1==n.indexOf(a)&&-1==n.indexOf(l)&&(n.push(a),n.push(l),n.push(s))}return n};var D,x,C={errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},P=function(e){for(var t=[].concat(e),n=[],o=0,r=t.length;o<r;o++){var i=SuperMap3D.Cartographic.fromCartesian(t[o]),a={longitude:SuperMap3D.Math.toDegrees(i.longitude),latitude:SuperMap3D.Math.toDegrees(i.latitude),height:i.height};n.push(a)}return n},E={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},O=(x=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=x,x).toLowerCase();var k=((D=void 0!==O?O:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||D.startsWith("ja"),E),L=e({isViewer:!1,changeLayers:0,changeGeometrys:0});var _=function(e,t){var n=0;switch(t&&(n=t),e){case"Point":window.handlerPoint=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Point);break;case"Polyline":window.handlerPolyline=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Line,n);break;case"Polygon":window.handlerPolygon=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Polygon,n);break;case"Marker":window.handlerMarker=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Marker,n);break;case"Box":window.handlerBox=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box,n)}window.tooltip||(window.tooltip=function(e){var t=function(e){var t=document.createElement("DIV");t.className="twipsy right";var n=document.createElement("DIV");n.className="twipsy-arrow",t.appendChild(n);var o=document.createElement("DIV");o.className="twipsy-inner",t.appendChild(o),this._div=t,this._title=o,this.message="",e.appendChild(t);var r=this;t.onmousemove=function(e){r.showAt({x:e.clientX,y:e.clientY},r.message)}};return t.prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},t.prototype.showAt=function(e,t){e&&t&&(this.setVisible(!0),this._title.innerHTML=t,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px",this.message=t)},new t(e)}(viewer._element)),window.polylineCollection||(window.polylineCollection=new SuperMap3D.PolylineCollection({translucentRS:SuperMap3D.RenderState.fromCache({depthMask:!1,depthTest:{enabled:!1}})}),window.polylineTransparent=window.polylineCollection.add({width:2,material:SuperMap3D.Material.fromType(SuperMap3D.Material.ColorType,{color:SuperMap3D.Color.fromCssColorString("#51ff00").withAlpha(.3)})}),viewer.scene.primitives.add(window.polylineCollection))},H=function(e){var t;switch(e){case"Point":t=window.handlerPoint;break;case"Polyline":t=window.handlerPolyline;break;case"Polygon":t=window.handlerPolygon;break;case"Marker":t=window.handlerMarker;break;case"Box":t=window.handlerBox}return t};function I(e){var t=function(e){var t=document.createElement("DIV");t.className="tooltip",this._div=t,this.message="",e.appendChild(t)};return t.prototype.setVisible=function(e){this._div.style.right=e?"10px":"-300px"},t.prototype.showAt=function(e,t){t&&(this._div.style.top=t),e&&(this.setVisible(!0),this._div.innerHTML=e)},new t(e)}function A(a){var l,s,p,d=e({profile2d:!0,polylineColor:"rgb(250, 213, 6)",polylineWidth:5,initEchartsOption:null,updateEchartsOption:null});if(a)for(var c in a)d.hasOwnProperty(c)?d[c]=a[c]:C.errorMsg(k.AttributeError+c);var u=!0,w=[],y=[],f=null,h=n(null);function v(){window.echarts?(l||(l=window.echarts.init(h.value),window.onresize=function(){l.resize()}),d.initEchartsOption?l.setOption(d.initEchartsOption):l.setOption({title:{text:"剖面分析",textStyle:{fontSize:14}},grid:{left:30,right:0,top:30,bottom:8},tooltip:{},xAxis:{data:[]},yAxis:{data:[]},series:[{type:"bar",data:[]}]})):C.warnMsg(k.EchartsErr)}function b(e,t){d.profile2d=!0,l.clear(),l.showLoading(),w.length=0,y.length=0;for(var n=[],o=1,r=t.length;o<r;o++){var i=t[o-1],a=t[o],c=SuperMap3D.Cartesian3.distance(i,a);D(parseInt(c));for(var u=1,f=s;u<=f;u++)n.push(SuperMap3D.Cartesian3.lerp(i,a,u/s,new SuperMap3D.Cartesian3))}viewer.scene.clampToHeightMostDetailed(n).then((function(e){w=P(y=e),function(){if(l.hideLoading(),l.clear(),d.updateEchartsOption)return void l.setOption(d.updateEchartsOption);var e={title:{text:"剖面信息",textStyle:{fontSize:14}},grid:{left:50,right:8,top:40,bottom:20},tooltip:{trigger:"axis",backgroundColor:"#ffffff",textStyle:{color:"#000"},formatter:function(e){var t=e[0].dataIndex;return p=y[t],['当前位置: <hr size=1 style="margin: 3px 0">',"经度: "+w[t].longitude.toFixed(6)+"<br/>","纬度: "+w[t].latitude.toFixed(6)+"<br/>","海拔: "+w[t].height.toFixed(2)+"米<br/>"].join("")}},xAxis:{data:w.map((function(e,t){return t})),show:!1},yAxis:{min:function(e){return e.min<20?0:Math.floor(e.min)},axisLabel:{interval:"auto",formatter:function(e,t){return e>999?(e/1e3).toFixed(2)+"km":e+"m"}},splitLine:{show:!0}},toolbox:{left:"right",feature:{saveAsImage:{}}},dataZoom:[{type:"inside",xAxisIndex:0,filterMode:"filter",start:0,end:100}],series:{name:"height",type:"line",data:w.map((function(e){return e.height})),areaStyle:{}}};l.setOption(e)}()}))}function D(e){s=e/1e4>1?parseInt(e/100):e/1e3>5?parseInt(e/10):e/1e3>2?parseInt(e/5):e/1e3>1?parseInt(e/2):e/100>5?parseInt(e/1.5):e/100>2?e:2*e}function x(){var e,t;d.profile2d=!1,viewer.entities.removeById("location4"),viewer.entities.removeById("polyline-profile"),l.clear(),w.length=0,y.length=0,(t=(e="Polyline")?H(e):window.handlerPolygon)&&(t.deactivate(),t.clear(),viewer.enableCursorStyle=!0,window.tooltip.setVisible(!1),window.polylineTransparent&&(window.polylineTransparent.show=!1)),window.editHandler&&(window.editHandler.deactivate(),window.editHandler.clear()),window.selectHandler&&(window.selectHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_UP),window.selectHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),window.selectHandler.destroy(),window.selectHandler=null),v(),tooltip.setVisible(!1)}return o((function(){v()})),L.isViewer&&(window.tooltip||(window.tooltip=I(viewer._element))),r((function(){return L.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=I(viewer._element)))})),r((function(){return d.profile2d}),(function(e){e&&l?setTimeout((function(){l.resize()}),200):d.getSkyline2d=!1})),i((function(){x(),l.clear(),w.length=0,y.length=0})),g(g({},t(d)),{},{echarts_box:h,myChart:l,Entypositions:p,LatAndLons:w,Cartesians:y,analysis:function(){u&&(tooltip.showAt(" <p>点击鼠标左键开始绘制</p> <p>单击右键结束分析</p><p>选中可进行编辑</p>","250px"),u=!1),window.handlerPolyline||_("Polyline"),function(e,t,n){var o=!0;!1===t&&(o=t);var r=H(e);return new Promise((function(t,n){var i=window.tooltip,a=r.activeEvt.addEventListener((function(t){1==t?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="","Point"==e||"Marker"==e?document.body.classList.add("measureCur"):document.body.classList.add("drawCur")):(viewer.enableCursorStyle=!0,i.setVisible(!1),"Point"==e||"Marker"==e?document.body.classList.remove("measureCur"):document.body.classList.remove("drawCur"))})),l=r.movingEvt.addEventListener((function(t){if(t.x<200&&t.y<150)i.setVisible(!1);else if(r.polyline&&r.isDrawing){var n=m(r.positions);"Polygon"==e&&n.push(n[0]),window.polylineTransparent.show=!0,window.polylineTransparent.positions=n}})),s=r.drawEvt.addEventListener((function(n){if(!n.object.positions&&"Point"!=e&&"Box"!=e)return i.showAt(n,"<p>请绘制正确的多边形</p>"),r.polygon.show=!1,r.polyline.show=!1,r.deactivate(),void r.activate();if("Box"!=e){if("Point"==e||"Marker"==e)r.clear(),t({result:n});else{if(window.polylineTransparent.show=o,o&&"Polygon"==e&&o){r.polygon._polygon._material._color._value.alpha=.1;var p=m(n.object.positions);p.push(p[0]),window.polylineTransparent.positions=p}var d=M(n.object.positions);t({result:n,positions:d})}a(),l(),s()}else t({result:n})}))}))}("Polyline").then((function(e){l.showLoading(),f=e.positions,function(e){viewer.entities.removeById("polyline-profile"),viewer.entities.removeById("location4");var t=SuperMap3D.Color.fromCssColorString(d.polylineColor);viewer.entities.add({id:"polyline-profile",polyline:{positions:SuperMap3D.Cartesian3.fromDegreesArrayHeights(e),width:d.polylineWidth,material:t,clampToGround:!0}}),function(){if(viewer.entities.getById("location4"))return;viewer.entities.add({id:"location4",position:new SuperMap3D.CallbackProperty((function(){return p}),!1),billboard:{image:"src/style/images/location4.png",width:30,height:40,scaleByDistance:new SuperMap3D.NearFarScalar(10,1,2e3,.6),eyeOffset:new SuperMap3D.Cartesian3(0,1,-5)}})}()}(e.positions);var t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),b("",e.result.positions),function(e,t,n){window.selectHandler||(window.selectHandler=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas));var o=window.selectHandler;window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!0),o.setInputAction((function(){console.log("viewer.selectedEntity:",viewer.selectedEntity);var r=viewer.selectedEntity,i=window.editHandler;r&&(i&&i&&i.clear(),i?(i.deactivate(),i.setEditObject(r),i.activate()):(window.editHandler=new SuperMap3D.EditHandler(viewer,r),window.editHandler.isEditZ=t||!1,window.editHandler.activate()),o.setInputAction((function(){if(r=viewer.selectedEntity,i=window.editHandler,r&&i&&i._positions){var t=M(i._positions);if(S(e,t))return;if(e=t,n&&n(t,window.editHandler),window.handlerPolygon&&window.handlerPolygon.polygon&&window.handlerPolygon.polygon.show){var o=m(i._positions);o.push(o[0]),window.polylineTransparent.positions=o}}}),SuperMap3D.ScreenSpaceEventType.LEFT_UP))}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)}(f,!1,b),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()},clear:x})}var j={name:"Sm3dProfile",props:{profile2d:{type:Boolean,default:!0},polylineColor:{type:String},polylineWidth:{type:Number},initEchartsOption:{type:Object},updateEchartsOption:{type:Object}},setup:function(e){var t=A(e);return{profile2d:t.profile2d,analysis:t.analysis,clear:t.clear,echarts_box:t.echarts_box}}},T={id:"profile",class:"sm-panel"},B={class:"sm-function-module-sub-section",style:{margin:"0"}},V={class:"sm-half-L"},F={style:{width:"80%"}},z={class:"boxchild flex-between"},N={ref:"echarts_box",id:"echarts_box"};j.render=function(e,t,n,o,r,i){var f=a("stopdrag"),h=a("drag");return l(),s(p,null,[d(c("div",T,[d(c("div",B,[c("div",V,[d(c("input",{checked:"",type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=function(e){return o.profile2d=e})},null,512),[[u,o.profile2d]]),c("label",F,w(e.Resource.profileInformation),1)]),c("div",z,[c("button",{type:"button",class:"tbtn",onClick:t[2]||(t[2]=function(){return o.analysis&&o.analysis.apply(o,arguments)})},w(e.Resource.analyze),1),c("button",{type:"button",class:"tbtn tbtn-margin-left",onClick:t[3]||(t[3]=function(){return o.clear&&o.clear.apply(o,arguments)})},w(e.Resource.clear),1)])],512),[[f]])],512),[[h]]),d(c("div",N,null,512),[[y,o.profile2d]])],64)},j.__file="src/components/analysis_3d/profile/profile.vue",j.install=function(e){e.component(j.name,j)};export default j;
