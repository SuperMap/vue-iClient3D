import{reactive as e,toRefs as r,ref as n,watch as t,onMounted as a,onBeforeUnmount as i,resolveComponent as o,resolveDirective as l,openBlock as s,createBlock as c,Fragment as d,withDirectives as u,createVNode as v,createCommentVNode as m,toDisplayString as p}from"vue";function f(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function h(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function y(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?h(Object(n),!0).forEach((function(r){f(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var g,b,w={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},k=(b=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=b,b).toLowerCase();var C=((g=void 0!==k?k:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||g.startsWith("ja"),w),T=e({isViewer:!1,changeLayers:0,changeGeometrys:0}),x=function(e){T.changeLayers+=1};function D(o){var l,s,c,d,u,v,m=e({TreeDatas:[],expandedKeys:[]}),p=n(null),f=n(null),h=function(){},g=document.getElementById("SuperMap3DContainer"),b=document.body.clientWidth-g.clientWidth,w=document.body.clientHeight-g.clientHeight;function k(){l=viewer.scene.layers.layerQueue,s=viewer.imageryLayers._layers,d=viewer.scene._vectorTileMaps._layerQueue,c=viewer.terrainProvider,m.TreeDatas.length=0,D(),P(),L(),function(){if(!c.tablename)return;var e={id:"terrain",label:"地形图层",children:[]},r={id:"terrain-0",label:c.tablename};e.children.push(r),m.TreeDatas[3]=e}(),setTimeout((function(){p.value.setCheckedNodes(m.TreeDatas)}),500),console.log(d)}function D(){if(0!=l.length){var e={id:"s3m",label:"S3M图层",children:[]};l.forEach((function(r,n){var t={id:"s3m-"+n,label:r._name};e.children.push(t)})),m.TreeDatas[0]=e}else m.TreeDatas[0]&&p.value.remove(m.TreeDatas[0])}function P(){if(1!=s.length){var e={id:"img",label:"IMG图层",children:[]};s.forEach((function(r,n){var t=r._imageryProvider instanceof SuperMap3D.MvtProviderGL;if(0===n||t)return!0;var a={id:"img-"+n,label:C.BaseMapImg};r._imageryProvider.tablename&&(a.label=r._imageryProvider.tablename),e.children.unshift(a)})),e.children.length>0&&(m.TreeDatas[1]=e)}else m.TreeDatas[1]&&p.value.remove(m.TreeDatas[1])}function L(){if(0!=d.length){var e={id:"mvt",label:"MVT图层",children:[]};d.forEach((function(r,n){var t={id:"mvt-"+n,label:r.name};e.children.unshift(t)})),m.TreeDatas[2]=e}else m.TreeDatas[2]&&p.value.remove(m.TreeDatas[2])}return o&&o.deleteCallback&&(h=o.deleteCallback),t((function(){return T.changeLayers}),(function(e){k()})),a((function(){setTimeout((function(){k()}),500)})),document.onclick=function(e){e.stopPropagation(),f.value.style.display="none"},i((function(){document.onclick=function(){}})),y(y({},r(m)),{},{tree:p,domContextmenu:f,checkNode:function(e){var r=p.value.getNode(e);!function(e,r){var n=e[0],t=e[1];switch(n){case"s3m":if(!t){for(var a=0;a<l.length;a++)l[a].visible=r;return}l[t].visible=r;break;case"img":if(!t){for(var i=1;i<s.length;i++)s[i].show=r;return}s[t].show=r;break;case"mvt":if(!t){for(var o=0;o<d.length;o++)d[o].show=r;return}d[t].show=r;break;case"terrain":r?viewer.terrainProvider=u:(u=viewer.terrainProvider,viewer.terrainProvider=new SuperMap3D.EllipsoidTerrainProvider)}}(e.id.split("-"),r.checked)},nodeContextmenu:function(e,r){r.id.split("-")[1]&&(v=r,f.value.style.left=e.clientX+30-b+"px",e.clientX>=1810&&(f.value.style.left=e.clientX-80-b+"px"),f.value.style.top=e.clientY-w+"px",f.value.style.display="block")},nodeClick:function(e){!function(e){var r,n=e[0],t=e[1];switch(n){case"s3m":t&&(r=l[t]);break;case"img":t&&(r=s[t]);break;case"mvt":t&&(r=d[t])}r&&viewer.flyTo(r)}(e.id.split("-"))},deleteLayer:function(){f.value.style.display="none";var e=v.id.split("-"),r=e[0],n=e[1];switch(r){case"s3m":n&&(viewer.scene.layers.remove(l[n]._name),D(),setTimeout((function(){m.expandedKeys=["s3m"],p.value.setCheckedNodes(m.TreeDatas)}),50));break;case"img":n&&(viewer.imageryLayers.remove(s[n]),P(),setTimeout((function(){p.value.setCheckedNodes(m.TreeDatas)}),50));break;case"mvt":n&&(viewer.scene.removeVectorTilesMap(d[n].name),L(),setTimeout((function(){p.value.setCheckedNodes(m.TreeDatas)}),100));break;case"terrain":viewer.terrainProvider=new SuperMap3D.EllipsoidTerrainProvider,u=null;var t=p.value.getNode(r);p.value.remove(t)}x(),h(v)}})}var P={name:"Sm3dLayerManage",props:{deleteCallback:{type:Function}},setup:function(e){var r=D(e);return{nodeContextmenu:r.nodeContextmenu,nodeClick:r.nodeClick,TreeDatas:r.TreeDatas,tree:r.tree,domContextmenu:r.domContextmenu,checkNode:r.checkNode,deleteLayer:r.deleteLayer,expandedKeys:r.expandedKeys}}},L={id:"layer-manage-panel",class:"sm-panel"},O={class:"sm-function-module-sub-section",style:{margin:"0"}},M={class:"sm-half-L"},N={id:"contextmenu",ref:"domContextmenu"};P.render=function(e,r,n,t,a,i){var f=o("el-tree"),h=l("stopdrag"),y=l("drag");return s(),c(d,null,[u(v("div",L,[u(v("div",O,[v("div",M,[v(f,{data:t.TreeDatas,"show-checkbox":"","node-key":"id",accordion:"",ref:"tree","default-expanded-keys":t.expandedKeys,"highlight-current":!0,onCheck:t.checkNode,onNodeContextmenu:t.nodeContextmenu,onNodeClick:t.nodeClick},null,8,["data","default-expanded-keys","onCheck","onNodeContextmenu","onNodeClick"])])],512),[[h]])],512),[[y]]),v("div",N,[m(" <span>图层属性</span><br>\r\n          <span>图层风格</span><br>\r\n    <span>图层操作</span><br>"),v("span",{onClick:r[1]||(r[1]=function(){return t.deleteLayer&&t.deleteLayer.apply(t,arguments)}),style:{color:"red"}},p(e.Resource.delete),1)],512)],64)},P.__file="src/components/layer/layer-manage/layer-manage.vue",P.install=function(e){e.component(P.name,P)};export default P;
