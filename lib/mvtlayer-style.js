import{reactive as e,toRefs as t,ref as l,watch as n,onBeforeUnmount as r,resolveComponent as o,resolveDirective as i,openBlock as s,createBlock as u,Fragment as a,withDirectives as c,createVNode as p,renderList as y,toDisplayString as d,vShow as b,vModelSelect as h,vModelCheckbox as f,vModelText as m,createTextVNode as v}from"vue";function w(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}function g(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),l.push.apply(l,n)}return l}function S(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?g(Object(l),!0).forEach((function(t){w(e,t,l[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):g(Object(l)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))}))}return e}var L,k,x=(k=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=k,k).toLowerCase();(L=void 0!==x?x:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||L.startsWith("ja");var P=e({isViewer:!1,changeLayers:0,changeGeometrys:0});function C(o){var i,s,u,a,c=e({layerNames:[],selectedLayerIndex:"none",childLayerNames:[],selectedChildLayerIndex:"none",mvtAlpha:1,showLayer:!0,textAvoidance:!0,openFilter:!1,propertyKeys:[],symbols:[],clickGetFeature:{layer:{id:null},id:null},isClickShowProperty:!0,dockFontShow:!0,bubbleShow:!1,selectedPropertyKeys:[""],selectedSymbols:[""],inputPropertys:[""],inputSymbols:[""],inputValues:[""]}),p=[],y=!1,d=l(null);function b(){(i=viewer.scene._vectorTileMaps._layerQueue)&&i.length>0?(i.forEach((function(e,t){c.layerNames.includes(e.name)||c.layerNames.push(e.name)})),console.log("init"),(c.selectedLayerIndex="none")&&(c.selectedLayerIndex=0)):c.selectedLayerIndex="none",viewer.eventManager.addEventListener("CLICK",m,!0)}function h(e){return e.slice(0,e.length-1)}function f(){if(""==c.inputPropertys[0])return!1;var e=["any"];return c.inputPropertys.forEach((function(t,l){var n=[];n[0]=c.inputSymbols[l],n[1]=t,n[2]=c.inputValues[l],"number"==typeof Number(n[2])&&(n[2]=Number(n[2])),e.push(n)})),!(e.length<2)&&e}function m(e){var t=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(SuperMap3D.defined(t)&&SuperMap3D.defined(t.pickResult)){var l=document.body.clientWidth-e.message.position.x;d.value.style.left=l>=300?e.message.position.x+"px":e.message.position.x-250+"px",d.value.style.top=e.message.position.y-220+"px",c.bubbleShow=!0;var n=null;for(var r in t.pickResult){n=t.pickResult[r];break}var o=n[0].feature;o&&(c.clickGetFeature=o),console.log(o)}else c.bubbleShow=!1}function v(){a&&(s.removeLayer(a.id),a=null)}return c.symbols=["!","!=",">",">=","<","<=","==","in","like","!like","left","right"],P.isViewer&&setTimeout((function(){return b()}),500),n((function(){return P.isViewer}),(function(e){b()})),n((function(){return P.changeLayers}),(function(e){b()})),n((function(){return c.selectedLayerIndex}),(function(e){"none"!==e&&(p.length=0,s=i[e],c.showLayer=s.show,s.readyPromise.then((function(e){e&&(s.mapboxStyle.layers.forEach((function(e,t){c.childLayerNames.includes(e.id)||c.childLayerNames.push(e.id);var l=s.getLayoutProperty(e.id,"visibility");p.push(l)})),c.selectedChildLayerIndex=0)})))})),n((function(){return c.selectedChildLayerIndex}),(function(e){u=s.mapboxStyle.layers[e];var t=s.querySourceFeatures({sourceLayer:u.id,filter:["<","$id",10]});0==t.length?c.propertyKeys=[]:c.propertyKeys=t[0]._keys.length>0?t[0]._keys:[]})),n((function(){return c.mvtAlpha}),(function(e){s&&(s.alpha=Number(e))})),n((function(){return c.showLayer}),(function(e){s&&(s.show=e)})),n((function(){return c.textAvoidance}),(function(e){if(s)for(var t=s.mapboxStyle.layers,l=0;l<t.length;l++)t[l].isOverlapDisplayed=e})),n((function(){return c.isClickShowProperty}),(function(e){if(e)return viewer.eventManager.addEventListener("CLICK",m,!0),void(c.bubbleShow=!0);viewer.eventManager.removeEventListener("CLICK",m),c.bubbleShow=!1})),n((function(){return c.selectedPropertyKeys}),(function(e,t){e.length===t.length&&e.forEach((function(e,t){c.inputPropertys[t]=e}))}),{deep:!0}),n((function(){return c.selectedSymbols}),(function(e,t){e.length===t.length&&e.forEach((function(e,t){if("left"===e||"right"===e)return""===c.inputPropertys[t]||c.inputPropertys[t].includes("left(")||c.inputPropertys[t].includes("right(")?void(c.inputPropertys[t]=e+"()"):void(c.inputPropertys[t]=e+"("+c.inputPropertys[t]+",2)");c.inputSymbols[t]=e}))}),{deep:!0}),r((function(){i=null,s=null,u=null})),S(S({},t(c)),{},{addCondition:function(e){if(!e)return c.selectedPropertyKeys=h(c.selectedPropertyKeys),c.selectedSymbols=h(c.selectedSymbols),c.inputSymbols=h(c.inputSymbols),c.inputPropertys=h(c.inputPropertys),void(c.inputValues=h(c.inputValues));c.selectedPropertyKeys=c.selectedPropertyKeys.concat([""]),c.selectedSymbols=c.selectedSymbols.concat([""]),c.inputSymbols=c.inputSymbols.concat([""]),c.inputPropertys=c.inputPropertys.concat([""]),c.inputValues=c.inputValues.concat([""])},propertySearch:function(){var e=f();e&&function(e){a&&v();if(!u)return;var t=u.id+"_highlight";a||((a=SuperMap3D.clone(u,!0)).id=t,"line"==u.type?a.paint["line-color"]="rgba(0,255,255,1.00)":"fill"==u.type?a.paint["fill-color"]="rgba(0,255,255,1.00)":a.paint["text-color"]="rgba(255,0,0,1.00)",a.layout.visibility="visible",a.minzoom=3,s.addLayer(a),s.setFilter(a.id,e))}(e)},propertyFilter:function(){var e=f();y=!0,s&&(s.mapboxStyle.layers.forEach((function(e){s.setLayoutProperty(e.id,"visibility","none")})),s.setLayoutProperty(u.id,"visibility","visible"),e&&s.setFilter(u.id,e))},clear:function(){v(),y&&(s.mapboxStyle.layers.forEach((function(e,t){s.setLayoutProperty(e.id,"visibility",p[t])})),s.setFilter(u.id,null),s.refresh(),y=!1)},bubble:d,closeBubble:function(){c.bubbleShow=!1},dockBubble:function(e){e?(d.value.classList.add("bubbleDock"),c.dockFontShow=!1):(d.value.classList.remove("bubbleDock"),c.dockFontShow=!0)}})}var V={name:"Sm3dMvtlayerStyle",setup:function(e){var t=C();return{layerNames:t.layerNames,selectedLayerIndex:t.selectedLayerIndex,childLayerNames:t.childLayerNames,selectedChildLayerIndex:t.selectedChildLayerIndex,mvtAlpha:t.mvtAlpha,showLayer:t.showLayer,textAvoidance:t.textAvoidance,propertyKeys:t.propertyKeys,symbols:t.symbols,openFilter:t.openFilter,propertySearch:t.propertySearch,propertyFilter:t.propertyFilter,clear:t.clear,isClickShowProperty:t.isClickShowProperty,clickGetFeature:t.clickGetFeature,bubble:t.bubble,closeBubble:t.closeBubble,dockBubble:t.dockBubble,dockFontShow:t.dockFontShow,bubbleShow:t.bubbleShow,selectedPropertyKeys:t.selectedPropertyKeys,selectedSymbols:t.selectedSymbols,inputPropertys:t.inputPropertys,inputSymbols:t.inputSymbols,inputValues:t.inputValues,addCondition:t.addCondition}}},F={id:"mvtlayer-panel",class:"sm-panel"},K={class:"sm-function-module-sub-section",style:{margin:"0"}},I={class:"sm-half-L"},O=p("label",{style:{width:"28%"}},"选择图层",-1),U={value:"none"},N={class:"sm-half-L"},j=p("label",{style:{width:"28%"}},"透明度",-1),E={class:"sm-half-L"},A={style:{width:"auto"}},B=v("图层显隐 "),D={style:{width:"auto"}},G=v("文字避让 "),M={style:{width:"auto"}},_=v("图层属性 "),z={style:{width:"auto"}},R=v("查询过滤 "),W={style:{width:"100%"}},q={class:"sm-half-L",style:{"margin-top":"5px"}},T=p("label",{style:{width:"28%"}},"选择子图层",-1),$={class:"sm-half-L",style:{padding:"6px 0 6px 0"}},Q=p("label",{style:{width:"28%"}},"设置条件",-1),H={class:"sm-half-L"},J={class:"tab tab2"},X=p("tr",null,[p("th",null,"属性"),p("th",null,"条件"),p("th",null,"值")],-1),Y={style:{position:"relative"}},Z={style:{position:"relative"}},ee={class:"boxchild"},te={id:"mvtlayer-drop-left-panel",class:"sm-panel"},le={id:"bubble",class:"bubble-tabel",ref:"bubble"},ne={class:"boxchild flex-between"},re=p("label",{style:{width:"auto"}},"对象属性",-1),oe={class:"flex flex-end",style:{width:"auto"}},ie={class:"tab"},se=p("tr",null,[p("th",null,"属性"),p("th",null,"值")],-1),ue=p("td",null,"图层",-1),ae=p("td",null,"$id",-1);V.render=function(e,t,l,n,r,v){var w=o("el-slider"),g=i("stopdrag"),S=i("drag");return s(),u(a,null,[c(p("div",F,[c(p("div",K,[p("div",I,[O,c(p("select",{class:"sm-select",style:{width:"70%"},"onUpdate:modelValue":t[1]||(t[1]=function(e){return n.selectedLayerIndex=e})},[(s(!0),u(a,null,y(n.layerNames,(function(e,t){return s(),u("option",{key:t,value:t},d(e),9,["value"])})),128)),c(p("option",U,"暂无mvt图层",512),[[b,0==n.layerNames.length]])],512),[[h,n.selectedLayerIndex]])]),p("div",N,[j,p(w,{modelValue:n.mvtAlpha,"onUpdate:modelValue":t[2]||(t[2]=function(e){return n.mvtAlpha=e}),min:0,max:1,step:.05,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"70%"}},null,8,["modelValue","step"])]),p("div",E,[p("label",A,[c(p("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=function(e){return n.showLayer=e})},null,512),[[f,n.showLayer]]),B]),p("label",D,[c(p("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=function(e){return n.textAvoidance=e})},null,512),[[f,n.textAvoidance]]),G]),p("label",M,[c(p("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=function(e){return n.isClickShowProperty=e})},null,512),[[f,n.isClickShowProperty]]),_]),p("label",z,[c(p("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=function(e){return n.openFilter=e})},null,512),[[f,n.openFilter]]),R])]),c(p("div",W,[p("div",q,[T,c(p("select",{class:"sm-select",style:{width:"70%"},"onUpdate:modelValue":t[7]||(t[7]=function(e){return n.selectedChildLayerIndex=e})},[(s(!0),u(a,null,y(n.childLayerNames,(function(e,t){return s(),u("option",{key:t,value:t},d(e),9,["value"])})),128))],512),[[h,n.selectedChildLayerIndex]])]),p("div",$,[Q,p("div",null,[p("button",{class:"tbtn",type:"button",style:{width:"auto"},onClick:t[8]||(t[8]=function(e){return n.addCondition(!0)})},"增行"),p("button",{class:"tbtn tbtn-margin-left",type:"button",style:{width:"auto"},onClick:t[9]||(t[9]=function(e){return n.addCondition(!1)})},"删行")])]),p("div",H,[p("table",J,[p("tbody",null,[X,(s(!0),u(a,null,y(n.selectedPropertyKeys,(function(e,t){return s(),u("tr",{key:t},[p("td",Y,[c(p("select",{class:"sm-select","onUpdate:modelValue":function(e){return n.selectedPropertyKeys[t]=e}},[(s(!0),u(a,null,y(n.propertyKeys,(function(e){return s(),u("option",{key:e,value:e},d(e),9,["value"])})),128))],8,["onUpdate:modelValue"]),[[h,n.selectedPropertyKeys[t]]]),c(p("input",{type:"text",class:"input","onUpdate:modelValue":function(e){return n.inputPropertys[t]=e}},null,8,["onUpdate:modelValue"]),[[m,n.inputPropertys[t]]])]),p("td",Z,[c(p("select",{class:"sm-select","onUpdate:modelValue":function(e){return n.selectedSymbols[t]=e}},[(s(!0),u(a,null,y(n.symbols,(function(e){return s(),u("option",{key:e,value:e},d(e),9,["value"])})),128))],8,["onUpdate:modelValue"]),[[h,n.selectedSymbols[t]]]),c(p("input",{type:"text",class:"input","onUpdate:modelValue":function(e){return n.inputSymbols[t]=e}},null,8,["onUpdate:modelValue"]),[[m,n.inputSymbols[t]]])]),p("td",null,[c(p("input",{type:"text",class:"input2","onUpdate:modelValue":function(e){return n.inputValues[t]=e}},null,8,["onUpdate:modelValue"]),[[m,n.inputValues[t]]])])])})),128))])])]),p("div",ee,[p("button",{class:"tbtn",type:"button",style:{width:"auto"},onClick:t[10]||(t[10]=function(){return n.propertySearch&&n.propertySearch.apply(n,arguments)})},"查询"),p("button",{class:"tbtn tbtn-margin-left",type:"button",style:{width:"auto"},onClick:t[11]||(t[11]=function(){return n.propertyFilter&&n.propertyFilter.apply(n,arguments)})},"过滤"),p("button",{class:"tbtn tbtn-margin-left",style:{width:"auto"},type:"button ",onClick:t[12]||(t[12]=function(){return n.clear&&n.clear.apply(n,arguments)})},"清除")])],512),[[b,n.openFilter]])],512),[[g]])],512),[[S]]),c(p("div",te,null,512),[[b,e.isShowproPerties&&n.propertyKeys.length>0],[S]]),c(p("div",le,[p("div",ne,[re,p("div",oe,[c(p("i",{class:"el-icon-position",title:"停靠",style:{"margin-right":"8px"},onClick:t[13]||(t[13]=function(e){return n.dockBubble(!0)})},null,512),[[b,n.dockFontShow]]),c(p("i",{class:"el-icon-chat-square",title:"悬浮",style:{"margin-right":"8px"},onClick:t[14]||(t[14]=function(e){return n.dockBubble(!1)})},null,512),[[b,!n.dockFontShow]]),p("i",{class:"el-icon-close",title:"关闭",onClick:t[15]||(t[15]=function(){return n.closeBubble&&n.closeBubble.apply(n,arguments)})})])]),p("table",ie,[p("tbody",null,[se,p("tr",null,[ue,p("td",null,d(n.clickGetFeature.layer.id),1)]),p("tr",null,[ae,p("td",null,d(n.clickGetFeature.id),1)]),(s(!0),u(a,null,y(n.clickGetFeature.properties,(function(e,t,l){return s(),u("tr",{key:l},[p("td",null,d(t),1),p("td",null,d(e),1)])})),128))])])],512),[[S],[b,n.bubbleShow]])],64)},V.__file="src/components/layer/mvtlayer-style/mvtlayer-style.vue",V.install=function(e){e.component(V.name,V)};export default V;
