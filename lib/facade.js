import{reactive as e,toRefs as t,watch as n,onBeforeUnmount as o,resolveComponent as r,resolveDirective as a,withDirectives as i,openBlock as l,createBlock as s,createVNode as c,toDisplayString as u,vModelCheckbox as d,createTextVNode as p,Fragment as w,renderList as m,vShow as y,vModelSelect as f}from"vue";function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e){return function(e){if(Array.isArray(e))return D(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var x=e({isViewer:!1,changeLayers:0,changeGeometrys:0});var L=function(e){for(var t=[].concat(e),n=[],o=0,r=t.length;o<r;o++){var a=SuperMap3D.Cartographic.fromCartesian(t[o]),i=SuperMap3D.Math.toDegrees(a.longitude),l=SuperMap3D.Math.toDegrees(a.latitude),s=a.height;-1==n.indexOf(i)&&-1==n.indexOf(l)&&(n.push(i),n.push(l),n.push(s))}return n};var M,P,S={errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},C={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},k=(P=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=P,P).toLowerCase();var N=((M=void 0!==k?k:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||M.startsWith("ja"),C),V=function(e,t){var n=0;switch(t&&(n=t),e){case"Point":window.handlerPoint=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Point);break;case"Polyline":window.handlerPolyline=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Line,n);break;case"Polygon":window.handlerPolygon=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Polygon,n);break;case"Marker":window.handlerMarker=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Marker,n);break;case"Box":window.handlerBox=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box,n)}window.tooltip||(window.tooltip=function(e){var t=function(e){var t=document.createElement("DIV");t.className="twipsy right";var n=document.createElement("DIV");n.className="twipsy-arrow",t.appendChild(n);var o=document.createElement("DIV");o.className="twipsy-inner",t.appendChild(o),this._div=t,this._title=o,this.message="",e.appendChild(t);var r=this;t.onmousemove=function(e){r.showAt({x:e.clientX,y:e.clientY},r.message)}};return t.prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},t.prototype.showAt=function(e,t){e&&t&&(this.setVisible(!0),this._title.innerHTML=t,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px",this.message=t)},new t(e)}(viewer._element)),window.polylineCollection||(window.polylineCollection=new SuperMap3D.PolylineCollection({translucentRS:SuperMap3D.RenderState.fromCache({depthMask:!1,depthTest:{enabled:!1}})}),window.polylineTransparent=window.polylineCollection.add({width:2,material:SuperMap3D.Material.fromType(SuperMap3D.Material.ColorType,{color:SuperMap3D.Color.fromCssColorString("#51ff00").withAlpha(.3)})}),viewer.scene.primitives.add(window.polylineCollection))},O=function(e){var t;switch(e){case"Point":t=window.handlerPoint;break;case"Polyline":t=window.handlerPolyline;break;case"Polygon":t=window.handlerPolygon;break;case"Marker":t=window.handlerMarker;break;case"Box":t=window.handlerBox}return t};function j(e){var t=function(e){var t=document.createElement("DIV");t.className="tooltip",this._div=t,this.message="",e.appendChild(t)};return t.prototype.setVisible=function(e){this._div.style.right=e?"10px":"-300px"},t.prototype.showAt=function(e,t){t&&(this._div.style.top=t),e&&(this.setVisible(!0),this._div.innerHTML=e)},new t(e)}function E(r){var a,i,l,s=e({maxDistance:200,maxHeight:100,setLodrange:!1,layerNames:[],selectedLayerName:"none",lodrange:.01});if(r)for(var c in r)s.hasOwnProperty(c)?s[c]=r[c]:S.errorMsg(N.AttributeError+c);function u(){viewer.scene,(i=viewer.scene.layers.layerQueue)&&i.length>0&&(i.forEach((function(e,t){s.layerNames.includes(e._name)||s.layerNames.push(e._name)})),(s.selectedLayerName="none")&&(s.selectedLayerName=s.layerNames[0],l=i[0]))}function d(){var e,t;a.clear(),(t=(e="Polyline")?O(e):window.handlerPolygon)&&(t.deactivate(),t.clear(),viewer.enableCursorStyle=!0,window.tooltip.setVisible(!1),window.polylineTransparent&&(window.polylineTransparent.show=!1)),tooltip.setVisible(!1)}return x.isViewer&&(window.tooltip||(window.tooltip=j(viewer._element)),(a=new SuperMap3D.Facade(viewer.scene)).build(),u()),n((function(){return x.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=j(viewer._element)),(a=new SuperMap3D.Facade(viewer.scene)).build(),u())})),n((function(){return x.changeLayers}),(function(e){u()})),o((function(){d(),a.destroy()})),n((function(){return s.maxDistance}),(function(e){a.farDistance=Number(e)})),n((function(){return s.maxHeight}),(function(e){a.maxHeight=Number(e)})),n((function(){return s.selectedLayerName}),(function(e){var t=s.layerNames.indexOf(e);-1!=t&&(l=i[t])})),n((function(){return s.lodrange}),(function(e){l&&l.setLodRangeScale(Number(e))})),n((function(){return s.setLodrange}),(function(e){l&&(e?l.setLodRangeScale(Number(s.lodrange)):l.setLodRangeScale(1))})),v(v({},t(s)),{},{setRegion:function(){tooltip.showAt(" <p>点击鼠标左键开始绘制起点</p><p>绘制两点确定区域宽度</p> <p>单击右键结束分析</p><p>设置模型精细度调整图片清晰度</p>","350px"),window.handlerPolyline||V("Polyline"),function(e,t,n){var o=!0;!1===t&&(o=t);var r=O(e);return new Promise((function(t,n){var a=window.tooltip,i=r.activeEvt.addEventListener((function(t){1==t?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="","Point"==e||"Marker"==e?document.body.classList.add("measureCur"):document.body.classList.add("drawCur")):(viewer.enableCursorStyle=!0,a.setVisible(!1),"Point"==e||"Marker"==e?document.body.classList.remove("measureCur"):document.body.classList.remove("drawCur"))})),l=r.movingEvt.addEventListener((function(t){if(t.x<200&&t.y<150)a.setVisible(!1);else if(r.polyline&&r.isDrawing){var n=b(r.positions);"Polygon"==e&&n.push(n[0]),window.polylineTransparent.show=!0,window.polylineTransparent.positions=n}})),s=r.drawEvt.addEventListener((function(n){if(!n.object.positions&&"Point"!=e&&"Box"!=e)return a.showAt(n,"<p>请绘制正确的多边形</p>"),r.polygon.show=!1,r.polyline.show=!1,r.deactivate(),void r.activate();if("Box"!=e){if("Point"==e||"Marker"==e)r.clear(),t({result:n});else{if(window.polylineTransparent.show=o,o&&"Polygon"==e&&o){r.polygon._polygon._material._color._value.alpha=.1;var c=b(n.object.positions);c.push(c[0]),window.polylineTransparent.positions=c}var u=L(n.object.positions);t({result:n,positions:u})}i(),l(),s()}else t({result:n})}))}))}("Polyline").then((function(e){var t=e.result.object.positions[0],n=e.result.object.positions[1];a.startPoint=t,a.endPoint=n;var o=window.handlerPolyline;o.polyline.show=!1,window.polylineTransparent.show=!1,o.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()},execute:function(){a.readyPromise.then((function(e){!function(e){var t=new Image;t.src=e,t.onload=function(){var e=function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t}(t).toDataURL("image/jpeg"),n=document.createElement("a"),o=new MouseEvent("click");n.download=(new Date).getTime()+".jpg",n.href=e,n.dispatchEvent(o)}}(e)}))},clear:d})}var R={name:"Sm3dFacade",props:{maxDistance:{type:Number},maxHeight:{type:Number},setLodrange:{type:Boolean},lodrange:{type:Number},selectedLayerName:{type:String}},methods:{formatTooltip:function(e){return e+Resource.meter}},setup:function(e){var t=E(e),n=t.maxDistance,o=t.maxHeight,r=t.layerNames;return{maxDistance:n,maxHeight:o,setLodrange:t.setLodrange,layerNames:r,selectedLayerName:t.selectedLayerName,lodrange:t.lodrange,setRegion:t.setRegion,execute:t.execute,clear:t.clear}}},_={id:"facade-panel",class:"sm-panel"},H={class:"sm-function-module-sub-section",style:{margin:"0"}},T={class:"sm-half-L"},A={style:{width:"35%"}},B={class:"sm-half-L"},I={style:{width:"35%"}},U={class:"sm-half-L"},W={style:{width:"100%"}},z={class:"sm-half-L"},F={style:{width:"35%"}},q={class:"sm-half-L"},G={style:{width:"35%"}},Q={class:"boxchild flex-between"};R.render=function(e,t,n,o,h,g){var v=r("el-slider"),b=a("stopdrag"),D=a("drag");return i((l(),s("div",_,[i(c("div",H,[c("div",T,[c("label",A,u(e.Resource.facadeDistance),1),c(v,{modelValue:o.maxDistance,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.maxDistance=e}),min:1,max:1e3,step:1,"input-size":"mini",debounce:500,"format-tooltip":g.formatTooltip,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","format-tooltip"])]),c("div",B,[c("label",I,u(e.Resource.facadeHeight),1),c(v,{modelValue:o.maxHeight,"onUpdate:modelValue":t[2]||(t[2]=function(e){return o.maxHeight=e}),min:1,max:200,step:1,"input-size":"mini",debounce:500,"format-tooltip":g.formatTooltip,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","format-tooltip"])]),c("div",U,[c("label",W,[i(c("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=function(e){return o.setLodrange=e})},null,512),[[d,o.setLodrange]]),p(" "+u(e.Resource.setLodrange),1)]),i(c("div",z,[c("label",F,u(e.Resource.selectedLayer),1),i(c("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[4]||(t[4]=function(e){return o.selectedLayerName=e})},[(l(!0),s(w,null,m(o.layerNames,(function(e,t){return l(),s("option",{key:t,value:e},u(e),9,["value"])})),128)),i(c("option",{value:"none"},u(e.Resource.noLayer),513),[[y,0==o.layerNames.length]])],512),[[f,o.selectedLayerName]])],512),[[y,o.setLodrange]]),i(c("div",q,[c("label",G,u(e.Resource.lodrange),1),c(v,{modelValue:o.lodrange,"onUpdate:modelValue":t[5]||(t[5]=function(e){return o.lodrange=e}),min:.01,max:2,step:.01,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","min","step"])],512),[[y,o.setLodrange]])]),c("div",Q,[c("button",{class:"tbtn",type:"button",style:{width:"auto"},onClick:t[6]||(t[6]=function(){return o.setRegion&&o.setRegion.apply(o,arguments)})},u(e.Resource.setRegion),1),c("button",{class:"tbtn",type:"button",style:{width:"auto"},onClick:t[7]||(t[7]=function(){return o.execute&&o.execute.apply(o,arguments)})},u(e.Resource.execute),1),c("button",{onClick:t[8]||(t[8]=function(){return o.clear&&o.clear.apply(o,arguments)}),class:"tbtn",type:"button"},u(e.Resource.clear),1)])],512),[[b]])],512)),[[D]])},R.__file="src/components/scene/facade/facade.vue",R.install=function(e){e.component(R.name,R)};export default R;
