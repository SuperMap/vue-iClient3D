import{toRefs as e,reactive as o,watch as n,onBeforeUnmount as t,resolveComponent as r,resolveDirective as i,withDirectives as a,openBlock as l,createBlock as s,createVNode as p,toDisplayString as d,vModelText as u}from"vue";function c(e,o,n){return o in e?Object.defineProperty(e,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[o]=n,e}function w(e,o){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);o&&(t=t.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),n.push.apply(n,t)}return n}function f(e){for(var o=1;o<arguments.length;o++){var n=null!=arguments[o]?arguments[o]:{};o%2?w(Object(n),!0).forEach((function(o){c(e,o,n[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))}))}return e}function y(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,o){if(!e)return;if("string"==typeof e)return g(e,o);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(e,o)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,o){(null==o||o>e.length)&&(o=e.length);for(var n=0,t=new Array(o);n<o;n++)t[n]=e[n];return t}var h=function(e){for(var o=[].concat(e),n=[],t=0,r=o.length;t<r;t++){var i=SuperMap3D.Cartographic.fromCartesian(o[t]),a=SuperMap3D.Math.toDegrees(i.longitude),l=SuperMap3D.Math.toDegrees(i.latitude),s=i.height;-1==n.indexOf(a)&&-1==n.indexOf(l)&&(n.push(a),n.push(l),n.push(s))}return n};var m,b,v={errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},M={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},S=(b=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=b,b).toLowerCase();var D=((m=void 0!==S?S:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||m.startsWith("ja"),M),C=function(e){var o;switch(e){case"Point":o=window.handlerPoint;break;case"Polyline":o=window.handlerPolyline;break;case"Polygon":o=window.handlerPolygon;break;case"Marker":o=window.handlerMarker;break;case"Box":o=window.handlerBox}return o},H=function(e,o){var n,t,r=0;switch(o&&(r=o),e){case"Point":window.handlerPoint=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Point);break;case"Polyline":window.handlerPolyline=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Line,r);break;case"Polygon":window.handlerPolygon=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Polygon,r);break;case"Marker":window.handlerMarker=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Marker,r);break;case"Box":window.handlerBox=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box,r)}window.tooltip||(window.tooltip=(n=viewer._element,(t=function(e){var o=document.createElement("DIV");o.className="twipsy right";var n=document.createElement("DIV");n.className="twipsy-arrow",o.appendChild(n);var t=document.createElement("DIV");t.className="twipsy-inner",o.appendChild(t),this._div=o,this._title=t,this.message="",e.appendChild(o);var r=this;o.onmousemove=function(e){r.showAt({x:e.clientX,y:e.clientY},r.message)}}).prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},t.prototype.showAt=function(e,o){e&&o&&(this.setVisible(!0),this._title.innerHTML=o,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px",this.message=o)},new t(n))),window.polylineCollection||(window.polylineCollection=new SuperMap3D.PolylineCollection({translucentRS:SuperMap3D.RenderState.fromCache({depthMask:!1,depthTest:{enabled:!1}})}),window.polylineTransparent=window.polylineCollection.add({width:2,material:SuperMap3D.Material.fromType(SuperMap3D.Material.ColorType,{color:SuperMap3D.Color.fromCssColorString("#51ff00").withAlpha(.3)})}),viewer.scene.primitives.add(window.polylineCollection))},P=function(e,o,n){var t=!0;!1===o&&(t=o);var r=C(e);return new Promise((function(o,n){var i=window.tooltip,a=r.activeEvt.addEventListener((function(o){1==o?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="","Point"==e||"Marker"==e?document.body.classList.add("measureCur"):document.body.classList.add("drawCur")):(viewer.enableCursorStyle=!0,i.setVisible(!1),"Point"==e||"Marker"==e?document.body.classList.remove("measureCur"):document.body.classList.remove("drawCur"))})),l=r.movingEvt.addEventListener((function(o){if(o.x<200&&o.y<150)i.setVisible(!1);else if(r.polyline&&r.isDrawing){var n=y(r.positions);"Polygon"==e&&n.push(n[0]),window.polylineTransparent.show=!0,window.polylineTransparent.positions=n}})),s=r.drawEvt.addEventListener((function(n){if(!n.object.positions&&"Point"!=e&&"Box"!=e)return i.showAt(n,"<p>请绘制正确的多边形</p>"),r.polygon.show=!1,r.polyline.show=!1,r.deactivate(),void r.activate();if("Box"!=e){if("Point"==e||"Marker"==e)r.clear(),o({result:n});else{if(window.polylineTransparent.show=t,t&&"Polygon"==e&&t){r.polygon._polygon._material._color._value.alpha=.1;var p=y(n.object.positions);p.push(p[0]),window.polylineTransparent.positions=p}var d=h(n.object.positions);o({result:n,positions:d})}a(),l(),s()}else o({result:n})}))}))},k=function(e){var o;(o=e?C(e):window.handlerPolygon)&&(o.deactivate(),o.clear(),viewer.enableCursorStyle=!0,window.tooltip.setVisible(!1),window.polylineTransparent&&(window.polylineTransparent.show=!1))};function x(r){var i=o({maxHeight:9e3,minHeight:1e3,floodHeight:[1e3,9e3],currentHeight:1e3,floodTrans:.8,cheackedBand:"band1",colorBandShow:!1,floodSpeed:800,floodPositions:[],lineVisible:!0});if(r)for(var a in r)i.hasOwnProperty(a)?i[a]=r[a]:v.errorMsg(D.AttributeError+a);var l,s=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE,p=new SuperMap3D.HypsometricSetting,d=new SuperMap3D.ColorTable;d.insert(9e3,new SuperMap3D.Color(0,39/255,148/255)),d.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));var u=[];function c(e){e&&(u=e);var o=parseFloat(i.minHeight);p.CoverageArea=e,l=setInterval("flood()",100),window.flood=function(){if(o<=i.maxHeight&&(i.currentHeight=parseInt(o)),o>i.maxHeight)return i.currentHeight=i.maxHeight,void clearInterval(l);p.MaxVisibleValue=o;try{viewer.scene.globe.HypsometricSetting={hypsometricSetting:p,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION}}catch(e){console.log(e),clearInterval(l)}o+=parseFloat(i.floodSpeed)/10}}return n((function(){return i.floodTrans}),(function(e){p.Opacity=parseFloat(e),0!=u.length&&(viewer.scene.globe.HypsometricSetting={hypsometricSetting:p,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})})),n((function(){return i.floodHeight}),(function(e){i.minHeight=e[0],i.maxHeight=e[1]})),n((function(){return i.minHeight}),(function(e){p.MinVisibleValue=parseInt(e),0!=u.length?viewer.scene.globe.HypsometricSetting={hypsometricSetting:p,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION}:i.currentHeight=parseInt(e)})),n((function(){return i.maxHeight}),(function(e){p.MaxVisibleValue=parseInt(e),0!=u.length&&(viewer.scene.globe.HypsometricSetting={hypsometricSetting:p,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})})),n((function(){return i.cheackedBand}),(function(e){d=function(e){var o=new SuperMap3D.ColorTable;switch(e){case"band1":o.insert(9e3,new SuperMap3D.Color(0,39/255,148/255)),o.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));break;case"band2":o.insert(9e3,new SuperMap3D.Color(162/255,251/255,194/255)),o.insert(0,new SuperMap3D.Color(1,103/255,103/255));break;case"band3":o.insert(9e3,new SuperMap3D.Color(230/255,198/255,1)),o.insert(0,new SuperMap3D.Color(157/255,0,1));break;case"band4":o.insert(9e3,new SuperMap3D.Color(210/255,15/255,15/255)),o.insert(6e3,new SuperMap3D.Color(221/255,224/255,7/255)),o.insert(5e3,new SuperMap3D.Color(20/255,187/255,18/255)),o.insert(4e3,new SuperMap3D.Color(0,161/255,1)),o.insert(0,new SuperMap3D.Color(9/255,9/255,212/255));break;case"band5":o.insert(9e3,new SuperMap3D.Color(186/255,1,229/255)),o.insert(0,new SuperMap3D.Color(26/255,185/255,156/255));break;default:o.insert(9e3,new SuperMap3D.Color(0,39/255,148/255)),o.insert(0,new SuperMap3D.Color(149/255,232/255,249/255))}return o}(e),p.ColorTable=d,0!=u.length&&l&&(viewer.scene.globe.HypsometricSetting={hypsometricSetting:p,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})})),t((function(){p.destroy(),d.destroy(),p=void 0,d=void 0})),f(f({},e(i)),{},{floodBegin:function(e){e.preventDefault(),p.DisplayMode=s,p._lineColor=new SuperMap3D.Color(1,0,0,1),p.MinVisibleValue=i.minHeight,p.MaxVisibleValue=0,p.ColorTableMinKey=1,p.ColorTableMaxKey=9e3,p.ColorTable=d,p.Opacity=i.floodTrans,p.LineInterval=200,window.handlerPolygon||H("Polygon"),r&&r.floodPositions?c(r.floodPositions):(P("Polygon",i.lineVisible).then((function(e){var o=window.handlerPolygon;c(e.positions),o.polygon.show=!1,o.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||v.errorMsg(D.NoPickPositionSupported))},floodClear:function(e){e.preventDefault(),u=[],window.handlerPolygon&&(viewer.scene.globe.HypsometricSetting=void 0,clearInterval(l),k("Polygon"))},changeColor:function(e){i.colorBandShow=!1,i.cheackedBand=e},floodPosition:u})}var O={name:"Sm3dTerrainFlood",props:{maxHeight:{type:Number,default:8e3},minHeight:{type:Number,default:1e3},cheackedBand:{type:String,default:"band1"},floodSpeed:{type:Number,default:800},floodTrans:{type:Number,default:.8},floodPositions:{type:Array},lineVisible:{type:Boolean,default:!0}},methods:{formatTooltip:function(e){return e+"米"},formatTooltip2:function(e){return e+"米/秒"}},setup:function(e){var o=x(e);return{floodHeight:o.floodHeight,currentHeight:o.currentHeight,floodSpeed:o.floodSpeed,floodBegin:o.floodBegin,floodClear:o.floodClear}}},V={id:"terrain-flood-panel",class:"sm-panel"},E={class:"sm-function-module-sub-section",style:{margin:"0"}},T={class:"sm-half-L"},A={style:{width:"40%"}},B={class:"sm-half-L"},R={style:{width:"40%"}},L={class:"sm-half-L"},I={style:{width:"40%"}},_={class:"boxchild"};O.render=function(e,o,n,t,c,w){var f=r("el-slider"),y=i("stopdrag"),g=i("drag");return a((l(),s("div",V,[a(p("div",E,[p("div",T,[p("label",A,d(e.Resource.visibleHeight),1),p(f,{modelValue:t.floodHeight,"onUpdate:modelValue":o[1]||(o[1]=function(e){return t.floodHeight=e}),min:0,max:9e3,range:"",step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class","format-tooltip":w.formatTooltip,style:{width:"58%"}},null,8,["modelValue","format-tooltip"])]),p("div",B,[p("label",R,d(e.Resource.currentHeight),1),a(p("input",{class:"sm-input",disabled:"",type:"number",style:{width:"58%"},"onUpdate:modelValue":o[2]||(o[2]=function(e){return t.currentHeight=e})},null,512),[[u,t.currentHeight]])]),p("div",L,[p("label",I,d(e.Resource.floodSpeed),1),p(f,{modelValue:t.floodSpeed,"onUpdate:modelValue":o[3]||(o[3]=function(e){return t.floodSpeed=e}),max:1e3,min:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class","format-tooltip":w.formatTooltip2,style:{width:"58%"}},null,8,["modelValue","format-tooltip"])]),p("div",_,[p("button",{onClick:o[4]||(o[4]=function(){return t.floodBegin&&t.floodBegin.apply(t,arguments)}),class:"tbtn",type:"button"},d(e.Resource.analyze),1),p("button",{onClick:o[5]||(o[5]=function(){return t.floodClear&&t.floodClear.apply(t,arguments)}),class:"tbtn tbtn-margin-left",type:"button"},d(e.Resource.clear),1)])],512),[[y]])],512)),[[g]])},O.__file="src/components/terrain-analysis/terrain-flood/terrain-flood.vue",O.install=function(e){e.component(O.name,O)};export default O;
