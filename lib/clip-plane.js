import{reactive as e,toRefs as t,watch as r,onBeforeUnmount as n,resolveDirective as o,withDirectives as a,openBlock as i,createBlock as l,createVNode as s,toDisplayString as p,vModelSelect as c}from"vue";function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){if(e){if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function m(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=y(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw a}}}}var M=function(e){for(var t=[].concat(e),r=[],n=0,o=t.length;n<o;n++){var a=SuperMap3D.Cartographic.fromCartesian(t[n]),i=SuperMap3D.Math.toDegrees(a.longitude),l=SuperMap3D.Math.toDegrees(a.latitude),s=a.height;-1==r.indexOf(i)&&-1==r.indexOf(l)&&(r.push(i),r.push(l),r.push(s))}return r};var g,D,b={Message:{errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},axiosJsonp:function(e){if(e)return new Promise((function(t,r){window.jsonCallBack=function(e){t(e)};var n=document.createElement("script");n.type="text/javascript",n.src="".concat(e,"&callback=jsonCallBack"),document.getElementsByTagName("head")[0].appendChild(n),setTimeout((function(){document.getElementsByTagName("head")[0].removeChild(n)}),500)}));console.error("Axios.JSONP 至少需要一个url参数!")},isEqualArr:function(e,t){if(!e||!t)return!0;var r=!0;if(Object.keys(e).length!=Object.keys(t).length)return!1;for(var n in e)if("object"==u(e[n])){if(!(r=isSame(e[n],t[n])))break}else if(e[n]!=t[n]){r=!1;break}return r},CartesiantoDegrees:M,CartesiantoDegreesObjs:function(e){for(var t=[].concat(e),r=[],n=0,o=t.length;n<o;n++){var a=SuperMap3D.Cartographic.fromCartesian(t[n]),i={longitude:SuperMap3D.Math.toDegrees(a.longitude),latitude:SuperMap3D.Math.toDegrees(a.latitude),height:a.height};r.push(i)}return r},unique:function(e){for(var t=[],r={},n=0;n<e.length;n++)r[e[n]]||(t.push(e[n]),r[e[n]]=1);return t},gradientColors:function(e,t,r,n){var o,a,i,l,s=[],p=[];n=n||1;var c,u=function(e){return Math.pow(e/255,n)};for(e=d(e).map(u),t=d(t).map(u),o=0;o<r;o++){for(l=1-(i=o/(r-1)),a=0;a<3;a++)p[a]=1===(c=Math.round(255*Math.pow(e[a]*l+t[a]*i,1/n)).toString(16)).length?"0"+c:c;s.push("#"+p.join(""))}return s;function d(e){return 4===e.length?e.substr(1).split("").map((function(e){return 17*parseInt(e,16)})):[e.substr(1,2),e.substr(3,2),e.substr(5,2)].map((function(e){return parseInt(e,16)}))}},getAngleAndRadian:function(e,t){var r=SuperMap3D.Transforms.eastNorthUpToFixedFrame(e),n=SuperMap3D.Cartesian3.subtract(t,e,new SuperMap3D.Cartesian3),o=SuperMap3D.Matrix4.multiplyByPointAsVector(SuperMap3D.Matrix4.inverse(r,new SuperMap3D.Matrix4),n,new SuperMap3D.Cartesian3),a=SuperMap3D.Cartesian3.normalize(o,new SuperMap3D.Cartesian3),i=Math.atan2(a.y,a.x)-SuperMap3D.Math.PI_OVER_TWO,l=SuperMap3D.Math.TWO_PI-SuperMap3D.Math.zeroToTwoPi(i),s=l*(180/Math.PI);return s<0&&(s+=360),{angle:s,radian:l}},CartographictoDegrees:function(e){return[SuperMap3D.Math.toDegrees(e.longitude),SuperMap3D.Math.toDegrees(e.latitude),e.height]},getPitch:function(e,t){var r=SuperMap3D.Transforms.eastNorthUpToFixedFrame(e),n=SuperMap3D.Cartesian3.subtract(t,e,new SuperMap3D.Cartesian3),o=SuperMap3D.Matrix4.multiplyByPointAsVector(SuperMap3D.Matrix4.inverse(r,r),n,n);SuperMap3D.Cartesian3.normalize(o,o);var a=SuperMap3D.Math.PI_OVER_TWO-SuperMap3D.Math.acosClamped(o.z),i=a*(180/Math.PI);return i<0&&(i+=360),{angle:i,radian:a}}},S={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},P=(D=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=D,D).toLowerCase();var C=((g=void 0!==P?P:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||g.startsWith("ja"),S),x=function(e,t){var r=0;switch(t&&(r=t),e){case"Point":window.handlerPoint=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Point);break;case"Polyline":window.handlerPolyline=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Line,r);break;case"Polygon":window.handlerPolygon=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Polygon,r);break;case"Marker":window.handlerMarker=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Marker,r);break;case"Box":window.handlerBox=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box,r)}window.tooltip||(window.tooltip=function(e){var t=function(e){var t=document.createElement("DIV");t.className="twipsy right";var r=document.createElement("DIV");r.className="twipsy-arrow",t.appendChild(r);var n=document.createElement("DIV");n.className="twipsy-inner",t.appendChild(n),this._div=t,this._title=n,this.message="",e.appendChild(t);var o=this;t.onmousemove=function(e){o.showAt({x:e.clientX,y:e.clientY},o.message)}};return t.prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},t.prototype.showAt=function(e,t){e&&t&&(this.setVisible(!0),this._title.innerHTML=t,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px",this.message=t)},new t(e)}(viewer._element)),window.polylineCollection||(window.polylineCollection=new SuperMap3D.PolylineCollection({translucentRS:SuperMap3D.RenderState.fromCache({depthMask:!1,depthTest:{enabled:!1}})}),window.polylineTransparent=window.polylineCollection.add({width:2,material:SuperMap3D.Material.fromType(SuperMap3D.Material.ColorType,{color:SuperMap3D.Color.fromCssColorString("#51ff00").withAlpha(.3)})}),viewer.scene.primitives.add(window.polylineCollection))},O=function(e){var t;switch(e){case"Point":t=window.handlerPoint;break;case"Polyline":t=window.handlerPolyline;break;case"Polygon":t=window.handlerPolygon;break;case"Marker":t=window.handlerMarker;break;case"Box":t=window.handlerBox}return t};var k=e({isViewer:!1,changeLayers:0,changeGeometrys:0});function E(o){var a,i,l,s,p=e({clipMode:0,planeDirection:"vertical"});if(o)for(var c in o)p.hasOwnProperty(c)?p[c]=o[c]:b.Message.errorMsg(C.AttributeError+c);var u,d,w="public/data/s3m/box.s3m";function y(){a=viewer.scene.layers.layerQueue,s=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(s),window.tooltip||(window.tooltip=function(e){var t=function(e){var t=document.createElement("DIV");t.className="tooltip",this._div=t,this.message="",e.appendChild(t)};return t.prototype.setVisible=function(e){this._div.style.right=e?"10px":"-300px"},t.prototype.showAt=function(e,t){t&&(this._div.style.top=t),e&&(this.setVisible(!0),this._div.innerHTML=e)},new t(e)}(viewer._element))}function v(){if(i.cartPositions){var e,t=m(a);try{for(t.s();!(e=t.n()).done;){e.value.setCustomClipPlane(i.cartPositions[0],i.cartPositions[1],i.cartPositions[2])}}catch(e){t.e(e)}finally{t.f()}}}function g(){if(tooltip.setVisible(!1),d&&(viewer.entities.remove(d),u.deactivate(),s.removeCollection(w),d=null,i=null),window.handlerPolyline){var e,t;(t=(e="Polyline")?O(e):window.handlerPolygon)&&(t.deactivate(),t.clear(),viewer.enableCursorStyle=!0,window.tooltip.setVisible(!1),window.polylineTransparent&&(window.polylineTransparent.show=!1));var r,n=m(a);try{for(n.s();!(r=n.n()).done;){r.value.clearCustomClipBox()}}catch(e){n.e(e)}finally{n.f()}}}return r((function(){return k.changeLayers}),(function(e){var t,r=m(a=viewer.scene.layers.layerQueue);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.selectEnabled=!1,n.clipLineColor=new SuperMap3D.Color(1,1,1,0)}}catch(e){r.e(e)}finally{r.f()}})),k.isViewer&&y(),r((function(){return k.isViewer}),(function(e){y()})),r((function(){return p.clipMode}),(function(e){if(i){var t=h(i.cartPositions),r=[t[1],t[0],t[3],t[2]];i.cartPositions=r,v()}})),n((function(){a=void 0,u&&u.destroy()})),f(f({},t(p)),{},{clipPlaneStart:function(e){e.preventDefault(),d&&g(),tooltip.setVisible(!1),tooltip.showAt("<p>点击鼠标左键开始绘制平面的一条边</p><p>绘制两点即可</p><p>点击鼠标右键结束绘制</p>","350px"),window.handlerPolygon||x("Polyline"),function(e,t,r){var n=!0;!1===t&&(n=t);var o=O(e);return new Promise((function(t,r){var a=window.tooltip,i=o.activeEvt.addEventListener((function(t){1==t?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="","Point"==e||"Marker"==e?document.body.classList.add("measureCur"):document.body.classList.add("drawCur")):(viewer.enableCursorStyle=!0,a.setVisible(!1),"Point"==e||"Marker"==e?document.body.classList.remove("measureCur"):document.body.classList.remove("drawCur"))})),l=o.movingEvt.addEventListener((function(t){if(t.x<200&&t.y<150)a.setVisible(!1);else if(o.polyline&&o.isDrawing){var r=h(o.positions);"Polygon"==e&&r.push(r[0]),window.polylineTransparent.show=!0,window.polylineTransparent.positions=r}})),s=o.drawEvt.addEventListener((function(r){if(!r.object.positions&&"Point"!=e&&"Box"!=e)return a.showAt(r,"<p>请绘制正确的多边形</p>"),o.polygon.show=!1,o.polyline.show=!1,o.deactivate(),void o.activate();if("Box"!=e){if("Point"==e||"Marker"==e)o.clear(),t({result:r});else{if(window.polylineTransparent.show=n,n&&"Polygon"==e&&n){o.polygon._polygon._material._color._value.alpha=.1;var p=h(r.object.positions);p.push(p[0]),window.polylineTransparent.positions=p}var c=M(r.object.positions);t({result:r,positions:c})}i(),l(),s()}else t({result:r})}))}))}("Polyline").then((function(e){console.log("res:",e);var t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),function(e,t){var r,n=SuperMap3D.Cartesian3.distance(t[0],t[1]);n=SuperMap3D.defaultValue(n,100),r="vertical"===p.planeDirection?function(e,t,r){var n=e.slice(0,3),o=e.slice(3,6),a=o.slice(0,2).concat(o[2]+r),i=n.slice(0,2).concat(n[2]+r),l=[].concat(t);return l.push(SuperMap3D.Cartesian3.fromDegrees(a[0],a[1],a[2])),l.push(SuperMap3D.Cartesian3.fromDegrees(i[0],i[1],i[2])),l}(e,t,n):function(e,t){var r=new SuperMap3D.Cartesian3(0,0,0),n=new SuperMap3D.Cartesian3(0,0,0),o=new SuperMap3D.Cartesian3(0,0,0),a=new SuperMap3D.Cartesian3(0,0,0),i=new SuperMap3D.Cartesian3(0,0,0);return SuperMap3D.Cartesian3.subtract(e[0],e[1],r),SuperMap3D.Cartesian3.cross(r,e[0],n),SuperMap3D.Cartesian3.normalize(n,n),SuperMap3D.Cartesian3.multiplyComponents(n,new SuperMap3D.Cartesian3(t,t,t),o),SuperMap3D.Cartesian3.add(e[0],o,i),SuperMap3D.Cartesian3.add(e[1],o,a),[e[0],e[1],a,i]}(t,n);var o=SuperMap3D.BoundingSphere.fromPoints(r).center;i={cartPositions:r,centerPositions:o},d=viewer.entities.add({id:"clip-plane",polygon:{hierarchy:new SuperMap3D.CallbackProperty((function(){return{positions:i.cartPositions,holes:[]}}),!1),material:SuperMap3D.Color.GOLD.withAlpha(.2),outline:!0,outlineColor:SuperMap3D.Color.GOLD,perPositionHeight:!0}}),a=b.getAngleAndRadian(i.cartPositions[0],i.cartPositions[1]).radian,c="clip-model",s.add(w,{id:c,position:i.centerPositions,hpr:new SuperMap3D.HeadingPitchRoll(a,0,0),scale:new SuperMap3D.Cartesian3(.1,.1,.1)}),l=s.getInstance(w,c),u?(u.setEditObject(l),u.activate()):(f=l,(u=new SuperMap3D.ModelEditor({model:f,scene:viewer.scene,axesShow:{translation:!0,rotation:!1,scale:!1}})).activate(),u.changedEvt.addEventListener((function(e){var t=new SuperMap3D.Cartesian3;if(SuperMap3D.Matrix4.getTranslation(e.modelMatrix,t),t){for(var r=t.x-i.centerPositions.x,n=t.y-i.centerPositions.y,o=t.z-i.centerPositions.z,a=0;a<4;a++)i.cartPositions[a].x+=r,i.cartPositions[a].y+=n,i.cartPositions[a].z+=o;i.centerPositions=t,v()}}))),v();var a,c,f}(e.positions,e.result.positions),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()},clearClipPlane:g})}var j={name:"Sm3dClipPlane",props:{},setup:function(e){var t=E(e);return{clipPlaneStart:t.clipPlaneStart,clearClipPlane:t.clearClipPlane,clipMode:t.clipMode,planeDirection:t.planeDirection}}},T={id:"clip-plane-panel",class:"sm-panel"},A={class:"sm-function-module-sub-section",style:{margin:"0"}},L={class:"sm-half-L"},V={style:{width:"40%"}},_={selected:"",value:"vertical"},B={value:"parallel"},I={class:"sm-half-L"},R={style:{width:"40%"}},H={selected:"",value:"0"},N={value:"1"},z={class:"boxchild"};j.render=function(e,t,r,n,u,d){var w=o("stopdrag"),f=o("drag");return a((i(),l("div",T,[a(s("div",A,[s("div",L,[s("label",V,p(e.Resource.planeDirection),1),a(s("select",{class:"sm-select",style:{width:"58%"},"onUpdate:modelValue":t[1]||(t[1]=function(e){return n.planeDirection=e})},[s("option",_,p(e.Resource.verticalGround),1),s("option",B,p(e.Resource.parallelGround),1)],512),[[c,n.planeDirection]])]),s("div",I,[s("label",R,p(e.Resource.clipMode),1),a(s("select",{class:"sm-select",style:{width:"58%"},"onUpdate:modelValue":t[2]||(t[2]=function(e){return n.clipMode=e})},[s("option",H,p(e.Resource.clipInside),1),s("option",N,p(e.Resource.clipOutside),1)],512),[[c,n.clipMode]])]),s("div",z,[s("button",{onClick:t[3]||(t[3]=function(){return n.clipPlaneStart&&n.clipPlaneStart.apply(n,arguments)}),class:"tbtn",type:"button"},p(e.Resource.clip),1),s("button",{onClick:t[4]||(t[4]=function(){return n.clearClipPlane&&n.clearClipPlane.apply(n,arguments)}),class:"tbtn tbtn-margin-left",type:"button"},p(e.Resource.clear),1)])],512),[[w]])],512)),[[f]])},j.__file="src/components/clip/clip-plane-new/clip-plane-new.vue",j.install=function(e){e.component(j.name,j)};export default j;
