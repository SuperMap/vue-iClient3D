import{reactive as e,onBeforeUnmount as n,watch as t,toRefs as i,ref as o,onMounted as r}from"vue";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function l(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,n,t){return n&&l(e.prototype,n),t&&l(e,t),e}function c(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function d(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach((function(n){c(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,n){return(v=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function w(e,n){return!n||"object"!=typeof n&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function m(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,i=f(e);if(n){var o=f(this).constructor;t=Reflect.construct(i,arguments,o)}else t=i.apply(this,arguments);return w(this,t)}}function y(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||g(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,n){if(e){if("string"==typeof e)return h(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?h(e,n):void 0}}function h(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}function S(e,n){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=g(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==t.return||t.return()}finally{if(s)throw r}}}}var M=function(e,n){if(!e||!n)return!0;var t=!0;if(Object.keys(e).length!=Object.keys(n).length)return!1;for(var i in e)if("object"==a(e[i])){if(!(t=isSame(e[i],n[i])))break}else if(e[i]!=n[i]){t=!1;break}return t},b=function(e){for(var n=[].concat(e),t=[],i=0,o=n.length;i<o;i++){var r=SuperMap3D.Cartographic.fromCartesian(n[i]),a=SuperMap3D.Math.toDegrees(r.longitude),s=SuperMap3D.Math.toDegrees(r.latitude),l=r.height;-1==t.indexOf(a)&&-1==t.indexOf(s)&&(t.push(a),t.push(s),t.push(l))}return t};var C={Message:{errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},axiosJsonp:function(e){if(e)return new Promise((function(n,t){window.jsonCallBack=function(e){n(e)};var i=document.createElement("script");i.type="text/javascript",i.src="".concat(e,"&callback=jsonCallBack"),document.getElementsByTagName("head")[0].appendChild(i),setTimeout((function(){document.getElementsByTagName("head")[0].removeChild(i)}),500)}));console.error("Axios.JSONP 至少需要一个url参数!")},isEqualArr:M,CartesiantoDegrees:b,CartesiantoDegreesObjs:function(e){for(var n=[].concat(e),t=[],i=0,o=n.length;i<o;i++){var r=SuperMap3D.Cartographic.fromCartesian(n[i]),a={longitude:SuperMap3D.Math.toDegrees(r.longitude),latitude:SuperMap3D.Math.toDegrees(r.latitude),height:r.height};t.push(a)}return t},unique:function(e){for(var n=[],t={},i=0;i<e.length;i++)t[e[i]]||(n.push(e[i]),t[e[i]]=1);return n},gradientColors:function(e,n,t,i){var o,r,a,s,l=[],u=[];i=i||1;var c,p=function(e){return Math.pow(e/255,i)};for(e=d(e).map(p),n=d(n).map(p),o=0;o<t;o++){for(s=1-(a=o/(t-1)),r=0;r<3;r++)u[r]=1===(c=Math.round(255*Math.pow(e[r]*s+n[r]*a,1/i)).toString(16)).length?"0"+c:c;l.push("#"+u.join(""))}return l;function d(e){return 4===e.length?e.substr(1).split("").map((function(e){return 17*parseInt(e,16)})):[e.substr(1,2),e.substr(3,2),e.substr(5,2)].map((function(e){return parseInt(e,16)}))}},getAngleAndRadian:function(e,n){var t=SuperMap3D.Transforms.eastNorthUpToFixedFrame(e),i=SuperMap3D.Cartesian3.subtract(n,e,new SuperMap3D.Cartesian3),o=SuperMap3D.Matrix4.multiplyByPointAsVector(SuperMap3D.Matrix4.inverse(t,new SuperMap3D.Matrix4),i,new SuperMap3D.Cartesian3),r=SuperMap3D.Cartesian3.normalize(o,new SuperMap3D.Cartesian3),a=Math.atan2(r.y,r.x)-SuperMap3D.Math.PI_OVER_TWO,s=SuperMap3D.Math.TWO_PI-SuperMap3D.Math.zeroToTwoPi(a),l=s*(180/Math.PI);return l<0&&(l+=360),{angle:l,radian:s}},CartographictoDegrees:function(e){return[SuperMap3D.Math.toDegrees(e.longitude),SuperMap3D.Math.toDegrees(e.latitude),e.height]},getPitch:function(e,n){var t=SuperMap3D.Transforms.eastNorthUpToFixedFrame(e),i=SuperMap3D.Cartesian3.subtract(n,e,new SuperMap3D.Cartesian3),o=SuperMap3D.Matrix4.multiplyByPointAsVector(SuperMap3D.Matrix4.inverse(t,t),i,i);SuperMap3D.Cartesian3.normalize(o,o);var r=SuperMap3D.Math.PI_OVER_TWO-SuperMap3D.Math.acosClamped(o.z),a=r*(180/Math.PI);return a<0&&(a+=360),{angle:a,radian:r}}},D=/^\s+|\s+$/g,P=/^[-+]0x[0-9a-f]+$/i,E=/^0b[01]+$/i,x=/^0o[0-7]+$/i,L=parseInt,R="object"==("undefined"==typeof global?"undefined":a(global))&&global&&global.Object===Object&&global,T="object"==("undefined"==typeof self?"undefined":a(self))&&self&&self.Object===Object&&self,k=R||T||Function("return this")(),I=Object.prototype.toString,N=Math.max,V=Math.min,B=function(){return k.Date.now()};function A(e,n,t){var i,o,r,a,s,l,u=0,c=!1,p=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(n){var t=i,r=o;return i=o=void 0,u=n,a=e.apply(r,t)}function v(e){return u=e,s=setTimeout(m,n),c?f(e):a}function w(e){var t=e-l;return void 0===l||t>=n||t<0||p&&e-u>=r}function m(){var e=B();if(w(e))return y(e);s=setTimeout(m,function(e){var t=n-(e-l);return p?V(t,r-(e-u)):t}(e))}function y(e){return s=void 0,d&&i?f(e):(i=o=void 0,a)}function g(){var e=B(),t=w(e);if(i=arguments,o=this,l=e,t){if(void 0===s)return v(l);if(p)return s=setTimeout(m,n),f(l)}return void 0===s&&(s=setTimeout(m,n)),a}return n=F(n)||0,_(t)&&(c=!!t.leading,r=(p="maxWait"in t)?N(F(t.maxWait)||0,n):r,d="trailing"in t?!!t.trailing:d),g.cancel=function(){void 0!==s&&clearTimeout(s),u=0,i=l=o=s=void 0},g.flush=function(){return void 0===s?a:y(B())},g}function _(e){var n=a(e);return!!e&&("object"==n||"function"==n)}function O(e){return"symbol"==a(e)||function(e){return!!e&&"object"==a(e)}(e)&&"[object Symbol]"==I.call(e)}function F(e){if("number"==typeof e)return e;if(O(e))return NaN;if(_(e)){var n="function"==typeof e.valueOf?e.valueOf():e;e=_(n)?n+"":n}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(D,"");var t=E.test(e);return t||x.test(e)?L(e.slice(2),t?2:8):P.test(e)?NaN:+e}var H=e({isViewer:!1,changeLayers:0,changeGeometrys:0}),G=function(e){H.isViewer=e},j=function(e){H.changeLayers+=1},W=function(e){H.changeGeometrys+=1,console.log(K.geometrys)},K={geometrys:{},layers:null};function z(e,n){var t=[];try{e&&e.forEach((function(e){t.push(viewer.scene.addS3MTilesLayerByScp(e.url,e.options))})),Q(t,n,"S3M")}catch(e){var i=viewer.SuperMap3DWidget;if(i._showRenderLoopErrors){i.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}}function U(e,n,t){n&&n.SceneToken&&(SuperMap3D.Credential.CREDENTIAL=new SuperMap3D.Credential(n.SceneToken));var i=!0;if(n&&n.autoSetView&&(i=n.autoSetView),function(e){if(null===e||""===e)return!1;if('"'==e.charAt(0)||"'"==e.charAt(0)){var n=/^['|"](.*)['|"]$/;e=e.replace(n,"$1")}return!0}(e))try{Q([viewer.scene.open(e,void 0,{autoSetView:i})],t,"SCENE")}catch(e){var o=viewer.SuperMap3DWidget;if(o._showRenderLoopErrors){o.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}}function Q(e,n,t){SuperMap3D.when.all(e,(function(e){console.log("layers:",e),K.layers=viewer.scene.layers.layerQueue,j(),n(e[0],t),K.layers.forEach((function(e){(!e.visibleDistanceMax||e.visibleDistanceMax>12e3)&&(e.visibleDistanceMax=12e3)}))}),(function(e){var n=viewer.SuperMap3DWidget;if(n._showRenderLoopErrors){n.showErrorPanel("请检查url地址是否正确？",void 0,e)}}))}var X={addS3mLayers:z,addScene:U,addTerrainLayer:function(e,n){try{viewer.terrainProvider=new SuperMap3D.SuperMap3DTerrainProvider({url:e,isSct:n})}catch(e){var t=viewer.SuperMap3DWidget;if(t._showRenderLoopErrors){t.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}},addImageLayer:function(e){try{return viewer.imageryLayers.addImageryProvider(new SuperMap3D.SuperMapImageryProvider({url:e}))}catch(e){var n=viewer.SuperMap3DWidget;if(n._showRenderLoopErrors){n.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}},layersDelete:function(e,n,t){switch(e){case"S3M":viewer.scene.layers.remove(n),j(),t();break;case"IMG":var i;if("nunber"==typeof n)i=viewer.imageryLayers.get(n);else for(var o=viewer.imageryLayers._layers,r=0;r<o.length;r++)o[r].imageryProvider.tablename&&o[r].imageryProvider.tablename===n&&(i=o[r]);i&&(viewer.imageryLayers.remove(i),j(),t());break;case"TERRAIN":viewer.terrainProvider=new SuperMap3D.EllipsoidTerrainProvider,j(),t();break;case"MVT":viewer.scene.removeVectorTilesMap(n),j(),t()}},addMvtLayer:function(e,n,t){try{var i=viewer.scene.addVectorTilesMap({url:e,canvasWidth:512,name:n||"mvt",viewer:viewer});return SuperMap3D.when(i.readyPromise,(function(e){var n=i.rectangle;viewer.scene.camera.flyTo({destination:new SuperMap3D.Cartesian3.fromRadians(.5*(n.east+n.west),.5*(n.north+n.south),1e4),duration:0,orientation:{heading:0,roll:0}}),j(),t(i)})),i}catch(e){var o=viewer.SuperMap3DWidget;if(o._showRenderLoopErrors){o.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}}},Z={flyByCameraParam:function(e){e&&viewer.scene.camera.flyTo({destination:new SuperMap3D.Cartesian3(e.Cartesian3.x,e.Cartesian3.y,e.Cartesian3.z),orientation:{heading:e.heading,pitch:e.pitch,roll:e.roll},duration:0})},flyByLayerName:function(e,n){if(e&&n)switch(e){case"S3M":var t=viewer.scene.layers.find(n);viewer.flyTo(t,{duration:0});break;case"MVT":var i=viewer.scene.getVectorTilesMap(n).rectangle;viewer.scene.camera.flyTo({destination:new SuperMap3D.Cartesian3.fromRadians(.5*(i.east+i.west),.5*(i.north+i.south),1e4),duration:0,orientation:{heading:0,roll:0}});break;case"IMG":var o;if("nunber"==typeof n)o=viewer.imageryLayers.get(n);else for(var r=viewer.imageryLayers._layers,a=0;a<r.length;a++)r[a].imageryProvider.tablename&&r[a].imageryProvider.tablename===n&&(o=r[a]);o&&viewer.flyTo(o,{duration:0})}}};function Y(){}Object.assign(Y.prototype,{addEventListener:function(e,n){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];void 0===this._listeners&&(this._listeners={}),this._mutex=this._mutex||{};var i=this._mutex,o=this._listeners;void 0===o[e]&&(o[e]=[]),-1===o[e].indexOf(n)&&(t&&(i[e]=n),o[e].push(n))},hasEventListener:function(e,n){if(void 0===this._listeners)return!1;var t=this._listeners;return void 0!==t[e]&&-1!==t[e].indexOf(n)},removeEventListener:function(e,n){if(void 0!==this._listeners){var t=this._listeners[e];if(this._mutex[e]===n&&(this._mutex[e]=null),void 0!==t){var i=t.indexOf(n);-1!==i&&t.splice(i,1)}}},dispatchEvent:function(e){var n=this;if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;var i=t.slice(0);if(this._mutex[e.type])return void i.find((function(t){return t===n._mutex[e.type]})).call(this,e);for(var o=0,r=i.length;o<r;o++)i[o].call(this,e)}}},removeAllListener:function(){for(var e in this._mutex={},this._listeners)this._listeners[e]=[]}});var q="CLICK",J="LEFT_DOWN",$="LEFT_UP",ee="MOUSE_MOVE",ne="RIGHT_CLICK",te="LEFT_DOWN_MOUSE_MOVE",ie=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&v(e,n)}(t,Y);var n=m(t);function t(e){var i;return s(this,t),(i=n.call(this)).viewer=e,i.handler=new SuperMap3D.ScreenSpaceEventHandler(i.viewer.scene.canvas),i.handler.setInputAction((function(e){i.dispatchEvent({type:q,message:e})}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),i.handler.setInputAction((function(e){i.press=!0,i.dispatchEvent({type:J,message:e})}),SuperMap3D.ScreenSpaceEventType.LEFT_DOWN),i.handler.setInputAction((function(e){i.press=!1,i.dispatchEvent({type:$,message:e})}),SuperMap3D.ScreenSpaceEventType.LEFT_UP),i.handler.setInputAction((function(e){i.dispatchEvent({type:ne,message:e})}),SuperMap3D.ScreenSpaceEventType.RIGHT_CLICK),i.handler.setInputAction((function(e){i.press&&i.dispatchEvent({type:te,message:e}),i.dispatchEvent({type:ee,message:e})}),SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),i}return u(t,[{key:"addCameraMoveListener",value:function(e){this.viewer.camera.changed.addEventListener(e)}},{key:"removeCameraMoveListener",value:function(e){this.viewer.camera.changed.removeEventListener(e)}}]),t}();function oe(e){var n=function(e){var n=document.createElement("DIV");n.className="tooltip",this._div=n,this.message="",e.appendChild(n)};return n.prototype.setVisible=function(e){this._div.style.right=e?"10px":"-300px"},n.prototype.showAt=function(e,n){n&&(this._div.style.top=n),e&&(this.setVisible(!0),this._div.innerHTML=e)},new n(e)}var re,ae,se={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},le=(ae=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=ae,ae).toLowerCase();var ue=((re=void 0!==le?le:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||re.startsWith("ja"),se);var ce=function(e,n){var t=0;switch(n&&(t=n),e){case"Point":window.handlerPoint=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Point);break;case"Polyline":window.handlerPolyline=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Line,t);break;case"Polygon":window.handlerPolygon=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Polygon,t);break;case"Marker":window.handlerMarker=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Marker,t);break;case"Box":window.handlerBox=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box,t)}window.tooltip||(window.tooltip=function(e){var n=function(e){var n=document.createElement("DIV");n.className="twipsy right";var t=document.createElement("DIV");t.className="twipsy-arrow",n.appendChild(t);var i=document.createElement("DIV");i.className="twipsy-inner",n.appendChild(i),this._div=n,this._title=i,this.message="",e.appendChild(n);var o=this;n.onmousemove=function(e){o.showAt({x:e.clientX,y:e.clientY},o.message)}};return n.prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},n.prototype.showAt=function(e,n){e&&n&&(this.setVisible(!0),this._title.innerHTML=n,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px",this.message=n)},new n(e)}(viewer._element)),window.polylineCollection||(window.polylineCollection=new SuperMap3D.PolylineCollection({translucentRS:SuperMap3D.RenderState.fromCache({depthMask:!1,depthTest:{enabled:!1}})}),window.polylineTransparent=window.polylineCollection.add({width:2,material:SuperMap3D.Material.fromType(SuperMap3D.Material.ColorType,{color:SuperMap3D.Color.fromCssColorString("#51ff00").withAlpha(.3)})}),viewer.scene.primitives.add(window.polylineCollection))},pe=function(e,n,t){var i=!0;!1===n&&(i=n);var o=fe(e);return new Promise((function(n,t){var r=window.tooltip,a=o.activeEvt.addEventListener((function(n){1==n?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="","Point"==e||"Marker"==e?document.body.classList.add("measureCur"):document.body.classList.add("drawCur")):(viewer.enableCursorStyle=!0,r.setVisible(!1),"Point"==e||"Marker"==e?document.body.classList.remove("measureCur"):document.body.classList.remove("drawCur"))})),s=o.movingEvt.addEventListener((function(n){if(n.x<200&&n.y<150)r.setVisible(!1);else if(o.polyline&&o.isDrawing){var t=y(o.positions);"Polygon"==e&&t.push(t[0]),window.polylineTransparent.show=!0,window.polylineTransparent.positions=t}})),l=o.drawEvt.addEventListener((function(t){if(!t.object.positions&&"Point"!=e&&"Box"!=e)return r.showAt(t,"<p>请绘制正确的多边形</p>"),o.polygon.show=!1,o.polyline.show=!1,o.deactivate(),void o.activate();if("Box"!=e){if("Point"==e||"Marker"==e)o.clear(),n({result:t});else{if(window.polylineTransparent.show=i,i&&"Polygon"==e&&i){o.polygon._polygon._material._color._value.alpha=.1;var u=y(t.object.positions);u.push(u[0]),window.polylineTransparent.positions=u}var c=b(t.object.positions);n({result:t,positions:c})}a(),s(),l()}else n({result:t})}))}))},de=function(e){var n;(n=e?fe(e):window.handlerPolygon)&&(n.deactivate(),n.clear(),viewer.enableCursorStyle=!0,window.tooltip.setVisible(!1),window.polylineTransparent&&(window.polylineTransparent.show=!1))},fe=function(e){var n;switch(e){case"Point":n=window.handlerPoint;break;case"Polyline":n=window.handlerPolyline;break;case"Polygon":n=window.handlerPolygon;break;case"Marker":n=window.handlerMarker;break;case"Box":n=window.handlerBox}return n},ve=ce,we=pe,me=de,ye=function(e,n,t){window.selectHandler||(window.selectHandler=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas));var i=window.selectHandler;window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!0),i.setInputAction((function(){console.log("viewer.selectedEntity:",viewer.selectedEntity);var o=viewer.selectedEntity,r=window.editHandler;o&&(r&&r&&r.clear(),r?(r.deactivate(),r.setEditObject(o),r.activate()):(window.editHandler=new SuperMap3D.EditHandler(viewer,o),window.editHandler.isEditZ=n||!1,window.editHandler.activate()),i.setInputAction((function(){if(o=viewer.selectedEntity,r=window.editHandler,o&&r&&r._positions){var n=b(r._positions);if(M(e,n))return;if(e=n,t&&t(n,window.editHandler),window.handlerPolygon&&window.handlerPolygon.polygon&&window.handlerPolygon.polygon.show){var i=y(r._positions);i.push(i[0]),window.polylineTransparent.positions=i}}}),SuperMap3D.ScreenSpaceEventType.LEFT_UP))}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)},ge=function(){window.editHandler&&(window.editHandler.deactivate(),window.editHandler.clear()),window.selectHandler&&(window.selectHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_UP),window.selectHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),window.selectHandler.destroy(),window.selectHandler=null)};var he=function(){function e(n,t,i,o){s(this,e),this.viewer=n,this.id_type=t,this.pickedEntity=null,this.leftDownFlag=!1,this.moveEndCallBack=i||void 0,this.leftUpCallBack=o||void 0,this.movePickedEntity=null,this.layers=n.scene.layers.layerQueue}return u(e,[{key:"addEventListener",value:function(){for(var e=this,n=0;n<e.layers.length;n++)e.layers[n].selectEnabled=!1;e.viewer.screenSpaceEventHandler.setInputAction((function(n){var t=e.viewer.scene.pick(n.position);if(e.leftDownFlag=!0,t){var i=SuperMap3D.defaultValue(t.id,t.primitive.id);i.id&&i.id.includes(e.id_type)&&(e.pickedEntity=i,e.viewer.scene.screenSpaceCameraController.enableRotate=!1)}}),SuperMap3D.ScreenSpaceEventType.LEFT_DOWN),e.viewer.screenSpaceEventHandler.setInputAction((function(n){e.leftDownFlag=!1,e.viewer.scene.screenSpaceCameraController.enableRotate=!0,e.leftUpCallBack&&e.pickedEntity&&e.leftUpCallBack(e.pickedEntity);e.pickedEntity=null}),SuperMap3D.ScreenSpaceEventType.LEFT_UP),e.viewer.screenSpaceEventHandler.setInputAction((function(n){if(e.leftDownFlag){if(e.pickedEntity){var t=e.viewer.scene.pickPosition(n.endPosition);e.pickedEntity.position=t,e.moveEndCallBack&&e.moveEndCallBack(e.pickedEntity)}}else{var i=e.viewer.scene.pick(n.endPosition);if(i){var o=SuperMap3D.defaultValue(i.id,i.primitive.id);o.id&&o.id.includes(e.id_type)?(e.movePickedEntity=o,o.point.pixelSize=20):e.movePickedEntity&&(e.movePickedEntity.point.pixelSize=10)}else e.movePickedEntity&&(e.movePickedEntity.point.pixelSize=10)}}),SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"removeEventListener",value:function(){this.viewer.screenSpaceEventHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_DOWN),this.viewer.screenSpaceEventHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),this.viewer.screenSpaceEventHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_UP)}}]),e}();var Se=function(){function e(){s(this,e)}return u(e,[{key:"createXMLflyLine",value:function(e){var n=new DOMParser;window.parser=n;var t=n.parseFromString("<cusxmlRoute></cusxmlRoute>","text/xml");window.xmlDoc=t;var i=this.createSceneRouteNode(t),o=this.createRouteNode(t,e),r=this.createRouteStyleNode(t);o.appendChild(r);var a=e.routeStops;if(!(a.length<2)){for(var s=0;s<a.length;s++){var l=a[s],u={longitude:l.point[0],latitude:l.point[1],altitude:l.point[2],heading:l.heading*(180/Math.PI),tilt:l.tilt*(180/Math.PI)+90},c=this.createStopNode(t,u,l,s);o.appendChild(c)}return i.appendChild(o),t.children[0].appendChild(i),t.children[0].innerHTML}console.warn("节点数小于2")}},{key:"createSceneRouteNode",value:function(e){var n=e.createElement("SceneRoute");return n.setAttribute("xmlns","http://www.supermap.com.cn/ugc60"),n}},{key:"createRouteNode",value:function(e,n){var t=e.createElement("route"),i={name:n.routeName||"飞行路线",speed:n.speed||"200",lineType:"0",showroutestop:"False",showrouteline:"False",altitudefree:"False",headingfree:"False",tiltfree:"False",flycircle:"False",alongline:n.isAlongLine||"False"};for(var o in i)t.setAttribute(o,i[o]);return t}},{key:"createRouteStyleNode",value:function(e){var n=e.createElement("style"),t=e.createElement("geostyle3d"),i=e.createElement("linecolor");i.textContent="RGBA(147,112,219,255)";var o=e.createElement("linewidth");o.textContent=2;var r=e.createElement("altitudeMode");r.textContent="Absolute";var a=e.createElement("bottomAltitude");return a.textContent=0,t.appendChild(i),t.appendChild(o),t.appendChild(r),t.appendChild(a),n.appendChild(t),n}},{key:"createStopNode",value:function(e,n,t,i){var o=e.createElement("routestop"),r={name:t.stopName||"Stop"+(i+1),speed:t.speed,excluded:"False",viewType:"camera"};for(var a in r)o.setAttribute(a,r[a]);var s=this.createStopCameraNode(e,n);o.appendChild(s);var l=this.createStopStyleNode(e);o.appendChild(l);var u=this.createStopSettingNode(e,t);return o.appendChild(u),o}},{key:"createStopCameraNode",value:function(e,n){var t=e.createElement("camera");for(var i in n){var o=e.createElement(i);o.textContent=n[i],t.appendChild(o)}return t}},{key:"createStopStyleNode",value:function(e){var n={icon:"",markersize:4.8,markericonscale:1,markercolor:"RGBA(255, 255, 255, 255)"},t=e.createElement("style"),i=e.createElement("geostyle3d");for(var o in n){var r=e.createElement(o);r.textContent=n[o],i.appendChild(r)}return t.appendChild(i),t}},{key:"createStopSettingNode",value:function(e,n){var t=e.createElement("setting"),i={turnTime:n.surroundDuration||1.5,turnSlowly:"False",stopPlayMode:n.stopPlayMode||"StopPause",autoPlay:"False",pauseTime:n.waitTime||0,angularSpeed:1};for(var o in i){var r=e.createElement(o);r.textContent=i[o],t.appendChild(r)}return t}}]),e}();var Me={polyline:[{id:"1",iconfont:"iconshixian",lineName:"实线"},{id:"2",iconfont:"iconxuxian",lineName:"虚线"},{id:"3",iconfont:"iconlunkuoxian",lineName:"轮廓线"},{id:"4",iconfont:"iconjiantouxian",lineName:"箭头线"},{id:"5",iconfont:"iconguangyunxian",lineName:"光晕线"},{id:"6",iconfont:"iconweijixian",lineName:"尾迹线"},{},{}],polygon:[{id:"1",iconfont:"iconchunse",faceName:"纯色"},{id:"2",iconfont:"iconwangge",faceName:"网格"},{id:"3",iconfont:"icontiaowen",faceName:"条纹"}]};var be=[{id:0,name:"树木",type:"tree",data:[{id:0,name:"树1",thumbnail:"public/data/s3m/S3MData/tree.png",path:"public/data/s3m/S3MData/tree1.s3m"},{id:1,name:"树2",thumbnail:"public/data/s3m/S3MData/pine.png",path:"public/data/s3m/S3MData/tree2.s3m"},{id:2,name:"树3",thumbnail:"public/data/s3m/S3MData/tree3.png",path:"public/data/s3m/S3MData/tree3.s3m"},{id:3,name:"树4",thumbnail:"public/data/s3m/S3MData/tree2.png",path:"public/data/s3m/S3MData/tree4.s3m"},{id:4,name:"springTree",thumbnail:"public/data/s3m/S3MData/springTree.png",path:"public/data/s3m/S3MData/springTree.s3m"},{id:5,name:"autumnTree",thumbnail:"public/data/s3m/S3MData/autumnTree.png",path:"public/data/s3m/S3MData/autumnTree.s3m"},{id:6,name:"winterTree",thumbnail:"public/data/s3m/S3MData/winterTree.png",path:"public/data/s3m/S3MData/winterTree.s3m"},{},{},{}]},{id:1,name:"公共设施",type:"public-utilities",data:[{id:0,name:"椅子",thumbnail:"public/data/s3m/S3MData/bench.png",path:"public/data/s3m/S3MData/Chair.s3m"},{id:1,name:"垃圾箱",thumbnail:"public/data/s3m/S3MData/Dustbin.png",path:"public/data/s3m/S3MData/Dustbin.s3m"},{id:2,name:"垃圾箱2",thumbnail:"public/data/s3m/S3MData/paper-bucket.png",path:"public/data/s3m/S3MData/Dustbin2.s3m"},{id:3,name:"垃圾桶",thumbnail:"public/data/s3m/S3MData/dustbin1.png",path:"public/data/s3m/S3MData/GarbageCan.s3m"},{id:4,name:"报亭",thumbnail:"public/data/s3m/S3MData/newspaper.png",path:"public/data/s3m/S3MData/NewsStand.s3m"},{id:5,name:"邮政信箱",thumbnail:"public/data/s3m/S3MData/mailbox.png",path:"public/data/s3m/S3MData/PO-Box.s3m"},{id:6,name:"电信电话亭",thumbnail:"public/data/s3m/S3MData/phone-booth.png",path:"public/data/s3m/S3MData/T-TelBooth.s3m"},{},{},{}]},{id:2,name:"交通",type:"traffic",data:[{id:0,name:"限速牌",thumbnail:"public/data/s3m/S3MData/speed-limit.png",path:"public/data/s3m/S3MData/RestrictionBoard.s3m"},{id:1,name:"路灯",thumbnail:"public/data/s3m/S3MData/lamp-post.png",path:"public/data/s3m/S3MData/StreetLight.s3m"},{id:2,name:"红绿灯",thumbnail:"public/data/s3m/S3MData/traffic-light.png",path:"public/data/s3m/S3MData/TrafficLight.s3m"},{},{}]}],Ce=function(){function e(){s(this,e),this._positions=null,this.boundingSphere=null,this._geometry=null,this._triangleArrayByWeight=null}return u(e,[{key:"initPolygonEmitter",value:function(e){if(this._positions=SuperMap3D.defaultValue(e,[new SuperMap3D.Cartesian3,new SuperMap3D.Cartesian3,new SuperMap3D.Cartesian3]),this.boundingSphere=SuperMap3D.BoundingSphere.fromPoints(e),SuperMap3D.defaultValue(e)){var n=SuperMap3D.PolygonGeometry.fromPositions({positions:e,perPositionHeight:!0});this._geometry=SuperMap3D.PolygonGeometry.createGeometry(n),this._triangleArrayByWeight=this.initWeight(this._geometry)}}},{key:"initWeight",value:function(e){var n,t,i=new SuperMap3D.Cartesian3,o=new SuperMap3D.Cartesian3,r=new SuperMap3D.Cartesian3,a=e.indices,s=a.length/3,l=e.attributes.position.values,u=[],c=0;for(n=0;n<s;n++){var p=a[3*n],d=a[3*n+1],f=a[3*n+2];i.x=l[3*p],i.y=l[3*p+1],i.z=l[3*p+2],o.x=l[3*d],o.y=l[3*d+1],o.z=l[3*d+2],r.x=l[3*f],r.y=l[3*f+1],r.z=l[3*f+2];var v=this.triangleArea(i,o,r);c+=v,u.push(v)}var w=Math.max(100,10*s),m=[];for(n=0;n<s;n++){var y=Math.floor(u[n]/c*w);for(y=Math.max(1,y),t=0;t<y;t++)m.push(n)}return m}},{key:"triangleArea",value:function(e,n,t){var i=new SuperMap3D.Cartesian3,o=new SuperMap3D.Cartesian3,r=new SuperMap3D.Cartesian3;return i=SuperMap3D.Cartesian3.subtract(n,e,i),o=SuperMap3D.Cartesian3.subtract(t,e,o),r=SuperMap3D.Cartesian3.cross(i,o,r),.5*SuperMap3D.Cartesian3.magnitude(r)}},{key:"randomVertex",value:function(e,n,t,i,o){return(1-Math.sqrt(e))*t+Math.sqrt(e)*(1-n)*i+Math.sqrt(e)*n*o}},{key:"getOneRandomPosition",value:function(){if(SuperMap3D.defaultValue(this._geometry)){var e=Math.floor(SuperMap3D.Math.randomBetween(0,this._triangleArrayByWeight.length)),n=this._triangleArrayByWeight[e],t=this._geometry.indices[3*n],i=this._geometry.indices[3*n+1],o=this._geometry.indices[3*n+2],r=this._geometry.attributes.position.values,a=r[3*t],s=r[3*t+1],l=r[3*t+2],u=r[3*i],c=r[3*i+1],p=r[3*i+2],d=r[3*o],f=r[3*o+1],v=r[3*o+2],w=SuperMap3D.Math.randomBetween(0,1),m=SuperMap3D.Math.randomBetween(0,1),y=this.randomVertex(w,m,a,u,d),g=this.randomVertex(w,m,s,c,f),h=this.randomVertex(w,m,l,p,v);return SuperMap3D.Cartesian3.fromElements(y,g,h)}}},{key:"positions",get:function(){return this._positions},set:function(e){if(SuperMap3D.defaultValue(e)){this._positions=e;var n=SuperMap3D.PolygonGeometry.fromPositions({positions:this._positions,perPositionHeight:!0});this._geometry=SuperMap3D.PolygonGeometry.createGeometry(n),this._triangleArrayByWeight=this.initWeight(this._geometry),this.boundingSphere=SuperMap3D.BoundingSphere.fromPoints(e)}}}]),e}();var De=[{id:0,iconfont:"icondianguangyuan",lightName:"点光源"},{id:1,iconfont:"iconjuguangdeng",lightName:"聚光灯"},{id:2,iconfont:"iconpinghangguang",lightName:"平行光"}];var Pe=[{name:"线状纹理1",type:"line",url:"public/img/particleSystem/line-1.jpg"},{name:"线状纹理2",type:"line",url:"public/img/particleSystem/line-2.jpg"},{name:"环状纹理1",type:"ring",url:"public/img/particleSystem/ring-1.jpg"},{name:"环状纹理2",type:"ring",url:"public/img/particleSystem/ring-2.jpg"},{name:"环状六边形纹理",type:"ring",url:"public/img/particleSystem/ring-3.jpg"}];function Ee(e){this.tableName=e.tableName,this.opacityMinValue=e.opacityMinValue,this.opacityMaxValue=e.opacityMaxValue,this.gradientMinOpacity=e.gradientMinOpacity,this.gradientMaxOpacity=e.gradientMaxOpacity,this.visibleMinValue=e.visibleMinValue,this.visibleMaxValue=e.visibleMaxValue}Ee.prototype.setColorTable=function(e,n){if(SuperMap3D.defined(e)){var t=e.minValue,i=e.maxValue,o=this.visibleMinValue,r=this.visibleMaxValue;if(o>r){var a=o;o=r,r=a}this.setOpacityFunction(e,t,i,o,r),this.setColorFunction(e,t,i,o,r,n)}},Ee.prototype.setOpacityFunction=function(e,n,t,i,o){var r=this.opacityMinValue,a=this.opacityMaxValue,s=new SuperMap3D.PiecewiseFunction;s.addPoint(n,0),s.addPoint(n+(t-n)*i,r),s.addPoint(n+(t-n)*o,a),s.addPoint(n+(t-n)*(o+.01),r),s.addPoint(t,0),e.opacityTransferFunction=s},Ee.prototype.setColorFunction=function(e,n,t,i,o,r){var a=new SuperMap3D.ColorTransferFunction,s=(o-i)/15;switch(r){case 1:a.addRGBPoint(n,9/255,9/255,212/255),a.addRGBPoint(n+(t-n)*i,9/255,10/255,1),a.addRGBPoint(n+(t-n)*(i+s),9/255,.2,1),a.addRGBPoint(n+(t-n)*(i+2*s),9/255,.4,1),a.addRGBPoint(n+(t-n)*(i+3*s),9/255,.6,1),a.addRGBPoint(n+(t-n)*(i+4*s),9/255,.8,1),a.addRGBPoint(n+(t-n)*(i+5*s),9/255,1,1),a.addRGBPoint(n+(t-n)*(i+6*s),.2,1,.8),a.addRGBPoint(n+(t-n)*(i+7*s),.4,1,.6),a.addRGBPoint(n+(t-n)*(i+8*s),.6,1,.4),a.addRGBPoint(n+(t-n)*(i+9*s),.8,1,.2),a.addRGBPoint(n+(t-n)*(i+10*s),1,1,0),a.addRGBPoint(n+(t-n)*(i+11*s),1,.8,0),a.addRGBPoint(n+(t-n)*(i+12*s),1,.6,0),a.addRGBPoint(n+(t-n)*(i+13*s),1,.4,0),a.addRGBPoint(n+(t-n)*(i+14*s),1,.2,0),a.addRGBPoint(n+(t-n)*(i+15*s),1,0,0);break;case 2:a.addRGBPoint(n,1,103/255,103/255),a.addRGBPoint(n+(t-n)*i,1,0,1),a.addRGBPoint(n+(t-n)*(i+s),1,.2,1),a.addRGBPoint(n+(t-n)*(i+2*s),1,.4,1),a.addRGBPoint(n+(t-n)*(i+3*s),1,.6,1),a.addRGBPoint(n+(t-n)*(i+4*s),1,.8,1),a.addRGBPoint(n+(t-n)*(i+5*s),1,1,1),a.addRGBPoint(n+(t-n)*(i+6*s),.2,1,.8),a.addRGBPoint(n+(t-n)*(i+7*s),.4,1,.6),a.addRGBPoint(n+(t-n)*(i+8*s),.6,1,.4),a.addRGBPoint(n+(t-n)*(i+9*s),.8,1,.2),a.addRGBPoint(n+(t-n)*(i+10*s),1,1,0),a.addRGBPoint(n+(t-n)*(i+11*s),1,.8,0),a.addRGBPoint(n+(t-n)*(i+12*s),1,.6,0),a.addRGBPoint(n+(t-n)*(i+13*s),1,.4,0),a.addRGBPoint(n+(t-n)*(i+14*s),1,.2,0),a.addRGBPoint(n+(t-n)*(i+15*s),1,0,0);break;case 3:a.addRGBPoint(n,157/255,0,1),a.addRGBPoint(n+(t-n)*i,157/255,0,1),a.addRGBPoint(n+(t-n)*(i+s),157/255,.2,1),a.addRGBPoint(n+(t-n)*(i+2*s),157/255,.4,1),a.addRGBPoint(n+(t-n)*(i+3*s),157/255,.6,1),a.addRGBPoint(n+(t-n)*(i+4*s),157/255,.8,1),a.addRGBPoint(n+(t-n)*(i+5*s),157/255,1,1),a.addRGBPoint(n+(t-n)*(i+6*s),.2,1,.8),a.addRGBPoint(n+(t-n)*(i+7*s),.4,1,.6),a.addRGBPoint(n+(t-n)*(i+8*s),.6,1,.4),a.addRGBPoint(n+(t-n)*(i+9*s),.8,1,.2),a.addRGBPoint(n+(t-n)*(i+10*s),1,1,0),a.addRGBPoint(n+(t-n)*(i+11*s),1,.8,0),a.addRGBPoint(n+(t-n)*(i+12*s),1,.6,0),a.addRGBPoint(n+(t-n)*(i+13*s),1,.4,0),a.addRGBPoint(n+(t-n)*(i+14*s),1,.2,0),a.addRGBPoint(n+(t-n)*(i+15*s),1,0,0);break;case 4:a.addRGBPoint(n,149/255,232/255,249/255),a.addRGBPoint(n+(t-n)*i,149/255,0,1),a.addRGBPoint(n+(t-n)*(i+s),149/255,.2,1),a.addRGBPoint(n+(t-n)*(i+2*s),149/255,.4,1),a.addRGBPoint(n+(t-n)*(i+3*s),149/255,.6,1),a.addRGBPoint(n+(t-n)*(i+4*s),149/255,.8,1),a.addRGBPoint(n+(t-n)*(i+5*s),149/255,1,1),a.addRGBPoint(n+(t-n)*(i+6*s),.2,1,.8),a.addRGBPoint(n+(t-n)*(i+7*s),.4,1,.6),a.addRGBPoint(n+(t-n)*(i+8*s),.6,1,.4),a.addRGBPoint(n+(t-n)*(i+9*s),.8,1,.2),a.addRGBPoint(n+(t-n)*(i+10*s),1,1,0),a.addRGBPoint(n+(t-n)*(i+11*s),1,.8,0),a.addRGBPoint(n+(t-n)*(i+12*s),1,.6,0),a.addRGBPoint(n+(t-n)*(i+13*s),1,.4,0),a.addRGBPoint(n+(t-n)*(i+14*s),1,.2,0),a.addRGBPoint(n+(t-n)*(i+15*s),1,0,0);break;case 5:a.addRGBPoint(n,26/255,1,156/255),a.addRGBPoint(n+(t-n)*i,26/255,0,1),a.addRGBPoint(n+(t-n)*(i+s),26/255,.2,1),a.addRGBPoint(n+(t-n)*(i+2*s),26/255,.4,1),a.addRGBPoint(n+(t-n)*(i+3*s),26/255,.6,1),a.addRGBPoint(n+(t-n)*(i+4*s),26/255,.8,1),a.addRGBPoint(n+(t-n)*(i+5*s),26/255,1,1),a.addRGBPoint(n+(t-n)*(i+6*s),.2,1,.8),a.addRGBPoint(n+(t-n)*(i+7*s),.4,1,.6),a.addRGBPoint(n+(t-n)*(i+8*s),.6,1,.4),a.addRGBPoint(n+(t-n)*(i+9*s),.8,1,.2),a.addRGBPoint(n+(t-n)*(i+10*s),1,1,0),a.addRGBPoint(n+(t-n)*(i+11*s),1,.8,0),a.addRGBPoint(n+(t-n)*(i+12*s),1,.6,0),a.addRGBPoint(n+(t-n)*(i+13*s),1,.4,0),a.addRGBPoint(n+(t-n)*(i+14*s),1,.2,0),a.addRGBPoint(n+(t-n)*(i+15*s),1,0,0);break;default:a.addRGBPoint(n,0,0,1),a.addRGBPoint(n+(t-n)*i,0,0,1),a.addRGBPoint(n+(t-n)*(i+s),0,.2,1),a.addRGBPoint(n+(t-n)*(i+2*s),0,.4,1),a.addRGBPoint(n+(t-n)*(i+3*s),0,.6,1),a.addRGBPoint(n+(t-n)*(i+4*s),0,.8,1),a.addRGBPoint(n+(t-n)*(i+5*s),0,1,1),a.addRGBPoint(n+(t-n)*(i+6*s),.2,1,.8),a.addRGBPoint(n+(t-n)*(i+7*s),.4,1,.6),a.addRGBPoint(n+(t-n)*(i+8*s),.6,1,.4),a.addRGBPoint(n+(t-n)*(i+9*s),.8,1,.2),a.addRGBPoint(n+(t-n)*(i+10*s),1,1,0),a.addRGBPoint(n+(t-n)*(i+11*s),1,.8,0),a.addRGBPoint(n+(t-n)*(i+12*s),1,.6,0),a.addRGBPoint(n+(t-n)*(i+13*s),1,.4,0),a.addRGBPoint(n+(t-n)*(i+14*s),1,.2,0),a.addRGBPoint(n+(t-n)*(i+15*s),1,0,0)}i+15*s<1&&a.addRGBPoint(t,1,0,0),e.colorTransferFunction=a},Ee.prototype.setGradientOpacityValue=function(e){var n=e.minValue,t=e.maxValue,i=this.gradientMinOpacity,o=this.gradientMaxOpacity;if(i>o){var r=i;i=o,o=r}e.gradientOpacityMinValue=.1*Math.abs(t-n)*i,e.gradientOpacityMaxValue=.1*Math.abs(t-n)*o};var xe={initDrag:function(e,n){e.directive("drag",{beforeMount:function(e,n){var t,i,o,r,a,s,l=!1,u=e;u.addEventListener("touchstart",(function(e){if(l=!0,e.changedTouches[0]){var n=e.changedTouches[0],t=n.clientX,i=n.clientY;o=t-e.changedTouches[0].target.x,r=i-e.changedTouches[0].target.y,a=document.body.clientWidth,s=document.body.clientHeight}}),{passive:!1}),u.addEventListener("touchmove",A((function(n){n.preventDefault(),t=n.changedTouches[0].clientX-o,i=n.changedTouches[0].clientY-r,t<0&&i<0?(e.style.left="0px",e.style.top="0px"):t<0&&i+e.clientHeight<s?(e.style.left="0px",e.style.top=i+"px"):t<0&&i+e.clientHeight>=s?(e.style.left="0px",e.style.top=s-e.clientHeight+"px"):t+e.clientWidth>a&&i<0?(e.style.left=a-e.clientWidth+"px",e.style.top="0px"):t+e.clientWidth<a&&i+e.clientHeight>=s?(e.style.left=t+"px",e.style.top=s-e.clientHeight+"px"):t+e.clientWidth<a&&i<0?(e.style.left=t+"px",e.style.top="0px"):t+e.clientWidth>a&&i+e.clientHeight<s?(e.style.left=a-e.clientWidth+"px",e.style.top=i+"px"):t+e.clientWidth>a&&i+e.clientHeight>=s?(e.style.left=a-e.clientWidth+"px",e.style.top=s-e.clientHeight+"px"):(e.style.left=t+"px",e.style.top=i+"px")}),5),{passive:!1}),u.addEventListener("touchend",(function(e){l=!1,document.ontouchmove=null,document.ontouchmove=null,e.changedTouches[0].clientX,e.changedTouches[0].clientY}),{passive:!1}),u.onmousedown=function(n){if(a=document.body.clientWidth,s=document.body.clientHeight,!l){l=!0;var o=n.clientX,r=n.clientY,u=o-e.offsetLeft,c=r-e.offsetTop;document.onmousemove=A((function(n){t=n.clientX-u,i=n.clientY-c,t<0&&i<0?(e.style.left="0px",e.style.top="0px"):t<0&&i+e.clientHeight<s?(e.style.left="0px",e.style.top=i+"px"):t<0&&i+e.clientHeight>=s?(e.style.left="0px",e.style.top=s-e.clientHeight+"px"):t+e.clientWidth>a&&i<0?(e.style.left=a-e.clientWidth+"px",e.style.top="0px"):t+e.clientWidth<a&&i+e.clientHeight>=s?(e.style.left=t+"px",e.style.top=s-e.clientHeight+"px"):t+e.clientWidth<a&&i<0?(e.style.left=t+"px",e.style.top="0px"):t+e.clientWidth>a&&i+e.clientHeight<s?(e.style.left=a-e.clientWidth+"px",e.style.top=i+"px"):t+e.clientWidth>a&&i+e.clientHeight>=s?(e.style.left=a-e.clientWidth+"px",e.style.top=s-e.clientHeight+"px"):(e.style.left=t+"px",e.style.top=i+"px")}),5),document.onmouseup=function(e){document.onmousedown=null,document.onmousemove=null,l=!1}}}}}),e.directive("stopdrag",{beforeMount:function(e,n){e.onmousedown=function(e){"el-input__inner"!=e.target.className&&e.stopPropagation()}}})},tool:C,layerManagement:X,camera:Z,initViewer:function(e,t){var i;if(window.viewer&&(window.viewer=null),window.isPCBroswer=SuperMap3D.FeatureDetection.isPCBroswer()){i=new SuperMap3D.Viewer("SuperMap3DContainer",{timeline:!0,baseLayerPicker:!1,imageryProvider:!1,navigation:!1,animation:!1,infoBox:!1,contextOptions:{msaaLevel:8,requestWebgl2:!0},shadows:!1,pcss:!0,shadowQuality:0,creditContainer:document.createElement("div")}),document.getElementsByClassName("supermap3d-viewer-timelineContainer")[0].style.visibility="hidden"}else{var o=(i=new SuperMap3D.Viewer("SuperMap3DContainer",{selectionIndicator:!1,infoBox:!1,skyBox:!1,navigation:!1,contextOptions:{requestWebgl2:!0}})).scene;SuperMap3D.defined(o.sun)&&(o.globe.enableLighting=!1),SuperMap3D.defined(o.moon)&&(o.moon.show=!1),document.documentElement.style.height=window.innerHeight+"px",document.addEventListener("touchmove",(function(e){e.preventDefault()}),!1)}i.scene.debugShowFramesPerSecond=!0,i.scene.globe.baseColor=SuperMap3D.Color.BLACK,window.viewer=i,window.scene=i.scene,scene.moon.show=!1,i.eventManager=new ie(i);var r=i.SuperMap3DWidget;G(!0),i.geocoder&&(i.geocoder.viewModel.geoKey="fvV2osxwuZWlY0wJb8FEb2i5"),window.tooltip||(window.tooltip=oe(i._element));try{e&&e.openingAnimation&&i.camera.flyTo({destination:new SuperMap3D.Cartesian3(6788287.844465209,-41980756.10214644,29619220.04004376),duration:0,complete:function(){i.camera.flyTo({destination:new SuperMap3D.Cartesian3.fromDegrees(110.60396458865515,34.54408834959379,30644793.325518917),duration:5})}}),e&&e.afterInitviewer&&e.afterInitviewer(),e&&e.sceneUrl&&U(e.sceneUrl,{},(function(e){})),e&&e.s3mScps&&z(e.s3mScps)}catch(e){if(r._showRenderLoopErrors){var a=ue.showRenderLoopErrors;r.showErrorPanel(a,void 0,e)}}n((function(){i.destroy(),window.viewer=void 0,window.scene=void 0}))},terrainOperation:function(n){var o=e({digDepth:500,isEdit:!1,isEditZ:!1,lineVisible:!0,digPositions:[],modifyPositions:[],operationType:"dig",terrainVisible:"terrainVisible"});if(n)for(var r in n)o.hasOwnProperty(r)?o[r]=n[r]:C.Message.errorMsg(ue.AttributeError+r);var a=[],s=[],l="dig";function u(e){e&&(a=e),viewer.scene.globe.removeAllExcavationRegion(),viewer.scene.globe.addExcavationRegion({name:"dig_terrain",position:a,height:o.digDepth,transparent:!1})}function c(e){e&&(s=e),viewer.scene.globe.removeAllModifyRegion(),viewer.scene.globe.addModifyRegion({name:"ggg",position:s})}return n&&n.digPositions&&u(n.digPositions),t((function(){return o.digDepth}),(function(e){0!=a.length&&u()})),t((function(){return o.isEdit}),(function(e){e&&window.handlerPolygon?"dig"===l?ye(a,o.isEditZ,u):ye(s,o.isEditZ,c):(ge(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),t((function(){return o.isEditZ}),(function(e){window.editHandler&&(window.editHandler.isEditZ=e)})),t((function(){return o.terrainVisible}),(function(e){switch(e){case"terrainVisible":viewer.terrainProvider._visible=!0;break;case"terrainUnvisible":viewer.terrainProvider._visible=!1}})),d(d({},i(o)),{},{digTerrain:function(e){o.isEdit=!1,e.preventDefault(),l="dig",window.handlerPolygon||ce("Polygon"),pe("Polygon",o.lineVisible).then((function(e){a=e.positions;var n=window.handlerPolygon;u(e.positions),n.polygon.show=!1,n.polyline.show=!1,n.deactivate(),o.isEdit&&ye(a,o.isEditZ,u)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||C.Message.errorMsg(ue.NoPickPositionSupported)},clearDig:function(e){e.preventDefault(),a=[],o.isEdit=!1,window.handlerPolygon&&(viewer.scene.globe.removeAllExcavationRegion(),de("Polygon"),ge())},modifyTerrain:function(e){e.preventDefault(),l="modify",window.handlerPolygon||ce("Polygon"),pe("Polygon",o.lineVisible).then((function(e){s=e.positions;var n=window.handlerPolygon;c(e.positions),n.polygon.show=!1,n.polyline.show=!1,o.isEdit&&ye(s,o.isEditZ,c)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||alert("不支持深度纹理,无法绘制多边形，地形修改功能无法使用！")},clearModify:function(e){e.preventDefault(),window.handlerPolygon&&(viewer.scene.globe.removeAllModifyRegion(),de("Polygon"),ge())},digPosition:a,modifyPosition:s})},terrainSlope:function(o){var r=e({analysisArea:"ARM_REGION",displayMode:"FACE_AND_ARROW",wideMaxR:90,wideMinR:0,slopeInterval:[0,90],trans:.8,isEdit:!1,slopePositions:[],lineVisible:!0});if(o)for(var a in o)r.hasOwnProperty(a)?r[a]=o[a]:C.Message.errorMsg(ue.AttributeError+a);var s=!0,l=new SuperMap3D.SlopeSetting,u=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode[r.analysisArea],c=SuperMap3D.SlopeSettingEnum.DisplayMode[r.displayMode],p=new SuperMap3D.ColorTable,f=[];function v(e){e&&(f=e),l.CoverageArea=e,viewer.scene.globe.SlopeSetting={slopeSetting:l,analysisMode:u}}return p.insert(80,new SuperMap3D.Color(1,0,0)),p.insert(50,new SuperMap3D.Color(221/255,224/255,7/255)),p.insert(30,new SuperMap3D.Color(20/255,187/255,18/255)),p.insert(20,new SuperMap3D.Color(0,161/255,1)),p.insert(0,new SuperMap3D.Color(9/255,9/255,1)),o&&o.slopePositions&&v(o.slopePositions),H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element))),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)))})),t((function(){return r.analysisArea}),(function(e){switch(e){case"ARM_REGION":u=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION;break;case"ARM_ALL":u=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_ALL;break;case"ARM_NONE":u=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_NONE}0!=f.length&&v(f)})),t((function(){return r.wideMaxR}),(function(e){l.MaxVisibleValue=parseFloat(e),0!=f.length&&(viewer.scene.globe.SlopeSetting={slopeSetting:l,analysisMode:u})})),t((function(){return r.wideMinR}),(function(e){l.MinVisibleValue=parseFloat(e),0!=f.length&&(viewer.scene.globe.SlopeSetting={slopeSetting:l,analysisMode:u})})),t((function(){return r.slopeInterval}),(function(e){r.wideMinR=e[0],r.wideMaxR=e[1]})),t((function(){return r.displayMode}),(function(e){switch(e){case"FACE":c=SuperMap3D.SlopeSettingEnum.DisplayMode.FACE;break;case"ARROW":c=SuperMap3D.SlopeSettingEnum.DisplayMode.ARROW;break;case"FACE_AND_ARROW":c=SuperMap3D.SlopeSettingEnum.DisplayMode.FACE_AND_ARROW}l.DisplayMode=c,0!=f.length&&v(f)})),t((function(){return r.trans}),(function(e){l.Opacity=parseFloat(e),0!=f.length&&(viewer.scene.globe.SlopeSetting={slopeSetting:l,analysisMode:u})})),t((function(){return r.isEdit}),(function(e){e&&window.handlerPolygon?ye(f,!1,v):(ge(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),n((function(){l.destroy(),p.destroy(),l=void 0,p=void 0})),d(d({},i(r)),{},{startSlope:function(e){e.preventDefault(),tooltip.setVisible(!1),s&&(window.tooltip.showAt(" <p>点击鼠标左键绘制分析区域</p><p>点击鼠标右键结束绘制</p><p>坡度坡向分析需要带法线地形</p>","250px"),s=!1),l.DisplayMode=c,l.MaxVisibleValue=r.wideMaxR,l.MinVisibleValue=r.wideMinR,l.ColorTable=p,l.Opacity=r.trans,window.handlerPolygon||ce("Polygon"),pe("Polygon",r.lineVisible).then((function(e){v(f=e.positions);var n=window.handlerPolygon;n.polygon.show=!1,n.polyline.show=!1,n.deactivate(),r.isEdit&&ye(f,!1,v)}),(function(e){console.log(e)})),handlerPolygon.activate(),scene.pickPositionSupported||C.Message.errorMsg(ue.NoPickPositionSupported)},clearSlope:function(e){e.preventDefault(),f=[],window.handlerPolygon&&(viewer.scene.globe.SlopeSetting={analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_NONE},tooltip.setVisible(!1),de("Polygon"),ge())},slopePosition:f})},terrainIsoline:function(o){var r=e({fillMaxHeight:9e3,fillMinHeight:0,fillHeight:[0,9e3],equivalentIsoline:100,fillOptionsSelected:"Line",lineColor:"#FF8040",isEdit:!1,isolinePositions:[],lineVisible:!0});if(o)for(var a in o)r.hasOwnProperty(a)?r[a]=o[a]:C.Message.errorMsg(ue.AttributeError+a);var s=new SuperMap3D.HypsometricSetting,l=SuperMap3D.HypsometricSettingEnum.DisplayMode.LINE,u=new SuperMap3D.ColorTable;!function(e){e.insert(5597.06640625,new SuperMap3D.Color(0,0,1)),e.insert(5406.387386067709,new SuperMap3D.Color(0,.2,1)),e.insert(5215.708365885417,new SuperMap3D.Color(0,.4,1)),e.insert(5025.029345703126,new SuperMap3D.Color(0,.6,1)),e.insert(4834.350325520834,new SuperMap3D.Color(0,.8,1)),e.insert(4643.671305338543,new SuperMap3D.Color(0,1,1)),e.insert(4452.992285156252,new SuperMap3D.Color(.2,1,.8)),e.insert(4262.313264973961,new SuperMap3D.Color(.4,1,.6)),e.insert(4071.6342447916695,new SuperMap3D.Color(.6,1,.4)),e.insert(3880.955224609378,new SuperMap3D.Color(.8,1,.2)),e.insert(3690.2762044270867,new SuperMap3D.Color(1,1,0)),e.insert(3499.5971842447952,new SuperMap3D.Color(1,.8,0)),e.insert(3308.918164062504,new SuperMap3D.Color(1,.6,0)),e.insert(3118.239143880213,new SuperMap3D.Color(1,.4,0)),e.insert(2927.5601236979214,new SuperMap3D.Color(1,.2,0)),e.insert(2736.88110351563,new SuperMap3D.Color(1,0,0))}(u);var c=[];function p(e){e&&(c=e),0!=c.length&&(e&&(s.CoverageArea=e),viewer.scene.globe.HypsometricSetting={hypsometricSetting:s,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})}return o&&o.isolinePositions&&p(o.isolinePositions),t((function(){return r.fillMaxHeight}),(function(e){s.MaxVisibleValue=parseFloat(e),0!=c.length&&p()})),t((function(){return r.fillMinHeight}),(function(e){s.MinVisibleValue=parseFloat(e),0!=c.length&&p()})),t((function(){return r.fillHeight}),(function(e){r.fillMinHeight=e[0],r.fillMaxHeight=e[1]})),t((function(){return r.equivalentIsoline}),(function(e){s.LineInterval=parseFloat(e),0!=c.length&&p()})),t((function(){return r.lineColor}),(function(e){if(e){if(s._lineColor=SuperMap3D.Color.fromCssColorString(e),0==c.length)return;p()}else console.warn("err: color is  null")})),t((function(){return r.fillOptionsSelected}),(function(e){switch(e){case"None":l=void 0;break;case"Line":l=SuperMap3D.HypsometricSettingEnum.DisplayMode.LINE,s.Opacity=1;break;case"Region":l=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE,s.Opacity=.5;break;case"Line_Region":l=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE_AND_LINE,s.Opacity=.5}s.DisplayMode=l,0!=c.length&&p(c)})),t((function(){return r.isEdit}),(function(e){e&&window.handlerPolygon?ye(c,!1,p):(ge(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),n((function(){s.destroy(),u.destroy(),s=void 0,u=void 0})),d(d({},i(r)),{},{isoLineAnalysis:function(e){e.preventDefault(),s.DisplayMode=l,s._lineColor=SuperMap3D.Color.fromCssColorString(r.lineColor),s.LineInterval=parseFloat(r.equivalentIsoline),s.MaxVisibleValue=parseFloat(r.fillMaxHeight),s.MinVisibleValue=parseFloat(r.fillMinHeight),s.ColorTableMinKey=2736.88110351563,s.ColorTableMaxKey=5597.06640625,s.ColorTable=u,window.handlerPolygon||ce("Polygon"),pe("Polygon",r.lineVisible).then((function(e){c=e.positions;var n=window.handlerPolygon;p(c),n.polygon.show=!1,n.polyline.show=!1,n.deactivate(),r.isEdit&&ye(c,!1,p)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),scene.pickPositionSupported||C.Message.errorMsg(ue.NoPickPositionSupported)},clearIsoLine:function(e){e.preventDefault(),c=[],window.handlerPolygon&&(viewer.scene.globe.HypsometricSetting=void 0,s&&(s.MaxVisibleValue=-1e3),s&&(s.MinVisibleValue=-1e3),de("Polygon"),ge())},isolinePosition:c})},terrainFlood:function(o){var r=e({maxHeight:9e3,minHeight:1e3,floodHeight:[1e3,9e3],currentHeight:1e3,floodTrans:.8,cheackedBand:"band1",colorBandShow:!1,floodSpeed:800,floodPositions:[],lineVisible:!0});if(o)for(var a in o)r.hasOwnProperty(a)?r[a]=o[a]:C.Message.errorMsg(ue.AttributeError+a);var s,l=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE,u=new SuperMap3D.HypsometricSetting,c=new SuperMap3D.ColorTable;c.insert(9e3,new SuperMap3D.Color(0,39/255,148/255)),c.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));var p=[];function f(e){e&&(p=e);var n=parseFloat(r.minHeight);u.CoverageArea=e,s=setInterval("flood()",100),window.flood=function(){if(n<=r.maxHeight&&(r.currentHeight=parseInt(n)),n>r.maxHeight)return r.currentHeight=r.maxHeight,void clearInterval(s);u.MaxVisibleValue=n;try{viewer.scene.globe.HypsometricSetting={hypsometricSetting:u,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION}}catch(e){console.log(e),clearInterval(s)}n+=parseFloat(r.floodSpeed)/10}}return t((function(){return r.floodTrans}),(function(e){u.Opacity=parseFloat(e),0!=p.length&&(viewer.scene.globe.HypsometricSetting={hypsometricSetting:u,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})})),t((function(){return r.floodHeight}),(function(e){r.minHeight=e[0],r.maxHeight=e[1]})),t((function(){return r.minHeight}),(function(e){u.MinVisibleValue=parseInt(e),0!=p.length?viewer.scene.globe.HypsometricSetting={hypsometricSetting:u,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION}:r.currentHeight=parseInt(e)})),t((function(){return r.maxHeight}),(function(e){u.MaxVisibleValue=parseInt(e),0!=p.length&&(viewer.scene.globe.HypsometricSetting={hypsometricSetting:u,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})})),t((function(){return r.cheackedBand}),(function(e){c=function(e){var n=new SuperMap3D.ColorTable;switch(e){case"band1":n.insert(9e3,new SuperMap3D.Color(0,39/255,148/255)),n.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));break;case"band2":n.insert(9e3,new SuperMap3D.Color(162/255,251/255,194/255)),n.insert(0,new SuperMap3D.Color(1,103/255,103/255));break;case"band3":n.insert(9e3,new SuperMap3D.Color(230/255,198/255,1)),n.insert(0,new SuperMap3D.Color(157/255,0,1));break;case"band4":n.insert(9e3,new SuperMap3D.Color(210/255,15/255,15/255)),n.insert(6e3,new SuperMap3D.Color(221/255,224/255,7/255)),n.insert(5e3,new SuperMap3D.Color(20/255,187/255,18/255)),n.insert(4e3,new SuperMap3D.Color(0,161/255,1)),n.insert(0,new SuperMap3D.Color(9/255,9/255,212/255));break;case"band5":n.insert(9e3,new SuperMap3D.Color(186/255,1,229/255)),n.insert(0,new SuperMap3D.Color(26/255,185/255,156/255));break;default:n.insert(9e3,new SuperMap3D.Color(0,39/255,148/255)),n.insert(0,new SuperMap3D.Color(149/255,232/255,249/255))}return n}(e),u.ColorTable=c,0!=p.length&&s&&(viewer.scene.globe.HypsometricSetting={hypsometricSetting:u,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})})),n((function(){u.destroy(),c.destroy(),u=void 0,c=void 0})),d(d({},i(r)),{},{floodBegin:function(e){e.preventDefault(),u.DisplayMode=l,u._lineColor=new SuperMap3D.Color(1,0,0,1),u.MinVisibleValue=r.minHeight,u.MaxVisibleValue=0,u.ColorTableMinKey=1,u.ColorTableMaxKey=9e3,u.ColorTable=c,u.Opacity=r.floodTrans,u.LineInterval=200,window.handlerPolygon||ve("Polygon"),o&&o.floodPositions?f(o.floodPositions):(we("Polygon",r.lineVisible).then((function(e){var n=window.handlerPolygon;f(e.positions),n.polygon.show=!1,n.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||C.Message.errorMsg(ue.NoPickPositionSupported))},floodClear:function(e){e.preventDefault(),p=[],window.handlerPolygon&&(viewer.scene.globe.HypsometricSetting=void 0,clearInterval(s),me("Polygon"))},changeColor:function(e){r.colorBandShow=!1,r.cheackedBand=e},floodPosition:p})},clipBoxEditor:function(o){var r=e({clipModel:"ClipInside"});if(o)for(var a in o)r.hasOwnProperty(a)?r[a]=o[a]:C.Message.errorMsg(ue.AttributeError+a);var s,l,u,c,p="clip_behind_all_plane";function f(){if(void 0!==u){var e=u.box.dimensions.getValue(),n=u.position.getValue(0),t=0;if(void 0!==u.orientation){var i=SuperMap3D.Matrix3.fromQuaternion(u.orientation._value,new SuperMap3D.Matrix3),o=SuperMap3D.Matrix4.fromRotationTranslation(i,SuperMap3D.Cartesian3.ZERO,new SuperMap3D.Matrix4),r=SuperMap3D.Matrix4.inverse(SuperMap3D.Transforms.eastNorthUpToFixedFrame(n),new SuperMap3D.Matrix4),a=SuperMap3D.Matrix4.multiply(r,o,new SuperMap3D.Matrix4),s=SuperMap3D.Matrix4.getMatrix3(a,new SuperMap3D.Matrix3);t=SuperMap3D.HeadingPitchRoll.fromQuaternion(SuperMap3D.Quaternion.fromRotationMatrix(s)).heading}v({dimensions:e,position:n,clipMode:p,heading:t})}}function v(e){for(var n=0,t=s.length;n<t;n++)s[n].setCustomClipBox(e)}function w(){if(l&&(l.deactivate(),tooltip.setVisible(!1)),u){var e,n=S(s);try{for(n.s();!(e=n.n()).done;){e.value.clearCustomClipBox()}}catch(e){n.e(e)}finally{n.f()}u=void 0,c.deactivate(),viewer.entities.removeAll(),l.clear()}}return H.isViewer&&(s=viewer.scene.layers.layerQueue,l=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box),window.tooltip||(window.tooltip=oe(viewer._element))),t((function(){return H.isViewer}),(function(e){e&&(s=viewer.scene.layers.layerQueue,l=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box),window.tooltip||(window.tooltip=oe(viewer._element)))})),t((function(){return r.clipModel}),(function(e){switch(e){case"ClipInside":p="clip_behind_all_plane";break;case"ClipOutside":p="clip_behind_any_plane"}u&&f()})),n((function(){c&&c.destroy(),c=void 0,s=void 0,l=void 0,u=void 0})),d(d({},i(r)),{},{BoxClipByEitor:function(){w(),c||(function(){for(var e=0,n=s.length;e<n;e++)s[e].selectEnabled=!1,s[e].clipLineColor=new SuperMap3D.Color(1,1,1,0)}(),l.movingEvt.addEventListener((function(e){l.isDrawing?tooltip.showAt(" <p>点击鼠标左键结束绘制box底面</p><p>移动鼠标绘制box高度</p><p>点击鼠标右键结束绘制</p>","230px"):tooltip.showAt(" <p>点击鼠标左键开始绘制box底面</p>","230px")})),l.drawEvt.addEventListener((function(e){var n={dimensions:(u=e.object).box.dimensions.getValue(),position:u.position.getValue(0),clipMode:p,heading:0};(c=new SuperMap3D.BoxEditor(viewer,u)).editEvt.addEventListener((function(e){u.box.dimensions=e.dimensions,u.position=e.position,u.orientation=e.orientation,f()})),c.activate(),v(n),tooltip.setVisible(!1),l.clear(),l.deactivate()}))),l.activate()},clearBoxClipByEitor:w})},clipPolygon:function(o){var r=e({clipModelPolygon:"ClipInside",isEdit:!1,isEditZ:!1,lineVisible:!0});if(o)for(var a in o)r.hasOwnProperty(a)?r[a]=o[a]:C.Message&&C.Message.errorMsg(ue.AttributeError+a);var s,l=SuperMap3D.ModifyRegionMode.CLIP_INSIDE,u=!0,c=[];function p(e){c=e;var n,t=S(s);try{for(t.s();!(n=t.n()).done;){n.value.setModifyRegions([e],l)}}catch(e){t.e(e)}finally{t.f()}}return o&&o.polygonPositions&&p(o.slopePositions),H.isViewer&&(s=viewer.scene.layers.layerQueue,window.tooltip||(window.tooltip=oe(viewer._element))),t((function(){return H.isViewer}),(function(e){e&&(s=viewer.scene.layers.layerQueue,window.tooltip||(window.tooltip=oe(viewer._element)))})),t((function(){return r.clipModelPolygon}),(function(e){switch(e){case"ClipInside":l=SuperMap3D.ModifyRegionMode.CLIP_INSIDE;break;case"ClipOutside":l=SuperMap3D.ModifyRegionMode.CLIP_OUTSIDE}c.length>0&&p(c)})),t((function(){return r.isEdit}),(function(e){e&&window.handlerPolygon?ye(c,r.isEditZ,p):(ge(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),t((function(){return r.isEditZ}),(function(e){window.editHandler&&(window.editHandler.isEditZ=e)})),n((function(){s=void 0})),d(d({},i(r)),{},{clipPolygon:function(e){e.preventDefault(),tooltip.setVisible(!1),u&&(tooltip.showAt(" <p>点击鼠标左键开始绘制多边形</p><p>点击鼠标右键结束绘制</p>","230px"),u=!1),s||(s=viewer.scene.layers.layerQueue);var n,t=S(s);try{for(t.s();!(n=t.n()).done;){var i=n.value;i.selectEnabled=!1,i.clipLineColor=new SuperMap3D.Color(1,1,1,0)}}catch(e){t.e(e)}finally{t.f()}window.handlerPolygon||ce("Polygon"),pe("Polygon",r.lineVisible).then((function(e){p(e.positions);var n=window.handlerPolygon;n.polygon.show=!1,n.polyline.show=!1,n.deactivate(),r.isEdit&&ye(c,r.isEditZ,p)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),scene.pickPositionSupported||C.Message&&C.Message.errorMsg(ue.NoPickPositionSupported)},clearClipPolygon:function(e){if(e.preventDefault(),c=[],tooltip.setVisible(!1),window.handlerPolygon){de("Polygon");var n,t=S(s);try{for(t.s();!(n=t.n()).done;){n.value.clearModifyRegions()}}catch(e){t.e(e)}finally{t.f()}}},polygonPosition:c})},clipPlane:function(o){var r,a=e({isEdit:!0,isEditZ:!1,lineVisible:!0,PlanePositions:[]});if(o)for(var s in o)a.hasOwnProperty(s)?a[s]=o[s]:C.Message.errorMsg(ue.AttributeError+s);var l=[];function u(e){l=e;var n,t=S(r);try{for(t.s();!(n=t.n()).done;){n.value.setCustomClipPlane(e[0],e[1],e[2])}}catch(e){t.e(e)}finally{t.f()}}return o&&o.PlanePositions&&clipPolygonUpdate(o.PlanePositions),H.isViewer&&(r=viewer.scene.layers.layerQueue,window.tooltip||(window.tooltip=oe(viewer._element))),t((function(){return H.isViewer}),(function(e){e&&(r=viewer.scene.layers.layerQueue,window.tooltip||(window.tooltip=oe(viewer._element)))})),t((function(){return a.isEdit}),(function(e){e||window.handlerPolygon?ye(l,a.isEditZ,u):(ge(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),t((function(){return a.isEditZ}),(function(e){window.editHandler&&(window.editHandler.isEditZ=e)})),n((function(){r=void 0})),d(d({},i(a)),{},{clipPlaneStart:function(e){console.log(1),e.preventDefault(),tooltip.setVisible(!1),tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>绘制三点确定一个平面</p><p>点击鼠标右键结束绘制</p>","230px"),r||(r=viewer.scene.layers.layerQueue);var n,t=S(r);try{for(t.s();!(n=t.n()).done;){var i=n.value;i.selectEnabled=!1,i.clipLineColor=new SuperMap3D.Color(1,1,1,0)}}catch(e){t.e(e)}finally{t.f()}window.handlerPolygon||ce("Polygon"),pe("Polygon",a.lineVisible).then((function(e){u(e.result.object.positions),window.handlerPolygon.deactivate(),tooltip.setVisible(!1),ye(l,a.isEditZ,u)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),scene.pickPositionSupported||alert("不支持深度纹理,无法绘制多边形，裁剪功能无法使用！")},clearClipPlane:function(e){if(e.preventDefault(),tooltip.setVisible(!1),l=[],window.handlerPolygon){de("Polygon");var n,t=S(r);try{for(t.s();!(n=t.n()).done;){n.value.clearCustomClipBox()}}catch(e){t.e(e)}finally{t.f()}}},planePosition:l})},clipCross:function(o){var r,a,s,l,u,c,p,f=e({clipWidth:5,clipHeight:5,heading:0,pitch:0,roll:0,extrude:1});if(o)for(var v in o)f.hasOwnProperty(v)?f[v]=o[v]:C.Message.errorMsg(ue.AttributeError+v);function w(){var e,n=S(r);try{for(n.s();!(e=n.n()).done;){e.value.setCustomClipCross({position:p,dimensions:c,heading:f.heading,pitch:f.pitch,roll:f.roll,extrudeDistance:Number(f.extrude)})}}catch(e){n.e(e)}finally{n.f()}}function m(){l&&viewer.entities.removeById("cross-clip-identify-box");var e,n=S(r);try{for(n.s();!(e=n.n()).done;){e.value.clearCustomClipBox()}}catch(e){n.e(e)}finally{n.f()}s=!1,l=void 0,a.removeInputAction(SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),a.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)}return H.isViewer&&(a=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas),r=viewer.scene.layers.layerQueue),t((function(){return H.isViewer}),(function(e){e&&(a=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas),r=viewer.scene.layers.layerQueue)})),t((function(){return f.clipWidth}),(function(e){var n=Number(e);n<=0||!l||(l.box.dimensions=new SuperMap3D.Cartesian3(f.clipWidth,f.clipHeight,.1),c=new SuperMap3D.Cartesian3(n,f.clipHeight,f.extrude),w())})),t((function(){return f.clipHeight}),(function(e){var n=Number(e);n<=0||!l||(l.box.dimensions=new SuperMap3D.Cartesian3(f.clipWidth,f.clipHeight,.1),c=new SuperMap3D.Cartesian3(f.clipWidth,n,f.extrude),w())})),t((function(){return f.pitch}),(function(e){if(""!==e&&l){var n=Number(e),t=new SuperMap3D.HeadingPitchRoll(SuperMap3D.Math.toRadians(f.heading),SuperMap3D.Math.toRadians(n),SuperMap3D.Math.toRadians(f.roll)),i=SuperMap3D.Transforms.headingPitchRollQuaternion(u,t);l.orientation=i,w()}})),t((function(){return f.roll}),(function(e){if(""!==e&&l){var n=Number(e),t=new SuperMap3D.HeadingPitchRoll(SuperMap3D.Math.toRadians(f.heading),SuperMap3D.Math.toRadians(f.pitch),SuperMap3D.Math.toRadians(n)),i=SuperMap3D.Transforms.headingPitchRollQuaternion(u,t);l.orientation=i,w()}})),t((function(){return f.heading}),(function(e){if(""!==e&&l){var n=Number(e),t=new SuperMap3D.HeadingPitchRoll(SuperMap3D.Math.toRadians(n),SuperMap3D.Math.toRadians(f.pitch),SuperMap3D.Math.toRadians(f.roll)),i=SuperMap3D.Transforms.headingPitchRollQuaternion(u,t);l.orientation=i,w()}})),t((function(){return f.extrude}),(function(e){Number(e)<=0||!l||w()})),n((function(){a.destroy(),r=void 0,l=void 0,a=void 0,c=void 0})),d(d({},i(f)),{},{startCross:function(e){e.preventDefault(),viewer&&(l&&m(),function(){var e,n,t=S(r);try{for(t.s();!(e=t.n()).done;){e.value.selectEnabled=!1}}catch(e){t.e(e)}finally{t.f()}u=SuperMap3D.Cartesian3.fromDegrees(0,0,0),c=new SuperMap3D.Cartesian3(f.clipWidth,f.clipHeight,.1),l=viewer.entities.add({id:"cross-clip-identify-box",position:u,show:!1,box:{dimensions:c,fill:!1,outline:!0,outlineColor:SuperMap3D.Color.AQUA,outlineWidth:5}}),a.setInputAction((function(e){if(s){if(!(u=scene.pickPosition(e.endPosition)))return;l.position=u,n||(n=new SuperMap3D.HeadingPitchRoll(SuperMap3D.Math.toRadians(f.heading),SuperMap3D.Math.toRadians(f.pitch),SuperMap3D.Math.toRadians(f.roll)));var t=SuperMap3D.Transforms.headingPitchRollQuaternion(u,n);l.orientation=t}}),SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction((function(e){if(s){if(!(p=scene.pickPosition(e.position)))return;w(),s=!1,l.show=!1}a.removeInputAction(SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),a.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),n=null}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)}(),s=!0,l.show=!0)},clearCross:m})},clipBox:clipBox,measure:function(o){var r,a,s,l,u,c,p,f=e({measureMode:"Space",clampMode:SuperMap3D.ClampMode.Space,Ellipsoid:null,contourColor:"#ff7d00",isShowDVH:!1,isShowLine:!0,pickPointEnabled:!0});(u=new SuperMap3D.HypsometricSetting).DisplayMode=SuperMap3D.HypsometricSettingEnum.DisplayMode.LINE;var v=new SuperMap3D.ColorTable;u._lineColor=SuperMap3D.Color.fromCssColorString(f.contourColor),u.ColorTable=v,u.Opacity=.6,u.MaxVisibleValue=-100,u.MinVisibleValue=-100;var w=function(){setInterval((function(){console.log("now-state.pickPointEnabled:",f.pickPointEnabled)}),2e3),r=viewer.scene.layers.layerQueue,viewer.scene.globe.HypsometricSetting={hypsometricSetting:u,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_ALL},H.changeLayers&&m(),a=new SuperMap3D.MeasureHandler(viewer,SuperMap3D.MeasureMode.Distance,f.clampMode),s=new SuperMap3D.MeasureHandler(viewer,SuperMap3D.MeasureMode.Area,f.clampMode),l=new SuperMap3D.MeasureHandler(viewer,SuperMap3D.MeasureMode.DVH),a.activeEvt.addEventListener((function(e){1==e?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.scene.pickPointEnabled=f.pickPointEnabled):(viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),viewer.scene.pickPointEnabled=!1)})),a.measureEvt.addEventListener((function(e){var n=Number(e.distance),t=f.measureMode;"CGCS2000"!=t&&"XIAN80"!=t&&"WGS84"!=t||(n=Number(function(e){for(var n=[],t=0;t<e.length;t++){var i=SuperMap3D.Cartographic.fromCartesian(e[t]),o=SuperMap3D.Math.toDegrees(i.longitude),r=SuperMap3D.Math.toDegrees(i.latitude);n.push(o,r)}var a=new SuperMap3D.PolylineGeometry({positions:SuperMap3D.Cartesian3.fromDegreesArray(n)});return scene.globe.computeSurfaceDistance(a,f.Ellipsoid)}(e.positions)));var i=n>1e3?(n/1e3).toFixed(2)+"km":n.toFixed(2)+"m";a.disLabel.text="距离:"+i})),s.activeEvt.addEventListener((function(e){1==e?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.scene.pickPointEnabled=f.pickPointEnabled):(viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),viewer.scene.pickPointEnabled=!1)})),s.measureEvt.addEventListener((function(e){var n=Number(e.area),t=f.measureMode;"CGCS2000"==t||"XIAN80"==t||"WGS84"==t?n=Number(function(e){for(var n=[],t=0;t<e.length;t++){var i=SuperMap3D.Cartographic.fromCartesian(e[t]),o=SuperMap3D.Math.toDegrees(i.longitude),r=SuperMap3D.Math.toDegrees(i.latitude);n.push(o,r)}var a=new SuperMap3D.PolygonGeometry.fromPositions({positions:SuperMap3D.Cartesian3.fromDegreesArray(n)});return scene.globe.computeSurfaceArea(a,f.Ellipsoid)}(e.positions)):"6"==t&&(n=Number(function(e){for(var n=0,t=0;t<e.length;t++){var i=SuperMap3D.Cartographic.fromCartesian(e[t]);n+=SuperMap3D.Math.toDegrees(i.longitude)}for(var o=Math.round((n/e.length+6)/6),r=6*o-3,a=new SuperMap3D.CustomProjection({name:"tmerc",centralMeridian:r,primeMeridian:0,standardParallel_1:0,standardParallel_2:0,eastFalse:5e5,northFalse:0,semimajorAxis:6378137,inverseFlattening:298.257222101}),s=[],l=0;l<e.length;l++){var u=SuperMap3D.Cartographic.fromCartesian(e[l]),c=a.project(u);s.push(c)}return s.push(s[0]),SuperMap3D.getPreciseArea(s,"China2000",r,o,1)}(e.positions)));var i=n>1e6?(n/1e6).toFixed(2)+"km²":n.toFixed(2)+"㎡";s.areaLabel.text="面积:"+i})),l.measureEvt.addEventListener((function(e){var n=e.distance>1e3?(e.distance/1e3).toFixed(2)+"km":e.distance+"m",t=e.verticalHeight>1e3?(e.verticalHeight/1e3).toFixed(2)+"km":e.verticalHeight+"m",i=e.horizontalDistance>1e3?(e.horizontalDistance/1e3).toFixed(2)+"km":e.horizontalDistance+"m";l.disLabel.text="空间距离:"+n,l.vLabel.text="垂直高度:"+t,l.hLabel.text="水平距离:"+i,c=Number(e.endHeight),f.isShowLine&&y(c)})),l.activeEvt.addEventListener((function(e){1==e?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.scene.pickPointEnabled=f.pickPointEnabled):(viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),viewer.scene.pickPointEnabled=!1)}))};function m(){for(var e=0;e<r.length;e++)r[e].hypsometricSetting={hypsometricSetting:u,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_ALL};p=!0}function y(e){if(viewer.scene.globe.HypsometricSetting.hypsometricSetting.MaxVisibleValue=e,viewer.scene.globe.HypsometricSetting.hypsometricSetting.MinVisibleValue=e,p)for(var n=0;n<r.length;n++)r[n].hypsometricSetting.hypsometricSetting?(r[n].hypsometricSetting.hypsometricSetting.MaxVisibleValue=e,r[n].hypsometricSetting.hypsometricSetting.MinVisibleValue=e):m()}function g(e){var n=scene.pickPosition(e.message.position);C.CartesiantoDegrees(n)[2]}function h(){y(-1e4),viewer.eventManager.removeEventListener("CLICK",g)}function S(){a&&a.deactivate(),s&&s.deactivate(),l&&l.deactivate(),f.isShowDVH=!1,f.Ellipsoid=null,c=-1e4}return H.isViewer&&w(),t((function(){return H.isViewer}),(function(e){e&&w()})),t((function(){return H.changeLayers}),(function(e){m()})),t((function(){return f.isShowLine}),(function(e){y(e?c:-1e4)})),t((function(){return f.pickPointEnabled}),(function(e){viewer.scene.pickPointEnabled=e})),t((function(){return f.measureMode}),(function(e){"Space"==e?(f.clampMode=SuperMap3D.ClampMode.Space,s.clampMode=SuperMap3D.ClampMode.Space,a.clampMode=SuperMap3D.ClampMode.Space):(f.clampMode=SuperMap3D.ClampMode.Ground,s.clampMode=SuperMap3D.ClampMode.Ground,a.clampMode=SuperMap3D.ClampMode.Ground,f.Ellipsoid="XIAN80"==e?SuperMap3D.Ellipsoid.XIAN80:"CGCS2000"==e?SuperMap3D.Ellipsoid.CGCS2000:"WGS84"==e?SuperMap3D.Ellipsoid.WGS84:null)})),n((function(){u.destroy(),r=void 0})),d(d({},i(f)),{},{distanceClk:function(){S(),a&&a.activate()},areaClk:function(){S(),s&&s.activate()},heightClk:function(){p||m(),h(),viewer.eventManager.addEventListener("CLICK",g,!0),S(),f.isShowDVH=!0,l&&l.activate()},clear:function(){S(),a&&a.clear(),s&&s.clear(),l&&l.clear(),h(),viewer.scene.pickPointEnabled=!1}})},skyLine:function(a){var s=e({skylineRadius:1e4,lineWidth:3,skylineColor:"rgb(200, 0, 0)",skyBodyColor:"rgba(44,149,197,0.6)",barrierColor:"rgba(255, 186, 1, 1)",skylineMode:0,highlightBarrier:!1,getSkyline2d:!0,skylineSpatialAnalysisUrl:null,observerInformation:null,ignoreGlobe:!0,isClear:!0});if(a)for(var l in a)s.hasOwnProperty(l)?s[l]=a[l]:C.Message.errorMsg(ue.AttributeError+l);var u,c,p,f,v=!0,w=o(null);function m(){window.echarts?(u||(u=window.echarts.init(w.value),window.onresize=function(){u.resize()}),u.setOption({title:{text:"二维天际线",textStyle:{fontSize:14}},grid:{left:30,right:0,top:30,bottom:8},tooltip:{},xAxis:{show:!1},yAxis:{show:!1},series:[{type:"bar",data:[]}]})):C.Message.warnMsg(ue.EchartsErr)}function y(){p.build(),D();var e=viewer.scene.camera.positionCartographic;h({longitude:SuperMap3D.Math.toDegrees(e.longitude),latitude:SuperMap3D.Math.toDegrees(e.latitude),height:e.height,pitch:SuperMap3D.Math.toDegrees(f.camera.pitch),direction:SuperMap3D.Math.toDegrees(f.camera.heading)}),s.isClear=!1}function g(){var e=viewer.camera.position,n=viewer.scene.globe.ellipsoid.cartesianToCartographic(e).height/200;viewer.camera.moveBackward(n)}function h(e){p.viewPosition=[e.longitude,e.latitude,e.height],p.pitch=e.pitch,p.direction=e.direction,p.radius=Number(s.skylineRadius),p.lineWidth=Number(s.lineWidth),p.color=SuperMap3D.Color.fromCssColorString(s.skylineColor),p.displayStyle=Number(s.skylineMode>1?0:s.skylineMode),setTimeout((function(){s.highlightBarrier&&S(SuperMap3D.Color.fromCssColorString(s.barrierColor));2==s.skylineMode&&(s.skylineSpatialAnalysisUrl?M():b(e)),function(e){if(s.observerInformation&&u){var n={tooltip:{trigger:"axis",formatter:function(e){var n=Number(e[0].axisValue),t=e[0].data;return["X: "+n.toFixed(6)+"<br/>","Y: "+t.toFixed(6)].join("")}},grid:{left:40,right:0,top:35,bottom:8,borderColor:"#333333"},color:"red",xAxis:[{type:"category",boundaryGap:!1,data:null==e?void 0:e.x,show:!1}],yAxis:{min:function(e){return(e.min-.05).toFixed(2)},show:!0,axisLine:{show:!0}},dataZoom:[{type:"inside",xAxisIndex:0,filterMode:"filter",start:0,end:100}],series:[{symbolSize:8,symbol:"circle",smooth:!0,type:"line",data:null==e?void 0:e.y,lineStyle:{width:2,shadowColor:"rgba(145, 146, 148,0.7)",shadowBlur:10,shadowOffsetY:8}}]};u.setOption(n)}}(p.getSkyline2D())}),300),s.observerInformation=e,1===p.displayStyle&&g()}function S(e){var n=p.getObjectIds();console.log(n);var t=viewer.scene.layers._layerQueue,i=function(i){t.forEach((function(t){t._id===Number(i)&&t.setObjsColor(n[i],e)}))};for(var o in n)i(o)}function M(){var e=p.getSkylineSectorParameter(),n={viewerPoint:e.viewPos,line3D:e.geoLine3D,height:0,lonlat:!0},t=s.skylineSpatialAnalysisUrl,i=JSON.stringify(n);axios.post(t,i).then((function(e){axios.get(e.data.newResourceLocation+".json").then((function(e){var n=e.data;if(null!==n.geometry){var t=new Uint8Array(n.geometry.model).buffer;c.add("SkyLineBody",{id:1,position:SuperMap3D.Cartesian3.fromDegrees(n.geometry.position.x,n.geometry.position.y,n.geometry.position.z),hpr:new SuperMap3D.HeadingPitchRoll(0,0,0),color:SuperMap3D.Color.fromCssColorString(s.skyBodyColor)},t,!1),n.geometry.model=[4,0,0,0].concat(n.geometry.model),n.geometry.name=ue.SkyLineBody,K.geometrys.SkyLineBody=n.geometry,W()}})).catch((function(e){console.log(e),C.Message.errorMsg("获取天际线体数据失败",e)}))})).catch((function(e){console.log(e),C.Message.errorMsg("获取天际线体数据失败",e)}))}function b(e){var n=p.getSkyline3D(),t=new Array,i=SuperMap3D.Cartesian3.fromDegrees(e.longitude,e.latitude,e.height);t.push(i);for(var o=0;o<n.x.length;o++){var r=SuperMap3D.Cartesian3.fromDegrees(n.x[o],n.y[o],n.z[o]);t.push(r)}viewer.entities.add({id:"SkyLineBody",polygon:{extrudedHeight:10,hierarchy:t,perPositionHeight:!0,material:SuperMap3D.Color.fromCssColorString(s.skyBodyColor)}})}function D(){if(de(),tooltip.setVisible(!1),s.observerInformation){viewer.entities.removeById("SkyLineBody"),p&&p.clear();for(var e=0;e<f.layers._layerQueue.length;e++){f.layers.findByIndex(e).removeAllObjsColor()}s.observerInformation=null,u.clear(),m(),c.removeCollection("SkyLineBody"),K.geometrys.SkyLineBody&&(delete K.geometrys.SkyLineBody,W()),s.isClear=!0}}return r((function(){m()})),f=viewer.scene,c=new SuperMap3D.S3MInstanceCollection(viewer.scene._context),viewer.scene.primitives.add(c),(p=new SuperMap3D.Skyline(viewer.scene)).ignoreGlobe=s.ignoreGlobe,s.observerInformation&&h(s.observerInformation),window.tooltip||(window.tooltip=createTooltip(viewer._element)),t((function(){return s.skylineRadius}),(function(e){s.observerInformation&&(p.radius=parseFloat(e),p.pitch=parseFloat(s.observerInformation.pitch))})),t((function(){return s.lineWidth}),(function(e){s.isClear||(y(),p.lineWidth=Number(e))})),t((function(){return s.skylineColor}),(function(e){if(s.observerInformation&&""!=e){var n=SuperMap3D.Color.fromCssColorString(e);p.color=n,p.pitch=parseFloat(s.observerInformation.pitch)}})),t((function(){return s.barrierColor}),(function(e){!s.observerInformation&&s.highlightBarrier||S(SuperMap3D.Color.fromCssColorString(e))})),t((function(){return s.ignoreGlobe}),(function(e){p&&(p.ignoreGlobe=e),y()})),t((function(){return s.highlightBarrier}),(function(e){if(e&&s.observerInformation)S(SuperMap3D.Color.fromCssColorString(s.barrierColor));else for(var n=0;n<f.layers._layerQueue.length;n++){f.layers.findByIndex(n).removeAllObjsColor()}})),t((function(){return s.skyBodyColor}),(function(e){if(s.observerInformation&&""!=e){var n=SuperMap3D.Color.fromCssColorString(e);s.skylineSpatialAnalysisUrl?c.getInstance("SkyLineBody",1).updateColor(n):viewer.entities.getById("SkyLineBody").polygon.material=n}})),t((function(){return s.getSkyline2d}),(function(e){e&&u?setTimeout((function(){u.resize()}),200):s.getSkyline2d=!1})),t((function(){return s.skylineMode}),(function(e){0==e?(p.displayStyle=0,viewer.entities.removeById("SkyLineBody"),c.removeCollection("SkyLineBody"),K.geometrys.SkyLineBody&&(delete K.geometrys.SkyLineBody,W())):1==e?(p.displayStyle=1,viewer.entities.removeById("SkyLineBody"),c.removeCollection("SkyLineBody"),K.geometrys.SkyLineBody&&(delete K.geometrys.SkyLineBody,W()),g()):2==e&&(p.displayStyle=0,s.observerInformation&&(s.skylineSpatialAnalysisUrl?M(s.observerInformation):b(s.observerInformation)))})),n((function(){D(),p=void 0,u=void 0,c=void 0})),d(d({},i(s)),{},{skyLineAnalysis:y,setLimitBody:function(){window.handlerPolygon||ce("Polygon"),tooltip.setVisible(!1),v&&(window.tooltip.showAt(" <p>点击鼠标左键绘制区域</p><p>点击鼠标右键结束绘制</p>","450px"),v=!1),pe("Polygon").then((function(e){p.removeLimitbody("limitBody");for(var n=window.handlerPolygon,t=e.result.object.positions,i=[],o=0,r=t.length;o<r;o++){var a=SuperMap3D.Cartographic.fromCartesian(t[o]),s=SuperMap3D.Math.toDegrees(a.longitude),l=SuperMap3D.Math.toDegrees(a.latitude);i.push([s,l])}for(var u=[],c=0,d=C.unique(i).length;c<d;c++)u.push(i[c][0]),u.push(i[c][1]);p.addLimitbody({position:u,name:"limitBody"}),n.polygon.show=!1,n.polyline.show=!1,n.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate()},echarts_box:w,clear:D})},shadowquery:function(r){var a=e({timeValue:[24,64],currentDate:new Date,shadowShow:!0,marks:{0:"0:00",8:"",16:"",24:"6:00",32:"",40:"",48:"12:00",56:"",64:"",72:"18:00",80:"",88:"",96:"24:00"},timeInterval:60,spacing:10,bottomHeight:1,extrudeHeight:30,shadowQueryRegion:[],layerShadowType:SuperMap3D.ShadowType.ALL,terrainShadows:SuperMap3D.ShadowMode.RECEIVE_ONLY,showStartImgForTime:!0,showStartImgForDate:!0,shadowRadio:{shadowRadio:"",longitude:"",latitude:"",height:"",isShow:!1},dockFontShow:!0,legendShow:!1,shadowBodyShow:!1,shadowBodyFilter:[0,100]});if(r)for(var s in r)a.hasOwnProperty(s)?a[s]=r[s]:C.Message.errorMsg(ue.AttributeError+s);r&&r.shadowQueryRegion&&T(r.shadowQueryRegion);var l,u,c,p,f,v,w,m=!0,g=y(a.timeValue),h=o(null),S="public/data/s3m/box.s3m",M=[],b=C.gradientColors,D=["#0000ff"];function P(){var e=viewer.scene;viewer.shadows=a.shadowShow,viewer.terrainShadows=a.terrainShadows,u=viewer.scene.layers.layerQueue,e.globe.enableLighting=!0,e.skyBox.show=!0,viewer.clock.multiplier=1,viewer.clock.shouldAnimate=!0,l=new SuperMap3D.ShadowQueryPoints(e),(f=new SuperMap3D.S3MInstanceCollection(e._context)).setCullEnabled(S,!0),e.primitives.add(f),l.queryPointsEvent.addEventListener((function(e){M=e,a.shadowBodyShow&&V()})),H.changeLayers&&E()}function E(){for(var e=0;e<u.length;e++)u[e].shadowType=a.layerShadowType,v=!0}function x(e){var n;n=g[0]===e[0]?L(e[1]):L(e[0]),viewer.clock.currentTime=SuperMap3D.JulianDate.fromDate(n),g=e}function L(e){var n=parseInt(e/4),t=parseInt(e%4*15),i=a.currentDate;return i.setHours(n),i.setMinutes(t),i}function R(e){a.shadowShow&&(l.startTime=SuperMap3D.JulianDate.fromDate(L(e[0])),l.endTime=SuperMap3D.JulianDate.fromDate(L(e[1]))),a.showStartImgForTime&&a.shadowQueryRegion.length>0&&l.build()}function T(e){R(a.timeValue);var n=[];l.spacing=Number(a.spacing),l.timeInterval=Number(a.timeInterval);for(var t=Number(a.bottomHeight),i=Number(a.extrudeHeight),o=0,r=SuperMap3D.arrayRemoveDuplicates(e,SuperMap3D.Cartesian3.equalsEpsilon).length;o<r;o++){var s=SuperMap3D.Cartographic.fromCartesian(e[o]),u=SuperMap3D.Math.toDegrees(s.longitude),c=SuperMap3D.Math.toDegrees(s.latitude);n.push(u),n.push(c)}a.shadowQueryRegion=n,l.qureyRegion({position:n,bottom:t,extend:i}),l.build()}function k(e){if(a.shadowBodyShow){var n=scene.pick(e.message.position);if(n&&n.id){var t=M[n.id];if(!t)return;var i=100*t.shadowRatio;(i<a.shadowBodyFilter[0]||i>a.shadowBodyFilter[1])&&(a.shadowRadio.isShow=!1);var o=C.CartesiantoDegrees(t.position);a.shadowRadio={shadowRadio:(100*t.shadowRatio).toFixed(0)+"%",longitude:o[0].toFixed(8),latitude:o[1].toFixed(8),height:o[2].toFixed(8),isShow:!0},h.value.style.top=e.message.position.y-160+"px",h.value.style.left=e.message.position.x+"px"}else a.shadowRadio.isShow=!1}else{var r=scene.pickPosition(e.message.position),s=SuperMap3D.Cartographic.fromCartesian(r),u=l.getShadowRadio(s);if(-1!=u){var c=SuperMap3D.Math.toDegrees(s.longitude),p=SuperMap3D.Math.toDegrees(s.latitude),d=s.height;a.shadowRadio={shadowRadio:(100*u).toFixed(0)+"%",longitude:c.toFixed(8),latitude:p.toFixed(8),height:d.toFixed(8),isShow:!0},h.value.style.top=e.message.position.y-160+"px",h.value.style.left=e.message.position.x+"px"}else a.shadowRadio.isShow=!1}}function I(){a.shadowRadio.isShow=!1}function N(){a.legendShow=!1,de(),a.shadowQueryRegion.length=0,tooltip.setVisible(!1),I(),viewer.eventManager.removeEventListener("CLICK",k),l.clear(),M.length=0,f.removeCollection(S);for(var e=0;e<u.length;e++)u[e].shadowType=SuperMap3D.ShadowType.NONE}function V(){var e=[];if(!(l._bottom<0||0==M.length)){for(var n,t,i,o=Number(a.spacing-.5),r=0,s=M.length;r<s;r++)e.push({position:M[r].position,color:(n=M[r].shadowRatio,t=void 0,i=void 0,t=parseInt(100*n),i=D[t],SuperMap3D.Color.fromCssColorString(i)),scale:new SuperMap3D.Cartesian3(o,o,o)});e.length>0&&f.add(S,e),B(a.shadowBodyFilter)}}function B(e){if(!(l._bottom<=0||0==M.length))for(var n=0,t=M.length;n<t;n++){var i=100*M[n].shadowRatio;i<e[0]||i>e[1]?f.getInstance(S,n).visible=!1:f.getInstance(S,n).visible=!0}}function A(e){w&&clearTimeout(w),w=setTimeout((function(){e()}),500)}return D=D.concat(b("#0000ff","#00ffff",20)).concat(b("#00ffff","#00ff00",20)).concat(b("#00ff00","#ffff00",20)).concat(b("#ffff00","#ff7f00",20)).concat(b("#ff7f00","#ff0000",20)),H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element)),P()),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)),P())})),t((function(){return H.changeLayers}),(function(e){E()})),t((function(){return a.timeValue}),(function(e){x(e)})),t((function(){return a.currentDate}),(function(e){x(g)})),t((function(){return a.timeInterval}),(function(e){A((function(){l.timeInterval=Number(e)}))})),t((function(){return a.spacing}),(function(e){A((function(){l.spacing=Number(e)}))})),t((function(){return a.bottomHeight}),(function(e){0!==a.shadowQueryRegion.length&&A((function(){var n=Number(e),t=Number(a.extrudeHeight);l.qureyRegion({position:a.shadowQueryRegion,bottom:n,extend:t}),l.build()}))})),t((function(){return a.extrudeHeight}),(function(e){0!==a.shadowQueryRegion.length&&A((function(){var n=Number(a.bottomHeight),t=Number(e);l.qureyRegion({position:a.shadowQueryRegion,bottom:n,extend:t}),l.build()}))})),t((function(){return a.shadowShow}),(function(e){viewer.shadows=e;for(var n=0,t=u.length;n<t&&u[n].shadowType!=a.layerShadowType;n++)u[n].shadowType=a.layerShadowType})),t((function(){return a.shadowBodyShow}),(function(e){e?(l.isPointsVisible=!1,V()):(l.isPointsVisible=!0,f.removeCollection(S))})),n((function(){N(),l.destroy(),l=void 0,viewer.shadows=!1,u=void 0})),d(d({},i(a)),{},{timeChanged:R,filterChanged:function(e){B(e)},formatTooltip:function(e){return e===a.timeValue[0]?"开始时间:"+n(L(e).toLocaleTimeString()):"结束时间:"+n(L(e).toLocaleTimeString());function n(e){var n=e.split(":");return n[0]+":"+n[1]}},sunLightForTime:function(e){if(p&&(a.showStartImgForDate=!0,clearInterval(p)),!e)return a.showStartImgForTime=!0,void clearInterval(c);a.showStartImgForTime=!1;var n=y(g),t=n[0],i=n[1],o=t;c=setInterval((function(){o<i?(o+=.5,a.timeValue=[t,o]):(a.showStartImgForTime=!0,clearInterval(c))}),50)},sunLightForDate:function(e){if(c&&(clearInterval(c),a.showStartImgForTime=!0),!e)return a.showStartImgForDate=!0,void clearInterval(p);a.showStartImgForDate=!1;var n=L(g[1]),t=n.getMonth();p=setInterval((function(){t<11?t+=1:t=0,n.setMonth(t),a.currentDate=new Date(n)}),1e3)},analysis:function(){a.shadowShow?(tooltip.setVisible(!1),m&&(window.tooltip.showAt(" <p>点击鼠标左键绘制分析区域</p><p>点击鼠标右键结束绘制</p>","350px"),m=!1),v&&u[0].shadowType==a.layerShadowType||E(),window.handlerPolygon||ce("Polygon"),pe("Polygon").then((function(e){var n=window.handlerPolygon;T(e.result.object.positions),n.polygon.show=!1,n.polyline.show=!1,n.deactivate(),viewer.eventManager.addEventListener("CLICK",k,!0)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),a.legendShow=!0):a.shadowShow=!0},clear:N,bubble:h,closeBubble:I,dockBubble:function(e){e?(h.value.classList.add("bubbleDock"),a.dockFontShow=!1):(h.value.classList.remove("bubbleDock"),a.dockFontShow=!0)}})},viewshed:function(o){var r,a,s,l,u,c=e({viewshedSpatialUrl:"http://www.supermapol.com/realspace/services/spatialAnalysis-data_all/restjsr/spatialanalyst/geometry/3d/viewshedbody.json",observerInformation:null,direction:1,pitch:1,addheight:1.8,distance:200,verticalFov:60,horizontalFov:90,hintLineColor:"rgb(212,202,45)",visibleAreaColor:"rgba(9,199,112,0.5)",hiddenAreaColor:"rgba(238,114,22,0.5)",visibleBodyColor:"rgba(9,199,112,0.7)",invisibleBodyColor:"rgba(238,114,22,0.7)",visibleBody:!1,invisibleBody:!1,viewshedAnimation:!1,DynamicLine:[],DynamicSpeed:10});if(o)for(var p in o)c.hasOwnProperty(p)?c[p]=o[p]:C.Message.errorMsg(ue.AttributeError+p);var f,v,w=!0,m=["public/data/s3m/car1.s3m"];function y(){console.log("可视域分析"),l=viewer.scene,r=new SuperMap3D.ViewShed3D(l),a=new SuperMap3D.ScreenSpaceEventHandler(l.canvas),r.hintLineColor=SuperMap3D.Color.fromCssColorString(c.hintLineColor),r.visibleAreaColor=SuperMap3D.Color.fromCssColorString(c.visibleAreaColor),r.hiddenAreaColor=SuperMap3D.Color.fromCssColorString(c.hiddenAreaColor),s=new SuperMap3D.S3MInstanceCollection(l._context),viewer.scene.primitives.add(s),(v=new SuperMap3D.DynamicLayer3D(l.context,m)).updateInterval=100,v.setCullEnabled(m[0],SuperMap3D.CullFace.BACK),v.maxVisibleAltitude=2e3,v.minVisibleAltitude=0,l.primitives.add(v)}H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element)),y()),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)),y())}));var g=null;function h(e){switch(e){case"LEFT_CLICK":a.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK);break;case"MOUSE_MOVE":a.removeInputAction(SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE);break;case"RIGHT_CLICK":a.removeInputAction(SuperMap3D.ScreenSpaceEventType.RIGHT_CLICK);break;case"ALL":default:a.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),a.removeInputAction(SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),a.removeInputAction(SuperMap3D.ScreenSpaceEventType.RIGHT_CLICK)}}function S(){var e=r.getViewshedParameter(),n={viewerPoint:e.viewPosition,point3DsList:e.point3DList,radius:e.distance,lonlat:!0,viewShedType:"VISIBLEBODY"},t=JSON.stringify(n),i=SuperMap3D.Color.fromCssColorString(c.visibleBodyColor);window.axios.post(c.viewshedSpatialUrl,t).then((function(e){window.axios.get(e.data.newResourceLocation+".json").then((function(e){var n=e.data;if(null!=n.geometry){var t=new Uint8Array(n.geometry.model).buffer;s.add("VeiwshedBody",{id:1,position:SuperMap3D.Cartesian3.fromDegrees(n.geometry.position.x,n.geometry.position.y,n.geometry.position.z),hpr:new SuperMap3D.HeadingPitchRoll(0,0,0),color:i},t,!1),n.geometry.model=[4,0,0,0].concat(n.geometry.model),r.visibleAreaColor=SuperMap3D.Color.fromCssColorString("rgba(0,0,0,0)"),r.hiddenAreaColor=SuperMap3D.Color.fromCssColorString("rgba(0,0,0,0)"),n.geometry.name=ue.VeiwshedBody,K.geometrys.VeiwshedBody=n.geometry,W()}else C.Message.errorMsg("获取geometry失败")})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}function M(){var e=r.getViewshedParameter(),n={viewerPoint:e.viewPosition,point3DsList:e.point3DList,radius:e.distance,lonlat:!0,viewShedType:"HIDDENBODY"},t=JSON.stringify(n),i=SuperMap3D.Color.fromCssColorString(c.invisibleBodyColor);window.axios.post(c.viewshedSpatialUrl,t).then((function(e){window.axios.get(e.data.newResourceLocation+".json").then((function(e){var n=e.data;if(null!=n.geometry){var t=new Uint8Array(n.geometry.model).buffer;s.add("VeiwshedBodyHidden",{id:1,position:SuperMap3D.Cartesian3.fromDegrees(n.geometry.position.x,n.geometry.position.y,n.geometry.position.z),hpr:new SuperMap3D.HeadingPitchRoll(0,0,0),color:i},t,!1),n.geometry.model=[4,0,0,0].concat(n.geometry.model),r.visibleAreaColor=SuperMap3D.Color.fromCssColorString("rgba(0,0,0,0)"),r.hiddenAreaColor=SuperMap3D.Color.fromCssColorString("rgba(0,0,0,0)"),n.geometry.name=ue.VeiwshedBodyHidden,K.geometrys.VeiwshedBodyHidden=n.geometry,W()}else C.Message.errorMsg("获取geometry失败")})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}function b(){D(),v.clearState(m[0],[1]),clearInterval(f),f=null,c.viewshedAnimation=!1,de("Polyline")}function D(){tooltip.setVisible(!1),viewer.entities.removeById("viewshedPoint"),document.body.classList.remove("measureCur"),r.distance=1e-5,r.viewPosition=[0,0,0],c.visibleBody=!1,c.invisibleBody=!1,c.observerInformation=null}function P(){r.distance=c.distance,r.build();for(var e=c.DynamicLine,n=[],t=1,i=e.length;t<i;t++)for(var o=e[t-1],a=e[t],s=SuperMap3D.Cartesian3.distance(o,a),l=parseInt(s/(.05*c.DynamicSpeed))+1,u=1,p=l;u<=p;u++)n.push(SuperMap3D.Cartesian3.lerp(o,a,u/l,new SuperMap3D.Cartesian3));var d=C.CartesiantoDegreesObjs(n),w=new SuperMap3D.DynamicObjectState({id:1,longitude:d[0].longitude,latitude:d[0].latitude,altitude:d[0].height,scale:new SuperMap3D.Cartesian3(1,1,1)});v.updateObjectWithModel(m[0],[w]);var y=1;f=setInterval((function(){if(y>=d.length)clearInterval(f);else{w.longitude=d[y].longitude,w.latitude=d[y].latitude,w.altitude=d[y].height,v.updateObjectWithModel(m[0],[w]);var e=C.getAngleAndRadian(n[y-1],n[y]);r.direction=e.angle,r.viewPosition=[w.longitude,w.latitude,w.altitude+Number(c.addheight)],y+=1}}),50)}function E(e){if(""!=e)return SuperMap3D.Color.fromCssColorString(e)}return t((function(){return c.visibleBody}),(function(e){e&&c.observerInformation?S():(s.removeCollection("VeiwshedBody"),c.invisibleBody||(r.visibleAreaColor=SuperMap3D.Color.fromCssColorString(c.visibleAreaColor),r.hiddenAreaColor=SuperMap3D.Color.fromCssColorString(c.hiddenAreaColor)),K.geometrys.VeiwshedBody&&(delete K.geometrys.VeiwshedBody,W()))})),t((function(){return c.invisibleBody}),(function(e){e&&c.observerInformation?M():(s.removeCollection("VeiwshedBodyHidden"),c.visibleBody||(r.visibleAreaColor=SuperMap3D.Color.fromCssColorString(c.visibleAreaColor),r.hiddenAreaColor=SuperMap3D.Color.fromCssColorString(c.hiddenAreaColor)),K.geometrys.VeiwshedBodyHidden&&(delete K.geometrys.VeiwshedBodyHidden,W()))})),t((function(){return c.addheight}),(function(e){(""===e||e<0)&&(e=0),c.observerInformation&&(c.observerInformation[2]=g+parseFloat(e),r.viewPosition=c.observerInformation)})),t((function(){return c.pitch}),(function(e){(""===e||e<0)&&(e=0),r.pitch=parseFloat(e)})),t((function(){return c.direction}),(function(e){(""===e||e<0)&&(e=0),r.direction=parseFloat(e)})),t((function(){return c.distance}),(function(e){(""===e||e<0)&&(e=0),r.distance=parseFloat(e)})),t((function(){return c.verticalFov}),(function(e){(""===e||e<0)&&(e=0),r.verticalFov=parseFloat(e)})),t((function(){return c.horizontalFov}),(function(e){(""===e||e<0)&&(e=0),r.horizontalFov=parseFloat(e)})),t((function(){return c.hintLineColor}),(function(e){r.hintLineColor=E(e)})),t((function(){return c.visibleAreaColor}),(function(e){r.visibleAreaColor=E(e)})),t((function(){return c.visibleBodyColor}),(function(e){s.getInstance("VeiwshedBody",1).updateColor(E(e))})),t((function(){return c.hiddenAreaColor}),(function(e){r.hiddenAreaColor=E(e)})),t((function(){return c.invisibleBodyColor}),(function(e){s.getInstance("VeiwshedBodyHidden",1).updateColor(E(e))})),t((function(){return c.viewshedAnimation}),(function(e){e?(D(),tooltip.showAt("<p>点击分析按钮激活事件</p><p>点击鼠标左键确认模型移动路线</p><p>单击右键结束分析</p>","450px"),setTimeout((function(){tooltip.setVisible(!1)}),3e3)):b()})),n((function(){b(),s.destroy(),r.destroy(),a.destroy(),DynamicLayer3D.destroy(),r=void 0,a=void 0,s=void 0})),d(d({},i(c)),{},{analysis:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),c.viewshedAnimation?(f&&(b(),c.viewshedAnimation=!0,document.body.classList.add("measureCur")),function(){window.handlerPolyline||ce("Polyline");if(o.DynamicLine)return void P();pe("Polyline",SuperMap3D.ClampMode.Ground).then((function(e){var n=window.handlerPolyline;n.polyline.show=!1,window.polylineTransparent.show=!0,n.deactivate(),c.DynamicLine=e.result.object.positions,tooltip.setVisible(!1),c.DynamicLine.length<2?C.Message.warnMsg("至少需要两个点！"):P()}),(function(e){console.log(e)})),window.handlerPolyline.activate()}()):(w&&(window.tooltip.showAt(" <p>点击鼠标左键确认观察者位置</p> <p>右键单击结束分析</p>","450px"),w=!1),s.removeCollection("VeiwshedBody"),s.removeCollection("VeiwshedBodyHidden"),r.distance=1e-5,r.visibleAreaColor=SuperMap3D.Color.fromCssColorString(c.visibleAreaColor),r.hiddenAreaColor=SuperMap3D.Color.fromCssColorString(c.hiddenAreaColor),a.setInputAction((function(e){g=null;var n=l.pickPosition(e.position);u=n;var t=C.CartesiantoDegrees(n);g=t[2],t[2]+=Number(c.addheight),r.viewPosition=t,r.build(),c.observerInformation=t,document.body.classList.remove("measureCur"),h("LEFT_CLICK"),a.setInputAction((function(e){var n=e.endPosition,t=l.pickPosition(n);if(SuperMap3D.Cartesian3.distance(u,t)>0){var i=C.CartesiantoDegrees(t);r.setDistDirByPoint(i)}}),SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),a.setInputAction((function(e){c.direction=r.direction.toFixed(2),c.pitch=r.pitch.toFixed(2),c.distance=r.distance.toFixed(2),c.horizontalFov=r.horizontalFov,c.verticalFov=r.verticalFov,c.visibleBody&&S(),c.invisibleBody&&M(),tooltip.setVisible(!1),h("MOUSE_MOVE"),h("RIGHT_CLICK")}),SuperMap3D.ScreenSpaceEventType.RIGHT_CLICK),function(e){viewer.entities.removeById("viewshedPoint"),viewer.entities.add(new SuperMap3D.Entity({id:"viewshedPoint",point:new SuperMap3D.PointGraphics({color:E(c.hiddenAreaColor),pixelSize:8}),position:e}))}(SuperMap3D.Cartesian3.fromDegrees(t[0],t[1],t[2]))}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK))},clear:b})},profile:function(a){var s,l,u,c=e({profile2d:!0,polylineColor:"rgb(250, 213, 6)",polylineWidth:5,initEchartsOption:null,updateEchartsOption:null});if(a)for(var p in a)c.hasOwnProperty(p)?c[p]=a[p]:C.Message.errorMsg(ue.AttributeError+p);var f=!0,v=[],w=[],m=null,y=o(null);function g(){window.echarts?(s||(s=window.echarts.init(y.value),window.onresize=function(){s.resize()}),c.initEchartsOption?s.setOption(c.initEchartsOption):s.setOption({title:{text:"剖面分析",textStyle:{fontSize:14}},grid:{left:30,right:0,top:30,bottom:8},tooltip:{},xAxis:{data:[]},yAxis:{data:[]},series:[{type:"bar",data:[]}]})):C.Message.warnMsg(ue.EchartsErr)}function h(e,n){c.profile2d=!0,s.clear(),s.showLoading(),v.length=0,w.length=0;for(var t=[],i=1,o=n.length;i<o;i++){var r=n[i-1],a=n[i],p=SuperMap3D.Cartesian3.distance(r,a);S(parseInt(p));for(var d=1,f=l;d<=f;d++)t.push(SuperMap3D.Cartesian3.lerp(r,a,d/l,new SuperMap3D.Cartesian3))}viewer.scene.clampToHeightMostDetailed(t).then((function(e){w=e,v=C.CartesiantoDegreesObjs(w),function(){if(s.hideLoading(),s.clear(),c.updateEchartsOption)return void s.setOption(c.updateEchartsOption);var e={title:{text:"剖面信息",textStyle:{fontSize:14}},grid:{left:50,right:8,top:40,bottom:20},tooltip:{trigger:"axis",backgroundColor:"#ffffff",textStyle:{color:"#000"},formatter:function(e){var n=e[0].dataIndex;return u=w[n],['当前位置: <hr size=1 style="margin: 3px 0">',"经度: "+v[n].longitude.toFixed(6)+"<br/>","纬度: "+v[n].latitude.toFixed(6)+"<br/>","海拔: "+v[n].height.toFixed(2)+"米<br/>"].join("")}},xAxis:{data:v.map((function(e,n){return n})),show:!1},yAxis:{min:function(e){return e.min<20?0:Math.floor(e.min)},axisLabel:{interval:"auto",formatter:function(e,n){return e>999?(e/1e3).toFixed(2)+"km":e+"m"}},splitLine:{show:!0}},toolbox:{left:"right",feature:{saveAsImage:{}}},dataZoom:[{type:"inside",xAxisIndex:0,filterMode:"filter",start:0,end:100}],series:{name:"height",type:"line",data:v.map((function(e){return e.height})),areaStyle:{}}};s.setOption(e)}()}))}function S(e){l=e/1e4>1?parseInt(e/100):e/1e3>5?parseInt(e/10):e/1e3>2?parseInt(e/5):e/1e3>1?parseInt(e/2):e/100>5?parseInt(e/1.5):e/100>2?e:2*e}function M(){c.profile2d=!1,viewer.entities.removeById("location4"),viewer.entities.removeById("polyline-profile"),s.clear(),v.length=0,w.length=0,de("Polyline"),ge(),g(),tooltip.setVisible(!1)}return r((function(){g()})),H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element))),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)))})),t((function(){return c.profile2d}),(function(e){e&&s?setTimeout((function(){s.resize()}),200):c.getSkyline2d=!1})),n((function(){M(),s.clear(),v.length=0,w.length=0})),d(d({},i(c)),{},{echarts_box:y,myChart:s,Entypositions:u,LatAndLons:v,Cartesians:w,analysis:function(){f&&(tooltip.showAt(" <p>点击鼠标左键开始绘制</p> <p>单击右键结束分析</p><p>选中可进行编辑</p>","250px"),f=!1),window.handlerPolyline||ce("Polyline"),pe("Polyline").then((function(e){s.showLoading(),m=e.positions,function(e){viewer.entities.removeById("polyline-profile"),viewer.entities.removeById("location4");var n=SuperMap3D.Color.fromCssColorString(c.polylineColor);viewer.entities.add({id:"polyline-profile",polyline:{positions:SuperMap3D.Cartesian3.fromDegreesArrayHeights(e),width:c.polylineWidth,material:n,clampToGround:!0}}),function(){if(viewer.entities.getById("location4"))return;viewer.entities.add({id:"location4",position:new SuperMap3D.CallbackProperty((function(){return u}),!1),billboard:{image:"src/style/images/location4.png",width:30,height:40,scaleByDistance:new SuperMap3D.NearFarScalar(10,1,2e3,.6),eyeOffset:new SuperMap3D.Cartesian3(0,1,-5)}})}()}(e.positions);var n=window.handlerPolyline;n.polyline.show=!1,window.polylineTransparent.show=!1,n.deactivate(),h("",e.result.positions),ye(m,!1,h),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()},clear:M})},sightLine:function(o){var r,a,s,l=e({viewPosition:null,visibleColor:"rgb(0, 200, 0)",hiddenColor:"rgb(200, 0, 0)",barrierColor:"rgba(255, 186, 1, 1)",highlightBarrier:!1,lineWidth:3,showBarrierPoints:!0});if(o)for(var u in o)l.hasOwnProperty(u)?null!=o[u]&&(l[u]=o[u]):C.Message.errorMsg(ue.AttributeError+u);var c,p,f=!0,v=!1,w=[],m=0,y=[],g=[],h=[];function M(){r=viewer.scene,(a=new SuperMap3D.Sightline(r)).visibleColor=SuperMap3D.Color.fromCssColorString(l.visibleColor),a.hiddenColor=SuperMap3D.Color.fromCssColorString(l.hiddenColor),a.lineWidth=Number(l.lineWidth),s=new he(viewer,"sightPoint_",x,L)}function b(e){v=!0,clearTimeout(c),c=setTimeout((function(){v=!1}),20);var n=r.pickPosition(e.message.position),t=C.CartesiantoDegrees(n);t[2]<0&&(t[2]=0,n=SuperMap3D.Cartesian3.fromDegrees(t[0],t[1],t[2])),l.viewPosition?(a.addTargetPoint({position:t,name:"sightPoint_Target"+m}),y.push(n),requestAnimationFrame((function(){requestAnimationFrame((function(){a.getBarrierPoint("sightPoint_Target"+m,(function(e){var n;if(n=m,viewer.entities.add(new SuperMap3D.Entity({id:"sightPoint_Target"+n,point:new SuperMap3D.PointGraphics({color:new SuperMap3D.CallbackProperty((function(){return SuperMap3D.Color.fromCssColorString(h[n])}),!1),pixelSize:10}),position:new SuperMap3D.CallbackProperty((function(){return y[n]}),!1)})),e&&e.position){e.position.height+=2;var t=SuperMap3D.Cartographic.toCartesian(e.position);g.push(t);var i=a.getObjectIds();w.push(i),h.push(l.hiddenColor)}else g.push({x:6378137,y:0,z:0}),h.push(l.visibleColor);!function(e){var n=viewer.entities.add({name:"Point_Barrier"+e,position:new SuperMap3D.CallbackProperty((function(){return g[e]}),!1),cylinder:{length:3,topRadius:2,bottomRadius:0,material:SuperMap3D.Color.fromCssColorString("#d60000")}});D.push(n)}(m),m+=1}))}))}))):(a.viewPosition=t,l.viewPosition=t,a.build(),viewer.entities.add(new SuperMap3D.Entity({id:"sightPoint_view",point:new SuperMap3D.PointGraphics({color:SuperMap3D.Color.fromCssColorString(l.barrierColor),pixelSize:10}),position:new SuperMap3D.CallbackProperty((function(){return p}),!1)})),p=n)}H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element)),M()),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)),M())}));var D=[];function P(e){if(l.viewPosition&&!v){var n=r.pickPosition(e.message.endPosition),t=C.CartesiantoDegrees(n);a.addTargetPoint({position:t,name:"point"})}}function E(){window.tooltip.setVisible(!1),document.body.classList.remove("measureCur"),l.highlightBarrier&&R(),a.removeTargetPoint("point"),a.build(),s.addEventListener(),viewer.eventManager.removeEventListener("CLICK",b),viewer.eventManager.removeEventListener("MOUSE_MOVE",P),viewer.eventManager.removeEventListener("RIGHT_CLICK",E)}function x(e){if(e.id)if(e.id.includes("sightPoint_Target")){var n=C.CartesiantoDegrees(e.position._value);a.addTargetPoint({position:n,name:e.id})}else if(e.id.includes("sightPoint_view")){var t=C.CartesiantoDegrees(e.position._value);a.viewPosition=t}}function L(e){requestAnimationFrame((function(){requestAnimationFrame((function(){if(e.id)if(e.id.includes("sightPoint_view"))for(var n=0,t=g.length;n<t;n++)i("sightPoint_Target"+n,!0);else e.id.includes("sightPoint_Target")&&i(e.id);function i(n,t){a.getBarrierPoint(n,(function(i){var o=n.charAt(n.length-1);if(i&&i.position){i.position.height+=2;var s,u=SuperMap3D.Cartographic.toCartesian(i.position);if(t){var c=a._targetPoints.values[o],p=SuperMap3D.Cartesian3.fromDegrees(c[0],c[1],c[2]);s=SuperMap3D.Cartesian3.distance(p,u)}else s=SuperMap3D.Cartesian3.distance(e.position._value,u);s>=2.5?(g[o]=u,h[o]=l.hiddenColor):(g[o]={x:6378137,y:0,z:0},h[o]=l.visibleColor);var d=a.getObjectIds();if(w.splice(o,1,d),l.highlightBarrier){var f,v=S(r.layers.layerQueue);try{for(v.s();!(f=v.n()).done;){f.value.removeAllObjsColor()}}catch(e){v.e(e)}finally{v.f()}R()}}else g[o]={x:6378137,y:0,z:0},h[o]=l.visibleColor}))}}))}))}function R(e){var n=SuperMap3D.defaultValue(e,SuperMap3D.Color.fromCssColorString(l.barrierColor)),t=viewer.scene.layers.layerQueue,i=w[w.length-1],o=i[String(Object.keys(i))];console.log("barrierIds:",o),t.forEach((function(e){"Building@CBD"===e._name&&e.setObjsColor(o,n)}))}function T(){a.removeAllTargetPoint();var e,n=S(r.layers.layerQueue);try{for(n.s();!(e=n.n()).done;){e.value.removeAllObjsColor()}}catch(e){n.e(e)}finally{n.f()}m=0,w.length=0,y.length=0,g.length=0,h.length=0,s.removeEventListener(),viewer.entities.removeAll(),document.body.classList.remove("measureCur"),window.tooltip.setVisible(!1),l.viewPosition=null,D.length=0,viewer.eventManager.removeEventListener("CLICK",b),viewer.eventManager.removeEventListener("MOUSE_MOVE",P),viewer.eventManager.removeEventListener("RIGHT_CLICK",E)}return t((function(){return l.lineWidth}),(function(e){a&&(a.lineWidth=Number(e))})),t((function(){return l.visibleColor}),(function(e){a&&(a.visibleColor=SuperMap3D.Color.fromCssColorString(e))})),t((function(){return l.hiddenColor}),(function(e){a&&(a.hiddenColor=SuperMap3D.Color.fromCssColorString(e))})),t((function(){return l.barrierColor}),(function(e){0!==w.length&&R(SuperMap3D.Color.fromCssColorString(e))})),t((function(){return l.highlightBarrier}),(function(e){if(e)R();else{var n,t=S(r.layers.layerQueue);try{for(t.s();!(n=t.n()).done;){n.value.removeAllObjsColor()}}catch(e){t.e(e)}finally{t.f()}}})),t((function(){return l.showBarrierPoints}),(function(e){0!==D.length&&D.forEach((function(n){n.show=e}))})),n((function(){T(),a=void 0})),d(d({},i(l)),{},{analysis:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),f&&(window.tooltip.showAt(" <p>点击鼠标左键确认观察者位置</p><p>再点击左键确认目标位置</p> <p>右键单击结束分析</p>","400px"),f=!1),s.removeEventListener(),viewer.eventManager.addEventListener("CLICK",b,!0),viewer.eventManager.addEventListener("MOUSE_MOVE",P),viewer.eventManager.addEventListener("RIGHT_CLICK",E,!0)},clear:T})},openness:function(o){var r=e({addHeight:1,viewPosition:null,viewDomeRadius:100,domeType:"ALLDOME",isClosed:!1,visibleAreaColor:"rgba(9,199,112,0.5)",hiddenAreaColor:"rgba(238,114,22,0.5)",startAngle:0,endAngle:360});if(o)for(var a in o)r.hasOwnProperty(a)?r[a]=o[a]:C.Message.errorMsg(ue.AttributeError+a);var s,l,u,c=!0;function p(){s=viewer.scene,(l=new SuperMap3D.ViewDome(s)).viewPosition=[0,0,0],l.distance=Number(r.viewDomeRadius),l.domeType=SuperMap3D.ViewDomeType[r.domeType],l.visibleAreaColor=SuperMap3D.Color.fromCssColorString(r.visibleAreaColor),l.hiddenAreaColor=SuperMap3D.Color.fromCssColorString(r.hiddenAreaColor),l.startAngle=Number(r.startAngle),l.endAngle=Number(r.endAngle),l.isClosed=r.isClosed,l.build()}function f(e){viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");var n=s.pickPosition(e.message.position),t=C.CartesiantoDegrees(n);t[2]+=Number(r.addHeight),r.viewPosition={longitude:t[0].toFixed(6),latitude:t[1].toFixed(6),height:t[2].toFixed(2)},l.viewPosition=t,l.build(),window.tooltip.setVisible(!1),viewer.eventManager.removeEventListener("CLICK",f),viewer.eventManager.removeEventListener("MOUSE_MOVE",v),l.startAngle=Number(r.startAngle)}function v(e){u=s.pickPosition(e.message.endPosition)}function w(){viewer.entities.removeById("opennessPoint"),document.body.classList.remove("measureCur"),window.tooltip.setVisible(!1),r.viewPosition=null,l.viewPosition=[0,0,0],l.startAngle=Number(r.startAngle)}return H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element)),p()),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)),p())})),t((function(){return r.viewDomeRadius}),(function(e){""!=e&&(l.distance=Number(e))})),t((function(){return r.domeType}),(function(e){""!=e&&(l.domeType=SuperMap3D.ViewDomeType[e])})),t((function(){return r.isClosed}),(function(e){""!=e&&(l.isClosed=e)})),t((function(){return r.startAngle}),(function(e){""!=e&&(l.startAngle=Number(e))})),t((function(){return r.endAngle}),(function(e){""!=e&&(l.endAngle=Number(e))})),t((function(){return r.visibleAreaColor}),(function(e){if(""!=e){var n=SuperMap3D.Color.fromCssColorString(e);l.visibleAreaColor=n}})),t((function(){return r.hiddenAreaColor}),(function(e){if(""!=e){var n=SuperMap3D.Color.fromCssColorString(e);l.hiddenAreaColor=n}})),t((function(){return r.addHeight}),(function(e,n){var t=e-n;t=SuperMap3D.defaultValue(t,0),l.viewPosition[2]+=Number(t),u=SuperMap3D.Cartesian3.fromDegrees(l.viewPosition[0],l.viewPosition[1],l.viewPosition[2]),l.startAngle=Number(r.startAngle)})),n((function(){w(),l.destroy(),l=void 0})),d(d({},i(r)),{},{analysis:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),c&&(window.tooltip.showAt(" <p>点击鼠标左键确认分析位置</p>","250px"),c=!1),viewer.entities.removeById("opennessPoint"),viewer.entities.add(new SuperMap3D.Entity({id:"opennessPoint",point:new SuperMap3D.PointGraphics({color:SuperMap3D.Color.fromCssColorString("rgba(238,114,22,1)"),pixelSize:8}),position:new SuperMap3D.CallbackProperty((function(){return u}),!1)})),viewer.eventManager.addEventListener("CLICK",f,!0),viewer.eventManager.addEventListener("MOUSE_MOVE",v,!0)},clear:w})},spatialQuery3d:function(o){var r=e({layerNames:[],selectedLayerName:null,scale:3,positionMode:"intersects",Xpitch:0,Yroll:0,Zheading:0,geometryType:"box",drawType:"Fill_And_WireFrame",FillColor:"rgba(192,211,25,0.5)",WireFrameColor:"rgba(89,129,228,0.8)",searchColor:"rgba(255, 186, 1, 1)",GeometryBodyNames:[],boxParameters:[100,100,100],sphereParameters:[100],coneParameters:[100,200],cylinderParameters:[100,100,200],ellicpseParameters:[100,50,50],rotateOrigin:null});if(o)for(var a in o)r.hasOwnProperty(a)?r[a]=o[a]:C.Message.errorMsg(ue.AttributeError+a);var s,l,u,c,p,f=!0,v=[];function w(){if(r.GeometryBodyNames=[],v=[],K.geometrys)for(var e in K.geometrys){v.push(e);var n=K.geometrys[e].name;r.GeometryBodyNames.includes(n)||r.GeometryBodyNames.push(n)}0===r.GeometryBodyNames.length&&(o&&o.geometryType?r.geometryType=o.geometryType:r.geometryType="box")}function m(){s=viewer.scene,l=viewer.scene.layers.layerQueue,(u=new SuperMap3D.SpatialQuery3D(s)).outlineColor=SuperMap3D.Color.fromCssColorString(r.WireFrameColor),u.fillColor=SuperMap3D.Color.fromCssColorString(r.FillColor),u.fillStyle=SuperMap3D.FillStyle[r.drawType],S(r.geometryType),M(r.positionMode),u.build(),setTimeout((function(){0===r.layerNames.length&&y()}),1e3),p=new SuperMap3D.S3MInstanceCollection(s._context),viewer.scene.primitives.add(p)}function y(){var e=h(r.selectedLayerName);u&&u.layers&&(u.layers=e?[e]:[]),r.layerNames.length=0,l&&l.length>0&&(l.forEach((function(e,n){r.layerNames.includes(e._name)||r.layerNames.push(e._name)})),r.selectedLayerName||(r.selectedLayerName=r.layerNames[0]))}function g(e){document.body.classList.remove("measureCur");var n=s.pickPosition(e.message.position);b(C.CartesiantoDegrees(n)),tooltip.setVisible(!1),viewer.eventManager.removeEventListener("CLICK",g)}function h(e){return l.find((function(n,t){return n._name===e}))}function S(e){switch(e){case"box":var n=r.boxParameters;c=new SuperMap3D.GeoBox(n[0],n[1],n[2]);break;case"sphere":var t=r.sphereParameters;c=new SuperMap3D.GeoSphere(t[0]);break;case"cone":var i=r.coneParameters;c=new SuperMap3D.GeoCone(i[0],i[1]),r.rotateOrigin&&(c.rotateOrigin="APEX"==r.rotateOrigin?SuperMap3D.RotationOrigin.APEX:SuperMap3D.RotationOrigin.CENTER);break;case"cylinder":var o=r.cylinderParameters;c=new SuperMap3D.GeoCylinder(o[0],o[1],o[2]);break;case"ellicpse":var a=r.ellicpseParameters;c=new SuperMap3D.GeoEllipsoid(a[0],a[1],a[2]);break;default:(c=new SuperMap3D.GeoModel3D).geoModel=K.geometrys.SkyLineBody,u.clear()}u.geometry=c}function M(e){var n;switch(e){case"intersects":n=SuperMap3D.PositionMode.Intersects;break;case"disjoint":n=SuperMap3D.PositionMode.Disjoint;break;case"contains":n=SuperMap3D.PositionMode.Contains;break;default:n=SuperMap3D.PositionMode.Intersects}u.positionMode=n}function b(e){u&&u.geometry&&(u.geometry.geoPosition=new SuperMap3D.Point3D(e[0],e[1],e[2]))}function D(){var e=h(r.selectedLayerName);e&&(e.selectedColor=new SuperMap3D.Color(.7,.7,1,1),e.setSelection([]),e.selectColorType=SuperMap3D.SelectColorType.MIX),u.clear(),tooltip.setVisible(!1),document.body.classList.remove("measureCur"),u.geometry.geoPosition=new SuperMap3D.Point3D(0,0,0),viewer.eventManager.removeEventListener("CLICK",g)}return H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element)),m()),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)),m())})),t((function(){return H.changeLayers}),(function(e){y()})),H.changeGeometrys&&w(),t((function(){return H.changeGeometrys}),(function(e){w()})),t((function(){return r.Xpitch}),(function(e){""!=e&&(c.geoRotationX=parseFloat(e))})),t((function(){return r.Yroll}),(function(e){""!=e&&(c.geoRotationY=parseFloat(e))})),t((function(){return r.Zheading}),(function(e){""!=e&&(c.geoRotationZ=parseFloat(e))})),t((function(){return r.scale}),(function(e){""!=e&&(c.geoScaleX=parseFloat(e),c.geoScaleY=parseFloat(e),c.geoScaleZ=parseFloat(e))})),t((function(){return r.positionMode}),(function(e){""!=e&&M(e)})),t((function(){return r.geometryType}),(function(e){""!==e&&S(e)})),t((function(){return r.drawType}),(function(e){""!=e&&(u.fillStyle=SuperMap3D.FillStyle[e])})),t((function(){return r.FillColor}),(function(e){""!=e&&(u.fillColor=SuperMap3D.Color.fromCssColorString(e))})),t((function(){return r.WireFrameColor}),(function(e){""!=e&&(u.outlineColor=SuperMap3D.Color.fromCssColorString(e))})),t((function(){return r.searchColor}),(function(e){""!=e&&(h(r.selectedLayerName).selectedColor=SuperMap3D.Color.fromCssColorString(e))})),t((function(){return r.selectedLayerName}),(function(e,n){var t=h(n);t&&(t.selectedColor=new SuperMap3D.Color(.7,.7,1,1),t.setSelection([]),t.selectColorType=SuperMap3D.SelectColorType.MIX),D()})),n((function(){u.destroy(),u=void 0,l=void 0,c=void 0})),d(d({},i(r)),{},{setPosition:b,getQueryIDs:function(){return u.getQueryIDs()},analysis:function(){try{var e=h(r.selectedLayerName);if(!e)return void C.Message.warnMsg("请选择需要查询的图层！");if(u.layers=[e],tooltip.setVisible(!1),e.selectedColor=SuperMap3D.Color.fromCssColorString(r.searchColor),e.selectColorType=SuperMap3D.SelectColorType.REPLACE,e.selectEnabled=!1,u.geometry){var n=u.getQueryIDs();console.log(n)}if("number"==typeof r.geometryType)return S(r.geometryType),void u.build();u.build(),viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),f&&(window.tooltip.showAt(" <p>点击鼠标左键确认查询位置</p>","300px"),f=!1),viewer.eventManager.addEventListener("CLICK",g,!0)}catch(e){console.error(e)}},clear:D})},splitScreen:function(a){var s,l,u,c=e({multiViewport:"NONE",selectedViewport:"0",TreeDatas:[]});if(a)for(var p in a)c.hasOwnProperty(p)?c[p]=a[p]:C.Message.errorMsg(ue.AttributeError+p);var f=o(null),v={KeysViewport1:[],KeysViewport2:[],KeysViewport3:[],KeysViewport4:[]};function w(){s=viewer.scene.layers.layerQueue,l=viewer.imageryLayers._layers,u=viewer.scene._vectorTileMaps._layerQueue,viewer.terrainProvider,c.TreeDatas.length=0,function(){if(0==s.length)return;var e={id:"s3m",label:"S3M图层",children:[]};s.forEach((function(n,t){var i={id:"s3m-"+t,label:n._name};e.children.push(i)})),c.TreeDatas[0]=e}(),function(){if(1==l.length)return;var e={id:"img",label:"IMG图层",children:[]};l.forEach((function(n,t){var i=n._imageryProvider instanceof SuperMap3D.MvtProviderGL;if(0===t||i)return!0;var o={id:"img-"+t,label:ue.BaseMapImg};n._imageryProvider.tablename&&(o.label=n._imageryProvider.tablename),e.children.unshift(o)})),e.children.length>0&&(c.TreeDatas[1]=e)}(),function(){if(console.log(u),0==u.length)return;var e={id:"mvt",label:"MVT图层",children:[]};u.forEach((function(n,t){var i={id:"mvt-"+t,label:n.name};e.children.unshift(i)})),c.TreeDatas[2]=e}(),setTimeout((function(){f.value.setCheckedNodes(c.TreeDatas);var e=f.value.getCheckedKeys(!0);v.KeysViewport1=y(e),v.KeysViewport2=y(e),v.KeysViewport3=y(e),v.KeysViewport4=y(e)}),500)}return r((function(){setTimeout((function(){w()}),500)})),t((function(){return H.changeLayers}),(function(e){w()})),t((function(){return c.multiViewport}),(function(e){viewer.scene.multiViewportMode=SuperMap3D.MultiViewportMode[e]})),t((function(){return c.selectedViewport}),(function(e,n){var t=f.value.getCheckedKeys(!0);v["KeysViewport"+n]=t,f.value.setCheckedKeys(v["KeysViewport"+e],!0)})),n((function(){s=null,l=null,u=null,v=null})),d(d({},i(c)),{},{tree:f,checkNode:function(e){var n=f.value.getNode(e);!function(e,n){var t=e[0],i=e[1];switch(t){case"s3m":if(!i){for(var o=0;o<s.length;o++)s[o].setVisibleInViewport(Number(c.selectedViewport),n);return}s[i].setVisibleInViewport(Number(c.selectedViewport),n);break;case"img":if(!i){for(var r=0;r<l.length;r++)l[r].setVisibleInViewport(Number(c.selectedViewport),n);return}l[i].setVisibleInViewport(Number(c.selectedViewport),n);break;case"mvt":if(!i){for(var a=0;a<u.length;a++)u[a].setVisibleInViewport(Number(c.selectedViewport),n);return}u[i].setVisibleInViewport(Number(c.selectedViewport),n)}}(e.id.split("-"),n.checked)}})},roller:function(a){var s,l,u,c=e({useRoller:!1,rollerMode:"lrRoller",lrRoller:"1",tbRoller:"4",TreeDatas:[]});if(a)for(var p in a)c.hasOwnProperty(p)?c[p]=a[p]:C.Message.errorMsg(ue.AttributeError+p);var f=document.getElementById("SuperMap3DContainer"),v=document.body.clientWidth-f.clientWidth,w=document.body.clientHeight-f.clientHeight,m=f.clientWidth,y=f.clientHeight,g=o(null),h=o(null),S=o(null),M=o(null),b=o(null),D=new SuperMap3D.BoundingRectangle,P={startX:.33,startY:.33,endX:.66,endY:.66,index:1,mode:1};function E(){var e,n;s=viewer.scene.layers.layerQueue,l=viewer.imageryLayers._layers,u=viewer.scene._vectorTileMaps._layerQueue,viewer.terrainProvider,c.TreeDatas.length=0,function(){if(0==s.length)return;var e={id:"s3m",label:"S3M图层",children:[]};s.forEach((function(n,t){var i={id:"s3m-"+t,label:n._name};e.children.push(i)})),c.TreeDatas[0]=e}(),function(){if(1==l.length)return;var e={id:"img",label:"IMG图层",children:[]};l.forEach((function(n,t){if(0===t)return!0;if(n._imageryProvider instanceof SuperMap3D.MvtProviderGL)return!0;var i={id:"img-"+t,label:ue.BaseMapImg};n._imageryProvider.tablename&&(i.label=n._imageryProvider.tablename),e.children.unshift(i)})),e.children.length>0&&(c.TreeDatas[1]=e)}(),function(){if(0==u.length)return;var e={id:"mvt",label:"MVT图层",children:[]};u.forEach((function(n,t){var i={id:"mvt-"+t,label:n.name};e.children.unshift(i)})),c.TreeDatas[2]=e}(),n={id:"globe-0",label:"地表"},(e={id:"globe",label:"地球",children:[]}).children.push(n),c.TreeDatas[4]=e,setTimeout((function(){g.value.setCheckedNodes(c.TreeDatas)}),500)}function x(){var e=P.startX,n=P.startY,t=P.endX,i=P.endY;switch(P.mode){case 1:SuperMap3D.BoundingRectangle.unpack([e,0,1,1],0,D);break;case 2:SuperMap3D.BoundingRectangle.unpack([0,0,e,1],0,D);break;case 4:SuperMap3D.BoundingRectangle.unpack([0,n,1,1],0,D);break;case 8:SuperMap3D.BoundingRectangle.unpack([0,0,1,n],0,D);break;case 15:SuperMap3D.BoundingRectangle.unpack([e,n,t-e,i-n],0,D);break;default:SuperMap3D.BoundingRectangle.unpack([0,0,1,1],0,D)}g.value.getCheckedKeys(!0).forEach((function(e){L(e.split("-"),!0)}))}function L(e,n){var t=e[0],i=e[1];switch(t){case"s3m":if(!i){for(var o=0;o<s.length;o++)s[o].swipeEnabled=n,s[o].swipeRegion=D;return}s[i].swipeEnabled=n,s[i].swipeRegion=D;break;case"img":if(!i){for(var r=1;r<l.length;r++)l[r].swipeEnabled=n,l[r].swipeRegion=D;return}l[i].swipeEnabled=n,l[i].swipeRegion=D;break;case"mvt":if(!i){for(var a=0;a<u.length;a++)u[a].swipeEnabled=n,u[a].swipeRegion=D;return}u[i].swipeEnabled=n,u[i].swipeRegion=D;break;case"globe":viewer.scene.globe.swipeEnabled=n,viewer.scene.globe.swipeRegion=D}}function R(e){h.value.style.display="none",S.value.style.display="none",M.value.style.display="none",b.value.style.display="none",1&e&&(h.value.style.display="block"),2&e&&(S.value.style.display="block"),4&e&&(M.value.style.display="block"),8&e&&(b.value.style.display="block")}return t((function(){return H.changeLayers}),(function(e){E()})),r((function(){!function(){function e(e){document.removeEventListener("mousemove",t,!1)}function n(e,n){P.index=n,document.addEventListener("mousemove",t,!1)}function t(e){switch(e.preventDefault?e.preventDefault():e.returnValue=!1,P.index){case 1:h.value.style.left=e.clientX-v+"px",P.startX=(e.clientX-v)/m;break;case 2:M.value.style.top=e.clientY-w+"px",P.startY=(e.clientY-w)/y;break;case 3:S.value.style.left=e.clientX-v+"px",P.endX=(e.clientX-v)/m;break;case 4:b.value.style.top=e.clientY-w+"px",P.endY=(e.clientY-w)/y}x()}h.value.addEventListener("mousedown",(function(e){n(e,1)}),!1),S.value.onmousedown=function(e){n(e,3)},M.value.onmousedown=function(e){n(e,2)},b.value.onmousedown=function(e){n(e,4)},window.addEventListener("resize",(function(){m=document.body.clientWidth-v,y=document.body.clientHeight-w})),document.addEventListener("mouseup",e,!1)}(),setTimeout((function(){E()}),500)})),t((function(){return c.multiViewport}),(function(e){viewer.scene.multiViewportMode=SuperMap3D.MultiViewportMode[e]})),t((function(){return c.selectedViewport}),(function(e,n){var t=g.value.getCheckedKeys(!0);c["KeysViewport"+n]=t,g.value.setCheckedKeys(c["KeysViewport"+e],!0)})),t((function(){return c.useRoller}),(function(e){e?(1!=P.mode&&2!=P.mode||R(1),4!=P.mode&&8!=P.mode||R(4),15==P.mode&&R(15),x()):(R(0),L(["s3m"],!1),L(["img"],!1),L(["mvt"],!1),L(["globe"],!1))})),t((function(){return c.rollerMode}),(function(e){switch(e){case"lrRoller":c.useRoller&&R(1),P.mode=Number(c.lrRoller);break;case"tbRoller":c.useRoller&&R(4),P.mode=Number(c.tbRoller);break;case"customRoller":c.useRoller&&R(15),P.mode=15}c.useRoller&&x()})),t((function(){return c.lrRoller}),(function(e){c.useRoller&&(P.mode=Number(e),x())})),t((function(){return c.tbRoller}),(function(e){c.useRoller&&(P.mode=Number(e),x())})),n((function(){s=void 0,l=void 0,u=void 0})),d(d({},i(c)),{},{tree:g,checkNode:function(e){var n=g.value.getNode(e);L(e.id.split("-"),n.checked)},verticalSliderLeft:h,verticalSliderRight:S,horizontalSliderTop:M,horizontalSliderBottom:b})},layerManage:function(a){var s,l,u,c,p,f,v=e({TreeDatas:[],expandedKeys:[]}),w=o(null),m=o(null),y=function(){},g=document.getElementById("SuperMap3DContainer"),h=document.body.clientWidth-g.clientWidth,S=document.body.clientHeight-g.clientHeight;function M(){s=viewer.scene.layers.layerQueue,l=viewer.imageryLayers._layers,c=viewer.scene._vectorTileMaps._layerQueue,u=viewer.terrainProvider,v.TreeDatas.length=0,b(),C(),D(),function(){if(!u.tablename)return;var e={id:"terrain",label:"地形图层",children:[]},n={id:"terrain-0",label:u.tablename};e.children.push(n),v.TreeDatas[3]=e}(),setTimeout((function(){w.value.setCheckedNodes(v.TreeDatas)}),500),console.log(c)}function b(){if(0!=s.length){var e={id:"s3m",label:"S3M图层",children:[]};s.forEach((function(n,t){var i={id:"s3m-"+t,label:n._name};e.children.push(i)})),v.TreeDatas[0]=e}else v.TreeDatas[0]&&w.value.remove(v.TreeDatas[0])}function C(){if(1!=l.length){var e={id:"img",label:"IMG图层",children:[]};l.forEach((function(n,t){var i=n._imageryProvider instanceof SuperMap3D.MvtProviderGL;if(0===t||i)return!0;var o={id:"img-"+t,label:ue.BaseMapImg};n._imageryProvider.tablename&&(o.label=n._imageryProvider.tablename),e.children.unshift(o)})),e.children.length>0&&(v.TreeDatas[1]=e)}else v.TreeDatas[1]&&w.value.remove(v.TreeDatas[1])}function D(){if(0!=c.length){var e={id:"mvt",label:"MVT图层",children:[]};c.forEach((function(n,t){var i={id:"mvt-"+t,label:n.name};e.children.unshift(i)})),v.TreeDatas[2]=e}else v.TreeDatas[2]&&w.value.remove(v.TreeDatas[2])}return a&&a.deleteCallback&&(y=a.deleteCallback),t((function(){return H.changeLayers}),(function(e){M()})),r((function(){setTimeout((function(){M()}),500)})),document.onclick=function(e){e.stopPropagation(),m.value.style.display="none"},n((function(){document.onclick=function(){}})),d(d({},i(v)),{},{tree:w,domContextmenu:m,checkNode:function(e){var n=w.value.getNode(e);!function(e,n){var t=e[0],i=e[1];switch(t){case"s3m":if(!i){for(var o=0;o<s.length;o++)s[o].visible=n;return}s[i].visible=n;break;case"img":if(!i){for(var r=1;r<l.length;r++)l[r].show=n;return}l[i].show=n;break;case"mvt":if(!i){for(var a=0;a<c.length;a++)c[a].show=n;return}c[i].show=n;break;case"terrain":n?viewer.terrainProvider=p:(p=viewer.terrainProvider,viewer.terrainProvider=new SuperMap3D.EllipsoidTerrainProvider)}}(e.id.split("-"),n.checked)},nodeContextmenu:function(e,n){n.id.split("-")[1]&&(f=n,m.value.style.left=e.clientX+30-h+"px",e.clientX>=1810&&(m.value.style.left=e.clientX-80-h+"px"),m.value.style.top=e.clientY-S+"px",m.value.style.display="block")},nodeClick:function(e){!function(e){var n,t=e[0],i=e[1];switch(t){case"s3m":i&&(n=s[i]);break;case"img":i&&(n=l[i]);break;case"mvt":i&&(n=c[i])}n&&viewer.flyTo(n)}(e.id.split("-"))},deleteLayer:function(){m.value.style.display="none";var e=f.id.split("-"),n=e[0],t=e[1];switch(n){case"s3m":t&&(viewer.scene.layers.remove(s[t]._name),b(),setTimeout((function(){v.expandedKeys=["s3m"],w.value.setCheckedNodes(v.TreeDatas)}),50));break;case"img":t&&(viewer.imageryLayers.remove(l[t]),C(),setTimeout((function(){w.value.setCheckedNodes(v.TreeDatas)}),50));break;case"mvt":t&&(viewer.scene.removeVectorTilesMap(c[t].name),D(),setTimeout((function(){w.value.setCheckedNodes(v.TreeDatas)}),100));break;case"terrain":viewer.terrainProvider=new SuperMap3D.EllipsoidTerrainProvider,p=null;var i=w.value.getNode(n);w.value.remove(i)}j(),y(f)}})},mvtlayerStyle:function(r){var a,s,l,u,c=e({layerNames:[],selectedLayerIndex:"none",childLayerNames:[],selectedChildLayerIndex:"none",mvtAlpha:1,showLayer:!0,textAvoidance:!0,openFilter:!1,propertyKeys:[],symbols:[],clickGetFeature:{layer:{id:null},id:null},isClickShowProperty:!0,dockFontShow:!0,bubbleShow:!1,selectedPropertyKeys:[""],selectedSymbols:[""],inputPropertys:[""],inputSymbols:[""],inputValues:[""]}),p=[],f=!1,v=o(null);function w(){(a=viewer.scene._vectorTileMaps._layerQueue)&&a.length>0?(a.forEach((function(e,n){c.layerNames.includes(e.name)||c.layerNames.push(e.name)})),console.log("init"),(c.selectedLayerIndex="none")&&(c.selectedLayerIndex=0)):c.selectedLayerIndex="none",viewer.eventManager.addEventListener("CLICK",g,!0)}function m(e){return e.slice(0,e.length-1)}function y(){if(""==c.inputPropertys[0])return!1;var e=["any"];return c.inputPropertys.forEach((function(n,t){var i=[];i[0]=c.inputSymbols[t],i[1]=n,i[2]=c.inputValues[t],"number"==typeof Number(i[2])&&(i[2]=Number(i[2])),e.push(i)})),!(e.length<2)&&e}function g(e){var n=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(SuperMap3D.defined(n)&&SuperMap3D.defined(n.pickResult)){var t=document.body.clientWidth-e.message.position.x;v.value.style.left=t>=300?e.message.position.x+"px":e.message.position.x-250+"px",v.value.style.top=e.message.position.y-220+"px",c.bubbleShow=!0;var i=null;for(var o in n.pickResult){i=n.pickResult[o];break}var r=i[0].feature;r&&(c.clickGetFeature=r),console.log(r)}else c.bubbleShow=!1}function h(){u&&(s.removeLayer(u.id),u=null)}return c.symbols=["!","!=",">",">=","<","<=","==","in","like","!like","left","right"],H.isViewer&&setTimeout((function(){return w()}),500),t((function(){return H.isViewer}),(function(e){w()})),t((function(){return H.changeLayers}),(function(e){w()})),t((function(){return c.selectedLayerIndex}),(function(e){"none"!==e&&(p.length=0,s=a[e],c.showLayer=s.show,s.readyPromise.then((function(e){e&&(s.mapboxStyle.layers.forEach((function(e,n){c.childLayerNames.includes(e.id)||c.childLayerNames.push(e.id);var t=s.getLayoutProperty(e.id,"visibility");p.push(t)})),c.selectedChildLayerIndex=0)})))})),t((function(){return c.selectedChildLayerIndex}),(function(e){l=s.mapboxStyle.layers[e];var n=s.querySourceFeatures({sourceLayer:l.id,filter:["<","$id",10]});0==n.length?c.propertyKeys=[]:c.propertyKeys=n[0]._keys.length>0?n[0]._keys:[]})),t((function(){return c.mvtAlpha}),(function(e){s&&(s.alpha=Number(e))})),t((function(){return c.showLayer}),(function(e){s&&(s.show=e)})),t((function(){return c.textAvoidance}),(function(e){if(s)for(var n=s.mapboxStyle.layers,t=0;t<n.length;t++)n[t].isOverlapDisplayed=e})),t((function(){return c.isClickShowProperty}),(function(e){if(e)return viewer.eventManager.addEventListener("CLICK",g,!0),void(c.bubbleShow=!0);viewer.eventManager.removeEventListener("CLICK",g),c.bubbleShow=!1})),t((function(){return c.selectedPropertyKeys}),(function(e,n){e.length===n.length&&e.forEach((function(e,n){c.inputPropertys[n]=e}))}),{deep:!0}),t((function(){return c.selectedSymbols}),(function(e,n){e.length===n.length&&e.forEach((function(e,n){if("left"===e||"right"===e)return""===c.inputPropertys[n]||c.inputPropertys[n].includes("left(")||c.inputPropertys[n].includes("right(")?void(c.inputPropertys[n]=e+"()"):void(c.inputPropertys[n]=e+"("+c.inputPropertys[n]+",2)");c.inputSymbols[n]=e}))}),{deep:!0}),n((function(){a=null,s=null,l=null})),d(d({},i(c)),{},{addCondition:function(e){if(!e)return c.selectedPropertyKeys=m(c.selectedPropertyKeys),c.selectedSymbols=m(c.selectedSymbols),c.inputSymbols=m(c.inputSymbols),c.inputPropertys=m(c.inputPropertys),void(c.inputValues=m(c.inputValues));c.selectedPropertyKeys=c.selectedPropertyKeys.concat([""]),c.selectedSymbols=c.selectedSymbols.concat([""]),c.inputSymbols=c.inputSymbols.concat([""]),c.inputPropertys=c.inputPropertys.concat([""]),c.inputValues=c.inputValues.concat([""])},propertySearch:function(){var e=y();e&&function(e){u&&h();if(!l)return;var n=l.id+"_highlight";u||((u=SuperMap3D.clone(l,!0)).id=n,"line"==l.type?u.paint["line-color"]="rgba(0,255,255,1.00)":"fill"==l.type?u.paint["fill-color"]="rgba(0,255,255,1.00)":u.paint["text-color"]="rgba(255,0,0,1.00)",u.layout.visibility="visible",u.minzoom=3,s.addLayer(u),s.setFilter(u.id,e))}(e)},propertyFilter:function(){var e=y();f=!0,s&&(s.mapboxStyle.layers.forEach((function(e){s.setLayoutProperty(e.id,"visibility","none")})),s.setLayoutProperty(l.id,"visibility","visible"),e&&s.setFilter(l.id,e))},clear:function(){h(),f&&(s.mapboxStyle.layers.forEach((function(e,n){s.setLayoutProperty(e.id,"visibility",p[n])})),s.setFilter(l.id,null),s.refresh(),f=!1)},bubble:v,closeBubble:function(){c.bubbleShow=!1},dockBubble:function(e){e?(v.value.classList.add("bubbleDock"),c.dockFontShow=!1):(v.value.classList.remove("bubbleDock"),c.dockFontShow=!0)}})},s3mlayerAttribute:function(o){var r,a,s=e({layerNames:[],selectedLayerName:"none",brightness:1,contrast:1,hue:0,saturation:1,gamma:1,shadowMode:"noShadow",shadowDarkness:.3,selectEnabled:!0,multiChoose:!1,cullEnabled:!1,visibility:"showAll"});if(o)for(var l in o)s.hasOwnProperty(l)?s[l]=o[l]:C.Message.errorMsg(ue.AttributeError+l);function u(){viewer.scene,(r=viewer.scene.layers.layerQueue)&&r.length>0?(r.forEach((function(e,n){s.layerNames.includes(e._name)||s.layerNames.push(e._name)})),(s.selectedLayerName="none")&&(s.selectedLayerName=s.layerNames[0],a=r[0])):s.layerNames=[]}return H.isViewer&&u(),t((function(){return H.isViewer}),(function(e){e&&u()})),t((function(){return H.changeLayers}),(function(e){u()})),n((function(){r=null})),t((function(){return s.selectedLayerName}),(function(e){var n=s.layerNames.indexOf(e);-1!=n&&(a=r[n])})),t((function(){return s.brightness}),(function(e){a&&(a.brightness=Number(e))})),t((function(){return s.contrast}),(function(e){a&&(a.contrast=Number(e))})),t((function(){return s.hue}),(function(e){a&&(a.hue=Number(e))})),t((function(){return s.saturation}),(function(e){a&&(a.saturation=Number(e))})),t((function(){return s.gamma}),(function(e){a&&(a.gamma=Number(e))})),t((function(){return s.shadowMode}),(function(e){if(a)switch(e){case"noShadow":viewer.shadows=!1,a.shadowType=SuperMap3D.ShadowType.NONE;break;case"chooseShadow":viewer.shadows=!0,a.shadowType=SuperMap3D.ShadowType.SELECTION,a.refresh();break;case"allShadow":viewer.shadows=!0,a.shadowType=SuperMap3D.ShadowType.ALL,a.refresh()}})),t((function(){return s.shadowDarkness}),(function(e){viewer.scene.shadowMap.darkness=Number(e)})),t((function(){return s.multiChoose}),(function(e){a&&(a.multiChoose=e)})),t((function(){return s.selectEnabled}),(function(e){a&&(a.selectEnabled=e)})),t((function(){return s.cullEnabled}),(function(e){a&&(a.cullEnabled=e)})),t((function(){return s.visibility}),(function(e){if(a)switch(e){case"showAll":a.setObjsVisible([],!1);break;case"onlyHideSlection":var n=a.getSelection();a.setObjsVisible(n,!1);break;case"onlyShowSlection":var t=a.getSelection();a.setObjsVisible(t,!0)}})),d({},i(s))},s3mlayerStyle:function(o){var r,a,s=this,l=e({layerNames:[],selectedLayerName:"none",foreColor:"#ffffff",lineColor:"rgba(27, 27, 27, 1)",selectedColor:"#A40FF4",selectColorMode:"mix",bottomAltitude:0,LODScale:5,layerTrans:1,fillStyle:"fill-and-wireframe",visibleDistanceMin:0,visibleDistanceMax:1e4});if(o)for(var u in o)l.hasOwnProperty(u)?l[u]=o[u]:C.Message.errorMsg(ue.AttributeError+u);function c(){viewer.scene,(r=viewer.scene.layers.layerQueue)&&r.length>0?(r.forEach((function(e,n){l.layerNames.includes(e._name)||l.layerNames.push(e._name)})),(l.selectedLayerName="none")&&(l.selectedLayerName=l.layerNames[0],a=r[0])):l.layerNames=[]}return H.isViewer&&c(),t((function(){return H.isViewer}),(function(e){e&&c()})),t((function(){return H.changeLayers}),(function(e){c()})),n((function(){r=null})),t((function(){return l.selectedLayerName}),(function(e){var n=l.layerNames.indexOf(e);-1!=n&&(a=r[n])})),t((function(){return l.foreColor}),(function(e){a&&(a.style3D.fillForeColor=SuperMap3D.Color.fromCssColorString(e))})),t((function(){return l.lineColor}),(function(e){a&&(a.style3D.lineColor=SuperMap3D.Color.fromCssColorString(e))})),t((function(){return l.selectedColor}),(function(e){a&&(a.selectedColor=SuperMap3D.Color.fromCssColorString(e))})),t((function(){return l.selectColorMode}),(function(e){a&&(a.selectColorType="mix"===e?0:1)})),t((function(){return l.bottomAltitude}),(function(e){a&&(a.style3D.bottomAltitude=Number(e)),a.refresh()})),t((function(){return l.fillStyle}),(function(e){if(a)switch(e){case"fill":a.style3D.fillStyle=SuperMap3D.FillStyle.Fill;break;case"wireframe":a.style3D.fillStyle=SuperMap3D.FillStyle.WireFrame,a.style3D.lineColor=SuperMap3D.Color.fromCssColorString(l.lineColor);break;case"fill-and-wireframe":a.style3D.fillStyle=SuperMap3D.FillStyle.Fill_And_WireFrame,a.style3D.lineColor=SuperMap3D.Color.fromCssColorString(l.lineColor)}a.refresh()})),t((function(){return l.LODScale}),(function(e){a&&(a.lodRangeScale=Number(e))})),t((function(){return l.layerTrans}),(function(e){a&&(a.style3D.fillForeColor.alpha=Number(e))})),t((function(){return l.visibleDistanceMin}),(function(e){""==e&&(e=0),a&&(a.visibleDistanceMin=Number(e))})),t((function(){return l.visibleDistanceMax}),(function(e){""==e&&(e=s.maxNumber),a&&(a.cullEnabled=e),a.visibleDistanceMax=Number(e)})),d({},i(l))},s3mlayerOperation:function(o){var r,a,s=e({layerNames:[],selectedLayerName:"none",selectedoffset:!1,offsetX:0,offsetY:0,offsetZ:0,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnit:0});if(o)for(var l in o)s.hasOwnProperty(l)?s[l]=o[l]:C.Message.errorMsg(ue.AttributeError+l);function u(){viewer.scene,(r=viewer.scene.layers.layerQueue)&&r.length>0?(r.forEach((function(e,n){s.layerNames.includes(e._name)||s.layerNames.push(e._name)})),(s.selectedLayerName="none")&&(s.selectedLayerName=s.layerNames[0],a=r[0])):s.layerNames=[]}function c(){var e=a.getSelection();a.removeAllObjsOffset(),e.length>0&&a.setObjsOffset(e)}return H.isViewer&&u(),t((function(){return H.isViewer}),(function(e){e&&u()})),t((function(){return H.changeLayers}),(function(e){u()})),n((function(){r=null})),t((function(){return s.selectedLayerName}),(function(e){var n=s.layerNames.indexOf(e);-1!=n&&(a=r[n])})),t((function(){return s.selectedoffset}),(function(e){if(a)if(e){var n=Number(s.offsetX),t=Number(s.offsetY),i=Number(s.offsetZ);a.selectedTranslate=new SuperMap3D.Cartesian3(n,t,i),viewer.eventManager.addEventListener("CLICK",c,!0),c()}else viewer.eventManager.removeEventListener("CLICK",c),a.selectedTranslate=new SuperMap3D.Cartesian3(0,0,0),a.removeAllObjsOffset(),a.releaseSelection()})),t((function(){return s.offsetX}),(function(e){if(s.selectedoffset){var n=Number(e),t=Number(s.offsetY),i=Number(s.offsetZ);a.selectedTranslate=new SuperMap3D.Cartesian3(n,t,i)}})),t((function(){return s.offsetY}),(function(e){if(s.selectedoffset){var n=Number(s.offsetX),t=Number(s.offsetY),i=Number(s.offsetZ);a.selectedTranslate=new SuperMap3D.Cartesian3(n,t,i)}})),t((function(){return s.offsetZ}),(function(e){if(s.selectedoffset){var n=Number(s.offsetX),t=Number(s.offsetY),i=Number(s.offsetZ);a.selectedTranslate=new SuperMap3D.Cartesian3(n,t,i)}})),t((function(){return s.polygonOffset}),(function(e){a&&(e?a.setPolygonoffset(Number(s.polygonOffsetFactor),Number(e)):a.setPolygonoffset(0,0))})),t((function(){return s.polygonOffsetFactor}),(function(e){a&&s.polygonOffset&&a.setPolygonoffset(Number(e),Number(s.polygonOffsetUnit))})),t((function(){return s.polygonOffsetUnit}),(function(e){a&&s.polygonOffset&&a.setPolygonoffset(Number(s.polygonOffsetFactor),Number(e))})),d({},i(s))},modelFlood:function(o){var r,a,s=e({layerNames:[],selectedLayerName:"none",maxHeight:200,minHeight:0,floodHeight:[0,200],currentHeight:0,floodSpeed:1,floodTrans:.8,cheackedBand:"band1",colorBandShow:!1,floodPositions:[],lineVisible:!0});if(o)for(var l in o)s.hasOwnProperty(l)?s[l]=o[l]:C.Message.errorMsg(ue.AttributeError+l);var u,c=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE,p=new SuperMap3D.HypsometricSetting,f=new SuperMap3D.ColorTable;f.insert(500,new SuperMap3D.Color(0,39/255,148/255)),f.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));var v=[];function w(){viewer.scene,(r=viewer.scene.layers.layerQueue)&&r.length>0&&(r.forEach((function(e,n){s.layerNames.includes(e._name)||s.layerNames.push(e._name)})),(s.selectedLayerName="none")&&(s.selectedLayerName=s.layerNames[0],a=r[0]))}function m(e){e&&(v=e),p.CoverageArea=e;var n=Number(s.minHeight);u=setInterval("ModelFlood()",100),window.ModelFlood=function(){if(n>s.maxHeight)return s.currentHeight=s.maxHeight,void clearInterval(u);s.currentHeight=Number(n.toFixed(2)),p.MaxVisibleValue=n;try{y()}catch(e){console.log(e),clearInterval(u)}n+=parseFloat(s.floodSpeed)/10}}function y(){0!=v.length&&(a.hypsometricSetting={hypsometricSetting:p,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})}return H.isViewer&&w(),t((function(){return H.isViewer}),(function(e){e&&w()})),t((function(){return H.changeLayers}),(function(e){w()})),n((function(){r=null,p.destroy(),f.destroy(),p=void 0,f=void 0})),t((function(){return s.selectedLayerName}),(function(e){var n=s.layerNames.indexOf(e);-1!=n&&(a=r[n])})),t((function(){return s.maxHeight}),(function(e){p.MaxVisibleValue=parseInt(e),y()})),t((function(){return s.minHeight}),(function(e){p.MinVisibleValue=parseInt(e),s.currentHeight=parseInt(e),y()})),t((function(){return s.floodHeight}),(function(e){s.minHeight=e[0],s.maxHeight=e[1]})),t((function(){return s.floodTrans}),(function(e){p.Opacity=parseFloat(e),y()})),t((function(){return s.cheackedBand}),(function(e){f=function(e){var n=new SuperMap3D.ColorTable;switch(e){case"band1":n.insert(500,new SuperMap3D.Color(0,39/255,148/255)),n.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));break;case"band2":n.insert(500,new SuperMap3D.Color(162/255,251/255,194/255)),n.insert(0,new SuperMap3D.Color(1,103/255,103/255));break;case"band3":n.insert(500,new SuperMap3D.Color(230/255,198/255,1)),n.insert(0,new SuperMap3D.Color(157/255,0,1));break;case"band4":n.insert(500,new SuperMap3D.Color(210/255,15/255,15/255)),n.insert(100,new SuperMap3D.Color(221/255,224/255,7/255)),n.insert(50,new SuperMap3D.Color(20/255,187/255,18/255)),n.insert(4e3,new SuperMap3D.Color(0,161/255,1)),n.insert(0,new SuperMap3D.Color(9/255,9/255,212/255));break;case"band5":n.insert(500,new SuperMap3D.Color(186/255,1,229/255)),n.insert(0,new SuperMap3D.Color(26/255,185/255,156/255));break;default:n.insert(500,new SuperMap3D.Color(0,39/255,148/255)),n.insert(0,new SuperMap3D.Color(149/255,232/255,249/255))}return n}(e),p.ColorTable=f,y()})),d(d({},i(s)),{},{floodClear:function(e){e.preventDefault(),a.hypsometricSetting.hypsometricSetting.MaxVisibleValue=-1e3,clearInterval(u),v=[],s.currentHeight=Number(s.floodHeight[0]),window.handlerPolygon&&me("Polygon")},floodBegin:function(e){e.preventDefault(),p.DisplayMode=c,p._lineColor=new SuperMap3D.Color(1,0,0,1),p.MinVisibleValue=Number(s.floodHeight[0]),p.MaxVisibleValue=0,p.ColorTableMinKey=0,p.ColorTableMaxKey=200,p.ColorTable=f,p.Opacity=Number(s.floodTrans),p.LineInterval=10,window.handlerPolygon||ve("Polygon"),o&&o.floodPositions?m(o.floodPositions):(we("Polygon",s.lineVisible).then((function(e){var n=window.handlerPolygon;m(e.positions),n.polygon.show=!1,n.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||C.Message.errorMsg(ue.NoPickPositionSupported))},changeColor:function(e){s.colorBandShow=!1,s.cheackedBand=e},floodPosition:v})},photography:function(o){var r=e({layerNames:[],selectedLayerName:"none",operationType:"Excavation",lineVisible:!0});if(o)for(var a in o)r.hasOwnProperty(a)?r[a]=o[a]:C.Message.errorMsg(ue.AttributeError+a);var s,l,u=[],c=[];function p(){viewer.scene,(s=viewer.scene.layers.layerQueue)&&s.length>0&&(s.forEach((function(e,n){r.layerNames.includes(e._name)||r.layerNames.push(e._name)})),(r.selectedLayerName="none")&&(r.selectedLayerName=r.layerNames[0],l=s[0]))}function f(e){e&&(u=e),l.addExcavationRegion({position:e,name:"excavation_"+Math.random()})}function v(e){e&&(c=e),l.addFlattenRegion({position:e,name:"flatten"+Math.random()})}return H.isViewer&&p(),t((function(){return H.isViewer}),(function(e){e&&p()})),t((function(){return H.changeLayers}),(function(e){p()})),t((function(){return r.selectedLayerName}),(function(e){var n=r.layerNames.indexOf(e);-1!=n&&(l=s[n])})),n((function(){s=null})),d(d({},i(r)),{},{startExcavation:function(e){e.preventDefault(),window.handlerPolygon||ce("Polygon"),o&&o.excavationPositions?f(o.excavationPositions):(pe("Polygon",r.lineVisible).then((function(e){var n=window.handlerPolygon;f(e.positions),n.polygon.show=!1,n.polyline.show=!1,n.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||C.Message&&C.Message.errorMsg(ue.NoPickPositionSupported))},clearExcavation:function(e){e.preventDefault(),u=[],window.handlerPolygon&&(l.removeAllExcavationRegion(),de("Polygon"))},startFlatten:function(e){e.preventDefault(),window.handlerPolygon||ce("Polygon"),o&&o.flattenPositions?v(o.flattenPositions):(pe("Polygon",r.lineVisible).then((function(e){var n=window.handlerPolygon;v(e.positions),n.polygon.show=!1,n.polyline.show=!1}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||C.Message&&C.Message.errorMsg(ue.NoPickPositionSupported))},clearFlatten:function(e){e.preventDefault(),window.handlerPolygon&&(l.removeAllFlattenRegion(),de("Polygon"))},excavationPositions:u,flattenPositions:c})},imglayerAttribute:function(o){var r,a,s=e({layerNames:[],selectedLayerName:"none",brightness:1,contrast:1,hue:0,saturation:1,gamma:1,alpha:1,transparentBackColor:"#eecccc",transparentBackColorTolerance:0});if(o)for(var l in o)s.hasOwnProperty(l)?s[l]=o[l]:C.Message.errorMsg(ue.AttributeError+l);function u(){viewer.scene,(r=viewer.imageryLayers._layers)&&r.length>1&&(r.forEach((function(e,n){var t=e._imageryProvider instanceof SuperMap3D.MvtProviderGL;if(0===n||t)return!0;s.layerNames.includes(e._imageryProvider.tablename)||s.layerNames.push(e._imageryProvider.tablename)})),(s.selectedLayerName="none")&&(s.selectedLayerName=s.layerNames[0],a=r[1]))}return H.isViewer&&u(),t((function(){return H.isViewer}),(function(e){e&&u()})),t((function(){return H.changeLayers}),(function(e){u()})),n((function(){r=null})),t((function(){return s.selectedLayerName}),(function(e){var n=s.layerNames.indexOf(e);-1!=n&&(a=r[n+1])})),t((function(){return s.brightness}),(function(e){a&&(a.brightness=Number(e))})),t((function(){return s.contrast}),(function(e){a&&(a.contrast=Number(e))})),t((function(){return s.hue}),(function(e){a&&(a.hue=Number(e))})),t((function(){return s.saturation}),(function(e){a&&(a.saturation=Number(e))})),t((function(){return s.gamma}),(function(e){a&&(a.gamma=Number(e))})),t((function(){return s.alpha}),(function(e){a&&(a.alpha=Number(e))})),t((function(){return s.transparentBackColor}),(function(e){var n=SuperMap3D.Color.fromCssColorString(e);a&&(a.transparentBackColor=n)})),t((function(){return s.transparentBackColorTolerance}),(function(e){a&&(a.transparentBackColorTolerance=Number(e))})),d({},i(s))},sceneAttribute:function(o){var r=e({earthShow:!0,shadows:!1,cloud:!1,skyBox:!1,sunShow:!1,timeline:!1,depthAgainst:!0,atomsphereRender:!0,fogEffect:!0,underground:!0,frameRate:!1,rain:!1,snow:!1,surfaceTransparency:1,cloudsUrl:"public/img/skyboxs/clouds/clouds1.png",skyboxSources:null,skyboxType:"bluesky",uspeed:0,vspeed:0,wspeed:.5,viewMode:"3D",rainAngle:45,rainSpeed:8,snowDesity:10,snowSpeed:4,snowAngle:10,snowType:"0",compass:!1,isCompass:""});if(r.skyboxSources={bluesky:{positiveX:"public/img/skyboxs/bluesky/Right.jpg",negativeX:"public/img/skyboxs/bluesky/Left.jpg",positiveY:"public/img/skyboxs/bluesky/Front.jpg",negativeY:"public/img/skyboxs/bluesky/Back.jpg",positiveZ:"public/img/skyboxs/bluesky/Up.jpg",negativeZ:"public/img/skyboxs/bluesky/Down.jpg"},sunsetglow:{positiveX:"public/img/skyboxs/sunsetglow/Right.jpg",negativeX:"public/img/skyboxs/sunsetglow/Left.jpg",positiveY:"public/img/skyboxs/sunsetglow/Front.jpg",negativeY:"public/img/skyboxs/sunsetglow/Back.jpg",positiveZ:"public/img/skyboxs/sunsetglow/Up.jpg",negativeZ:"public/img/skyboxs/sunsetglow/Down.jpg"}},o)for(var a in o)r.hasOwnProperty(a)?r[a]=o[a]:C.Message.errorMsg(ue.AttributeError+a);var s,l=new SuperMap3D.CloudBox({url:r.cloudsUrl}),u={};for(var c in r.skyboxSources){var p=new SuperMap3D.SkyBox({sources:r.skyboxSources[c]});p.USpeed=r.uspeed,p.VSpeed=r.vspeed,p.WSpeed=r.wspeed,u[c]=p}function f(){if(viewer.scene.frameState.passes.render){for(var e in u)u[e].update(viewer.scene.frameState,!0),u[e].show=!1;viewer.scene.postRender.removeEventListener(f)}}function v(){r.skyBox&&(viewer.scene.camera.positionCartographic.height>22e4?(viewer.scene.skyBox.show=!1,r.atomsphereRender=!0):(viewer.scene.skyBox.show=!0,r.atomsphereRender=!1))}H.isViewer&&(s=viewer.scene.skyBox,viewer.scene.postRender.addEventListener(f),viewer.scene.postProcessStages.snow.uniforms.density=parseFloat(r.snowDesity),viewer.scene.postProcessStages.snow.uniforms.speed=parseFloat(r.snowSpeed),viewer.scene.postProcessStages.rain.uniforms.speed=parseFloat(r.rainSpeed),v());for(var w=viewer.scene.layers.layerQueue,m=0;m<w.length;m++)w[m].shadowType=2;return t((function(){return H.isViewer}),(function(e){e&&(s=viewer.scene.skyBox,viewer.scene.postRender.addEventListener(f),viewer.scene.postProcessStages.snow.uniforms.density=parseFloat(r.snowDesity),viewer.scene.postProcessStages.snow.uniforms.speed=parseFloat(r.snowSpeed),viewer.scene.postProcessStages.rain.uniforms.speed=parseFloat(r.rainSpeed),v())})),n((function(){for(var e in l.destroy(),u)u[e].destroy();viewer.scene.skyBox=s})),t((function(){return r.earthShow}),(function(e){viewer.scene.globe.show=e})),t((function(){return r.shadows}),(function(e){e?(viewer.shadows=!0,viewer.pcss=!0,viewer.shadowQuality=0,viewer.scene.shadowMap.maximumDistance=2e3,viewer.shadowMap.darkness=.4,viewer.shadowMap.penumbraRatio=.1):viewer.shadows=!1})),t((function(){return r.sunShow}),(function(e){viewer.scene.globe.enableLighting=e})),t((function(){return r.timeline}),(function(e){var n=document.getElementsByClassName("supermap3d-viewer-timelineContainer")[0];e?(n.style.visibility="visible",n.style["z-index"]=99999999999):n.style.visibility="hidden"})),t((function(){return r.depthAgainst}),(function(e){viewer.scene.globe.depthTestAgainstTerrain=e})),t((function(){return r.atomsphereRender}),(function(e){viewer.scene.skyAtmosphere.show=e})),t((function(){return r.fogEffect}),(function(e){viewer.scene.fog.enabled=e})),t((function(){return r.surfaceTransparency}),(function(e){viewer.scene.globe.globeAlpha=parseFloat(e)})),t((function(){return r.underground}),(function(e){viewer.scene.undergroundMode=e,e?(viewer.scene.screenSpaceCameraController.minimumZoomDistance=-1e3,viewer.scene.terrainProvider.isCreateSkirt=!1):(viewer.scene.screenSpaceCameraController.minimumZoomDistance=1,viewer.scene.terrainProvider.isCreateSkirt=!0)})),t((function(){return r.frameRate}),(function(e){viewer.scene.debugShowFramesPerSecond=e})),t((function(){return r.cloud}),(function(e){viewer.scene.cloudBox=e?l:null})),t((function(){return r.cloudsUrl}),(function(e){viewer.scene.cloudBox.url=e})),t((function(){return r.skyBox}),(function(e){if(e){var n=viewer.scene.camera.positionCartographic.height;viewer.scene.postRender.addEventListener(v),viewer.scene.skyBox=u[r.skyboxType],n<22e4?(viewer.scene.skyBox.show=!0,r.atomsphereRender=!1):r.atomsphereRender=!0}else r.atomsphereRender=!0,viewer.scene.skyBox.show=!1,viewer.scene.skyBox=s,viewer.scene.postRender.removeEventListener(v)})),t((function(){return r.skyboxType}),(function(e){r.skyBox&&(u[e].show=!0,viewer.scene.skyBox=u[e])})),t((function(){return r.uspeed}),(function(e){u[r.skyboxType].USpeed=Number(e),r.skyBox&&(viewer.scene.skyBox.USpeed=Number(e))})),t((function(){return r.vspeed}),(function(e){u[r.skyboxType].VSpeed=Number(e),r.skyBox&&(viewer.scene.skyBox.VSpeed=Number(e))})),t((function(){return r.wspeed}),(function(e){u[r.skyboxType].WSpeed=Number(e),r.skyBox&&(viewer.scene.skyBox.WSpeed=Number(e))})),t((function(){return r.viewMode}),(function(e){viewer.scene.mode="2D"===e?SuperMap3D.SceneMode.SCENE2D:"3D"===e?SuperMap3D.SceneMode.SCENE3D:SuperMap3D.SceneMode.COLUMBUS_VIEW})),t((function(){return r.rain}),(function(e){viewer.scene.postProcessStages.rain.enabled=e})),t((function(){return r.snow}),(function(e){viewer.scene.postProcessStages.snow.enabled=e,console.log(viewer.scene.postProcessStages.snow.uniforms)})),t((function(){return r.rainAngle}),(function(e){viewer.scene.postProcessStages.rain.uniforms.angle=parseFloat(e)})),t((function(){return r.rainSpeed}),(function(e){viewer.scene.postProcessStages.rain.uniforms.speed=parseFloat(e)})),t((function(){return r.snowDesity}),(function(e){viewer.scene.postProcessStages.snow.uniforms.density=parseFloat(e)})),t((function(){return r.snowSpeed}),(function(e){viewer.scene.postProcessStages.snow.uniforms.speed=parseFloat(e)})),t((function(){return r.snowAngle}),(function(e){viewer.scene.postProcessStages.snow.uniforms.angle=parseFloat(e)})),t((function(){return r.snowType}),(function(e){switch(e){case"0":r.snowDesity=5,r.snowSpeed=2;break;case"1":r.snowDesity=10,r.snowSpeed=4;break;case"2":r.snowDesity=15,r.snowSpeed=6;break;case"3":r.snowDesity=20,r.snowSpeed=10;break;default:r.snowDesity=5,r.snowSpeed=2}})),t((function(){return r.isCompass}),(function(e){r.compass=e?"Sm3dCompass":""})),d({},i(r))},facade:function(o){var r,a,s,l=e({maxDistance:200,maxHeight:100,setLodrange:!1,layerNames:[],selectedLayerName:"none",lodrange:.01});if(o)for(var u in o)l.hasOwnProperty(u)?l[u]=o[u]:C.Message.errorMsg(ue.AttributeError+u);function c(){viewer.scene,(a=viewer.scene.layers.layerQueue)&&a.length>0&&(a.forEach((function(e,n){l.layerNames.includes(e._name)||l.layerNames.push(e._name)})),(l.selectedLayerName="none")&&(l.selectedLayerName=l.layerNames[0],s=a[0]))}function p(){r.clear(),de("Polyline"),tooltip.setVisible(!1)}return H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element)),(r=new SuperMap3D.Facade(viewer.scene)).build(),c()),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)),(r=new SuperMap3D.Facade(viewer.scene)).build(),c())})),t((function(){return H.changeLayers}),(function(e){c()})),n((function(){p(),r.destroy()})),t((function(){return l.maxDistance}),(function(e){r.farDistance=Number(e)})),t((function(){return l.maxHeight}),(function(e){r.maxHeight=Number(e)})),t((function(){return l.selectedLayerName}),(function(e){var n=l.layerNames.indexOf(e);-1!=n&&(s=a[n])})),t((function(){return l.lodrange}),(function(e){s&&s.setLodRangeScale(Number(e))})),t((function(){return l.setLodrange}),(function(e){s&&(e?s.setLodRangeScale(Number(l.lodrange)):s.setLodRangeScale(1))})),d(d({},i(l)),{},{setRegion:function(){tooltip.showAt(" <p>点击鼠标左键开始绘制起点</p><p>绘制两点确定区域宽度</p> <p>单击右键结束分析</p><p>设置模型精细度调整图片清晰度</p>","350px"),window.handlerPolyline||ce("Polyline"),pe("Polyline").then((function(e){var n=e.result.object.positions[0],t=e.result.object.positions[1];r.startPoint=n,r.endPoint=t;var i=window.handlerPolyline;i.polyline.show=!1,window.polylineTransparent.show=!1,i.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()},execute:function(){r.readyPromise.then((function(e){!function(e){var n=new Image;n.src=e,n.onload=function(){var e=function(e){var n=document.createElement("canvas");return n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0),n}(n).toDataURL("image/jpeg"),t=document.createElement("a"),i=new MouseEvent("click");t.download=(new Date).getTime()+".jpg",t.href=e,t.dispatchEvent(i)}}(e)}))},clear:p})},compass:function(r){var a,s,l=e({resetPosition:"",isfull:!1});if(l.resetPosition=new SuperMap3D.Cartesian3.fromDegrees(110.60396458865515,34.54408834959379,30644793.325518917),r)for(var u in r)l.hasOwnProperty(u)?l[u]=r[u]:C.Message.errorMsg(ue.AttributeError+u);l.isfull&&g();var c,p,f=o(null),v=!1;function w(){(s=new SuperMap3D.Cartesian2).x=a.canvas.clientWidth/2,s.y=a.canvas.clientHeight/2,a.postRender.addEventListener(m),window.addEventListener("resize",(function(){s.x=a.canvas.clientWidth/2,s.y=a.canvas.clientHeight/2}))}function m(){var e=a.camera.heading,n="rotate("+-SuperMap3D.Math.toDegrees(e)+"deg)";f.value.style.transform=n,v&&(e<=.05||e>=6.23)&&(a.camera.stopFlyCircle(),e=0,v=!1)}function y(){var e=a.pickPosition(s),n=viewer.camera.position,t=SuperMap3D.Cartesian3.distance(e,n);return t>=1e3?t/30:t>=20?t/20:t>0?.5:0}function g(){var e;document.fullscreenElement?(l.isfull=!1,document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()):(l.isfull=!0,(e=document.documentElement).requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen())}return H.isViewer&&(a=viewer.scene,w()),t((function(){return H.isViewer}),(function(e){e&&(a=viewer.scene,w())})),n((function(){a.postRender.removeEventListener(m)})),d(d({},i(l)),{},{compass_dom:f,reduceCompass:function(){var e=a.camera.heading,n=8;if(!(e<=.05||e>=6.23)){(e<=.5||e>=5.8)&&(n=2),v=!0;var t=a.pickPosition(s);if(a.camera.heading-SuperMap3D.Math.PI>=0)return a.camera.speedRatio=n,void a.camera.flyCircle(t);a.camera.speedRatio=-n,a.camera.flyCircle(t)}},reset:function(){viewer.camera.flyTo({destination:l.resetPosition})},fullscreenchange:g,zoomIn:function(){var e=10;clearInterval(c),c=setInterval((function(){e=y(),viewer.camera.zoomIn(e)}),30)},mouseup_zoomIn:function(){clearInterval(c)},zoomOut:function(){var e=10;clearInterval(p),p=setInterval((function(){e=y(),viewer.camera.zoomOut(e)}),30)},mouseup_zoomOut:function(){clearInterval(p)}})},flyRoute:function(a){var s,l,u=e({routeType:"designatedRoute",fileSrc:"",fpfUrl:null,selectedStopIndex:0,showRoute:!1,showStop:!1,currentStopNames:[],customRouteNames:[],customRouteSelectedIndex:null,routeStops:[],selectedAddedStopIndex:null,setStopName:"Stop-1",setStopSpeed:0,stopPlayMode:"StopPause",waitTime:0,surroundDuration:1,isAlongline:!1,routeSpeed:200});if(a)for(var c in a)u.hasOwnProperty(c)?u[c]=a[c]:C.Message.errorMsg(ue.AttributeError+c);var p,f,v=o(null),w=new FileReader,m=[];function y(){l=new SuperMap3D.RouteCollection(viewer.entities),s=new SuperMap3D.FlyManager({scene:viewer.scene,routes:l}),f=new Se,u.fpfUrl&&g()}function g(){s.stop(),l.fromFile(u.fpfUrl),s.readyPromise.then((function(){var e=s.currentRoute;e.isLineVisible=u.showRoute,e.isStopVisible=u.showStop,S()}))}function h(){l.readyPromise.then((function(){s.routes=l;var e=s.currentRoute;e.isLineVisible=u.showRoute,e.isStopVisible=u.showStop,S()}))}function S(){u.currentStopNames.length=0;for(var e=0,n=(p=s.getAllRouteStops()).length;e<n;e++){var t=p[e].stopName||"Stop"+(e+1);u.currentStopNames.push(t)}}function M(){if(s.stop(),!(m.length<1))if(m.splice(u.customRouteSelectedIndex,1),u.customRouteNames.splice(u.customRouteSelectedIndex,1),m.length>0)u.customRouteSelectedIndex=0;else{u.customRouteSelectedIndex=null,u.currentStopNames.length=0;var e=s.currentRoute;e&&e.clear()}}return H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element)),y()),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)),y())})),r((function(){v.value.addEventListener("change",(function(e){s.stop();var n=s.currentRoute;n&&n.clear(),l=new SuperMap3D.RouteCollection(viewer.entities);var t=e.target.files[0];t&&(u.fileSrc=v.value.value,w.onload=function(e){var n=e.target.result;l.fromXML(n)},w.readAsBinaryString(t),h())}))})),t((function(){return u.selectedStopIndex}),(function(e){s&&s.stop();var n=Number(e),t=p[n];s.viewToStop(t)})),t((function(){return u.showRoute}),(function(e){var n=s.currentRoute;n&&(n.isLineVisible=e)})),t((function(){return u.showStop}),(function(e){var n=s.currentRoute;n&&(n.isStopVisible=e)})),t((function(){return u.fpfUrl}),(function(e){g()})),t((function(){return u.customRouteSelectedIndex}),(function(e){if(null!==e){s&&s.stop();var n=s.currentRoute;n&&n.clear(),(l=new SuperMap3D.RouteCollection(viewer.entities)).fromXML(m[e]),h()}})),t((function(){return u.selectedAddedStopIndex}),(function(e){var n=u.routeStops[e];n&&viewer.camera.setView({destination:SuperMap3D.Cartesian3.fromDegrees(n.point[0],n.point[1],n.point[2]),orientation:{heading:n.heading,pitch:n.tilt,roll:0}})})),t((function(){return u.routeType}),(function(e){"customRoute"===e?(window.tooltip.showAt(" <p>调整当前相机位置和视角</p><p>以当前相机位置和视角设置站点</p><p>点击添加保存此站点</p>","80%"),setTimeout((function(){window.tooltip.setVisible(!1)}),5e3)):window.tooltip.setVisible(!1);var n=s.currentRoute;n&&(n.isLineVisible=!1,n.isStopVisible=!1)})),n((function(){u=null,s=l=null,p=null,f=m=null})),d(d({},i(u)),{},{flyFile_dom:v,chooseFile:function(){v.value.click()},flyStart:function(){s.readyPromise.then((function(){s.play()}))},flyPause:function(){s&&s.pause()},flyStop:function(){s&&s.stop()},addStop:function(){s.stop();var e=viewer.camera.position,n=C.CartesiantoDegrees(e),t={stopName:u.setStopName,point:n,heading:viewer.camera.heading,tilt:viewer.camera.pitch,speed:u.setStopSpeed,stopPlayMode:u.stopPlayMode,surroundDuration:u.surroundDuration,waitTime:u.waitTime};if(u.routeStops.push(t),u.routeStops.length>0){var i=u.routeStops.length,o=u.routeStops[i-1].stopName.split("-")[1]||1,r="Stop-"+(Number(o)+1);u.setStopName=r}u.selectedAddedStopIndex=u.routeStops.length-1},saveStop:function(){if(u.routeStops.length<2)C.Message.warnMsg("节点小于2");else{m.length>0&&M();var e={routeName:"飞行路线_"+(m.length+1),speed:u.routeSpeed,isAlongLine:"False",routeStops:u.routeStops},n=f.createXMLflyLine(e);m.push(n),u.customRouteNames.push(e.routeName),null===u.customRouteSelectedIndex&&(u.customRouteSelectedIndex=0)}},restStops:function(){u.routeStops.length=0,u.setStopName="Stop-1",u.setStopSpeed=0,u.stopPlayMode="StopPause",u.waitTime=0,u.surroundDuration=1},downLoad:function(){var e=m[u.customRouteSelectedIndex];if(e){var n=new Blob([e]),t=document.createElement("a");t.download="fly-route.fpf",t.href=URL.createObjectURL(n),t.click()}},clearRoute:M,clearStop:function(){u.routeStops.splice(u.selectedAddedStopIndex,1),u.routeStops.length>0?u.selectedAddedStopIndex=u.routeStops.length-1:(u.selectedAddedStopIndex=null,u.setStopName="Stop-1")}})},drawLineSrface:function(o){var r=e({drawModle:"space",currentId:"1",config:Me,lineColor:"rgba(250, 196, 65, 1)",lineWidth:5,dottedColor:"rgba(250, 196, 65, 0)",dottedLength:30,outLineColor:"rgba(29, 206, 200, 1)",outLineWidth:2,glowStrength:.5,trailPercentage:.3,trailPeroid:2,isEdit:!0,isEditZ:!1,drawType:"polyline",solidColor:"rgba(250, 196, 65, 1)",gridColor:"rgba(250, 196, 65, 1)",gridWidth:1,gridCount:8,gridCellAlpha:.1,stripeEvenColor:"#FFFFFF",stripeOddColor:"#000000",stripeRepeat:12,stripeOffset:0,stripeOrientation:"horizontal"});if(o)for(var a in o)r.hasOwnProperty(a)?r[a]=o[a]:C.Message.errorMsg(ue.AttributeError+a);var s=void 0,l=void 0,u=!0,c=(SuperMap3D.ClassificationType.TERRAIN,void 0),p=void 0,f=void 0;function v(){window.handlerPolyline||ce("Polyline"),window.tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>右键单击结束分析</p><p>选中对象进行编辑或清除</p>","50%"),pe("Polyline").then((function(e){!function(e){var n,t=SuperMap3D.Color.fromCssColorString(r.lineColor),i=Number(r.lineWidth);switch(r.currentId){case"1":n=t;break;case"2":var o=SuperMap3D.Color.fromCssColorString(r.dottedColor),a=Number(r.dottedLength);n=new SuperMap3D.PolylineDashMaterialProperty({color:t,gapColor:o,dashLength:a});break;case"3":var u=SuperMap3D.Color.fromCssColorString(r.outLineColor),p=Number(r.outLineWidth);n=new SuperMap3D.PolylineOutlineMaterialProperty({color:t,outlineWidth:p,outlineColor:u});break;case"4":n=new SuperMap3D.PolylineArrowMaterialProperty(t);break;case"5":var d=Number(r.glowStrength);n=new SuperMap3D.PolylineGlowMaterialProperty({glowPower:d,color:t});break;case"6":var v=Number(r.trailPercentage);n=new SuperMap3D.PolylineTrailMaterialProperty({color:t,trailLength:v,period:r.trailPeroid});break;default:n=t}c=viewer.entities.add({id:"polyline-symbol-line-"+(new Date).getTime(),polyline:{positions:e,width:i,material:n,clampToGround:s,classificationType:l,height:f}})}(e.result.object.positions);var n=window.handlerPolyline;n.polyline.show=!1,window.polylineTransparent.show=!1,n.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()}function w(e){var n=viewer.scene.pick(e.message.position);n&&n.id&&n.id.id&&"string"==typeof n.id.id&&(-1!=n.id.id.indexOf("polyline-symbol-line")&&(c=n.id),-1!=n.id.id.indexOf("polygon-symbol-gon")&&(p=n.id))}function m(e,n,t){s=e,l=n,f=t,c&&(c.polyline.clampToGround=s,c.polyline.classificationType=l,c.polyline.height=t)}function y(e,n,t){u=e,l=n,f=t,p&&(p.polygon.perPositionHeight=u,p.classificationType=l,p.polygon.height=t)}return H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element)),viewer.eventManager.addEventListener("CLICK",w,!1),ye()),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)),viewer.eventManager.addEventListener("CLICK",w,!1),ye())})),n((function(){viewer&&viewer.eventManager.removeEventListener("CLICK",w)})),t((function(){return r.drawModle}),(function(e){var n="polyline"===r.drawType;switch(e){case"space":n?m(void 0,void 0,void 0):y(!0,void 0,void 0);break;case"stick":n?m(!0,SuperMap3D.ClassificationType.TERRAIN,0):y(!1,SuperMap3D.ClassificationType.TERRAIN,0);break;case"postObject":n?m(!0,SuperMap3D.ClassificationType.S3M_TILE,void 0):y(!1,SuperMap3D.ClassificationType.S3M_TILE,void 0);break;default:m(void 0,void 0,void 0),y(!0,!1,void 0)}})),t((function(){return r.lineColor}),(function(e){var n=SuperMap3D.Color.fromCssColorString(e);c&&(c.polyline.material.color=n)})),t((function(){return r.lineWidth}),(function(e){c&&(c.polyline.width=Number(e))})),t((function(){return r.dottedColor}),(function(e){var n=SuperMap3D.Color.fromCssColorString(e);c&&(c.polyline.material.gapColor=n)})),t((function(){return r.dottedLength}),(function(e){c&&(c.polyline.material.dashLength=Number(e))})),t((function(){return r.outLineColor}),(function(e){var n=SuperMap3D.Color.fromCssColorString(e);c&&(c.polyline.material.outlineColor=n)})),t((function(){return r.outLineWidth}),(function(e){c&&(c.polyline.material.outlineWidth=Number(e))})),t((function(){return r.glowStrength}),(function(e){c&&(c.polyline.material.glowPower=Number(e))})),t((function(){return r.trailPercentage}),(function(e){c&&(c.polyline.material.trailLength=Number(e))})),t((function(){return r.isEdit}),(function(e){c&&(e?ye():ge())})),t((function(){return r.isEditZ}),(function(e){c&&window.editHandler&&(window.editHandler.isEditZ=e)})),t((function(){return r.drawType}),(function(e){r.currentId="1"})),t((function(){return r.solidColor}),(function(e){var n=SuperMap3D.Color.fromCssColorString(e);p&&(p.polygon.material=n)})),t((function(){return r.gridColor}),(function(e){var n=SuperMap3D.Color.fromCssColorString(e);p&&(p.polygon.material.color=n)})),t((function(){return r.gridWidth}),(function(e){p&&(p.polygon.material.lineThickness=new SuperMap3D.Cartesian2(Number(e),Number(e)))})),t((function(){return r.gridCount}),(function(e){p&&(p.polygon.material.lineCount=new SuperMap3D.Cartesian2(Number(e),Number(e)))})),t((function(){return r.gridCellAlpha}),(function(e){p&&(p.polygon.material.cellAlpha=Number(e))})),t((function(){return r.stripeEvenColor}),(function(e){var n=SuperMap3D.Color.fromCssColorString(e);p&&(p.polygon.material.evenColor=n)})),t((function(){return r.stripeOddColor}),(function(e){var n=SuperMap3D.Color.fromCssColorString(e);p&&(p.polygon.material.oddColor=n)})),t((function(){return r.stripeRepeat}),(function(e){p&&(p.polygon.material.repeat=Number(e))})),t((function(){return r.stripeOffset}),(function(e){p&&(p.polygon.material.offset=Number(e))})),t((function(){return r.stripeOrientation}),(function(e){if(p){var n="horizontal"===e?0:1;p.polygon.material.orientation=n}})),d(d({},i(r)),{},{draw:function(){"polyline"===r.drawType?v():function(){window.handlerPolygon||ce("Polygon");pe("Polygon",!1).then((function(e){var n=window.handlerPolygon;!function(e){var n;switch(console.log(e),r.currentId){case"1":n=SuperMap3D.Color.fromCssColorString(r.solidColor);break;case"2":var t=SuperMap3D.Color.fromCssColorString(r.gridColor),i=Number(r.gridWidth),o=Number(r.gridCount),a=Number(r.gridCellAlpha);n=new SuperMap3D.GridMaterialProperty({color:t,cellAlpha:a,lineCount:new SuperMap3D.Cartesian2(o,o),lineThickness:new SuperMap3D.Cartesian2(i,i)});break;case"3":var s=SuperMap3D.Color.fromCssColorString(r.stripeEvenColor),c=SuperMap3D.Color.fromCssColorString(r.stripeOddColor),d=Number(r.stripeRepeat),v=Number(r.stripeOffset);n=new SuperMap3D.StripeMaterialProperty({evenColor:s,oddColor:c,repeat:d,offset:v,orientation:"horizontal"===r.stripeOrientation?0:1})}p=viewer.entities.add({id:"polygon-symbol-gon-"+(new Date).getTime(),polygon:{hierarchy:{positions:e},material:n,perPositionHeight:u,groundBottomAltitude:0,groundExtrudedHeight:100},classificationType:l,height:f})}(e.result.object.positions),n.polygon.show=!1,n.polyline.show=!1,n.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate()}()},changeSelect:function(e){r.currentId=e},clear:function(){c&&"polyline"===r.drawType&&viewer.entities.removeById(c.id),p&&"polygon"===r.drawType&&viewer.entities.removeById(p.id),window.tooltip.setVisible(!1),de("Polyline"),de("Polygon"),window.editHandler&&window.editHandler.clear(),r.isEdit=!1,r.isEditZ=!1}})},symbol:function(o){var r=e({selectedTypeId:0,selectedSymbolId:0,symbolColor:"#ffffff",space:10,density:100,addType:"single"});if(o)for(var a in o)r.hasOwnProperty(a)?r[a]=o[a]:C.Message.errorMsg(ue.AttributeError+a);var s,l,u,c=be[r.selectedTypeId].data,p=null,f=!1,v=[],w=!1,m=!0;function y(e){if(!f){if(w){tooltip.setVisible(!1),viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");var n=scene.pickPosition(e.message.position),t=SuperMap3D.Color.fromCssColorString(r.symbolColor),i="symbol-"+be[r.selectedTypeId].id+"-"+c[r.selectedSymbolId].id+"-"+(new Date).getTime(),o=c[r.selectedSymbolId].path;return s.add(o,{id:i,position:n,color:t}),v.includes(o)||v.push(o),void(w=!1)}var a=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(a&&a.id&&"string"==typeof a.id&&-1!=a.id.indexOf("symbol-")){if(p&&p.id===a.id)return;return l&&l.destroy(),p=a,void(l=new SuperMap3D.ModelEditor({model:p.primitive,scene:viewer.scene})).activate()}l&&l.destroy(),l=null,p=null}}function g(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),w=!0}function h(){f=!0,window.handlerPolyline||ce("Polyline"),pe("Polyline").then((function(e){!function(e,n){for(var t=[],i=1,o=n.positions.length;i<o;i++)for(var a=n.positions[i-1],l=n.positions[i],u=SuperMap3D.Cartesian3.distance(a,l),p=S(parseInt(u)),d=1,w=p;d<=w;d++)t.push(SuperMap3D.Cartesian3.lerp(a,l,d/p,new SuperMap3D.Cartesian3));viewer.scene.clampToHeightMostDetailed(t).then((function(e){f=!1;var n=SuperMap3D.Color.fromCssColorString(r.symbolColor),t="symbol-"+be[r.selectedTypeId].id+"-"+c[r.selectedSymbolId].id+"-",i=c[r.selectedSymbolId].path;v.includes(i)||v.push(i);for(var o=0,a=e.length;o<=a;o++)s.add(i,{id:t+(new Date).getTime()+o,position:e[o],color:n})}))}(0,e.result.object);var n=window.handlerPolyline;n.polyline.show=!1,window.polylineTransparent.show=!1,n.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()}function S(e){var n=Number(r.space);return parseInt(e/n)+1}return H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element)),s=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(s),u=new Ce),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)),s=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(s),u=new Ce)})),n((function(){c.length=0,s=null,p=null,l&&l.destroy(),v.length=0})),t((function(){return r.selectedTypeId}),(function(e){c=be[r.selectedTypeId].data})),t((function(){return r.symbolColor}),(function(e){var n=SuperMap3D.Color.fromCssColorString(e);if(p){var t=p.primitive,i=p.id;t.updateColor(n,i)}})),d(d({},i(r)),{},{s3mModels:be,changeSelect:function(e){r.selectedSymbolId=e},clear:function(){if(p){var e=p.id,n=e.split("-"),t=be[n[1]].data[n[2]].path;t&&(s.removeInstance(t,e),p=null)}else v.forEach((function(e){s.removeCollection(e)})),v.length=0;0===v.length&&viewer.eventManager.removeEventListener("CLICK",y),l&&l.destroy(),l=null,window.tooltip.setVisible(!1),de("Polyline"),de("Polygon"),w=!1,viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur")},statrtAdd:function(){switch(m&&(window.tooltip.showAt("<p>选中模型可以编辑和清除选中模型</p><p>未选中模型时清除所有</p>","420px"),m=!1),viewer.eventManager.addEventListener("CLICK",y,!0),r.addType){case"single":g();break;case"line":h();break;case"face":f=!0,window.handlerPolygon||ce("Polygon"),pe("Polygon",!1).then((function(e){tooltip.setVisible(!1);var n=window.handlerPolygon;n.polygon.show=!1,n.polyline.show=!1,n.deactivate(),u.initPolygonEmitter(e.result.object.positions);var t=SuperMap3D.Color.fromCssColorString(r.symbolColor),i="symbol-"+be[r.selectedTypeId].id+"-"+c[r.selectedSymbolId].id+"-",o=c[r.selectedSymbolId].path;v.includes(o)||v.push(o);for(var a=Number(r.density),l=0;l<a;l++){var p=u.getOneRandomPosition();s.add(o,{id:i+(new Date).getTime()+l,position:p,color:t})}f=!1}),(function(e){console.log(e)})),window.handlerPolygon.activate();break;default:g()}}})},light:function(r){var a,s,l,u=e({lightSelectId:0,lightColor:"#FFFFFF",cutoffDistance:200,lightDecay:5,lightIntensity:5,spotLightAngle:30,visibleModel:!0,dockFontShow:!0,modelPosition:[0,0,0],modelLongitude:"",modelLatitude:"",modelHeight:"",bubbleShow:!1,visiblePositions:!1});if(r)for(var c in r)u.hasOwnProperty(c)?u[c]=r[c]:C.Message.errorMsg(ue.AttributeError+c);var p,f=!1,v=new Map,w="public/data/s3m/light.s3m",m=o(null);function y(e,n){var t="light-model-"+(new Date).getTime();l.add(w,{id:t,position:e,scale:new SuperMap3D.Cartesian3(2,2,2)}),a=l.getInstance(w,t),v.set(t,n)}H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element)),l=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(l)),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)),l=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(l))}));var g,h=!1;function S(){window.handlerPolyline||ce("Polyline"),pe("Polyline").then((function(e){var n,t,i,o,r;1===u.lightSelectId?(n=e.result.object.positions,t=b(n[0]),i=n[1],o={color:SuperMap3D.Color.fromCssColorString(u.lightColor),distance:Number(u.cutoffDistance),decay:Number(u.lightDecay),intensity:Number(u.lightIntensity),angle:SuperMap3D.Math.toRadians(Number(u.spotLightAngle))},r=new SuperMap3D.SpotLight(t,i,o),s=r,viewer.scene.addLightSource(r),y(t,r)):function(e){var n=b(e[0]),t={targetPosition:e[1],color:SuperMap3D.Color.fromCssColorString(u.lightColor),intensity:Number(u.lightIntensity)},i=new SuperMap3D.DirectionalLight(n,t);s=i,viewer.scene.addLightSource(i),y(n,i)}(e.result.object.positions);var a=window.handlerPolyline;a.polyline.show=!1,window.polylineTransparent.show=!1,a.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()}function M(e){if(f){f=!1,viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),!function(e){var n=b(e),t={color:SuperMap3D.Color.fromCssColorString(u.lightColor),cutoffDistance:Number(u.cutoffDistance),decay:Number(u.lightDecay),intensity:Number(u.lightIntensity)},i=new SuperMap3D.PointLight(n,t);s=i,viewer.scene.addLightSource(i),y(n,i)}(scene.pickPosition(e.message.position)),tooltip.setVisible(!1)}else{var n=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(n&&n.id&&"string"==typeof n.id&&-1!=n.id.indexOf("light-model-")){var t;if(a&&a.id===n.id.id)return;a=n,s=v.get(n.id),p?p.setEditObject(n.primitive):(o=n.primitive,(p=new SuperMap3D.ModelEditor({model:o,scene:viewer.scene,axesShow:{translation:!0,rotation:!1,scale:!0}})).activate(),p.changedEvt.addEventListener((function(e){var n=new SuperMap3D.Cartesian3;if(SuperMap3D.Matrix4.getTranslation(e.modelMatrix,n),n){var t;s.position=n,h=!0,P((function(){return h=!1}));var i=C.CartesiantoDegrees(n);u.modelPosition.length=0,(t=u.modelPosition).push.apply(t,[i[0].toFixed(6),i[1].toFixed(6),i[2].toFixed(2)])}}))),m.value.style.top=e.message.position.y-160+"px",m.value.style.left=e.message.position.x+"px",console.log(p);var i=C.CartesiantoDegrees(p._position);return u.modelPosition.length=0,(t=u.modelPosition).push.apply(t,[i[0].toFixed(6),i[1].toFixed(6),i[2].toFixed(2)]),void(u.bubbleShow=!0)}a=void 0,s=void 0,p&&p.deactivate(),u.bubbleShow=!1}var o}function b(e){var n=SuperMap3D.Cartographic.fromCartesian(e);return n.height+=.5,SuperMap3D.Cartographic.toCartesian(n)}function D(){u.bubbleShow=!1}function P(e){g&&clearTimeout(g),g=setTimeout((function(){e()}),1e3)}return t((function(){return u.lightColor}),(function(e){if(s){var n=SuperMap3D.Color.fromCssColorString(e);s.color=n}})),t((function(){return u.cutoffDistance}),(function(e){s&&(1!==s.lightType?2!==s.lightType||(s.distance=Number(e)):s.cutoffDistance=Number(e))})),t((function(){return u.lightDecay}),(function(e){s&&0!==s.lightType&&(s.decay=Number(e))})),t((function(){return u.lightIntensity}),(function(e){s&&(s.intensity=Number(e))})),t((function(){return u.spotLightAngle}),(function(e){s&&2===s.lightType&&(s.angle=SuperMap3D.Math.toRadians(Number(e)))})),t((function(){return u.visibleModel}),(function(e){a&&(p&&p.deactivate(),l.visible=e)})),t((function(){return u.modelPosition}),(function(e){a&&!h&&P((function(){var n=Number(e[0]),t=Number(e[1]),i=Number(e[2]),o=SuperMap3D.Cartesian3.fromDegrees(n,t,i);s.position=o,a.primitive.updatePosition(o),p&&p.setEditObject(a.primitive)}))}),{deep:!0}),n((function(){})),d(d({},i(u)),{},{config:De,addLight:function(){var e=0===u.lightSelectId?"<p>点击确认点光源位置</p><p>选中光源模型可编辑与删除</p>":"<p>点击第一点确认光源位置</p><p>第二点确认光源方向</p><p>选中光源模型可编辑与删除</p>";if(window.tooltip.showAt(e,"400px"),viewer.eventManager.addEventListener("CLICK",M,!0),0===u.lightSelectId)return viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),void(f=!0);S()},clearLight:function(){a&&(v.delete(a.id),l.removeInstance(w,a.id),a=null),s&&viewer.scene.removeLightSource(s),0===v.size&&viewer.eventManager.removeEventListener("CLICK",M),p&&p.deactivate(),f=!1,s=null,de(),viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),tooltip.setVisible(!1),D()},bubble:m,closeBubble:D,dockBubble:function(e){e?(m.value.classList.add("bubbleDock"),u.dockFontShow=!1):(m.value.classList.remove("bubbleDock"),u.dockFontShow=!0)}})},projection:function(a){var s,l,u,c=e({viewlongitude:"",viewlatitude:"",viewheight:"",direction:"",pitch:"",horizontal:20,vertical:10,distance:200,hintLineColor:"rgba(251,250,248,1)",clipMode:"clip-inside",visibleLine:!0,fileText:"",fromInfo:null});if(a)for(var p in a)c.hasOwnProperty(p)?c[p]=a[p]:C.Message.errorMsg(ue.AttributeError+p);var f,v,w,m=o(null),y=new Map,g="public/data/s3m/projector.s3m",h=!1,S=null,M=new FileReader,b=!1;function D(e,n){return new Promise((function(t,i){var o=document.getElementById("videoContain"),r=document.createElement("video"),a=document.createElement("source");a.src=e,r.appendChild(a),r.id="trailer-"+n,r.classList.add("videoBox"),r.setAttribute("autoplay","autoplay"),r.setAttribute("loop","loop"),r.setAttribute("crossorigin","crossorigin"),r.setAttribute("controls","controls"),r.setAttribute("muted","muted"),o.appendChild(r),setTimeout((function(){t(r)}),500)}))}function P(e){if(!b){if(h){viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");var n=SuperMap3D.Cartesian3.fromDegrees(u.viewPosition[0],u.viewPosition[1],u.viewPosition[2]),t=JSON.parse(JSON.stringify(n));return viewer.eventManager.removeEventListener("MOUSE_MOVE",E),i=t,o="projector-"+(new Date).getTime(),r=u.direction,a=u.pitch,s=SuperMap3D.Math.toRadians(r),l=s>=SuperMap3D.Math.PI?s-SuperMap3D.Math.PI:s+SuperMap3D.Math.PI,p=-SuperMap3D.Math.toRadians(a),f.add(g,{id:o,position:i,hpr:{heading:l,pitch:0,roll:p}}),S=f.getInstance(g,o),y.set(o,u),void(h=!1)}var i,o,r,a,s,l,p,d=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(d&&d.id&&"string"==typeof d.id&&-1!=d.id.indexOf("projector-"))return v&&v.destroy(),S=d,void((u=y.get(d.id))&&(c.horizontal=u.horizontalFov,c.vertical=u.verticalFov,c.distance=u.distance));S=null,u=null}}function E(e){var n=0,t=viewer.scene.camera.position,i=l.pickPosition(e.message.endPosition);i&&(n=SuperMap3D.Cartesian3.distance(t,i)),n>0&&n<1e3&&u.setDistDirByPoint(C.CartesiantoDegrees(i))}return H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element)),l=viewer.scene,s=viewer.scene.layers.layerQueue,f=new SuperMap3D.S3MInstanceCollection(l._context),viewer.scene.primitives.add(f),viewer.eventManager.addEventListener("CLICK",P,!0)),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)),l=viewer.scene,s=viewer.scene.layers.layerQueue,f=new SuperMap3D.S3MInstanceCollection(l._context),viewer.scene.primitives.add(f))})),t((function(){return H.changeLayers}),(function(e){for(var n=0;n<s.length;n++)s[n].selectEnabled=!1})),r((function(){m.value.addEventListener("change",(function(e){var n=e.target.files[0];if(n){c.fileText=m.value.value;var t=new Blob([n],{type:"video/mp4"});M.readAsDataURL(t),M.onload=function(e){var n=e.target.result,t=document.querySelectorAll("#videoContain>video").length;D(n,t).then((function(e){w=document.getElementById("trailer-"+t)}))}}})),w=document.getElementById("trailer-0")})),t((function(){return c.fileText}),(function(e){if(-1!==e.indexOf("http")){var n=document.querySelectorAll("#videoContain>video").length;D(e,n).then((function(e){w=document.getElementById("trailer-"+n)}))}})),t((function(){return c.horizontal}),(function(e){""!=e&&u&&(u.horizontalFov=Number(e))})),t((function(){return c.vertical}),(function(e){""!=e&&u&&(u.verticalFov=Number(e))})),t((function(){return c.distance}),(function(e){""!=e&&u&&(u.distance=Number(e))})),t((function(){return c.visibleLine}),(function(e){u&&(f.visible=e,y.forEach((function(n){n.hintLineVisible=e})))})),t((function(){return c.hintLineColor}),(function(e){u&&(u.hintLineColor=SuperMap3D.Color.fromCssColorString(e))})),t((function(){return c.clipMode}),(function(e){if(u){var n="clip-outside"===e?SuperMap3D.ModifyRegionMode.CLIP_INSIDE:SuperMap3D.ModifyRegionMode.CLIP_OUTSIDE;u.setClipMode(n)}})),t((function(){return c.viewlongitude}),(function(e){u&&""!=e&&(u.viewPosition[0]=e)})),t((function(){return c.viewlatitude}),(function(e){u&&""!=e&&(u.viewPosition[1]=e)})),t((function(){return c.viewheight}),(function(e){u&&""!=e&&(u.viewPosition[2]=e)})),t((function(){return c.direction}),(function(e){u&&""!=e&&(u.direction=Number(e))})),t((function(){return c.pitch}),(function(e){u&&""!=e&&(u.pitch=Number(e))})),t((function(){return c.fromInfo}),(function(e){e&&""!=e&&SuperMap3D.ProjectionImage.fromInfo(l,c.fromInfo.infoUrl,c.fromInfo.baseUrl)})),n((function(){for(var e=0;e<s.length;e++)s[e].selectEnabled=!0})),d(d({},i(c)),{},{chooseFile:function(){m.value.click()},vedioFile_dom:m,startProjection:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur");var e=viewer.scene.camera.position;w.play(),(u=new SuperMap3D.ProjectionImage(l)).setImage({video:w}),u.distance=Number(c.distance),u.horizontalFov=Number(c.horizontal),u.verticalFov=Number(c.vertical),u.viewPosition=C.CartesiantoDegrees(e),u.build(),h=!0,window.tooltip.showAt(" <p>选中投放模型进行编辑和清除</p>","400px"),viewer.eventManager.addEventListener("MOUSE_MOVE",E),viewer.eventManager.addEventListener("CLICK",P,!0)},clear:function(){viewer.eventManager.removeEventListener("MOUSE_MOVE",E),S&&(y.delete(S.id),f.removeInstance(g,S.id),S=null),u&&(u.removeAllClipRegion(),u.destroy()),0===y.size&&viewer.eventManager.removeEventListener("CLICK",P),v&&v.destroy(),v=null,u=null,window.tooltip.setVisible(!1),de(),viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur")},clipProjectImg:function(){b=!0,tooltip.setVisible(!1),window.tooltip.showAt(" <p>点击鼠标左键绘制裁剪区域</p><p>点击鼠标右键结束绘制</p><p>注：只能裁剪当前选中投放对象</p>","400px"),window.handlerPolygon||ce("Polygon"),pe("Polygon").then((function(e){b=!1;var n=window.handlerPolygon;!function(e){if(!u)return;u.addClipRegion({name:"clip-Projector"+(new Date).getTime(),position:e})}(e.positions),n.polygon.show=!1,n.polyline.show=!1,window.polylineTransparent.show=!1,n.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate()}})},scanEffect:function(o){var r=e({scanMode:"lineMode",scanColor:"#0F7AF4",scanTextures:[],selectedTextureIndex:0,bloomShow:!1,openHDR:!1,threshold:.01,intensity:.5,lineWidth:100,period:3,speed:100,addTextures:null,scanShow:!1});if(o)for(var s in o)r.hasOwnProperty(s)?r[s]=o[s]:C.Message.errorMsg(ue.AttributeError+s);var l=[{name:"无纹理",type:"line",url:""}],u=[{name:"无纹理",type:"ring",url:""}];function c(e){for(var n=0;n<e.length;n++)"line"===e[n].type?l.push(e[n]):u.push(e[n]);r.scanTextures="lineMode"===r.scanMode?l:u}function p(){viewer.scene.scanEffect.color=SuperMap3D.Color.fromCssColorString(r.scanColor),viewer.scene.scanEffect.textureUrl="",viewer.scene.scanEffect.lineWidth=Number(r.lineWidth),viewer.scene.scanEffect.period=Number(r.period),viewer.scene.scanEffect.speed=Number(r.speed),viewer.scene.scanEffect.centerPostion=new SuperMap3D.Cartesian3.fromDegrees(0,0,0)}function f(){window.handlerPolyline||ce("Polyline"),window.tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>绘制两点确定扫描线方向</p><p>鼠标右键结束绘制</p>","350px"),pe("Polyline").then((function(e){!function(e){var n=new SuperMap3D.Cartesian3;if(SuperMap3D.Cartesian3.subtract(e[1],e[0],n),r.scanShow)return viewer.scene.scanEffect.add(e[0]),void(viewer.scene.scanEffect.lineMoveDirection=n);viewer.scene.scanEffect.centerPostion=e[0],viewer.scene.scanEffect.lineMoveDirection=n,r.scanShow=!0}(e.result.object.positions);var n=window.handlerPolyline;n.polyline.show=!1,window.polylineTransparent.show=!1,n.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()}function v(e){viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");var n=viewer.scene.pickPosition(e.message.position);r.scanShow?viewer.scene.scanEffect.add(n):(viewer.scene.scanEffect.centerPostion=n,r.scanShow=!0,viewer.eventManager.removeEventListener("CLICK",v))}return c(Pe),H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element)),p()),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)),p())})),t((function(){return r.scanShow}),(function(e){viewer.scene.scanEffect.show=e})),t((function(){return r.scanMode}),(function(e){if("lineMode"===e)return viewer.scene.scanEffect.mode=SuperMap3D.ScanEffectMode.LINE,void(r.scanTextures=l);viewer.scene.scanEffect.mode=SuperMap3D.ScanEffectMode.CIRCLE,r.scanTextures=u})),t((function(){return r.scanColor}),(function(e){viewer.scene.scanEffect.color=SuperMap3D.Color.fromCssColorString(e)})),t((function(){return r.selectedTextureIndex}),(function(e){viewer.scene.scanEffect.textureUrl=r.scanTextures[e].url})),t((function(){return r.scanTextures}),(function(e){r.selectedTextureIndex=0})),t((function(){return r.bloomShow}),(function(e){viewer.scene.bloomEffect.show=e,viewer.scene.bloomEffect.threshold=Number(r.threshold),viewer.scene.bloomEffect.bloomIntensity=Number(r.intensity)})),t((function(){return r.openHDR}),(function(e){viewer.scene.hdrEnabled=e})),t((function(){return r.threshold}),(function(e){viewer.scene.bloomEffect.threshold=Number(e)})),t((function(){return r.intensity}),(function(e){viewer.scene.bloomEffect.bloomIntensity=Number(e)})),t((function(){return r.lineWidth}),(function(e){viewer.scene.scanEffect.lineWidth=Number(e)})),t((function(){return r.period}),(function(e){viewer.scene.scanEffect.period=Number(e)})),t((function(){return r.speed}),(function(e){viewer.scene.scanEffect.speed=Number(e)})),t((function(){return r.scanShow}),(function(e){viewer.scene.scanEffect.scanShow=e})),t((function(){return r.addTextures}),(function(e){"object"===a(e)?c(e):console.log("addTextures类型不是数组！")})),n((function(){})),d(d({},i(r)),{},{addScans:function(){"lineMode"!==r.scanMode?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.eventManager.addEventListener("CLICK",v,!0)):f()},clear:function(){r.scanShow=!1;for(var e=viewer.scene.scanEffect.count,n=0;n<e;n++)viewer.scene.scanEffect.remove(n);viewer.eventManager.removeEventListener("CLICK",v),de("Polyline")}})},geologicalBody:function(o){var r=e({operationType:"stretch_cut",stretchHeight:1,modelUrls:null,digHeight:500,drillRadius:400,drillHeight:2e3,clipType:"drawClip",drawClipMode:"KeepInside"});if(r.modelUrls=[{id:1,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer1/features/1.stream",color:new SuperMap3D.Color(179/255,179/255,179/255,1)},{id:2,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer2/features/1.stream",color:new SuperMap3D.Color(94/255,179/255,59/255,1)},{id:3,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer3/features/1.stream",color:new SuperMap3D.Color(52/255,94/255,35/255,1)},{id:4,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer4/features/1.stream",color:new SuperMap3D.Color(115/255,115/255,115/255,1)},{id:5,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer5/features/1.stream",color:new SuperMap3D.Color(171/255,85/255,66/255,1)},{id:6,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer6/features/1.stream",color:new SuperMap3D.Color(68/255,68/255,68/255,1)}],o)for(var a in o)r.hasOwnProperty(a)?r[a]=o[a]:C.Message.errorMsg(ue.AttributeError+a);var s,l,u,c,p=[],f=0,v=[];function w(){(s=viewer.scene).logarithmicDepthBuffer=!0,s.camera.frustum.near=.1,s.globe.show=!1,viewer.scene.skyAtmosphere.show=!1,(l=new SuperMap3D.SolidModelsProfile(s)).addModels(r.modelUrls),console.log(l),l.addedEvent.addEventListener((function(e){console.log(l._s3mInstanceCollection.getInstance(r.modelUrls[2].model,3))})),viewer.scene.camera.setView({destination:new SuperMap3D.Cartesian3(-2167835.4408299956,4423497.534529096,4095839.2845661934),orientation:{heading:4.029329438295484,pitch:-.23796647219353817,roll:8.994289757424667e-10}})}function m(){tooltip.setVisible(!1),l.clearProfile(),de("Polyline"),p.forEach((function(e){viewer.entities.removeById(e)})),p.length=0}function y(){window.handlerPolygon||ce("Polygon"),pe("Polygon",!1).then((function(e){var n=window.handlerPolygon;!function(e){var n=new SuperMap3D.Point3Ds;C.CartesiantoDegreesObjs(e).forEach((function(e){var t=new SuperMap3D.Point3D(e.longitude,e.latitude,e.height+1e3);n.add(t)}));var t=new SuperMap3D.GeoRegion3D([n]);if("dig"===r.operationType){l.clippingType=SuperMap3D.ClippingType.KeepOutside,t.extrudedHeight=-Number(r.digHeight);var i=new SuperMap3D.GeoRegion3D([n]);i.isLatLon=!1,i.bottomAltitude=t.extrudedHeight,l.addProfileGeometry(i)}else t.extrudedHeight=-7e3;t.isLatLon=!1,l.setClipGeometry(t);for(var o=0;o<e.length;o++){var a=[];a.push(e[o]),o==e.length-1?a.push(e[0]):a.push(e[o+1]),l.addProfileGeometry(a),l.build()}}(e.result.object.positions),n.polygon.show=!1,n.polyline.show=!1,n.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate()}function g(){tooltip.setVisible(!1),l.clearProfile(),de()}function h(e){var n=viewer.scene.pickPosition(e.message.position);!function(e){f++,viewer.entities.add({id:"Drill_Point-"+f,position:e,cylinder:{length:100,topRadius:Number(r.drillRadius),bottomRadius:Number(r.drillRadius),material:SuperMap3D.Color.fromCssColorString("#d60000")}})}(n),v.push(n)}function M(e){window.tooltip.setVisible(!1),document.body.classList.remove("measureCur"),C.CartesiantoDegreesObjs(v).forEach((function(e){var n=new SuperMap3D.GeoCylinder(Number(r.drillRadius),Number(r.drillRadius),Number(r.drillHeight)),t=Number(r.drillHeight)/2;n.geoPosition=new SuperMap3D.Point3D(e.longitude,e.latitude,e.height-t),l.addProfileGeometry(n)}));for(var n=1;n<=f;n++)viewer.entities.removeById("Drill_Point-"+n);l.build(),viewer.eventManager.removeEventListener("CLICK",h),viewer.eventManager.removeEventListener("RIGHT_CLICK",M)}function b(){tooltip.setVisible(!1),l.clearProfile(),document.body.classList.remove("measureCur");for(var e=1;e<=f;e++)viewer.entities.removeById("Drill_Point-"+e);viewer.eventManager.removeEventListener("CLICK",h),viewer.eventManager.removeEventListener("RIGHT_CLICK",M),f=0,v.length=0}function D(){g(),de("Box"),u&&(u.deactivate(),u.destroy(),u=null)}function P(){m(),D(),b()}return H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element)),w()),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)),w())})),t((function(){return r.modelUrls}),(function(e){l.addModels(e)})),t((function(){return r.stretchHeight}),(function(e){if(r.modelUrls&&0!=r.modelUrls.length){var n,t=S(r.modelUrls);try{for(t.s();!(n=t.n()).done;){var i=n.value.model;l._s3mInstanceCollection._group[i].instances._array[0].updateScale(new SuperMap3D.Cartesian3(1,1,Number(e)))}}catch(e){t.e(e)}finally{t.f()}}})),t((function(){return r.operationType}),(function(e){P()})),t((function(){return r.drawClipMode}),(function(e){l.clippingType=SuperMap3D.ClippingType[e]})),t((function(){return r.clipType}),(function(e){D()})),n((function(){l.clear(),viewer.scene.globe.show=!0,viewer.scene.skyAtmosphere.show=!0,P(),s=null,l=null,c=null})),d(d({},i(r)),{},{drawLine:function(){window.handlerPolyline||ce("Polyline"),window.tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>鼠标右键结束绘制</p><p>可以绘制多条线段</p>","350px"),pe("Polyline").then((function(e){!function(e){var n=[];if(e.length<2)return;for(var t=0;t<e.length-1;t++)n.length=0,n.push(e[t]),n.push(e[t+1]),l.addProfileGeometry(n)}(e.result.object.positions);var n=window.handlerPolyline;n.polyline.show=!1,n.deactivate(),tooltip.setVisible(!1);var t="geologicalbody_cutline-"+(new Date).getTime();p.push(t),viewer.entities.add({id:t,polyline:{positions:e.result.object.positions,width:2,material:SuperMap3D.Color.fromCssColorString("#51ff00")}})}),(function(e){console.log(e)})),window.handlerPolyline.activate()},startCut:function(){tooltip.setVisible(!1),de("Polyline"),0!==p.length?l.build():window.tooltip.showAt(" <p>请先绘制剖切的线段</p>","350px")},clearCut:m,startDig:function(){g(),y()},clearDig:g,startDrilling:function(){b(),viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),window.tooltip.showAt(" <p>点击鼠标左键确认钻孔位置</p><p>鼠标右键结束绘制并执行钻孔</p>","350px"),console.log(1),viewer.eventManager.addEventListener("CLICK",h,!0),viewer.eventManager.addEventListener("RIGHT_CLICK",M,!0)},clearDrilling:b,startClip:function(){D(),l.clippingType=SuperMap3D.ClippingType[r.drawClipMode],"drawClip"!==r.clipType?function(){u&&u.deactivate();tooltip.showAt(" <p>点击鼠标左键开始绘制box底面</p><p>然后移动鼠标绘制box高度</p><p>点击鼠标右键结束绘制</p>","350px"),window.handlerBox||ce("Box");pe("Box",!1).then((function(e){var n=window.handlerBox;!function(e){e.show=!1;var n=e.box.dimensions.getValue(),t=SuperMap3D.Cartographic.fromCartesian(e.position.getValue(0));if((c=new SuperMap3D.GeoBox(n.x,n.y,n.z)).geoPosition=new SuperMap3D.Point3D(SuperMap3D.Math.toDegrees(t.longitude),SuperMap3D.Math.toDegrees(t.latitude),t.height),l.addProfileGeometry(c),l.build(),u)u.setEditObject(e);else{(u=new SuperMap3D.BoxEditor(viewer,e)).color=SuperMap3D.Color.WHITE.withAlpha(0),u.hoverColor=SuperMap3D.Color.BLUE;var i=function(e){var n=e.dimensions;c.geoWidth=n.y,c.geoHeight=n.z,c.geoLength=n.x;var t=C.CartesiantoDegrees(e.position);c.geoPosition=new SuperMap3D.Point3D(t[0],t[1],t[2]),c.geoRotationZ=u.hpr.heading*(180/SuperMap3D.Math.PI)};u.editEvt.addEventListener(i)}u.activate()}(e.result.object),n.deactivate()}),(function(e){console.log(e)})),window.handlerBox.activate()}():y()},clearClip:D})},volume:function(o){var r,a=e({dataUrl:"",operationType:"addDate",dimensions:[],variables:[],selectedDateName:null,xDim:100,yDim:200,zDim:9,timeDim:40,drawMode:"volume",opacityInterval:[0,1],useGradientOpacity:!1,gradientOpacityValue:[0,1],gradientOpacity:[0,1],showClipPlane:!1,clipX:.5,clipY:.5,clipRotate:0,xOffset:.5,yOffset:.5,zOffset:.5,contourValue:1,contourRange:[0,1],zScale:0,colorInterval:[0,1],timeOrder:0,timeRange:[0,24],openLight:!1});if(o)for(var s in o)a.hasOwnProperty(s)?a[s]=o[s]:C.Message.errorMsg(ue.AttributeError+s);var l,u=new SuperMap3D.Cartesian3(1,1,1),c=new SuperMap3D.Cartesian3(.5,.5,.5),p=SuperMap3D.Plane.fromPointNormal(new SuperMap3D.Cartesian3(0,0,0),new SuperMap3D.Cartesian3(1,0,0));function f(){if(!a.dataUrl)return C.Message.warnMsg("请先定义数据路径！");var e=viewer.scene.addVoxelGridLayer(a.dataUrl,"test");SuperMap3D.when(e,(function(e){r=e,a.dimensions=r._NetCDFInfo.dimensions,a.variables=r._NetCDFInfo.variables,a.selectedDateName=a.variables[0].name,a.xDim=a.dimensions[0].name,a.yDim=a.dimensions[1].name,a.zDim=a.dimensions[2].name,a.timeDim=a.dimensions[3].name,r.layerBounds=new SuperMap3D.Rectangle(99.95422,32.25671,107.1912,37.1386),r.zBounds=new SuperMap3D.Cartesian2(500,5e4)}))}function v(){var e=r.layerBounds.west+(r.layerBounds.east-r.layerBounds.west)*Number(a.clipX),n=r.layerBounds.south+(r.layerBounds.north-r.layerBounds.south)*Number(a.clipY);viewer.entities.removeById("volume-clip-plane"),viewer.entities.add({id:"volume-clip-plane",position:SuperMap3D.Cartesian3.fromDegrees(e,n,5e4),point:{color:SuperMap3D.Color.YELLOW,pixelSize:10}})}return H.isViewer&&(window.tooltip||(window.tooltip=oe(viewer._element)),f()),t((function(){return H.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=oe(viewer._element)),f())})),n((function(){viewer.scene.layers.remove(r.name),r=null})),t((function(){return a.drawMode}),(function(e){r&&(r.volumeRenderMode="slice"===e?1:"gradient"===e?2:0)})),t((function(){return a.useGradientOpacity}),(function(e){r&&(r.useGradientOpacity=e)})),t((function(){return a.gradientOpacityValue}),(function(e){r&&(l.gradientMinOpacity=e[0],l.gradientMaxOpacity=e[1],l.setGradientOpacityValue(r))})),t((function(){return a.opacityInterval}),(function(e){r&&(l.opacityMinValue=e[0],l.opacityMaxValue=e[1],l.setColorTable(r))})),t((function(){return a.gradientOpacity}),(function(e){r&&(r.gradientOpacityMinOpacity=e[0],r.gradientOpacityMaxOpacity=e[1])})),t((function(){return a.zScale}),(function(e){r&&(u.z=parseFloat(e),r.scale=u)})),t((function(){return a.colorInterval}),(function(e){r&&(l.visibleMinValue=e[0],l.visibleMaxValue=e[1],l.setColorTable(r))})),t((function(){return a.timeOrder}),(function(e){r&&(r.frameIndex=Number(e))})),t((function(){return a.openLight}),(function(e){r&&(r.enableLighting=e)})),t((function(){return a.clipX}),(function(e){if(r){v();var n=parseFloat(e),t=parseFloat(a.clipY),i=SuperMap3D.Math.toRadians(a.clipRotate),o=SuperMap3D.Quaternion.fromAxisAngle(SuperMap3D.Cartesian3.UNIT_Z,i),s=new SuperMap3D.Cartesian3(n,t,0),l=new SuperMap3D.TranslationRotationScale(s,o),u=SuperMap3D.Matrix4.fromTranslationRotationScale(l);SuperMap3D.Plane.fromPointNormal(new SuperMap3D.Cartesian3(0,0,0),new SuperMap3D.Cartesian3(1,0,0),p),SuperMap3D.Plane.transform(p,u,p)}})),t((function(){return a.clipY}),(function(e){if(r){v();var n=parseFloat(a.clipX),t=parseFloat(e),i=new SuperMap3D.Cartesian3(n,t,0);SuperMap3D.Plane.fromPointNormal(i,new SuperMap3D.Cartesian3(0,1,0),p)}})),t((function(){return a.clipRotate}),(function(e){if(r){var n=parseFloat(a.clipX),t=parseFloat(a.clipY),i=SuperMap3D.Math.toRadians(e),o=SuperMap3D.Quaternion.fromAxisAngle(SuperMap3D.Cartesian3.UNIT_Z,i),s=new SuperMap3D.Cartesian3(n,t,0),l=SuperMap3D.Matrix3.fromQuaternion(o),u=SuperMap3D.Matrix4.fromRotationTranslation(l),c=new SuperMap3D.Cartesian3(1,0,0);c=SuperMap3D.Matrix4.multiplyByPoint(u,c,new SuperMap3D.Cartesian3),SuperMap3D.Plane.fromPointNormal(s,c,p)}})),t((function(){return a.xOffset}),(function(e){r&&(c.x=parseFloat(e),r.sliceCoordinate=c)})),t((function(){return a.yOffset}),(function(e){r&&(c.y=parseFloat(e),r.sliceCoordinate=c)})),t((function(){return a.zOffset}),(function(e){r&&(c.z=parseFloat(e),r.sliceCoordinate=c)})),t((function(){return a.contourValue}),(function(e){r&&(r.contourValue=parseFloat(e))})),d(d({},i(a)),{},{startRender:function(){r?a.xDim!=a.yDim&&a.xDim!=a.zDim&&a.yDim!=a.zDim?((l=new Ee({opacityMinValue:0,opacityMaxValue:.8,gradientMinOpacity:1,gradientMaxOpacity:1,visibleMinValue:0,visibleMaxValue:.37})).setColorTable(r,0),r.startRender({variableName:a.selectedDateName,xDimName:a.xDim,yDimName:a.yDim,zDimName:a.zDim,timeDimName:a.timeDim}),function(){a.contourRange=[Math.ceil(r.minValue),Math.ceil(r.maxValue)],a.contourValue=Math.ceil(r.minValue);var e=r._NetCDFInfo.recordDimension;e&&e.length>0&&(a.timeRange=[0,e.length])}(),viewer.scene.camera.flyTo({destination:{x:-1688158.0372444934,y:6654029.431965283,z:2998692.1265170774},orientation:{heading:.028840576504810755,pitch:-.8994386458052253,roll:6.283185307179586}})):C.Message.warnMsg("各维度名不能一样"):f()},addClipPlane:function(){!SuperMap3D.defined(r)||r.getNumberOfClipPlanes()>0||(a.showClipPlane=!0,r.addClipPlane(p),v())},removeClipPlane:function(){SuperMap3D.defined(r)&&0!==r.getNumberOfClipPlanes()&&(a.showClipPlane=!1,r.removeAllClipPlanes(),viewer.entities.removeById("volume-clip-plane"))},clear:function(){r&&(viewer.scene.layers.remove(r.name),r=null,f())}})},particle:function(t){var o=e({particles:[{id:0,iconfont:"iconhuoyan",particleName:"火焰"},{id:1,iconfont:"iconshui",particleName:"水"},{id:2,iconfont:"iconyanhua",particleName:"烟花"}],particleSelectedId:0});if(t)for(var r in t)o.hasOwnProperty(r)?null!=t[r]&&(o[r]=t[r]):C.Message.errorMsg(ue.AttributeError+r);return n((function(){})),d({},i(o))}};"undefined"!=typeof window&&window.Vue&&(window.webgl3d_mc=xe);export default xe;
