import{reactive as e,toRefs as n,watch as o,onBeforeUnmount as t,resolveComponent as i,resolveDirective as r,withDirectives as a,openBlock as l,createBlock as s,createVNode as p,toDisplayString as d,vModelSelect as c}from"vue";function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function y(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,t)}return o}function f(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?y(Object(o),!0).forEach((function(n){w(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):y(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function g(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return v(e,n);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return v(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,n){(null==n||n>e.length)&&(n=e.length);for(var o=0,t=new Array(n);o<n;o++)t[o]=e[o];return t}var h=function(e,n){if(!e||!n)return!0;var o=!0;if(Object.keys(e).length!=Object.keys(n).length)return!1;for(var t in e)if("object"==u(e[t])){if(!(o=isSame(e[t],n[t])))break}else if(e[t]!=n[t]){o=!1;break}return o},M=function(e){for(var n=[].concat(e),o=[],t=0,i=n.length;t<i;t++){var r=SuperMap3D.Cartographic.fromCartesian(n[t]),a=SuperMap3D.Math.toDegrees(r.longitude),l=SuperMap3D.Math.toDegrees(r.latitude),s=r.height;-1==o.indexOf(a)&&-1==o.indexOf(l)&&(o.push(a),o.push(l),o.push(s))}return o};var S,m,b={errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},D={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},A=(m=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=m,m).toLowerCase();var E=((S=void 0!==A?A:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||S.startsWith("ja"),D),P=function(e,n){var o=0;switch(n&&(o=n),e){case"Point":window.handlerPoint=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Point);break;case"Polyline":window.handlerPolyline=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Line,o);break;case"Polygon":window.handlerPolygon=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Polygon,o);break;case"Marker":window.handlerMarker=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Marker,o);break;case"Box":window.handlerBox=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box,o)}window.tooltip||(window.tooltip=function(e){var n=function(e){var n=document.createElement("DIV");n.className="twipsy right";var o=document.createElement("DIV");o.className="twipsy-arrow",n.appendChild(o);var t=document.createElement("DIV");t.className="twipsy-inner",n.appendChild(t),this._div=n,this._title=t,this.message="",e.appendChild(n);var i=this;n.onmousemove=function(e){i.showAt({x:e.clientX,y:e.clientY},i.message)}};return n.prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},n.prototype.showAt=function(e,n){e&&n&&(this.setVisible(!0),this._title.innerHTML=n,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px",this.message=n)},new n(e)}(viewer._element)),window.polylineCollection||(window.polylineCollection=new SuperMap3D.PolylineCollection({translucentRS:SuperMap3D.RenderState.fromCache({depthMask:!1,depthTest:{enabled:!1}})}),window.polylineTransparent=window.polylineCollection.add({width:2,material:SuperMap3D.Material.fromType(SuperMap3D.Material.ColorType,{color:SuperMap3D.Color.fromCssColorString("#51ff00").withAlpha(.3)})}),viewer.scene.primitives.add(window.polylineCollection))},R=function(e){var n;switch(e){case"Point":n=window.handlerPoint;break;case"Polyline":n=window.handlerPolyline;break;case"Polygon":n=window.handlerPolygon;break;case"Marker":n=window.handlerMarker;break;case"Box":n=window.handlerBox}return n},C=function(e,n,o){window.selectHandler||(window.selectHandler=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas));var t=window.selectHandler;window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!0),t.setInputAction((function(){console.log("viewer.selectedEntity:",viewer.selectedEntity);var i=viewer.selectedEntity,r=window.editHandler;i&&(r&&r&&r.clear(),r?(r.deactivate(),r.setEditObject(i),r.activate()):(window.editHandler=new SuperMap3D.EditHandler(viewer,i),window.editHandler.isEditZ=n||!1,window.editHandler.activate()),t.setInputAction((function(){if(i=viewer.selectedEntity,r=window.editHandler,i&&r&&r._positions){var n=M(r._positions);if(h(e,n))return;if(e=n,o&&o(n,window.editHandler),window.handlerPolygon&&window.handlerPolygon.polygon&&window.handlerPolygon.polygon.show){var t=g(r._positions);t.push(t[0]),window.polylineTransparent.positions=t}}}),SuperMap3D.ScreenSpaceEventType.LEFT_UP))}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)},_=function(){window.editHandler&&(window.editHandler.deactivate(),window.editHandler.clear()),window.selectHandler&&(window.selectHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_UP),window.selectHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),window.selectHandler.destroy(),window.selectHandler=null)};function O(e){var n=function(e){var n=document.createElement("DIV");n.className="tooltip",this._div=n,this.message="",e.appendChild(n)};return n.prototype.setVisible=function(e){this._div.style.right=e?"10px":"-300px"},n.prototype.showAt=function(e,n){n&&(this._div.style.top=n),e&&(this.setVisible(!0),this._div.innerHTML=e)},new n(e)}var k=e({isViewer:!1,changeLayers:0,changeGeometrys:0});function x(i){var r=e({analysisArea:"ARM_REGION",displayMode:"FACE_AND_ARROW",wideMaxR:90,wideMinR:0,slopeInterval:[0,90],trans:.8,isEdit:!1,slopePositions:[],lineVisible:!0});if(i)for(var a in i)r.hasOwnProperty(a)?r[a]=i[a]:b.errorMsg(E.AttributeError+a);var l=!0,s=new SuperMap3D.SlopeSetting,p=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode[r.analysisArea],d=SuperMap3D.SlopeSettingEnum.DisplayMode[r.displayMode],c=new SuperMap3D.ColorTable,u=[];function w(e){e&&(u=e),s.CoverageArea=e,viewer.scene.globe.SlopeSetting={slopeSetting:s,analysisMode:p}}return c.insert(80,new SuperMap3D.Color(1,0,0)),c.insert(50,new SuperMap3D.Color(221/255,224/255,7/255)),c.insert(30,new SuperMap3D.Color(20/255,187/255,18/255)),c.insert(20,new SuperMap3D.Color(0,161/255,1)),c.insert(0,new SuperMap3D.Color(9/255,9/255,1)),i&&i.slopePositions&&w(i.slopePositions),k.isViewer&&(window.tooltip||(window.tooltip=O(viewer._element))),o((function(){return k.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=O(viewer._element)))})),o((function(){return r.analysisArea}),(function(e){switch(e){case"ARM_REGION":p=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION;break;case"ARM_ALL":p=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_ALL;break;case"ARM_NONE":p=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_NONE}0!=u.length&&w(u)})),o((function(){return r.wideMaxR}),(function(e){s.MaxVisibleValue=parseFloat(e),0!=u.length&&(viewer.scene.globe.SlopeSetting={slopeSetting:s,analysisMode:p})})),o((function(){return r.wideMinR}),(function(e){s.MinVisibleValue=parseFloat(e),0!=u.length&&(viewer.scene.globe.SlopeSetting={slopeSetting:s,analysisMode:p})})),o((function(){return r.slopeInterval}),(function(e){r.wideMinR=e[0],r.wideMaxR=e[1]})),o((function(){return r.displayMode}),(function(e){switch(e){case"FACE":d=SuperMap3D.SlopeSettingEnum.DisplayMode.FACE;break;case"ARROW":d=SuperMap3D.SlopeSettingEnum.DisplayMode.ARROW;break;case"FACE_AND_ARROW":d=SuperMap3D.SlopeSettingEnum.DisplayMode.FACE_AND_ARROW}s.DisplayMode=d,0!=u.length&&w(u)})),o((function(){return r.trans}),(function(e){s.Opacity=parseFloat(e),0!=u.length&&(viewer.scene.globe.SlopeSetting={slopeSetting:s,analysisMode:p})})),o((function(){return r.isEdit}),(function(e){e&&window.handlerPolygon?C(u,!1,w):(_(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),t((function(){s.destroy(),c.destroy(),s=void 0,c=void 0})),f(f({},n(r)),{},{startSlope:function(e){e.preventDefault(),tooltip.setVisible(!1),l&&(window.tooltip.showAt(" <p>点击鼠标左键绘制分析区域</p><p>点击鼠标右键结束绘制</p><p>坡度坡向分析需要带法线地形</p>","250px"),l=!1),s.DisplayMode=d,s.MaxVisibleValue=r.wideMaxR,s.MinVisibleValue=r.wideMinR,s.ColorTable=c,s.Opacity=r.trans,window.handlerPolygon||P("Polygon"),function(e,n,o){var t=!0;!1===n&&(t=n);var i=R(e);return new Promise((function(n,o){var r=window.tooltip,a=i.activeEvt.addEventListener((function(n){1==n?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="","Point"==e||"Marker"==e?document.body.classList.add("measureCur"):document.body.classList.add("drawCur")):(viewer.enableCursorStyle=!0,r.setVisible(!1),"Point"==e||"Marker"==e?document.body.classList.remove("measureCur"):document.body.classList.remove("drawCur"))})),l=i.movingEvt.addEventListener((function(n){if(n.x<200&&n.y<150)r.setVisible(!1);else if(i.polyline&&i.isDrawing){var o=g(i.positions);"Polygon"==e&&o.push(o[0]),window.polylineTransparent.show=!0,window.polylineTransparent.positions=o}})),s=i.drawEvt.addEventListener((function(o){if(!o.object.positions&&"Point"!=e&&"Box"!=e)return r.showAt(o,"<p>请绘制正确的多边形</p>"),i.polygon.show=!1,i.polyline.show=!1,i.deactivate(),void i.activate();if("Box"!=e){if("Point"==e||"Marker"==e)i.clear(),n({result:o});else{if(window.polylineTransparent.show=t,t&&"Polygon"==e&&t){i.polygon._polygon._material._color._value.alpha=.1;var p=g(o.object.positions);p.push(p[0]),window.polylineTransparent.positions=p}var d=M(o.object.positions);n({result:o,positions:d})}a(),l(),s()}else n({result:o})}))}))}("Polygon",r.lineVisible).then((function(e){w(u=e.positions);var n=window.handlerPolygon;n.polygon.show=!1,n.polyline.show=!1,n.deactivate(),r.isEdit&&C(u,!1,w)}),(function(e){console.log(e)})),handlerPolygon.activate(),scene.pickPositionSupported||b.errorMsg(E.NoPickPositionSupported)},clearSlope:function(e){var n,o;e.preventDefault(),u=[],window.handlerPolygon&&(viewer.scene.globe.SlopeSetting={analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_NONE},tooltip.setVisible(!1),(o=(n="Polygon")?R(n):window.handlerPolygon)&&(o.deactivate(),o.clear(),viewer.enableCursorStyle=!0,window.tooltip.setVisible(!1),window.polylineTransparent&&(window.polylineTransparent.show=!1)),_())},slopePosition:u})}var H={name:"Sm3dTerrainSlope",props:{analysisArea:{type:String},displayMode:{type:String},wideMaxR:{type:Number},wideMinR:{type:Number},trans:{type:Number},isEdit:{type:Boolean,default:!1},slopePositions:{type:Array},lineVisible:{type:Boolean,default:!0}},methods:{formatTooltip:function(e){return Resource.slope+e+"°"}},setup:function(e){var n=x(e);return{analysisArea:n.analysisArea,displayMode:n.displayMode,wideMaxR:n.wideMaxR,wideMinR:n.wideMinR,trans:n.trans,isEdit:n.isEdit,slopeInterval:n.slopeInterval,startSlope:n.startSlope,clearSlope:n.clearSlope}}},L={id:"terrain-slope-panel",class:"sm-panel"},V={class:"sm-function-module-sub-section",style:{margin:"0"}},T={class:"sm-half-L"},N={class:"label-S"},j={value:"ARM_REGION"},I={value:"ARM_ALL"},B={value:"ARM_NONE"},F={class:"sm-half-L"},W={style:{width:"40%"}},G={class:"boxchild"};H.render=function(e,n,o,t,u,w){var y=i("el-slider"),f=r("stopdrag"),g=r("drag");return a((l(),s("div",L,[a(p("div",V,[p("div",T,[p("label",N,d(e.Resource.analysisArea),1),a(p("select",{class:"sm-select-m",style:{width:"60%"},"onUpdate:modelValue":n[1]||(n[1]=function(e){return t.analysisArea=e})},[p("option",j,d(e.Resource.specifyPolygon),1),p("option",I,d(e.Resource.allRegionsAnalysis),1),p("option",B,d(e.Resource.allRegionsNOAnalysis),1)],512),[[c,t.analysisArea]])]),p("div",F,[p("label",W,d(e.Resource.slopeRange),1),p(y,{modelValue:t.slopeInterval,"onUpdate:modelValue":n[2]||(n[2]=function(e){return t.slopeInterval=e}),min:0,max:90,range:"",step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class","format-tooltip":w.formatTooltip,style:{width:"58%"}},null,8,["modelValue","format-tooltip"])]),p("div",G,[p("button",{onClick:n[3]||(n[3]=function(){return t.startSlope&&t.startSlope.apply(t,arguments)}),class:"tbtn",type:"button"},d(e.Resource.analyze),1),p("button",{onClick:n[4]||(n[4]=function(){return t.clearSlope&&t.clearSlope.apply(t,arguments)}),class:"tbtn tbtn-margin-left",type:"button"},d(e.Resource.clear),1)])],512),[[f]])],512)),[[g]])},H.__file="src/components/terrain-analysis/terrain-slope/terrain-slope.vue",H.install=function(e){e.component(H.name,H)};export default H;
