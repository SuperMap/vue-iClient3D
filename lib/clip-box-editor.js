import{reactive as e,toRefs as t,watch as r,onBeforeUnmount as i,resolveDirective as o,withDirectives as n,openBlock as a,createBlock as l,createVNode as p,vModelRadio as s,createTextVNode as u,toDisplayString as c}from"vue";function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function w(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,l=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){l=!0,n=e},f:function(){try{a||null==r.return||r.return()}finally{if(l)throw n}}}}var b,g,m={errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},M={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},h=(g=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=g,g).toLowerCase();var x=((b=void 0!==h?h:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||b.startsWith("ja"),M);function B(e){var t=function(e){var t=document.createElement("DIV");t.className="tooltip",this._div=t,this.message="",e.appendChild(t)};return t.prototype.setVisible=function(e){this._div.style.right=e?"10px":"-300px"},t.prototype.showAt=function(e,t){t&&(this._div.style.top=t),e&&(this.setVisible(!0),this._div.innerHTML=e)},new t(e)}var C=e({isViewer:!1,changeLayers:0,changeGeometrys:0});function S(o){var n=e({clipModel:"ClipInside"});if(o)for(var a in o)n.hasOwnProperty(a)?n[a]=o[a]:m.errorMsg(x.AttributeError+a);var l,p,s,u,c="clip_behind_all_plane";function d(){if(void 0!==s){var e=s.box.dimensions.getValue(),t=s.position.getValue(0),r=0;if(void 0!==s.orientation){var i=SuperMap3D.Matrix3.fromQuaternion(s.orientation._value,new SuperMap3D.Matrix3),o=SuperMap3D.Matrix4.fromRotationTranslation(i,SuperMap3D.Cartesian3.ZERO,new SuperMap3D.Matrix4),n=SuperMap3D.Matrix4.inverse(SuperMap3D.Transforms.eastNorthUpToFixedFrame(t),new SuperMap3D.Matrix4),a=SuperMap3D.Matrix4.multiply(n,o,new SuperMap3D.Matrix4),l=SuperMap3D.Matrix4.getMatrix3(a,new SuperMap3D.Matrix3);r=SuperMap3D.HeadingPitchRoll.fromQuaternion(SuperMap3D.Quaternion.fromRotationMatrix(l)).heading}f({dimensions:e,position:t,clipMode:c,heading:r})}}function f(e){for(var t=0,r=l.length;t<r;t++)l[t].setCustomClipBox(e)}function y(){if(p&&(p.deactivate(),tooltip.setVisible(!1)),s){var e,t=w(l);try{for(t.s();!(e=t.n()).done;){e.value.clearCustomClipBox()}}catch(e){t.e(e)}finally{t.f()}s=void 0,u.deactivate(),viewer.entities.removeAll(),p.clear()}}return C.isViewer&&(l=viewer.scene.layers.layerQueue,p=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box),window.tooltip||(window.tooltip=B(viewer._element))),r((function(){return C.isViewer}),(function(e){e&&(l=viewer.scene.layers.layerQueue,p=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box),window.tooltip||(window.tooltip=B(viewer._element)))})),r((function(){return n.clipModel}),(function(e){switch(e){case"ClipInside":c="clip_behind_all_plane";break;case"ClipOutside":c="clip_behind_any_plane"}s&&d()})),i((function(){u&&u.destroy(),u=void 0,l=void 0,p=void 0,s=void 0})),v(v({},t(n)),{},{BoxClipByEitor:function(){y(),u||(function(){for(var e=0,t=l.length;e<t;e++)l[e].selectEnabled=!1,l[e].clipLineColor=new SuperMap3D.Color(1,1,1,0)}(),p.movingEvt.addEventListener((function(e){p.isDrawing?tooltip.showAt(" <p>点击鼠标左键结束绘制box底面</p><p>移动鼠标绘制box高度</p><p>点击鼠标右键结束绘制</p>","230px"):tooltip.showAt(" <p>点击鼠标左键开始绘制box底面</p>","230px")})),p.drawEvt.addEventListener((function(e){var t={dimensions:(s=e.object).box.dimensions.getValue(),position:s.position.getValue(0),clipMode:c,heading:0};(u=new SuperMap3D.BoxEditor(viewer,s)).editEvt.addEventListener((function(e){s.box.dimensions=e.dimensions,s.position=e.position,s.orientation=e.orientation,d()})),u.activate(),f(t),tooltip.setVisible(!1),p.clear(),p.deactivate()}))),p.activate()},clearBoxClipByEitor:y})}var D={name:"Sm3dClipBoxByeditor",props:{clipModel:{type:String,default:"ClipInside"}},setup:function(e){var t=S(e);return{clipModel:t.clipModel,BoxClipByEitor:t.BoxClipByEitor,clearBoxClipByEitor:t.clearBoxClipByEitor}}},E={id:"clip-box-panel",class:"sm-panel"},O={class:"sm-function-module-sub-section",style:{margin:"0"}},_={class:"sm-half-L"},j={style:{width:"auto"}},V={style:{width:"auto"}},L={class:"boxchild"};D.render=function(e,t,r,i,d,f){var v=o("stopdrag"),y=o("drag");return n((a(),l("div",E,[n(p("div",O,[p("div",_,[p("label",j,[n(p("input",{type:"radio",value:"ClipInside","onUpdate:modelValue":t[1]||(t[1]=function(e){return i.clipModel=e})},null,512),[[s,i.clipModel]]),u(c(e.Resource.clipInside),1)]),p("label",V,[n(p("input",{type:"radio",value:"ClipOutside","onUpdate:modelValue":t[2]||(t[2]=function(e){return i.clipModel=e})},null,512),[[s,i.clipModel]]),u(c(e.Resource.clipOutside),1)])]),p("div",L,[p("button",{onClick:t[3]||(t[3]=function(){return i.BoxClipByEitor&&i.BoxClipByEitor.apply(i,arguments)}),class:"tbtn",type:"button"},c(e.Resource.clip),1),p("button",{onClick:t[4]||(t[4]=function(){return i.clearBoxClipByEitor&&i.clearBoxClipByEitor.apply(i,arguments)}),class:"tbtn tbtn-margin-left",type:"button"},c(e.Resource.clear),1)])],512),[[v]])],512)),[[y]])},D.__file="src/components/clip/clip-box-editor/clip-box-editor.vue",D.install=function(e){e.component(D.name,D)};export default D;
