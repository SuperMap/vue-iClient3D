import{reactive as e,onBeforeUnmount as t,onMounted as o,openBlock as l,createBlock as i,renderSlot as n,toRefs as a,watch as s,resolveDirective as r,withDirectives as d,createVNode as p,vModelRadio as c,createTextVNode as u,toDisplayString as m,vModelText as y,vShow as h,vModelCheckbox as w,resolveComponent as g,vModelSelect as f,createCommentVNode as b,ref as v,Fragment as S,pushScopeId as C,popScopeId as M,withScopeId as D,renderList as R,createStaticVNode as x,resolveDynamicComponent as L,unref as P}from"vue";const V=e({isViewer:!1,changeLayers:0,changeGeometrys:0}),k={setIsViewer(e){V.isViewer=e},setChangeLayers(e){V.changeLayers+=1},setGeometrys(e){V.changeGeometrys+=1,console.log(E.geometrys)}},E={geometrys:{},layers:null};var N={storeState:V,actions:k,storeDate:E},T=/^\s+|\s+$/g,A=/^[-+]0x[0-9a-f]+$/i,B=/^0b[01]+$/i,I=/^0o[0-7]+$/i,_=parseInt,F="object"==typeof global&&global&&global.Object===Object&&global,O="object"==typeof self&&self&&self.Object===Object&&self,U=F||O||Function("return this")(),H=Object.prototype.toString,z=Math.max,G=Math.min,W=function(){return U.Date.now()};function j(e,t,o){var l,i,n,a,s,r,d=0,p=!1,c=!1,u=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var o=l,n=i;return l=i=void 0,d=t,a=e.apply(n,o)}function y(e){return d=e,s=setTimeout(w,t),p?m(e):a}function h(e){var o=e-r;return void 0===r||o>=t||o<0||c&&e-d>=n}function w(){var e=W();if(h(e))return g(e);s=setTimeout(w,function(e){var o=t-(e-r);return c?G(o,n-(e-d)):o}(e))}function g(e){return s=void 0,u&&l?m(e):(l=i=void 0,a)}function f(){var e=W(),o=h(e);if(l=arguments,i=this,r=e,o){if(void 0===s)return y(r);if(c)return s=setTimeout(w,t),m(r)}return void 0===s&&(s=setTimeout(w,t)),a}return t=Q(t)||0,K(o)&&(p=!!o.leading,n=(c="maxWait"in o)?z(Q(o.maxWait)||0,t):n,u="trailing"in o?!!o.trailing:u),f.cancel=function(){void 0!==s&&clearTimeout(s),d=0,l=r=i=s=void 0},f.flush=function(){return void 0===s?a:g(W())},f}function K(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Q(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==H.call(e)}(e))return NaN;if(K(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=K(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(T,"");var o=B.test(e);return o||I.test(e)?_(e.slice(2),o?2:8):A.test(e)?NaN:+e}var X={analyze:"分析",clear:"清除",meter_second:"米/秒",meter:"米",isEdit:"编辑",isEditZ:"编辑Z轴",zAxis:"z-轴方向",visiblePositions:"坐标显示",longitude:"经度",latitude:"纬度",altitude:"高程",delete:"删除",analysisArea:"分析区域",specifyPolygon:"指定多边形区域",allRegionsAnalysis:"全部区域参与分析",allRegionsNOAnalysis:"全部区域不参与分析",slopeRange:"坡度区间",displayStyle:"显示样式",slope:"坡度",terrainExcavation:"地形开挖",terrainModify:"地形修改",terrainExcavationDepth:"开挖深度(米)",modify:"修改",excavation:"开挖",visibleHeight:"可见高度",isolineInterval:"等值距(米)",displayMode:"显示模式",contourFilling:"等高线填充",panelFilling:"等高面填充",contourPanelFilling:"等高线面填充",noColorTable:"无颜色表",currentHeight:"当前高程",floodSpeed:"淹没速度",add:"添加",scanMode:"扫描模式",lineScan:"线状扫描",circularScan:"环状扫描",scanColor:"扫描颜色",scanTexture:"扫描纹理",particleSystem:"粒子",flameTyle:"火焰类型",fountainTyle:"水柱类型",type:"类型",flame:"标准立体火焰",ringFire:"环形火",jetFire:"喷射火",flowFire:"流淌火",explosionFire:"爆炸火",fountain:"喷泉",fireWater:"消防水",setting:"参数设置",ringRadius:"环形半径",emissionRate:"粒子数量",particleSize:"粒子大小",particleLife:"生命周期",speedRange:"速度范围",startScale:"初始比例",endScale:"终止比例",gravity:"重力",launchType:"发射类型",circularRadiation:"圆形放射",spheroidRadiation:"球体放射",conicalRadiation:"圆锥体放射",boxedRadiation:"盒状放射",scale:"缩放",searchLayers:"查询图层",positionMode:"位置模式",intersects:"相交",disjoint:"相离",contains:"包含",geometryType:"模型选择",box:"立方体",search:"查询",viewportOne:"视口一",viewportTwo:"视口二",viewportThree:"视口三",viewportFour:"视口四",earthShow:"地球",timeline:"时间轴",atomsphereRender:"大气渲染",sunShow:"太阳",fogEffect:"雾化效果",depthAgainst:"深度检测",shadowMap:"阴影",underground:"开启地下",frameRate:"显示帧率",cloud:"云层",skyBox:"天空盒",rain:"雨",snow:"雪",viewMode:"视图模式",surfaceTransparency:"地表透明度",rollerMode:"卷帘模式",lrRoller:"左右卷帘",tbRoller:"上下卷帘",customRoller:"自定义卷帘",useRoller:"使用卷帘",shieldLeft:"屏蔽左侧",shieldRight:"屏蔽右侧",shieldTop:"屏蔽上侧",shieldBottom:"屏蔽下侧",videoUrl:"视频路径",fileType:"在线或本地文件",horizontal:"水平视角",vertical:"垂直视角",projectDistance:"投放距离",clipMode:"裁剪模式",clipInside:"裁剪内部",clipOutside:"裁剪外部",visibleLine:"显示投放线和模型",projection:"投放",clip:"裁剪",planeDirection:"平面方向",verticalGround:"竖直方向",parallelGround:"水平方向",lightColor:"光源颜色",cutoffDistance:"扩散距离",lightDecay:"衰减因子",lightIntensity:"光源强度",spotLightAngle:"聚光范围",lightModel:"光源模型",lightPositions:"光源坐标",multiViewport:"分屏显示",onePort:"不使用分屏",horizontalSnap:"水平分屏",verticalSnap:"垂直分屏",tripeSnap:"三视口",quadSnap:"四视口",flatten:"压平",facadeDistance:"立面图距离",facadeHeight:"立面图高度",setLodrange:"设置模型精细度",selectedLayer:"选择图层",noLayer:"暂无图层",lodrange:"缩放系数",setRegion:"指定范围",execute:"立面出图",fullScreen:"全屏",compass:"罗盘",zoomIn:"放大",zoomOut:"缩小",reset:"重置",operationType:"操作类型",stretch_cut:"拉伸与剖切",drilling:"钻孔",stretchHeight:"拉伸高度",drawLine:"画线",cut:"剖切",drillRadius:"钻孔半径",drillHeight:"钻孔深度",drawClip:"绘制裁剪",boxClip:"Box裁剪",foreColor:"前景色",lineColor:"线颜色",selectedColor:"选中色",selectColorMode:"选中色模式",mix:"混合",replace:"替换",bottomAltitude:"底部高层",layerTrans:"图层透明度",fillStyle:"填充风格",fillMode:"填充模式",lineMode:"线框模式",fillAndLine:"填充和线框模式",visibleDistanceMin:"最小可见距离",visibleDistanceMax:"最大可见距离",noS3mLayer:"暂无s3m图层",selectedPbr:"选择材质",selectedoffset:"选中偏移",offsetX:"沿X轴偏移",offsetY:"沿Y轴偏移",offsetZ:"沿Z轴偏移",polygonOffset:"多边形偏移",polygonOffsetFactor:"偏移因子",polygonOffsetUnit:"偏移量",brightness:"亮度",contrast:"对比度",hue:"色调",saturation:"饱和度",gamma:"伽马",closeShadow:"关闭阴影",openShadow:"开启阴影",shadowDarkness:"阴影明暗度",selectEnabled:"是否可选",multiChoose:"多选",cullEnabled:"双面渲染",visibility:"可见性",onlyShowSlection:"仅选中对象可见",onlyHideSlection:"仅选中对象隐藏",showAll:"显示全部",noImgLayer:"暂无影像图层",alpha:"透明度",transparentColor:"透明色",transparentColorTolerance:"透明色容限",designatedRoute:"指定路线",customRoute:"自定义路线",routeType:"路线选择",selectFlyRouteFile:"选择飞行线路文件",selectStop:"站点选择",showRoute:"显示路线",showStop:"显示站点",pause:"暂停",stop:"结束",start:"开始",flySpeed:"飞行速度",addedStops:"已添站点",save:"保存",customRouteOperating:"自定义路线操作",downLoad:"下载",polyline:"绘制线",polygon:"绘制面",drawModle:"绘制模式",space:"空间模式",stick:"贴地模式",postObject:"贴对象模式",lineColor:"线颜色",lineWidth:"线宽度",dottedColor:"间隔颜色",dottedLength:"分量长度",outLineColor:"轮廓颜色",outLineWidth:"轮廓宽度",glowStrength:"光晕强度",trailPercentage:"尾迹占比",polygonColor:"面颜色",gridWidth:"网格线宽",gridCount:"网格线数",gridCellAlpha:"单元透明度",stripeEvenColor:"偶数带颜色",stripeOddColor:"基数带颜色",stripeRepeat:"带条重复数",stripeOffset:"带条偏移量",downstripeOrientationLoad:"带条水平方向",stripeOrientation:"带条垂直方向",draw:"绘制",symbolType:"符号类型",symbolColor:"符号颜色",addType:"添加模式",singleAdd:"单个添加",lineAdd:"沿线添加",faceAdd:"区域添加",spacing:"间距",number:"数量",Xrotation:"绕X轴旋转（°）",Yrotation:"绕Y轴旋转（°）",Zrotation:"绕Z轴旋转（°）",ClipWidth:"裁剪宽度（米）",ClipHeight:"裁剪高度（米）",displayVisualsBody:"显示可视体",displayInvisibleBody:"显示不可视体",viewshedAnimation:"动态可视域",addheight:"附加高度",verticalFov:"垂直视角",horizontalFov:"水平视角",hintLineColor:"提示线颜色",visibleAreaColor:"可视区颜色",hiddenAreaColor:"不可视颜色",visibleBodyColor:"可视域体颜色",invisibleBodyColor:"不可视体颜色",polylineShow:"线显示",polygonShow:"面显示",bodyShow:"体显示",graphDisplay:"二维显示",limitBody:"限高体",skylineRadius:"分析半径",skylineColor:"天际线颜色",skyBodyColor:"天际体颜色",barrierColor:"障碍物颜色",highlightBarrier:"高亮障碍物",ignoreGlobe:"地表不参与分析",visibleColor:"可视区颜色",hiddenColor:"不可视颜色",showBarrierPoints:"显示障碍点",title1:"播放一天时间段内阳光和阴影动画",title2:"播放一年的阳光和阴影动画",title0:"停止动画",daylightFilter:"采光率过滤",shadowShow:"显示阴影",profileInformation:"剖面信息",observeRadius:"观察半径",allShow:"全部显示",visibleShow:"可视部分",hiddenShow:"不可视部分",selectMode:"模式选择",measureSpace:"空间量算",measureGround:"贴地量算",planeProjection:"平面投影",measureDistance:"测距",measureHeight:"测高",measureSurface:"测面",showContour:"显示等高线",startAngle:"开始角度",endAngle:"终止角度",isClosed:"是否封口",fire:"火焰",water:"水滴",fireworks:"烟花",displayEdit:"显示编辑框",parameterSet:"参数设置",emitSpeed:"发射速度",lifeCycle:"生命周期",speedRange:"速度范围",scaleRange:"比例范围",emitType:"发射类型",particleNumber:"发射数量",particleSize:"粒子大小",gravity:"重力",coneEmit:"圆锥体放射",sphereEmit:"球体放射",boxEmit:"盒状放射",addParticle:"添加",clearParticle:"清除"};function Y(e,t){let o=[];try{e&&e.forEach((e=>{o.push(viewer.scene.addS3MTilesLayerByScp(e.url,e.options))})),q(o,t,"S3M")}catch(e){let t=viewer.SuperMap3DWidget;if(t._showRenderLoopErrors){let o="渲染时发生错误，已停止渲染。";t.showErrorPanel(o,void 0,e)}}}function Z(e,t,o){t&&t.SceneToken&&(SuperMap3D.Credential.CREDENTIAL=new SuperMap3D.Credential(t.SceneToken));let l=!0;if(t&&t.autoSetView&&(l=t.autoSetView),function(e){if(null===e||""===e)return!1;if('"'==e.charAt(0)||"'"==e.charAt(0)){let t=/^['|"](.*)['|"]$/;e=e.replace(t,"$1")}return!0}(e))try{q([viewer.scene.open(e,void 0,{autoSetView:l})],o,"SCENE")}catch(e){let t=viewer.SuperMap3DWidget;if(t._showRenderLoopErrors){let o="渲染时发生错误，已停止渲染。";t.showErrorPanel(o,void 0,e)}}}function q(e,t,o){SuperMap3D.when.all(e,(function(e){console.log("layers:",e),E.layers=viewer.scene.layers.layerQueue,k.setChangeLayers(),t(e[0],o),E.layers.forEach((e=>{(!e.visibleDistanceMax||e.visibleDistanceMax>12e3)&&(e.visibleDistanceMax=12e3)}))}),(function(e){let t=viewer.SuperMap3DWidget;if(t._showRenderLoopErrors){let o="请检查url地址是否正确？";t.showErrorPanel(o,void 0,e)}}))}var J={addS3mLayers:Y,addScene:Z,addTerrainLayer:function(e,t){try{viewer.terrainProvider=new SuperMap3D.SuperMap3DTerrainProvider({url:e,isSct:t})}catch(e){let t=viewer.SuperMap3DWidget;if(t._showRenderLoopErrors){let o="渲染时发生错误，已停止渲染。";t.showErrorPanel(o,void 0,e)}}},addImageLayer:function(e){try{return viewer.imageryLayers.addImageryProvider(new SuperMap3D.SuperMapImageryProvider({url:e}))}catch(e){let t=viewer.SuperMap3DWidget;if(t._showRenderLoopErrors){let o="渲染时发生错误，已停止渲染。";t.showErrorPanel(o,void 0,e)}}},layersDelete:function(e,t,o){switch(e){case"S3M":viewer.scene.layers.remove(t),k.setChangeLayers(),o();break;case"IMG":let e;if("nunber"==typeof t)e=viewer.imageryLayers.get(t);else{let o=viewer.imageryLayers._layers;for(let l=0;l<o.length;l++)o[l].imageryProvider.tablename&&o[l].imageryProvider.tablename===t&&(e=o[l])}e&&(viewer.imageryLayers.remove(e),k.setChangeLayers(),o());break;case"TERRAIN":viewer.terrainProvider=new SuperMap3D.EllipsoidTerrainProvider,k.setChangeLayers(),o();break;case"MVT":viewer.scene.removeVectorTilesMap(t),k.setChangeLayers(),o()}},addMvtLayer:function(e,t,o){try{let l=viewer.scene.addVectorTilesMap({url:e,canvasWidth:512,name:t||"mvt",viewer:viewer});return SuperMap3D.when(l.readyPromise,(function(e){var t=l.rectangle;viewer.scene.camera.flyTo({destination:new SuperMap3D.Cartesian3.fromRadians(.5*(t.east+t.west),.5*(t.north+t.south),1e4),duration:0,orientation:{heading:0,roll:0}}),k.setChangeLayers(),o(l)})),l}catch(e){let t=viewer.SuperMap3DWidget;if(t._showRenderLoopErrors){let o="渲染时发生错误，已停止渲染。";t.showErrorPanel(o,void 0,e)}}}};function $(){}Object.assign($.prototype,{addEventListener:function(e,t,o=!1){void 0===this._listeners&&(this._listeners={}),this._mutex=this._mutex||{};const l=this._mutex;var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&(o&&(l[e]=t),i[e].push(t))},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var o=this._listeners;return void 0!==o[e]&&-1!==o[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var o=this._listeners[e];if(this._mutex[e]===t&&(this._mutex[e]=null),void 0!==o){var l=o.indexOf(t);-1!==l&&o.splice(l,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;var o=t.slice(0);if(this._mutex[e.type]){return void o.find((t=>t===this._mutex[e.type])).call(this,e)}for(var l=0,i=o.length;l<i;l++)o[l].call(this,e)}}},removeAllListener(){this._mutex={};for(const e in this._listeners)this._listeners[e]=[]}});var ee="CLICK",te="LEFT_DOWN",oe="LEFT_UP",le="MOUSE_MOVE",ie="RIGHT_CLICK",ne="LEFT_DOWN_MOUSE_MOVE";class ae extends ${constructor(e){super(),this.viewer=e,this.handler=new SuperMap3D.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.handler.setInputAction((e=>{this.dispatchEvent({type:ee,message:e})}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((e=>{this.press=!0,this.dispatchEvent({type:te,message:e})}),SuperMap3D.ScreenSpaceEventType.LEFT_DOWN),this.handler.setInputAction((e=>{this.press=!1,this.dispatchEvent({type:oe,message:e})}),SuperMap3D.ScreenSpaceEventType.LEFT_UP),this.handler.setInputAction((e=>{this.dispatchEvent({type:ie,message:e})}),SuperMap3D.ScreenSpaceEventType.RIGHT_CLICK),this.handler.setInputAction((e=>{this.press&&this.dispatchEvent({type:ne,message:e}),this.dispatchEvent({type:le,message:e})}),SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE)}addCameraMoveListener(e){this.viewer.camera.changed.addEventListener(e)}removeCameraMoveListener(e){this.viewer.camera.changed.removeEventListener(e)}}function se(e){let t=function(e){let t=document.createElement("DIV");t.className="tooltip",this._div=t,this.message="",e.appendChild(t)};return t.prototype.setVisible=function(e){this._div.style.right=e?"10px":"-300px"},t.prototype.showAt=function(e,t){t&&(this._div.style.top=t),e&&(this.setVisible(!0),this._div.innerHTML=e)},new t(e)}var re,de={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},pe=function(){let e=(navigator.language||navigator.browserLanguage).toLowerCase();return window.lang=e,e}().toLowerCase();var ce=((re=void 0!==pe?pe:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||re.startsWith("ja"),de);var ue={name:"Sm3dViewer",props:{sceneUrl:{type:String},s3mScps:{type:Array},afterInitviewer:{type:Function},openingAnimation:{type:Boolean}},setup(e){o((()=>{!function(e,o){let l;if(window.viewer&&(window.viewer=null),window.isPCBroswer=SuperMap3D.FeatureDetection.isPCBroswer())l=new SuperMap3D.Viewer("SuperMap3DContainer",{timeline:!0,baseLayerPicker:!1,imageryProvider:!1,navigation:!1,animation:!1,infoBox:!1,contextOptions:{msaaLevel:8,requestWebgl2:!0},shadows:!1,pcss:!0,shadowQuality:0,creditContainer:document.createElement("div")}),document.getElementsByClassName("supermap3d-viewer-timelineContainer")[0].style.visibility="hidden";else{l=new SuperMap3D.Viewer("SuperMap3DContainer",{selectionIndicator:!1,infoBox:!1,skyBox:!1,navigation:!1,contextOptions:{requestWebgl2:!0}});let e=l.scene;SuperMap3D.defined(e.sun)&&(e.globe.enableLighting=!1),SuperMap3D.defined(e.moon)&&(e.moon.show=!1),document.documentElement.style.height=window.innerHeight+"px",document.addEventListener("touchmove",(function(e){e.preventDefault()}),!1)}l.scene.debugShowFramesPerSecond=!0,l.scene.globe.baseColor=SuperMap3D.Color.BLACK,window.viewer=l,window.scene=l.scene,scene.moon.show=!1,l.eventManager=new ae(l);let i=l.SuperMap3DWidget;k.setIsViewer(!0),l.geocoder&&(l.geocoder.viewModel.geoKey="fvV2osxwuZWlY0wJb8FEb2i5"),window.tooltip||(window.tooltip=se(l._element));try{e&&e.openingAnimation&&l.camera.flyTo({destination:new SuperMap3D.Cartesian3(6788287.844465209,-41980756.10214644,29619220.04004376),duration:0,complete:function(){l.camera.flyTo({destination:new SuperMap3D.Cartesian3.fromDegrees(110.60396458865515,34.54408834959379,30644793.325518917),duration:5})}}),e&&e.afterInitviewer&&e.afterInitviewer(),e&&e.sceneUrl&&Z(e.sceneUrl,{},(e=>{})),e&&e.s3mScps&&Y(e.s3mScps)}catch(e){if(i._showRenderLoopErrors){let t=ce.showRenderLoopErrors;i.showErrorPanel(t,void 0,e)}}t((()=>{l.destroy(),window.viewer=void 0,window.scene=void 0}))}(e)}))}};const me={id:"SuperMap3DContainer",ref:"viewer"};ue.render=function(e,t,o,a,s,r){return l(),i("div",me,[n(e.$slots,"default")],512)},ue.__file="src/components/viewer/viewer.vue",ue.install=function(e){e.component(ue.name,ue)};const ye=(e,t)=>{if(!e||!t)return!0;let o=!0;if(Object.keys(e).length!=Object.keys(t).length)return!1;for(let l in e)if("object"==typeof e[l]){if(o=isSame(e[l],t[l]),!o)break}else if(e[l]!=t[l]){o=!1;break}return o},he=e=>{let t=[].concat(e),o=[];for(let e=0,l=t.length;e<l;e++){let l=SuperMap3D.Cartographic.fromCartesian(t[e]),i=SuperMap3D.Math.toDegrees(l.longitude),n=SuperMap3D.Math.toDegrees(l.latitude),a=l.height;-1==o.indexOf(i)&&-1==o.indexOf(n)&&(o.push(i),o.push(n),o.push(a))}return o};var we={Message:{errorMsg:e=>{console.log("error",e),alert("error："+e)},warnMsg:e=>{console.log("warn",e)},successMsg:e=>{console.log("success",e)}},axiosJsonp:e=>{if(e)return new Promise(((t,o)=>{window.jsonCallBack=e=>{t(e)};var l=document.createElement("script");l.type="text/javascript",l.src=`${e}&callback=jsonCallBack`,document.getElementsByTagName("head")[0].appendChild(l),setTimeout((()=>{document.getElementsByTagName("head")[0].removeChild(l)}),500)}));console.error("Axios.JSONP 至少需要一个url参数!")},isEqualArr:ye,CartesiantoDegrees:he,CartesiantoDegreesObjs:e=>{let t=[].concat(e),o=[];for(let e=0,l=t.length;e<l;e++){let l=SuperMap3D.Cartographic.fromCartesian(t[e]),i={longitude:SuperMap3D.Math.toDegrees(l.longitude),latitude:SuperMap3D.Math.toDegrees(l.latitude),height:l.height};o.push(i)}return o},unique:e=>{let t=[],o={};for(var l=0;l<e.length;l++)o[e[l]]||(t.push(e[l]),o[e[l]]=1);return t},gradientColors:function(e,t,o,l){var i,n,a,s,r=[],d=[];l=l||1;var p,c=function(e){return Math.pow(e/255,l)};for(e=u(e).map(c),t=u(t).map(c),i=0;i<o;i++){for(s=1-(a=i/(o-1)),n=0;n<3;n++)d[n]=1===(p=Math.round(255*Math.pow(e[n]*s+t[n]*a,1/l)).toString(16)).length?"0"+p:p;r.push("#"+d.join(""))}return r;function u(e){return 4===e.length?e.substr(1).split("").map((function(e){return 17*parseInt(e,16)})):[e.substr(1,2),e.substr(3,2),e.substr(5,2)].map((function(e){return parseInt(e,16)}))}},getAngleAndRadian:function(e,t){const o=SuperMap3D.Transforms.eastNorthUpToFixedFrame(e),l=SuperMap3D.Cartesian3.subtract(t,e,new SuperMap3D.Cartesian3),i=SuperMap3D.Matrix4.multiplyByPointAsVector(SuperMap3D.Matrix4.inverse(o,new SuperMap3D.Matrix4),l,new SuperMap3D.Cartesian3),n=SuperMap3D.Cartesian3.normalize(i,new SuperMap3D.Cartesian3),a=Math.atan2(n.y,n.x)-SuperMap3D.Math.PI_OVER_TWO;let s=SuperMap3D.Math.TWO_PI-SuperMap3D.Math.zeroToTwoPi(a);var r=s*(180/Math.PI);return r<0&&(r+=360),{angle:r,radian:s}},CartographictoDegrees:e=>[SuperMap3D.Math.toDegrees(e.longitude),SuperMap3D.Math.toDegrees(e.latitude),e.height],getPitch:function(e,t){let o=SuperMap3D.Transforms.eastNorthUpToFixedFrame(e);const l=SuperMap3D.Cartesian3.subtract(t,e,new SuperMap3D.Cartesian3);let i=SuperMap3D.Matrix4.multiplyByPointAsVector(SuperMap3D.Matrix4.inverse(o,o),l,l);SuperMap3D.Cartesian3.normalize(i,i);let n=SuperMap3D.Math.PI_OVER_TWO-SuperMap3D.Math.acosClamped(i.z);var a=n*(180/Math.PI);return a<0&&(a+=360),{angle:a,radian:n}}};const ge=function(e,t){let o=0;switch(t&&(o=t),e){case"Point":window.handlerPoint=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Point);break;case"Polyline":window.handlerPolyline=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Line,o);break;case"Polygon":window.handlerPolygon=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Polygon,o);break;case"Marker":window.handlerMarker=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Marker,o);break;case"Box":window.handlerBox=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box,o)}window.tooltip||(window.tooltip=function(e){var t=function(e){var t=document.createElement("DIV");t.className="twipsy right";var o=document.createElement("DIV");o.className="twipsy-arrow",t.appendChild(o);var l=document.createElement("DIV");l.className="twipsy-inner",t.appendChild(l),this._div=t,this._title=l,this.message="",e.appendChild(t);var i=this;t.onmousemove=function(e){i.showAt({x:e.clientX,y:e.clientY},i.message)}};return t.prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},t.prototype.showAt=function(e,t){e&&t&&(this.setVisible(!0),this._title.innerHTML=t,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px",this.message=t)},new t(e)}(viewer._element)),window.polylineCollection||(window.polylineCollection=new SuperMap3D.PolylineCollection({translucentRS:SuperMap3D.RenderState.fromCache({depthMask:!1,depthTest:{enabled:!1}})}),window.polylineTransparent=window.polylineCollection.add({width:2,material:SuperMap3D.Material.fromType(SuperMap3D.Material.ColorType,{color:SuperMap3D.Color.fromCssColorString("#51ff00").withAlpha(.3)})}),viewer.scene.primitives.add(window.polylineCollection))},fe=function(e,t,o){let l=!0;!1===t&&(l=t);let i=ve(e);return new Promise(((t,o)=>{let n=window.tooltip,a=i.activeEvt.addEventListener((t=>{1==t?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="","Point"==e||"Marker"==e?document.body.classList.add("measureCur"):document.body.classList.add("drawCur")):(viewer.enableCursorStyle=!0,n.setVisible(!1),"Point"==e||"Marker"==e?document.body.classList.remove("measureCur"):document.body.classList.remove("drawCur"))})),s=i.movingEvt.addEventListener((t=>{if(t.x<200&&t.y<150)n.setVisible(!1);else if(i.polyline&&i.isDrawing){let t=[...i.positions];"Polygon"==e&&t.push(t[0]),window.polylineTransparent.show=!0,window.polylineTransparent.positions=t}})),r=i.drawEvt.addEventListener((o=>{if(!o.object.positions&&"Point"!=e&&"Box"!=e)return n.showAt(o,"<p>请绘制正确的多边形</p>"),i.polygon.show=!1,i.polyline.show=!1,i.deactivate(),void i.activate();if("Box"!=e){if("Point"==e||"Marker"==e)i.clear(),t({result:o});else{if(window.polylineTransparent.show=l,l&&"Polygon"==e&&l){i.polygon._polygon._material._color._value.alpha=.1;let e=[...o.object.positions];e.push(e[0]),window.polylineTransparent.positions=e}let n=he(o.object.positions);t({result:o,positions:n})}a(),s(),r()}else t({result:o})}))}))},be=e=>{let t;t=e?ve(e):window.handlerPolygon,t&&(t.deactivate(),t.clear(),viewer.enableCursorStyle=!0,window.tooltip.setVisible(!1),window.polylineTransparent&&(window.polylineTransparent.show=!1))},ve=e=>{let t;switch(e){case"Point":t=window.handlerPoint;break;case"Polyline":t=window.handlerPolyline;break;case"Polygon":t=window.handlerPolygon;break;case"Marker":t=window.handlerMarker;break;case"Box":t=window.handlerBox}return t};var Se=ge,Ce=fe,Me=be;const De=(e,t,o)=>{window.selectHandler||(window.selectHandler=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas));let l=window.selectHandler;window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!0),l.setInputAction((()=>{console.log("viewer.selectedEntity:",viewer.selectedEntity);let i=viewer.selectedEntity,n=window.editHandler;i&&(n&&n&&n.clear(),n?(n.deactivate(),n.setEditObject(i),n.activate()):(window.editHandler=new SuperMap3D.EditHandler(viewer,i),window.editHandler.isEditZ=t||!1,window.editHandler.activate()),l.setInputAction((()=>{if(i=viewer.selectedEntity,n=window.editHandler,i&&n&&n._positions){let t=he(n._positions);if(ye(e,t))return;if(e=t,o&&o(t,window.editHandler),window.handlerPolygon&&window.handlerPolygon.polygon&&window.handlerPolygon.polygon.show){let e=[...n._positions];e.push(e[0]),window.polylineTransparent.positions=e}}}),SuperMap3D.ScreenSpaceEventType.LEFT_UP))}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)},Re=()=>{window.editHandler&&(window.editHandler.deactivate(),window.editHandler.clear()),window.selectHandler&&(window.selectHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_UP),window.selectHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),window.selectHandler.destroy(),window.selectHandler=null)};var xe={name:"Sm3dTerrainOperation",props:{digDepth:{type:Number,default:500},digPositions:{type:Array},modifyPositions:{type:Array},isEdit:{type:Boolean,default:!1},isEditZ:{type:Boolean,default:!1},lineVisible:{type:Boolean,default:!0}},setup(t){let{digDepth:o,isEdit:l,isEditZ:i,terrainVisible:n,digTerrain:r,clearDig:d,modifyTerrain:p,clearModify:c,operationType:u}=function(t){let o=e({digDepth:500,isEdit:!1,isEditZ:!1,lineVisible:!0,digPositions:[],modifyPositions:[],operationType:"dig",terrainVisible:"terrainVisible"});if(t)for(let e in t)o.hasOwnProperty(e)?o[e]=t[e]:we.Message.errorMsg(ce.AttributeError+e);let l=[],i=[],n="dig";function r(e){e&&(l=e),viewer.scene.globe.removeAllExcavationRegion(),viewer.scene.globe.addExcavationRegion({name:"dig_terrain",position:l,height:o.digDepth,transparent:!1})}function d(e){e&&(i=e),viewer.scene.globe.removeAllModifyRegion(),viewer.scene.globe.addModifyRegion({name:"ggg",position:i})}return t&&t.digPositions&&r(t.digPositions),s((()=>o.digDepth),(e=>{0!=l.length&&r()})),s((()=>o.isEdit),(e=>{e&&window.handlerPolygon?"dig"===n?De(l,o.isEditZ,r):De(i,o.isEditZ,d):(Re(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),s((()=>o.isEditZ),(e=>{window.editHandler&&(window.editHandler.isEditZ=e)})),s((()=>o.terrainVisible),(e=>{switch(e){case"terrainVisible":viewer.terrainProvider._visible=!0;break;case"terrainUnvisible":viewer.terrainProvider._visible=!1}})),{...a(o),digTerrain:function(e){o.isEdit=!1,e.preventDefault(),n="dig",window.handlerPolygon||ge("Polygon"),fe("Polygon",o.lineVisible).then((e=>{l=e.positions;let t=window.handlerPolygon;r(e.positions),t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),o.isEdit&&De(l,o.isEditZ,r)}),(e=>{console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||we.Message.errorMsg(ce.NoPickPositionSupported)},clearDig:function(e){e.preventDefault(),l=[],o.isEdit=!1,window.handlerPolygon&&(viewer.scene.globe.removeAllExcavationRegion(),be("Polygon"),Re())},modifyTerrain:function(e){e.preventDefault(),n="modify",window.handlerPolygon||ge("Polygon"),fe("Polygon",o.lineVisible).then((e=>{i=e.positions;let t=window.handlerPolygon;d(e.positions),t.polygon.show=!1,t.polyline.show=!1,o.isEdit&&De(i,o.isEditZ,d)}),(e=>{console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||alert("不支持深度纹理,无法绘制多边形，地形修改功能无法使用！")},clearModify:function(e){e.preventDefault(),window.handlerPolygon&&(viewer.scene.globe.removeAllModifyRegion(),be("Polygon"),Re())},digPosition:l,modifyPosition:i}}(t);return{digDepth:o,isEdit:l,isEditZ:i,terrainVisible:n,digTerrain:r,clearDig:d,modifyTerrain:p,clearModify:c,operationType:u}}};const Le={id:"terrain-operation-panel",class:"sm-panel"},Pe={class:"sm-function-module-sub-section",style:{margin:"0"}},Ve={class:"sm-half-L"},ke={style:{width:"auto"}},Ee={style:{width:"auto"}},Ne={class:"sm-half-L"},Te={style:{width:"35%"}},Ae={class:"sm-half-L"},Be={style:{width:"auto"}},Ie={style:{width:"auto"}},_e={class:"boxchild"},Fe={class:"boxchild"};xe.render=function(e,t,o,n,a,s){const g=r("stopdrag"),f=r("drag");return d((l(),i("div",Le,[d(p("div",Pe,[p("div",Ve,[p("label",ke,[d(p("input",{type:"radio",value:"dig","onUpdate:modelValue":t[1]||(t[1]=e=>n.operationType=e)},null,512),[[c,n.operationType]]),u(" "+m(e.Resource.terrainExcavation),1)]),p("label",Ee,[d(p("input",{type:"radio",value:"modify","onUpdate:modelValue":t[2]||(t[2]=e=>n.operationType=e)},null,512),[[c,n.operationType]]),u(" "+m(e.Resource.terrainModify),1)])]),d(p("div",Ne,[p("label",Te,m(e.Resource.terrainExcavationDepth),1),d(p("input",{class:"sm-input",style:{width:"43%"},type:"number",min:"0","onUpdate:modelValue":t[3]||(t[3]=e=>n.digDepth=e)},null,512),[[y,n.digDepth]])],512),[[h,"dig"===n.operationType]]),p("div",Ae,[p("label",Be,[d(p("input",{checked:"",type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>n.isEdit=e)},null,512),[[w,n.isEdit]]),u(" "+m(e.Resource.isEdit),1)]),d(p("label",Ie,[d(p("input",{checked:"",type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=e=>n.isEditZ=e)},null,512),[[w,n.isEditZ]]),u(" "+m(e.Resource.isEditZ),1)],512),[[h,"modify"===n.operationType]])]),d(p("div",_e,[p("button",{onClick:t[6]||(t[6]=(...e)=>n.modifyTerrain&&n.modifyTerrain(...e)),class:"tbtn",type:"button"},m(e.Resource.modify),1),p("button",{onClick:t[7]||(t[7]=(...e)=>n.clearModify&&n.clearModify(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.clear),1)],512),[[h,"modify"===n.operationType]]),d(p("div",Fe,[p("button",{onClick:t[8]||(t[8]=(...e)=>n.digTerrain&&n.digTerrain(...e)),onTouchstart:t[9]||(t[9]=(...e)=>n.digTerrain&&n.digTerrain(...e)),class:"tbtn",type:"button"},m(e.Resource.excavation),33),p("button",{onClick:t[10]||(t[10]=(...e)=>n.clearDig&&n.clearDig(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.clear),1)],512),[[h,"dig"===n.operationType]])],512),[[g]])],512)),[[f]])},xe.__file="src/components/terrain-analysis/terrain-operation/terrain-operation.vue",xe.install=function(e){e.component(xe.name,xe)};var Oe={name:"Sm3dTerrainSlope",props:{analysisArea:{type:String},displayMode:{type:String},wideMaxR:{type:Number},wideMinR:{type:Number},trans:{type:Number},isEdit:{type:Boolean,default:!1},slopePositions:{type:Array},lineVisible:{type:Boolean,default:!0}},methods:{formatTooltip:e=>Resource.slope+e+"°"},setup(o){let{analysisArea:l,displayMode:i,wideMaxR:n,wideMinR:r,trans:d,isEdit:p,slopeInterval:c,startSlope:u,clearSlope:m}=function(o){let l=e({analysisArea:"ARM_REGION",displayMode:"FACE_AND_ARROW",wideMaxR:90,wideMinR:0,slopeInterval:[0,90],trans:.8,isEdit:!1,slopePositions:[],lineVisible:!0});if(o)for(let e in o)l.hasOwnProperty(e)?l[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let i=!0,n=new SuperMap3D.SlopeSetting,r=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode[l.analysisArea],d=SuperMap3D.SlopeSettingEnum.DisplayMode[l.displayMode],p=new SuperMap3D.ColorTable,c=[];function u(e){e&&(c=e),n.CoverageArea=e,viewer.scene.globe.SlopeSetting={slopeSetting:n,analysisMode:r}}return p.insert(80,new SuperMap3D.Color(1,0,0)),p.insert(50,new SuperMap3D.Color(221/255,224/255,7/255)),p.insert(30,new SuperMap3D.Color(20/255,187/255,18/255)),p.insert(20,new SuperMap3D.Color(0,161/255,1)),p.insert(0,new SuperMap3D.Color(9/255,9/255,1)),o&&o.slopePositions&&u(o.slopePositions),V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element))),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)))})),s((()=>l.analysisArea),(e=>{switch(e){case"ARM_REGION":r=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION;break;case"ARM_ALL":r=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_ALL;break;case"ARM_NONE":r=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_NONE}0!=c.length&&u(c)})),s((()=>l.wideMaxR),(e=>{n.MaxVisibleValue=parseFloat(e),0!=c.length&&(viewer.scene.globe.SlopeSetting={slopeSetting:n,analysisMode:r})})),s((()=>l.wideMinR),(e=>{n.MinVisibleValue=parseFloat(e),0!=c.length&&(viewer.scene.globe.SlopeSetting={slopeSetting:n,analysisMode:r})})),s((()=>l.slopeInterval),(e=>{l.wideMinR=e[0],l.wideMaxR=e[1]})),s((()=>l.displayMode),(e=>{switch(e){case"FACE":d=SuperMap3D.SlopeSettingEnum.DisplayMode.FACE;break;case"ARROW":d=SuperMap3D.SlopeSettingEnum.DisplayMode.ARROW;break;case"FACE_AND_ARROW":d=SuperMap3D.SlopeSettingEnum.DisplayMode.FACE_AND_ARROW}n.DisplayMode=d,0!=c.length&&u(c)})),s((()=>l.trans),(e=>{n.Opacity=parseFloat(e),0!=c.length&&(viewer.scene.globe.SlopeSetting={slopeSetting:n,analysisMode:r})})),s((()=>l.isEdit),(e=>{e&&window.handlerPolygon?De(c,!1,u):(Re(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),t((()=>{n.destroy(),p.destroy(),n=void 0,p=void 0})),{...a(l),startSlope:function(e){e.preventDefault(),tooltip.setVisible(!1),i&&(window.tooltip.showAt(" <p>点击鼠标左键绘制分析区域</p><p>点击鼠标右键结束绘制</p><p>坡度坡向分析需要带法线地形</p>","250px"),i=!1),n.DisplayMode=d,n.MaxVisibleValue=l.wideMaxR,n.MinVisibleValue=l.wideMinR,n.ColorTable=p,n.Opacity=l.trans,window.handlerPolygon||ge("Polygon"),fe("Polygon",l.lineVisible).then((e=>{c=e.positions,u(c);let t=window.handlerPolygon;t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),l.isEdit&&De(c,!1,u)}),(e=>{console.log(e)})),handlerPolygon.activate(),scene.pickPositionSupported||we.Message.errorMsg(ce.NoPickPositionSupported)},clearSlope:function(e){e.preventDefault(),c=[],window.handlerPolygon&&(viewer.scene.globe.SlopeSetting={analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_NONE},tooltip.setVisible(!1),be("Polygon"),Re())},slopePosition:c}}(o);return{analysisArea:l,displayMode:i,wideMaxR:n,wideMinR:r,trans:d,isEdit:p,slopeInterval:c,startSlope:u,clearSlope:m}}};const Ue={id:"terrain-slope-panel",class:"sm-panel"},He={class:"sm-function-module-sub-section",style:{margin:"0"}},ze={class:"sm-half-L"},Ge={class:"label-S"},We={value:"ARM_REGION"},je={value:"ARM_ALL"},Ke={value:"ARM_NONE"},Qe={class:"sm-half-L"},Xe={style:{width:"40%"}},Ye={class:"boxchild"};function Ze(o){let l=e({fillMaxHeight:9e3,fillMinHeight:0,fillHeight:[0,9e3],equivalentIsoline:100,fillOptionsSelected:"Line",lineColor:"#FF8040",isEdit:!1,isolinePositions:[],lineVisible:!0});if(o)for(let e in o)l.hasOwnProperty(e)?l[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let i=new SuperMap3D.HypsometricSetting,n=SuperMap3D.HypsometricSettingEnum.DisplayMode.LINE,r=new SuperMap3D.ColorTable;!function(e){e.insert(5597.06640625,new SuperMap3D.Color(0,0,1)),e.insert(5406.387386067709,new SuperMap3D.Color(0,.2,1)),e.insert(5215.708365885417,new SuperMap3D.Color(0,.4,1)),e.insert(5025.029345703126,new SuperMap3D.Color(0,.6,1)),e.insert(4834.350325520834,new SuperMap3D.Color(0,.8,1)),e.insert(4643.671305338543,new SuperMap3D.Color(0,1,1)),e.insert(4452.992285156252,new SuperMap3D.Color(.2,1,.8)),e.insert(4262.313264973961,new SuperMap3D.Color(.4,1,.6)),e.insert(4071.6342447916695,new SuperMap3D.Color(.6,1,.4)),e.insert(3880.955224609378,new SuperMap3D.Color(.8,1,.2)),e.insert(3690.2762044270867,new SuperMap3D.Color(1,1,0)),e.insert(3499.5971842447952,new SuperMap3D.Color(1,.8,0)),e.insert(3308.918164062504,new SuperMap3D.Color(1,.6,0)),e.insert(3118.239143880213,new SuperMap3D.Color(1,.4,0)),e.insert(2927.5601236979214,new SuperMap3D.Color(1,.2,0)),e.insert(2736.88110351563,new SuperMap3D.Color(1,0,0))}(r);let d=[];function p(e){e&&(d=e),0!=d.length&&(e&&(i.CoverageArea=e),viewer.scene.globe.HypsometricSetting={hypsometricSetting:i,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})}return o&&o.isolinePositions&&p(o.isolinePositions),s((()=>l.fillMaxHeight),(e=>{i.MaxVisibleValue=parseFloat(e),0!=d.length&&p()})),s((()=>l.fillMinHeight),(e=>{i.MinVisibleValue=parseFloat(e),0!=d.length&&p()})),s((()=>l.fillHeight),(e=>{l.fillMinHeight=e[0],l.fillMaxHeight=e[1]})),s((()=>l.equivalentIsoline),(e=>{i.LineInterval=parseFloat(e),0!=d.length&&p()})),s((()=>l.lineColor),(e=>{if(e){if(i._lineColor=SuperMap3D.Color.fromCssColorString(e),0==d.length)return;p()}else console.warn("err: color is  null")})),s((()=>l.fillOptionsSelected),(e=>{switch(e){case"None":n=void 0;break;case"Line":n=SuperMap3D.HypsometricSettingEnum.DisplayMode.LINE,i.Opacity=1;break;case"Region":n=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE,i.Opacity=.5;break;case"Line_Region":n=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE_AND_LINE,i.Opacity=.5}i.DisplayMode=n,0!=d.length&&p(d)})),s((()=>l.isEdit),(e=>{e&&window.handlerPolygon?De(d,!1,p):(Re(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),t((()=>{i.destroy(),r.destroy(),i=void 0,r=void 0})),{...a(l),isoLineAnalysis:function(e){e.preventDefault(),i.DisplayMode=n,i._lineColor=SuperMap3D.Color.fromCssColorString(l.lineColor),i.LineInterval=parseFloat(l.equivalentIsoline),i.MaxVisibleValue=parseFloat(l.fillMaxHeight),i.MinVisibleValue=parseFloat(l.fillMinHeight),i.ColorTableMinKey=2736.88110351563,i.ColorTableMaxKey=5597.06640625,i.ColorTable=r,window.handlerPolygon||ge("Polygon"),fe("Polygon",l.lineVisible).then((e=>{d=e.positions;let t=window.handlerPolygon;p(d),t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),l.isEdit&&De(d,!1,p)}),(e=>{console.log(e)})),window.handlerPolygon.activate(),scene.pickPositionSupported||we.Message.errorMsg(ce.NoPickPositionSupported)},clearIsoLine:function(e){e.preventDefault(),d=[],window.handlerPolygon&&(viewer.scene.globe.HypsometricSetting=void 0,i&&(i.MaxVisibleValue=-1e3),i&&(i.MinVisibleValue=-1e3),be("Polygon"),Re())},isolinePosition:d}}Oe.render=function(e,t,o,n,a,s){const c=g("el-slider"),u=r("stopdrag"),y=r("drag");return d((l(),i("div",Ue,[d(p("div",He,[p("div",ze,[p("label",Ge,m(e.Resource.analysisArea),1),d(p("select",{class:"sm-select-m",style:{width:"60%"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.analysisArea=e)},[p("option",We,m(e.Resource.specifyPolygon),1),p("option",je,m(e.Resource.allRegionsAnalysis),1),p("option",Ke,m(e.Resource.allRegionsNOAnalysis),1)],512),[[f,n.analysisArea]])]),p("div",Qe,[p("label",Xe,m(e.Resource.slopeRange),1),p(c,{modelValue:n.slopeInterval,"onUpdate:modelValue":t[2]||(t[2]=e=>n.slopeInterval=e),min:0,max:90,range:"",step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class","format-tooltip":s.formatTooltip,style:{width:"58%"}},null,8,["modelValue","format-tooltip"])]),p("div",Ye,[p("button",{onClick:t[3]||(t[3]=(...e)=>n.startSlope&&n.startSlope(...e)),class:"tbtn",type:"button"},m(e.Resource.analyze),1),p("button",{onClick:t[4]||(t[4]=(...e)=>n.clearSlope&&n.clearSlope(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.clear),1)])],512),[[u]])],512)),[[y]])},Oe.__file="src/components/terrain-analysis/terrain-slope/terrain-slope.vue",Oe.install=function(e){e.component(Oe.name,Oe)};var qe={name:"Sm3dTerrainIsoline",props:{fillMaxHeight:{type:Number},fillMinHeight:{type:Number},equivalentIsoline:{type:Number},lineColor:{type:String},fillOptionsSelected:{type:String},isEdit:{type:Boolean,default:!1},isolinePositions:{type:Array},lineVisible:{type:Boolean,default:!0}},methods:{formatTooltip:e=>e+Resource.meter,formatTooltip2:e=>e+Resource.meter_second},setup(e){let{fillMaxHeight:t,fillMinHeight:o,fillHeight:l,equivalentIsoline:i,lineColor:n,fillOptionsSelected:a,isEdit:s,isoLineAnalysis:r,clearIsoLine:d}=Ze(e);return{fillMaxHeight:t,fillMinHeight:o,fillHeight:l,equivalentIsoline:i,lineColor:n,fillOptionsSelected:a,isEdit:s,isoLineAnalysis:r,clearIsoLine:d}}};const Je={id:"terrain-isoline-panel",class:"sm-panel"},$e={class:"sm-function-module-sub-section",style:{margin:"0"}},et={class:"sm-half-L"},tt={style:{width:"40%"}},ot={class:"sm-half-L"},lt={style:{width:"40%"}},it={class:"sm-half-L"},nt={style:{width:"40%"}},at={value:"Line"},st={value:"Region"},rt={value:"Line_Region"},dt={value:"None"},pt={class:"boxchild"};function ct(o){let l=e({maxHeight:9e3,minHeight:1e3,floodHeight:[1e3,9e3],currentHeight:1e3,floodTrans:.8,cheackedBand:"band1",colorBandShow:!1,floodSpeed:800,floodPositions:[],lineVisible:!0});if(o)for(let e in o)l.hasOwnProperty(e)?l[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let i,n=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE,r=new SuperMap3D.HypsometricSetting,d=new SuperMap3D.ColorTable;d.insert(9e3,new SuperMap3D.Color(0,39/255,148/255)),d.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));let p=[];function c(e){e&&(p=e);let t=parseFloat(l.minHeight);r.CoverageArea=e,i=setInterval("flood()",100),window.flood=()=>{if(t<=l.maxHeight&&(l.currentHeight=parseInt(t)),t>l.maxHeight)return l.currentHeight=l.maxHeight,void clearInterval(i);r.MaxVisibleValue=t;try{viewer.scene.globe.HypsometricSetting={hypsometricSetting:r,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION}}catch(e){console.log(e),clearInterval(i)}t+=parseFloat(l.floodSpeed)/10}}return s((()=>l.floodTrans),(e=>{r.Opacity=parseFloat(e),0!=p.length&&(viewer.scene.globe.HypsometricSetting={hypsometricSetting:r,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})})),s((()=>l.floodHeight),(e=>{l.minHeight=e[0],l.maxHeight=e[1]})),s((()=>l.minHeight),(e=>{r.MinVisibleValue=parseInt(e),0!=p.length?viewer.scene.globe.HypsometricSetting={hypsometricSetting:r,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION}:l.currentHeight=parseInt(e)})),s((()=>l.maxHeight),(e=>{r.MaxVisibleValue=parseInt(e),0!=p.length&&(viewer.scene.globe.HypsometricSetting={hypsometricSetting:r,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})})),s((()=>l.cheackedBand),(e=>{d=function(e){let t=new SuperMap3D.ColorTable;switch(e){case"band1":t.insert(9e3,new SuperMap3D.Color(0,39/255,148/255)),t.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));break;case"band2":t.insert(9e3,new SuperMap3D.Color(162/255,251/255,194/255)),t.insert(0,new SuperMap3D.Color(1,103/255,103/255));break;case"band3":t.insert(9e3,new SuperMap3D.Color(230/255,198/255,1)),t.insert(0,new SuperMap3D.Color(157/255,0,1));break;case"band4":t.insert(9e3,new SuperMap3D.Color(210/255,15/255,15/255)),t.insert(6e3,new SuperMap3D.Color(221/255,224/255,7/255)),t.insert(5e3,new SuperMap3D.Color(20/255,187/255,18/255)),t.insert(4e3,new SuperMap3D.Color(0,161/255,1)),t.insert(0,new SuperMap3D.Color(9/255,9/255,212/255));break;case"band5":t.insert(9e3,new SuperMap3D.Color(186/255,1,229/255)),t.insert(0,new SuperMap3D.Color(26/255,185/255,156/255));break;default:t.insert(9e3,new SuperMap3D.Color(0,39/255,148/255)),t.insert(0,new SuperMap3D.Color(149/255,232/255,249/255))}return t}(e),r.ColorTable=d,0!=p.length&&i&&(viewer.scene.globe.HypsometricSetting={hypsometricSetting:r,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})})),t((()=>{r.destroy(),d.destroy(),r=void 0,d=void 0})),{...a(l),floodBegin:function(e){e.preventDefault(),r.DisplayMode=n,r._lineColor=new SuperMap3D.Color(1,0,0,1),r.MinVisibleValue=l.minHeight,r.MaxVisibleValue=0,r.ColorTableMinKey=1,r.ColorTableMaxKey=9e3,r.ColorTable=d,r.Opacity=l.floodTrans,r.LineInterval=200,window.handlerPolygon||Se("Polygon"),o&&o.floodPositions?c(o.floodPositions):(Ce("Polygon",l.lineVisible).then((e=>{let t=window.handlerPolygon;c(e.positions),t.polygon.show=!1,t.deactivate()}),(e=>{console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||we.Message.errorMsg(ce.NoPickPositionSupported))},floodClear:function(e){e.preventDefault(),p=[],window.handlerPolygon&&(viewer.scene.globe.HypsometricSetting=void 0,clearInterval(i),Me("Polygon"))},changeColor:function(e){l.colorBandShow=!1,l.cheackedBand=e},floodPosition:p}}qe.render=function(e,t,o,n,a,s){const c=g("el-slider"),u=r("stopdrag"),h=r("drag");return d((l(),i("div",Je,[d(p("div",$e,[p("div",et,[p("label",tt,m(e.Resource.visibleHeight),1),p(c,{modelValue:n.fillHeight,"onUpdate:modelValue":t[1]||(t[1]=e=>n.fillHeight=e),min:0,max:9e3,range:"",step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class","format-tooltip":s.formatTooltip,style:{width:"58%"}},null,8,["modelValue","format-tooltip"])]),p("div",ot,[p("label",lt,m(e.Resource.isolineInterval),1),d(p("input",{class:"sm-input",style:{width:"58%"},min:"0",type:"number","onUpdate:modelValue":t[2]||(t[2]=e=>n.equivalentIsoline=e)},null,512),[[y,n.equivalentIsoline]])]),p("div",it,[p("label",nt,m(e.Resource.displayMode),1),d(p("select",{class:"sm-select",style:{width:"58%"},id:"fillOptions","onUpdate:modelValue":t[3]||(t[3]=e=>n.fillOptionsSelected=e)},[p("option",at,m(e.Resource.contourFilling),1),p("option",st,m(e.Resource.panelFilling),1),p("option",rt,m(e.Resource.contourPanelFilling),1),p("option",dt,m(e.Resource.noColorTable),1)],512),[[f,n.fillOptionsSelected]])]),p("div",pt,[p("button",{onClick:t[4]||(t[4]=(...e)=>n.isoLineAnalysis&&n.isoLineAnalysis(...e)),class:"tbtn",type:"button"},m(e.Resource.analyze),1),p("button",{onClick:t[5]||(t[5]=(...e)=>n.clearIsoLine&&n.clearIsoLine(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.clear),1)])],512),[[u]])],512)),[[h]])},qe.__file="src/components/terrain-analysis/terrain-isoline/terrain-isoline.vue",qe.install=function(e){e.component(qe.name,qe)};var ut={name:"Sm3dTerrainFlood",props:{maxHeight:{type:Number,default:8e3},minHeight:{type:Number,default:1e3},cheackedBand:{type:String,default:"band1"},floodSpeed:{type:Number,default:800},floodTrans:{type:Number,default:.8},floodPositions:{type:Array},lineVisible:{type:Boolean,default:!0}},methods:{formatTooltip:e=>e+"米",formatTooltip2:e=>e+"米/秒"},setup(e){let{floodHeight:t,currentHeight:o,floodSpeed:l,floodBegin:i,floodClear:n}=ct(e);return{floodHeight:t,currentHeight:o,floodSpeed:l,floodBegin:i,floodClear:n}}};const mt={id:"terrain-flood-panel",class:"sm-panel"},yt={class:"sm-function-module-sub-section",style:{margin:"0"}},ht={class:"sm-half-L"},wt={style:{width:"40%"}},gt={class:"sm-half-L"},ft={style:{width:"40%"}},bt={class:"sm-half-L"},vt={style:{width:"40%"}},St={class:"boxchild"};function Ct(o){let l=e({clipModel:"ClipInside"});if(o)for(let e in o)l.hasOwnProperty(e)?l[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let i,n,r,d,p="clip_behind_all_plane";function c(){if(void 0===r)return;let e=r.box.dimensions.getValue(),t=r.position.getValue(0),o=0;if(void 0!==r.orientation){let e=SuperMap3D.Matrix3.fromQuaternion(r.orientation._value,new SuperMap3D.Matrix3),l=SuperMap3D.Matrix4.fromRotationTranslation(e,SuperMap3D.Cartesian3.ZERO,new SuperMap3D.Matrix4),i=SuperMap3D.Matrix4.inverse(SuperMap3D.Transforms.eastNorthUpToFixedFrame(t),new SuperMap3D.Matrix4),n=SuperMap3D.Matrix4.multiply(i,l,new SuperMap3D.Matrix4),a=SuperMap3D.Matrix4.getMatrix3(n,new SuperMap3D.Matrix3);o=SuperMap3D.HeadingPitchRoll.fromQuaternion(SuperMap3D.Quaternion.fromRotationMatrix(a)).heading}u({dimensions:e,position:t,clipMode:p,heading:o})}function u(e){for(let t=0,o=i.length;t<o;t++)i[t].setCustomClipBox(e)}function m(){if(n&&(n.deactivate(),tooltip.setVisible(!1)),r){for(let e of i)e.clearCustomClipBox();r=void 0,d.deactivate(),viewer.entities.removeAll(),n.clear()}}return V.isViewer&&(i=viewer.scene.layers.layerQueue,n=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box),window.tooltip||(window.tooltip=se(viewer._element))),s((()=>V.isViewer),(e=>{e&&(i=viewer.scene.layers.layerQueue,n=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box),window.tooltip||(window.tooltip=se(viewer._element)))})),s((()=>l.clipModel),(e=>{switch(e){case"ClipInside":p="clip_behind_all_plane";break;case"ClipOutside":p="clip_behind_any_plane"}r&&c()})),t((()=>{d&&d.destroy(),d=void 0,i=void 0,n=void 0,r=void 0})),{...a(l),BoxClipByEitor:function(){m(),d||(function(){for(let e=0,t=i.length;e<t;e++)i[e].selectEnabled=!1,i[e].clipLineColor=new SuperMap3D.Color(1,1,1,0)}(),n.movingEvt.addEventListener((e=>{n.isDrawing?tooltip.showAt(" <p>点击鼠标左键结束绘制box底面</p><p>移动鼠标绘制box高度</p><p>点击鼠标右键结束绘制</p>","230px"):tooltip.showAt(" <p>点击鼠标左键开始绘制box底面</p>","230px")})),n.drawEvt.addEventListener((e=>{r=e.object;let t={dimensions:r.box.dimensions.getValue(),position:r.position.getValue(0),clipMode:p,heading:0};d=new SuperMap3D.BoxEditor(viewer,r),d.editEvt.addEventListener((e=>{r.box.dimensions=e.dimensions,r.position=e.position,r.orientation=e.orientation,c()})),d.activate(),u(t),tooltip.setVisible(!1),n.clear(),n.deactivate()}))),n.activate()},clearBoxClipByEitor:m}}ut.render=function(e,t,o,n,a,s){const c=g("el-slider"),u=r("stopdrag"),h=r("drag");return d((l(),i("div",mt,[d(p("div",yt,[p("div",ht,[p("label",wt,m(e.Resource.visibleHeight),1),p(c,{modelValue:n.floodHeight,"onUpdate:modelValue":t[1]||(t[1]=e=>n.floodHeight=e),min:0,max:9e3,range:"",step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class","format-tooltip":s.formatTooltip,style:{width:"58%"}},null,8,["modelValue","format-tooltip"])]),p("div",gt,[p("label",ft,m(e.Resource.currentHeight),1),d(p("input",{class:"sm-input",disabled:"",type:"number",style:{width:"58%"},"onUpdate:modelValue":t[2]||(t[2]=e=>n.currentHeight=e)},null,512),[[y,n.currentHeight]])]),p("div",bt,[p("label",vt,m(e.Resource.floodSpeed),1),p(c,{modelValue:n.floodSpeed,"onUpdate:modelValue":t[3]||(t[3]=e=>n.floodSpeed=e),max:1e3,min:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class","format-tooltip":s.formatTooltip2,style:{width:"58%"}},null,8,["modelValue","format-tooltip"])]),p("div",St,[p("button",{onClick:t[4]||(t[4]=(...e)=>n.floodBegin&&n.floodBegin(...e)),class:"tbtn",type:"button"},m(e.Resource.analyze),1),p("button",{onClick:t[5]||(t[5]=(...e)=>n.floodClear&&n.floodClear(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.clear),1)])],512),[[u]])],512)),[[h]])},ut.__file="src/components/terrain-analysis/terrain-flood/terrain-flood.vue",ut.install=function(e){e.component(ut.name,ut)};var Mt={name:"Sm3dClipBoxByeditor",props:{clipModel:{type:String,default:"ClipInside"}},setup(e){let{clipModel:t,BoxClipByEitor:o,clearBoxClipByEitor:l}=Ct(e);return{clipModel:t,BoxClipByEitor:o,clearBoxClipByEitor:l}}};const Dt={id:"clip-box-panel",class:"sm-panel"},Rt={class:"sm-function-module-sub-section",style:{margin:"0"}},xt={class:"sm-half-L"},Lt={style:{width:"auto"}},Pt={style:{width:"auto"}},Vt={class:"boxchild"};Mt.render=function(e,t,o,n,a,s){const y=r("stopdrag"),h=r("drag");return d((l(),i("div",Dt,[d(p("div",Rt,[p("div",xt,[p("label",Lt,[d(p("input",{type:"radio",value:"ClipInside","onUpdate:modelValue":t[1]||(t[1]=e=>n.clipModel=e)},null,512),[[c,n.clipModel]]),u(m(e.Resource.clipInside),1)]),p("label",Pt,[d(p("input",{type:"radio",value:"ClipOutside","onUpdate:modelValue":t[2]||(t[2]=e=>n.clipModel=e)},null,512),[[c,n.clipModel]]),u(m(e.Resource.clipOutside),1)])]),p("div",Vt,[p("button",{onClick:t[3]||(t[3]=(...e)=>n.BoxClipByEitor&&n.BoxClipByEitor(...e)),class:"tbtn",type:"button"},m(e.Resource.clip),1),p("button",{onClick:t[4]||(t[4]=(...e)=>n.clearBoxClipByEitor&&n.clearBoxClipByEitor(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.clear),1)])],512),[[y]])],512)),[[h]])},Mt.__file="src/components/clip/clip-box-editor/clip-box-editor.vue",Mt.install=function(e){e.component(Mt.name,Mt)};var kt={name:"Sm3dClipPolygon",props:{clipModelPolygon:{type:String,default:"ClipInside"},isEdit:{type:Boolean,default:!1},isEditZ:{type:Boolean,default:!1},polygonPositions:{type:Array},lineVisible:{type:Boolean,default:!0}},setup(o){let{clipModelPolygon:l,isEdit:i,isEditZ:n,clipPolygon:r,clearClipPolygon:d}=function(o){let l=e({clipModelPolygon:"ClipInside",isEdit:!1,isEditZ:!1,lineVisible:!0});if(o)for(let e in o)l.hasOwnProperty(e)?l[e]=o[e]:we.Message&&we.Message.errorMsg(ce.AttributeError+e);let i,n=SuperMap3D.ModifyRegionMode.CLIP_INSIDE,r=!0,d=[];function p(e){d=e;for(let t of i)t.setModifyRegions([e],n)}return o&&o.polygonPositions&&p(o.slopePositions),V.isViewer&&(i=viewer.scene.layers.layerQueue,window.tooltip||(window.tooltip=se(viewer._element))),s((()=>V.isViewer),(e=>{e&&(i=viewer.scene.layers.layerQueue,window.tooltip||(window.tooltip=se(viewer._element)))})),s((()=>l.clipModelPolygon),(e=>{switch(e){case"ClipInside":n=SuperMap3D.ModifyRegionMode.CLIP_INSIDE;break;case"ClipOutside":n=SuperMap3D.ModifyRegionMode.CLIP_OUTSIDE}d.length>0&&p(d)})),s((()=>l.isEdit),(e=>{e&&window.handlerPolygon?De(d,l.isEditZ,p):(Re(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),s((()=>l.isEditZ),(e=>{window.editHandler&&(window.editHandler.isEditZ=e)})),t((()=>{i=void 0})),{...a(l),clipPolygon:function(e){e.preventDefault(),tooltip.setVisible(!1),r&&(tooltip.showAt(" <p>点击鼠标左键开始绘制多边形</p><p>点击鼠标右键结束绘制</p>","230px"),r=!1),i||(i=viewer.scene.layers.layerQueue);for(let e of i)e.selectEnabled=!1,e.clipLineColor=new SuperMap3D.Color(1,1,1,0);window.handlerPolygon||ge("Polygon"),fe("Polygon",l.lineVisible).then((e=>{p(e.positions);let t=window.handlerPolygon;t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),l.isEdit&&De(d,l.isEditZ,p)}),(e=>{console.log(e)})),window.handlerPolygon.activate(),scene.pickPositionSupported||we.Message&&we.Message.errorMsg(ce.NoPickPositionSupported)},clearClipPolygon:function(e){if(e.preventDefault(),d=[],tooltip.setVisible(!1),window.handlerPolygon){be("Polygon");for(let e of i)e.clearModifyRegions()}},polygonPosition:d}}(o);return{clipModelPolygon:l,isEdit:i,isEditZ:n,clipPolygon:r,clearClipPolygon:d}}};const Et={id:"clip-polygon-panel",class:"sm-panel"},Nt={class:"sm-function-module-sub-section",style:{margin:"0"}},Tt={class:"sm-half-L"},At={style:{width:"auto"}},Bt={style:{width:"auto"}},It={class:"boxchild"};function _t(o){let l,i,n,r,d,p,c,u=e({clipWidth:5,clipHeight:5,heading:0,pitch:0,roll:0,extrude:1});if(o)for(let e in o)u.hasOwnProperty(e)?u[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);function m(){for(let e of l)e.setCustomClipCross({position:c,dimensions:p,heading:u.heading,pitch:u.pitch,roll:u.roll,extrudeDistance:Number(u.extrude)})}function y(){r&&viewer.entities.removeById("cross-clip-identify-box");for(let e of l)e.clearCustomClipBox();n=!1,r=void 0,i.removeInputAction(SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),i.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)}return V.isViewer&&(i=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas),l=viewer.scene.layers.layerQueue),s((()=>V.isViewer),(e=>{e&&(i=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas),l=viewer.scene.layers.layerQueue)})),s((()=>u.clipWidth),(e=>{let t=Number(e);t<=0||!r||(r.box.dimensions=new SuperMap3D.Cartesian3(u.clipWidth,u.clipHeight,.1),p=new SuperMap3D.Cartesian3(t,u.clipHeight,u.extrude),m())})),s((()=>u.clipHeight),(e=>{let t=Number(e);t<=0||!r||(r.box.dimensions=new SuperMap3D.Cartesian3(u.clipWidth,u.clipHeight,.1),p=new SuperMap3D.Cartesian3(u.clipWidth,t,u.extrude),m())})),s((()=>u.pitch),(e=>{if(""===e||!r)return;let t=Number(e),o=new SuperMap3D.HeadingPitchRoll(SuperMap3D.Math.toRadians(u.heading),SuperMap3D.Math.toRadians(t),SuperMap3D.Math.toRadians(u.roll)),l=SuperMap3D.Transforms.headingPitchRollQuaternion(d,o);r.orientation=l,m()})),s((()=>u.roll),(e=>{if(""===e||!r)return;let t=Number(e),o=new SuperMap3D.HeadingPitchRoll(SuperMap3D.Math.toRadians(u.heading),SuperMap3D.Math.toRadians(u.pitch),SuperMap3D.Math.toRadians(t)),l=SuperMap3D.Transforms.headingPitchRollQuaternion(d,o);r.orientation=l,m()})),s((()=>u.heading),(e=>{if(""===e||!r)return;let t=Number(e),o=new SuperMap3D.HeadingPitchRoll(SuperMap3D.Math.toRadians(t),SuperMap3D.Math.toRadians(u.pitch),SuperMap3D.Math.toRadians(u.roll)),l=SuperMap3D.Transforms.headingPitchRollQuaternion(d,o);r.orientation=l,m()})),s((()=>u.extrude),(e=>{Number(e)<=0||!r||m()})),t((()=>{i.destroy(),l=void 0,r=void 0,i=void 0,p=void 0})),{...a(u),startCross:function(e){e.preventDefault(),viewer&&(r&&y(),function(){for(let e of l)e.selectEnabled=!1;let e;d=SuperMap3D.Cartesian3.fromDegrees(0,0,0),p=new SuperMap3D.Cartesian3(u.clipWidth,u.clipHeight,.1),r=viewer.entities.add({id:"cross-clip-identify-box",position:d,show:!1,box:{dimensions:p,fill:!1,outline:!0,outlineColor:SuperMap3D.Color.AQUA,outlineWidth:5}}),i.setInputAction((t=>{if(n){if(d=scene.pickPosition(t.endPosition),!d)return;r.position=d,e||(e=new SuperMap3D.HeadingPitchRoll(SuperMap3D.Math.toRadians(u.heading),SuperMap3D.Math.toRadians(u.pitch),SuperMap3D.Math.toRadians(u.roll)));let o=SuperMap3D.Transforms.headingPitchRollQuaternion(d,e);r.orientation=o}}),SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction((t=>{if(n){if(c=scene.pickPosition(t.position),!c)return;m(),n=!1,r.show=!1}i.removeInputAction(SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),i.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),e=null}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)}(),n=!0,r.show=!0)},clearCross:y}}kt.render=function(e,t,o,n,a,s){const y=r("stopdrag"),h=r("drag");return d((l(),i("div",Et,[d(p("div",Nt,[p("div",Tt,[p("label",At,[d(p("input",{type:"radio",value:"ClipInside","onUpdate:modelValue":t[1]||(t[1]=e=>n.clipModelPolygon=e)},null,512),[[c,n.clipModelPolygon]]),u(" "+m(e.Resource.clipInside),1)]),p("label",Bt,[d(p("input",{type:"radio",value:"ClipOutside","onUpdate:modelValue":t[2]||(t[2]=e=>n.clipModelPolygon=e)},null,512),[[c,n.clipModelPolygon]]),u(" "+m(e.Resource.clipOutside),1)])]),p("div",It,[p("button",{onClick:t[3]||(t[3]=(...e)=>n.clipPolygon&&n.clipPolygon(...e)),class:"tbtn",type:"button"},m(e.Resource.clip),1),p("button",{onClick:t[4]||(t[4]=(...e)=>n.clearClipPolygon&&n.clearClipPolygon(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.clear),1)])],512),[[y]])],512)),[[h]])},kt.__file="src/components/clip/clip-polygon/clip-polygon.vue",kt.install=function(e){e.component(kt.name,kt)};var Ft={name:"Sm3dClipCross",props:{clipWidth:{type:Number,default:5},clipHeight:{type:Number,default:5},heading:{type:Number,default:0},pitch:{type:Number,default:0},roll:{type:Number,default:0},extrude:{type:Number,default:1}},setup(e){let{clipWidth:t,clipHeight:o,heading:l,pitch:i,roll:n,extrude:a,startCross:s,clearCross:r}=_t(e);return{clipWidth:t,clipHeight:o,heading:l,pitch:i,roll:n,extrude:a,startCross:s,clearCross:r}}};const Ot={id:"viewer-panel",class:"sm-panel"},Ut={class:"sm-function-module-sub-section",style:{margin:"0"}},Ht={class:"sm-half-L"},zt={class:"label-S"},Gt={class:"sm-slider-input-box"},Wt={class:"sm-half-L"},jt={class:"label-S"},Kt={class:"sm-slider-input-box"},Qt={class:"sm-half-L"},Xt={class:"label-S"},Yt={class:"sm-slider-input-box"},Zt={class:"sm-half-L"},qt={class:"label-S"},Jt={class:"sm-slider-input-box"},$t={class:"sm-half-L"},eo={class:"label-S"},to={class:"sm-slider-input-box"},oo={class:"sm-half-L"},lo={class:"label-S"},io={class:"sm-slider-input-box"},no={class:"boxchild"};function ao(o){let l,i,n,r,d=e({clipMode:0,planeDirection:"vertical"});if(o)for(let e in o)d.hasOwnProperty(e)?d[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let p,c,u="public/data/s3m/box.s3m";function m(){l=viewer.scene.layers.layerQueue,r=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(r),window.tooltip||(window.tooltip=se(viewer._element))}function y(){if(i.cartPositions)for(let e of l)e.setCustomClipPlane(i.cartPositions[0],i.cartPositions[1],i.cartPositions[2])}function h(){if(tooltip.setVisible(!1),c&&(viewer.entities.remove(c),p.deactivate(),r.removeCollection(u),c=null,i=null),window.handlerPolyline){be("Polyline");for(let e of l)e.clearCustomClipBox()}}return s((()=>V.changeLayers),(e=>{l=viewer.scene.layers.layerQueue;for(let e of l)e.selectEnabled=!1,e.clipLineColor=new SuperMap3D.Color(1,1,1,0)})),V.isViewer&&m(),s((()=>V.isViewer),(e=>{m()})),s((()=>d.clipMode),(e=>{if(i){let e=[...i.cartPositions],t=[e[1],e[0],e[3],e[2]];i.cartPositions=t,y()}})),t((()=>{l=void 0,p&&p.destroy()})),{...a(d),clipPlaneStart:function(e){e.preventDefault(),c&&h(),tooltip.setVisible(!1),tooltip.showAt("<p>点击鼠标左键开始绘制平面的一条边</p><p>绘制两点即可</p><p>点击鼠标右键结束绘制</p>","350px"),window.handlerPolygon||ge("Polyline"),fe("Polyline").then((e=>{console.log("res:",e);let t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),function(e,t){let o,l=SuperMap3D.Cartesian3.distance(t[0],t[1]);l=SuperMap3D.defaultValue(l,100),o="vertical"===d.planeDirection?function(e,t,o){let l=e.slice(0,3),i=e.slice(3,6),n=i.slice(0,2).concat(i[2]+o),a=l.slice(0,2).concat(l[2]+o),s=[].concat(t);return s.push(SuperMap3D.Cartesian3.fromDegrees(n[0],n[1],n[2])),s.push(SuperMap3D.Cartesian3.fromDegrees(a[0],a[1],a[2])),s}(e,t,l):function(e,t){let o=new SuperMap3D.Cartesian3(0,0,0),l=new SuperMap3D.Cartesian3(0,0,0),i=new SuperMap3D.Cartesian3(0,0,0),n=new SuperMap3D.Cartesian3(0,0,0),a=new SuperMap3D.Cartesian3(0,0,0);return SuperMap3D.Cartesian3.subtract(e[0],e[1],o),SuperMap3D.Cartesian3.cross(o,e[0],l),SuperMap3D.Cartesian3.normalize(l,l),SuperMap3D.Cartesian3.multiplyComponents(l,new SuperMap3D.Cartesian3(t,t,t),i),SuperMap3D.Cartesian3.add(e[0],i,a),SuperMap3D.Cartesian3.add(e[1],i,n),[e[0],e[1],n,a]}(t,l);let a=SuperMap3D.BoundingSphere.fromPoints(o).center;i={cartPositions:o,centerPositions:a},c=viewer.entities.add({id:"clip-plane",polygon:{hierarchy:new SuperMap3D.CallbackProperty((()=>({positions:i.cartPositions,holes:[]})),!1),material:SuperMap3D.Color.GOLD.withAlpha(.2),outline:!0,outlineColor:SuperMap3D.Color.GOLD,perPositionHeight:!0}}),function(){let e=we.getAngleAndRadian(i.cartPositions[0],i.cartPositions[1]).radian,t="clip-model";var o;r.add(u,{id:t,position:i.centerPositions,hpr:new SuperMap3D.HeadingPitchRoll(e,0,0),scale:new SuperMap3D.Cartesian3(.1,.1,.1)}),n=r.getInstance(u,t),p?(p.setEditObject(n),p.activate()):(o=n,p=new SuperMap3D.ModelEditor({model:o,scene:viewer.scene,axesShow:{translation:!0,rotation:!1,scale:!1}}),p.activate(),p.changedEvt.addEventListener((e=>{let t=new SuperMap3D.Cartesian3;if(SuperMap3D.Matrix4.getTranslation(e.modelMatrix,t),t){let e=t.x-i.centerPositions.x,o=t.y-i.centerPositions.y,l=t.z-i.centerPositions.z;for(let t=0;t<4;t++)i.cartPositions[t].x+=e,i.cartPositions[t].y+=o,i.cartPositions[t].z+=l;i.centerPositions=t,y()}})))}(),y()}(e.positions,e.result.positions),tooltip.setVisible(!1)}),(e=>{console.log(e)})),window.handlerPolyline.activate()},clearClipPlane:h}}Ft.render=function(e,t,o,n,a,s){const c=g("el-slider"),u=r("stopdrag"),h=r("drag");return d((l(),i("div",Ot,[d(p("div",Ut,[p("div",Ht,[p("label",zt,m(e.Resource.ClipWidth),1),p("div",Gt,[p(c,{modelValue:n.clipWidth,"onUpdate:modelValue":t[1]||(t[1]=e=>n.clipWidth=e),min:1,step:1,"input-size":"mini",debounce:500,"show-tooltip":!1,style:{width:"62%"}},null,8,["modelValue"]),d(p("input",{class:"sm-input-S",min:"1",step:"1",type:"number","onUpdate:modelValue":t[2]||(t[2]=e=>n.clipWidth=e)},null,512),[[y,n.clipWidth]])])]),p("div",Wt,[p("label",jt,m(e.Resource.ClipHeight),1),p("div",Kt,[p(c,{modelValue:n.clipHeight,"onUpdate:modelValue":t[3]||(t[3]=e=>n.clipHeight=e),min:1,step:1,"input-size":"mini",debounce:500,"show-tooltip":!1,style:{width:"62%"}},null,8,["modelValue"]),d(p("input",{class:"sm-input-S",min:"1",step:"1",type:"number","onUpdate:modelValue":t[4]||(t[4]=e=>n.clipHeight=e)},null,512),[[y,n.clipHeight]])])]),p("div",Qt,[p("label",Xt,m(e.Resource.Xrotation),1),p("div",Yt,[p(c,{modelValue:n.pitch,"onUpdate:modelValue":t[5]||(t[5]=e=>n.pitch=e),min:0,step:1,max:360,"input-size":"mini",debounce:500,"show-tooltip":!1,style:{width:"62%"}},null,8,["modelValue"]),d(p("input",{class:"sm-input-S",min:"0",max:"360",step:"1",type:"number","onUpdate:modelValue":t[6]||(t[6]=e=>n.pitch=e)},null,512),[[y,n.pitch]])])]),p("div",Zt,[p("label",qt,m(e.Resource.Yrotation),1),p("div",Jt,[p(c,{modelValue:n.roll,"onUpdate:modelValue":t[7]||(t[7]=e=>n.roll=e),min:0,step:1,max:360,"input-size":"mini",debounce:500,"show-tooltip":!1,style:{width:"62%"}},null,8,["modelValue"]),d(p("input",{class:"sm-input-S",min:"0",step:"1",max:"360",type:"number","onUpdate:modelValue":t[8]||(t[8]=e=>n.roll=e)},null,512),[[y,n.roll]])])]),p("div",$t,[p("label",eo,m(e.Resource.Zrotation),1),p("div",to,[p(c,{modelValue:n.heading,"onUpdate:modelValue":t[9]||(t[9]=e=>n.heading=e),min:0,step:1,max:360,"input-size":"mini",debounce:500,"show-tooltip":!1,style:{width:"62%"}},null,8,["modelValue"]),d(p("input",{class:"sm-input-S",min:"0",step:"1",max:"360",type:"number","onUpdate:modelValue":t[10]||(t[10]=e=>n.heading=e)},null,512),[[y,n.heading]])])]),p("div",oo,[p("label",lo,m(e.Resource.stretchHeight),1),p("div",io,[p(c,{modelValue:n.extrude,"onUpdate:modelValue":t[11]||(t[11]=e=>n.extrude=e),min:1,step:1,"input-size":"mini",debounce:500,"show-tooltip":!1,style:{width:"62%"}},null,8,["modelValue"]),d(p("input",{class:"sm-input-S",min:"1",step:"1",type:"number","onUpdate:modelValue":t[12]||(t[12]=e=>n.extrude=e)},null,512),[[y,n.extrude]])])]),p("div",no,[p("button",{onClick:t[13]||(t[13]=(...e)=>n.startCross&&n.startCross(...e)),class:"tbtn",type:"button"},m(e.Resource.clip),1),p("button",{onClick:t[14]||(t[14]=(...e)=>n.clearCross&&n.clearCross(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.clear),1)])],512),[[u]])],512)),[[h]])},Ft.__file="src/components/clip/clip-cross/clip-cross.vue",Ft.install=function(e){e.component(Ft.name,Ft)};var so={name:"Sm3dClipPlane",props:{},setup(e){let{clipPlaneStart:t,clearClipPlane:o,clipMode:l,planeDirection:i}=ao(e);return{clipPlaneStart:t,clearClipPlane:o,clipMode:l,planeDirection:i}}};const ro={id:"clip-plane-panel",class:"sm-panel"},po={class:"sm-function-module-sub-section",style:{margin:"0"}},co={class:"sm-half-L"},uo={style:{width:"40%"}},mo={selected:"",value:"vertical"},yo={value:"parallel"},ho={class:"sm-half-L"},wo={style:{width:"40%"}},go={selected:"",value:"0"},fo={value:"1"},bo={class:"boxchild"};function vo(o){let l,i,n,r,d,p,c,u=e({measureMode:"Space",clampMode:SuperMap3D.ClampMode.Space,Ellipsoid:null,contourColor:"#ff7d00",isShowDVH:!1,isShowLine:!0,pickPointEnabled:!0});d=new SuperMap3D.HypsometricSetting,d.DisplayMode=SuperMap3D.HypsometricSettingEnum.DisplayMode.LINE;let m=new SuperMap3D.ColorTable;d._lineColor=SuperMap3D.Color.fromCssColorString(u.contourColor),d.ColorTable=m,d.Opacity=.6,d.MaxVisibleValue=-100,d.MinVisibleValue=-100;var y=()=>{setInterval((()=>{console.log("now-state.pickPointEnabled:",u.pickPointEnabled)}),2e3),l=viewer.scene.layers.layerQueue,viewer.scene.globe.HypsometricSetting={hypsometricSetting:d,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_ALL},V.changeLayers&&h(),i=new SuperMap3D.MeasureHandler(viewer,SuperMap3D.MeasureMode.Distance,u.clampMode),n=new SuperMap3D.MeasureHandler(viewer,SuperMap3D.MeasureMode.Area,u.clampMode),r=new SuperMap3D.MeasureHandler(viewer,SuperMap3D.MeasureMode.DVH),i.activeEvt.addEventListener((e=>{1==e?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.scene.pickPointEnabled=u.pickPointEnabled):(viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),viewer.scene.pickPointEnabled=!1)})),i.measureEvt.addEventListener((e=>{let t=Number(e.distance),o=u.measureMode;"CGCS2000"!=o&&"XIAN80"!=o&&"WGS84"!=o||(t=Number(function(e){let t=[];for(let o=0;o<e.length;o++){let l=SuperMap3D.Cartographic.fromCartesian(e[o]),i=SuperMap3D.Math.toDegrees(l.longitude),n=SuperMap3D.Math.toDegrees(l.latitude);t.push(i,n)}let o=new SuperMap3D.PolylineGeometry({positions:SuperMap3D.Cartesian3.fromDegreesArray(t)});return scene.globe.computeSurfaceDistance(o,u.Ellipsoid)}(e.positions)));let l=t>1e3?(t/1e3).toFixed(2)+"km":t.toFixed(2)+"m";i.disLabel.text="距离:"+l})),n.activeEvt.addEventListener((e=>{1==e?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.scene.pickPointEnabled=u.pickPointEnabled):(viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),viewer.scene.pickPointEnabled=!1)})),n.measureEvt.addEventListener((e=>{let t=Number(e.area),o=u.measureMode;"CGCS2000"==o||"XIAN80"==o||"WGS84"==o?t=Number(function(e){let t=[];for(let o=0;o<e.length;o++){let l=SuperMap3D.Cartographic.fromCartesian(e[o]),i=SuperMap3D.Math.toDegrees(l.longitude),n=SuperMap3D.Math.toDegrees(l.latitude);t.push(i,n)}let o=new SuperMap3D.PolygonGeometry.fromPositions({positions:SuperMap3D.Cartesian3.fromDegreesArray(t)});return scene.globe.computeSurfaceArea(o,u.Ellipsoid)}(e.positions)):"6"==o&&(t=Number(function(e){let t=0;for(let o=0;o<e.length;o++){let l=SuperMap3D.Cartographic.fromCartesian(e[o]);t+=SuperMap3D.Math.toDegrees(l.longitude)}let o=Math.round((t/e.length+6)/6),l=6*o-3,i=new SuperMap3D.CustomProjection({name:"tmerc",centralMeridian:l,primeMeridian:0,standardParallel_1:0,standardParallel_2:0,eastFalse:5e5,northFalse:0,semimajorAxis:6378137,inverseFlattening:298.257222101}),n=[];for(let t=0;t<e.length;t++){let o=SuperMap3D.Cartographic.fromCartesian(e[t]),l=i.project(o);n.push(l)}return n.push(n[0]),SuperMap3D.getPreciseArea(n,"China2000",l,o,1)}(e.positions)));let l=t>1e6?(t/1e6).toFixed(2)+"km²":t.toFixed(2)+"㎡";n.areaLabel.text="面积:"+l})),r.measureEvt.addEventListener((e=>{let t=e.distance>1e3?(e.distance/1e3).toFixed(2)+"km":e.distance+"m",o=e.verticalHeight>1e3?(e.verticalHeight/1e3).toFixed(2)+"km":e.verticalHeight+"m",l=e.horizontalDistance>1e3?(e.horizontalDistance/1e3).toFixed(2)+"km":e.horizontalDistance+"m";r.disLabel.text="空间距离:"+t,r.vLabel.text="垂直高度:"+o,r.hLabel.text="水平距离:"+l,p=Number(e.endHeight),u.isShowLine&&w(p)})),r.activeEvt.addEventListener((e=>{1==e?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.scene.pickPointEnabled=u.pickPointEnabled):(viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),viewer.scene.pickPointEnabled=!1)}))};function h(){for(let e=0;e<l.length;e++)l[e].hypsometricSetting={hypsometricSetting:d,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_ALL};c=!0}function w(e){if(viewer.scene.globe.HypsometricSetting.hypsometricSetting.MaxVisibleValue=e,viewer.scene.globe.HypsometricSetting.hypsometricSetting.MinVisibleValue=e,c)for(let t=0;t<l.length;t++)l[t].hypsometricSetting.hypsometricSetting?(l[t].hypsometricSetting.hypsometricSetting.MaxVisibleValue=e,l[t].hypsometricSetting.hypsometricSetting.MinVisibleValue=e):h()}function g(e){let t=scene.pickPosition(e.message.position);we.CartesiantoDegrees(t)[2]}function f(){w(-1e4),viewer.eventManager.removeEventListener("CLICK",g)}function b(){i&&i.deactivate(),n&&n.deactivate(),r&&r.deactivate(),u.isShowDVH=!1,u.Ellipsoid=null,p=-1e4}return V.isViewer&&y(),s((()=>V.isViewer),(e=>{e&&y()})),s((()=>V.changeLayers),(e=>{h()})),s((()=>u.isShowLine),(e=>{w(e?p:-1e4)})),s((()=>u.pickPointEnabled),(e=>{viewer.scene.pickPointEnabled=e})),s((()=>u.measureMode),(e=>{"Space"==e?(u.clampMode=SuperMap3D.ClampMode.Space,n.clampMode=SuperMap3D.ClampMode.Space,i.clampMode=SuperMap3D.ClampMode.Space):(u.clampMode=SuperMap3D.ClampMode.Ground,n.clampMode=SuperMap3D.ClampMode.Ground,i.clampMode=SuperMap3D.ClampMode.Ground,u.Ellipsoid="XIAN80"==e?SuperMap3D.Ellipsoid.XIAN80:"CGCS2000"==e?SuperMap3D.Ellipsoid.CGCS2000:"WGS84"==e?SuperMap3D.Ellipsoid.WGS84:null)})),t((()=>{d.destroy(),l=void 0})),{...a(u),distanceClk:function(){b(),i&&i.activate()},areaClk:function(){b(),n&&n.activate()},heightClk:function(){c||h(),f(),viewer.eventManager.addEventListener("CLICK",g,!0),b(),u.isShowDVH=!0,r&&r.activate()},clear:function(){b(),i&&i.clear(),n&&n.clear(),r&&r.clear(),f(),viewer.scene.pickPointEnabled=!1}}}so.render=function(e,t,o,n,a,s){const c=r("stopdrag"),u=r("drag");return d((l(),i("div",ro,[d(p("div",po,[p("div",co,[p("label",uo,m(e.Resource.planeDirection),1),d(p("select",{class:"sm-select",style:{width:"58%"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.planeDirection=e)},[p("option",mo,m(e.Resource.verticalGround),1),p("option",yo,m(e.Resource.parallelGround),1)],512),[[f,n.planeDirection]])]),p("div",ho,[p("label",wo,m(e.Resource.clipMode),1),d(p("select",{class:"sm-select",style:{width:"58%"},"onUpdate:modelValue":t[2]||(t[2]=e=>n.clipMode=e)},[p("option",go,m(e.Resource.clipInside),1),p("option",fo,m(e.Resource.clipOutside),1)],512),[[f,n.clipMode]])]),p("div",bo,[p("button",{onClick:t[3]||(t[3]=(...e)=>n.clipPlaneStart&&n.clipPlaneStart(...e)),class:"tbtn",type:"button"},m(e.Resource.clip),1),p("button",{onClick:t[4]||(t[4]=(...e)=>n.clearClipPlane&&n.clearClipPlane(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.clear),1)])],512),[[c]])],512)),[[u]])},so.__file="src/components/clip/clip-plane-new/clip-plane-new.vue",so.install=function(e){e.component(so.name,so)};var So={name:"Sm3dMeasure",setup(e){let{measureMode:t,isShowDVH:o,interval:l,isShowLine:i,distanceClk:n,areaClk:a,heightClk:s,clear:r}=vo();return{measureMode:t,isShowDVH:o,interval:l,isShowLine:i,distanceClk:n,areaClk:a,heightClk:s,clear:r}}};const Co={id:"measure-panel",class:"sm-panel"},Mo={class:"sm-function-module-sub-section",style:{margin:"0"}},Do={class:"sm-half-L"},Ro={class:"label-S"},xo={selected:"",value:"Space"},Lo={value:"Ground"},Po=p("option",{selected:"",value:"CGCS2000"},"CGCS2000",-1),Vo=p("option",{value:"XIAN80"},"XIAN80",-1),ko=p("option",{value:"WGS84"},"WGS84",-1),Eo={value:"null"},No=p("span",{class:"iconfont iconkongjianjuli"},null,-1),To=p("span",{class:"iconfont icongaoduceliang"},null,-1),Ao=p("span",{class:"iconfont iconkongjianmianji"},null,-1),Bo=p("span",{class:"iconfont iconqingchu"},null,-1),Io={class:"sm-half-L flex-start",style:{"margin-top":"6px"}},_o={style:{"margin-left":"10%"}};function Fo(l){let i=e({skylineRadius:1e4,lineWidth:3,skylineColor:"rgb(200, 0, 0)",skyBodyColor:"rgba(44,149,197,0.6)",barrierColor:"rgba(255, 186, 1, 1)",skylineMode:0,highlightBarrier:!1,getSkyline2d:!0,skylineSpatialAnalysisUrl:null,observerInformation:null,ignoreGlobe:!0,isClear:!0});if(l)for(let e in l)i.hasOwnProperty(e)?i[e]=l[e]:we.Message.errorMsg(ce.AttributeError+e);let n,r,d,p,c=!0;const u=v(null);function m(){window.echarts?(n||(n=window.echarts.init(u.value),window.onresize=function(){n.resize()}),n.setOption({title:{text:"二维天际线",textStyle:{fontSize:14}},grid:{left:30,right:0,top:30,bottom:8},tooltip:{},xAxis:{show:!1},yAxis:{show:!1},series:[{type:"bar",data:[]}]})):we.Message.warnMsg(ce.EchartsErr)}function y(){d.build(),S();let e=viewer.scene.camera.positionCartographic;w({longitude:SuperMap3D.Math.toDegrees(e.longitude),latitude:SuperMap3D.Math.toDegrees(e.latitude),height:e.height,pitch:SuperMap3D.Math.toDegrees(p.camera.pitch),direction:SuperMap3D.Math.toDegrees(p.camera.heading)}),i.isClear=!1}function h(){let e=viewer.camera.position,t=viewer.scene.globe.ellipsoid.cartesianToCartographic(e).height/200;viewer.camera.moveBackward(t)}function w(e){d.viewPosition=[e.longitude,e.latitude,e.height],d.pitch=e.pitch,d.direction=e.direction,d.radius=Number(i.skylineRadius),d.lineWidth=Number(i.lineWidth),d.color=SuperMap3D.Color.fromCssColorString(i.skylineColor),d.displayStyle=Number(i.skylineMode>1?0:i.skylineMode),setTimeout((()=>{if(i.highlightBarrier){g(SuperMap3D.Color.fromCssColorString(i.barrierColor))}2==i.skylineMode&&(i.skylineSpatialAnalysisUrl?f():b(e)),function(e){if(i.observerInformation&&n){let t={tooltip:{trigger:"axis",formatter:e=>{let t=Number(e[0].axisValue),o=e[0].data;return["X: "+t.toFixed(6)+"<br/>","Y: "+o.toFixed(6)].join("")}},grid:{left:40,right:0,top:35,bottom:8,borderColor:"#333333"},color:"red",xAxis:[{type:"category",boundaryGap:!1,data:e?.x,show:!1}],yAxis:{min:function(e){return(e.min-.05).toFixed(2)},show:!0,axisLine:{show:!0}},dataZoom:[{type:"inside",xAxisIndex:0,filterMode:"filter",start:0,end:100}],series:[{symbolSize:8,symbol:"circle",smooth:!0,type:"line",data:e?.y,lineStyle:{width:2,shadowColor:"rgba(145, 146, 148,0.7)",shadowBlur:10,shadowOffsetY:8}}]};n.setOption(t)}}(d.getSkyline2D())}),300),i.observerInformation=e,1===d.displayStyle&&h()}function g(e){let t=d.getObjectIds();console.log(t);let o=viewer.scene.layers._layerQueue;for(let l in t)o.forEach((o=>{o._id===Number(l)&&o.setObjsColor(t[l],e)}))}function f(){let e=d.getSkylineSectorParameter(),t={viewerPoint:e.viewPos,line3D:e.geoLine3D,height:0,lonlat:!0},o=i.skylineSpatialAnalysisUrl,l=JSON.stringify(t);axios.post(o,l).then((e=>{axios.get(e.data.newResourceLocation+".json").then((e=>{let t=e.data;if(null===t.geometry)return;let o=new Uint8Array(t.geometry.model).buffer;r.add("SkyLineBody",{id:1,position:SuperMap3D.Cartesian3.fromDegrees(t.geometry.position.x,t.geometry.position.y,t.geometry.position.z),hpr:new SuperMap3D.HeadingPitchRoll(0,0,0),color:SuperMap3D.Color.fromCssColorString(i.skyBodyColor)},o,!1),t.geometry.model=[4,0,0,0].concat(t.geometry.model),t.geometry.name=ce.SkyLineBody,E.geometrys.SkyLineBody=t.geometry,k.setGeometrys()})).catch((function(e){console.log(e),we.Message.errorMsg("获取天际线体数据失败",e)}))})).catch((function(e){console.log(e),we.Message.errorMsg("获取天际线体数据失败",e)}))}function b(e){let t=d.getSkyline3D(),o=new Array,l=SuperMap3D.Cartesian3.fromDegrees(e.longitude,e.latitude,e.height);o.push(l);for(let e=0;e<t.x.length;e++){let l=SuperMap3D.Cartesian3.fromDegrees(t.x[e],t.y[e],t.z[e]);o.push(l)}viewer.entities.add({id:"SkyLineBody",polygon:{extrudedHeight:10,hierarchy:o,perPositionHeight:!0,material:SuperMap3D.Color.fromCssColorString(i.skyBodyColor)}})}function S(){if(be(),tooltip.setVisible(!1),i.observerInformation){viewer.entities.removeById("SkyLineBody"),d&&d.clear();for(let e=0;e<p.layers._layerQueue.length;e++){p.layers.findByIndex(e).removeAllObjsColor()}i.observerInformation=null,n.clear(),m(),r.removeCollection("SkyLineBody"),E.geometrys.SkyLineBody&&(delete E.geometrys.SkyLineBody,k.setGeometrys()),i.isClear=!0}}return o((()=>{m()})),p=viewer.scene,r=new SuperMap3D.S3MInstanceCollection(viewer.scene._context),viewer.scene.primitives.add(r),d=new SuperMap3D.Skyline(viewer.scene),d.ignoreGlobe=i.ignoreGlobe,i.observerInformation&&w(i.observerInformation),window.tooltip||(window.tooltip=createTooltip(viewer._element)),s((()=>i.skylineRadius),(e=>{i.observerInformation&&(d.radius=parseFloat(e),d.pitch=parseFloat(i.observerInformation.pitch))})),s((()=>i.lineWidth),(e=>{i.isClear||(y(),d.lineWidth=Number(e))})),s((()=>i.skylineColor),(e=>{if(i.observerInformation&&""!=e){let t=SuperMap3D.Color.fromCssColorString(e);d.color=t,d.pitch=parseFloat(i.observerInformation.pitch)}})),s((()=>i.barrierColor),(e=>{if(i.observerInformation||!i.highlightBarrier){g(SuperMap3D.Color.fromCssColorString(e))}})),s((()=>i.ignoreGlobe),(e=>{d&&(d.ignoreGlobe=e),y()})),s((()=>i.highlightBarrier),(e=>{if(e&&i.observerInformation){g(SuperMap3D.Color.fromCssColorString(i.barrierColor))}else for(let e=0;e<p.layers._layerQueue.length;e++){p.layers.findByIndex(e).removeAllObjsColor()}})),s((()=>i.skyBodyColor),(e=>{if(i.observerInformation&&""!=e){let t=SuperMap3D.Color.fromCssColorString(e);i.skylineSpatialAnalysisUrl?r.getInstance("SkyLineBody",1).updateColor(t):viewer.entities.getById("SkyLineBody").polygon.material=t}})),s((()=>i.getSkyline2d),(e=>{e&&n?setTimeout((()=>{n.resize()}),200):i.getSkyline2d=!1})),s((()=>i.skylineMode),(e=>{0==e?(d.displayStyle=0,viewer.entities.removeById("SkyLineBody"),r.removeCollection("SkyLineBody"),E.geometrys.SkyLineBody&&(delete E.geometrys.SkyLineBody,k.setGeometrys())):1==e?(d.displayStyle=1,viewer.entities.removeById("SkyLineBody"),r.removeCollection("SkyLineBody"),E.geometrys.SkyLineBody&&(delete E.geometrys.SkyLineBody,k.setGeometrys()),h()):2==e&&(d.displayStyle=0,i.observerInformation&&(i.skylineSpatialAnalysisUrl?f(i.observerInformation):b(i.observerInformation)))})),t((()=>{S(),d=void 0,n=void 0,r=void 0})),{...a(i),skyLineAnalysis:y,setLimitBody:function(){window.handlerPolygon||ge("Polygon"),tooltip.setVisible(!1),c&&(window.tooltip.showAt(" <p>点击鼠标左键绘制区域</p><p>点击鼠标右键结束绘制</p>","450px"),c=!1),fe("Polygon").then((e=>{d.removeLimitbody("limitBody");let t=window.handlerPolygon,o=e.result.object.positions,l=[];for(let e=0,t=o.length;e<t;e++){let t=SuperMap3D.Cartographic.fromCartesian(o[e]),i=SuperMap3D.Math.toDegrees(t.longitude),n=SuperMap3D.Math.toDegrees(t.latitude);l.push([i,n])}let i=[];for(let e=0,t=we.unique(l).length;e<t;e++)i.push(l[e][0]),i.push(l[e][1]);d.addLimitbody({position:i,name:"limitBody"}),t.polygon.show=!1,t.polyline.show=!1,t.deactivate()}),(e=>{console.log(e)})),window.handlerPolygon.activate()},echarts_box:u,clear:S}}So.render=function(e,t,o,n,a,s){const c=r("stopdrag"),u=r("drag");return d((l(),i("div",Co,[d(p("div",Mo,[p("div",Do,[p("label",Ro,m(e.Resource.selectMode),1),d(p("select",{class:"sm-select-m","onUpdate:modelValue":t[1]||(t[1]=e=>n.measureMode=e)},[p("option",xo,m(e.Resource.measureSpace),1),p("option",Lo,m(e.Resource.measureGround),1),Po,Vo,ko,p("option",Eo,m(e.Resource.planeProjection),1),b(' <option value="2">+ Resource.skylinesectorbody +</option> // 需要iServer910支持 ')],512),[[f,n.measureMode]])]),p("button",{onClick:t[2]||(t[2]=(...e)=>n.distanceClk&&n.distanceClk(...e)),class:["sm-btn","null"===n.measureMode?"pointer-events":""],id:"distance",title:e.Resource.measureDistance,type:"button",disabled:"null"===n.measureMode},[No],10,["title","disabled"]),p("button",{onClick:t[3]||(t[3]=(...e)=>n.heightClk&&n.heightClk(...e)),class:["sm-btn","Space"!=n.measureMode&&"Ground"!=n.measureMode?"pointer-events":""],id:"height",title:e.Resource.measureHeight,type:"button",disabled:"Space"!=n.measureMode&&"Ground"!=n.measureMode},[To],10,["title","disabled"]),p("button",{onClick:t[4]||(t[4]=(...e)=>n.areaClk&&n.areaClk(...e)),class:"sm-btn",id:"area",title:e.Resource.measureSurface,type:"button"},[Ao],8,["title"]),p("button",{onClick:t[5]||(t[5]=(...e)=>n.clear&&n.clear(...e)),class:"sm-btn",id:"clear",title:e.Resource.clear,type:"button"},[Bo],8,["title"]),d(p("div",Io,[d(p("input",{checked:"",id:"showLine",style:{"margin-left":"6px"},type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=e=>n.isShowLine=e)},null,512),[[w,n.isShowLine]]),p("span",_o,m(e.Resource.showContour),1)],512),[[h,n.isShowDVH]])],512),[[c]])],512)),[[u]])},So.__file="src/components/analysis_3d/measure/measure.vue",So.install=function(e){e.component(So.name,So)};var Oo={name:"Sm3dSkyline",props:{skylineSpatialAnalysisUrl:{type:String},observerInformation:{type:Object},skylineRadius:{type:Number},lineWidth:{type:Number},skylineColor:{type:String},skyBodyColor:{type:String},highlightBarrierColor:{type:String},highlightBarrier:{type:Boolean,default:!1},skylineMode:{type:Number},getSkyline2d:{type:Boolean,default:!1},ignoreGlobe:{type:Boolean,default:!0}},setup(e){let{skylineRadius:t,lineWidth:o,skylineColor:l,skyBodyColor:i,barrierColor:n,highlightBarrier:a,getSkyline2d:s,skyLineAnalysis:r,setLimitBody:d,clear:p,echarts_box:c,skylineMode:u,ignoreGlobe:m}=Fo(e);return{skylineRadius:t,lineWidth:o,skylineColor:l,skyBodyColor:i,barrierColor:n,highlightBarrier:a,getSkyline2d:s,skyLineAnalysis:r,setLimitBody:d,clear:p,echarts_box:c,skylineMode:u,ignoreGlobe:m}}};const Uo={id:"skyLine-panel",class:"sm-panel"},Ho={class:"sm-function-module-sub-section",style:{margin:"0"}},zo={class:"sm-half-L"},Go={style:{width:"35%"}},Wo={selected:"",value:"0"},jo={value:"1"},Ko={value:"2"},Qo={class:"sm-half-L"},Xo={style:{width:"35%"}},Yo={class:"sm-half-L"},Zo={style:{width:"35%"}},qo={class:"sm-half-L"},Jo={style:{width:"35%"}},$o={class:"sm-half-L"},el={style:{width:"35%"}},tl={class:"sm-half-L"},ol={style:{width:"35%"}},ll={class:"sm-half-L"},il={style:{width:"auto"}},nl={style:{width:"auto"}},al={class:"sm-half-L flex-start"},sl={class:"boxchild"},rl={ref:"echarts_box",id:"echarts_box"};Oo.render=function(e,t,o,n,a,s){const c=g("el-slider"),b=g("el-color-picker"),v=r("stopdrag"),C=r("drag");return l(),i(S,null,[d(p("div",Uo,[d(p("div",Ho,[p("div",zo,[p("label",Go,m(e.Resource.displayMode),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.skylineMode=e)},[p("option",Wo,m(e.Resource.polylineShow),1),p("option",jo,m(e.Resource.polygonShow),1),p("option",Ko,m(e.Resource.bodyShow),1)],512),[[f,n.skylineMode]])]),p("div",Qo,[p("label",Xo,m(e.Resource.skylineRadius),1),d(p("input",{type:"number",class:"sm-input",style:{width:"63%"},"onUpdate:modelValue":t[2]||(t[2]=e=>n.skylineRadius=e)},null,512),[[y,n.skylineRadius]])]),p("div",Yo,[p("label",Zo,m(e.Resource.lineWidth),1),p(c,{modelValue:n.lineWidth,"onUpdate:modelValue":t[3]||(t[3]=e=>n.lineWidth=e),min:1,step:1,max:10,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])]),p("div",qo,[p("label",Jo,m(e.Resource.skylineColor),1),p(b,{modelValue:n.skylineColor,"onUpdate:modelValue":t[4]||(t[4]=e=>n.skylineColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])]),p("div",$o,[p("label",el,m(e.Resource.skyBodyColor),1),p(b,{modelValue:n.skyBodyColor,"onUpdate:modelValue":t[5]||(t[5]=e=>n.skyBodyColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])]),p("div",tl,[p("label",ol,m(e.Resource.barrierColor),1),p(b,{modelValue:n.barrierColor,"onUpdate:modelValue":t[6]||(t[6]=e=>n.barrierColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])]),p("div",ll,[p("label",il,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>n.getSkyline2d=e)},null,512),[[w,n.getSkyline2d]]),u(" "+m(e.Resource.graphDisplay),1)]),p("label",nl,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>n.highlightBarrier=e)},null,512),[[w,n.highlightBarrier]]),u(" "+m(e.Resource.highlightBarrier),1)])]),p("div",al,[d(p("input",{checked:"",type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=e=>n.ignoreGlobe=e)},null,512),[[w,n.ignoreGlobe]]),p("label",null,m(e.Resource.ignoreGlobe),1)]),p("div",sl,[p("button",{class:"tbtn",type:"button",onClick:t[10]||(t[10]=(...e)=>n.skyLineAnalysis&&n.skyLineAnalysis(...e))},m(e.Resource.analyze),1),p("button",{class:"tbtn tbtn-margin-left",type:"button ",onClick:t[11]||(t[11]=(...e)=>n.setLimitBody&&n.setLimitBody(...e))},m(e.Resource.limitBody),1),p("button",{onClick:t[12]||(t[12]=(...e)=>n.clear&&n.clear(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.clear),1)])],512),[[v]])],512),[[C]]),d(p("div",rl,null,512),[[h,n.getSkyline2d]])],64)},Oo.__file="src/components/analysis_3d/sky-line/sky-line.vue",Oo.install=function(e){e.component(Oo.name,Oo)};var dl={name:"Sm3dShadowQuery",props:{timeValue:{type:Array},currentDate:{type:Object},shadowShow:{type:Boolean,default:!0},timeInterval:{type:Number},spacing:{type:Number},bottomHeight:{type:Number},extrudeHeight:{type:Number},shadowQueryRegion:{type:Array},layerShadowType:{type:Number},terrainShadows:{type:Number},showStartImgForTime:{type:Boolean,default:!0},showStartImgForDate:{type:Boolean,default:!0},dockFontShow:{type:Boolean,default:!0},legendShow:{type:Boolean,default:!1},shadowBodyShow:{type:Boolean,default:!1},shadowBodyFilter:{type:Array}},methods:{formatTooltip2:e=>"采光率："+e+"%",formatTooltip3:e=>e+"米"},setup(o){let{marks:l,timeValue:i,currentDate:n,shadowShow:r,timeChanged:d,formatTooltip:p,sunLightForTime:c,sunLightForDate:u,analysis:m,clear:y,showStartImgForTime:h,showStartImgForDate:w,shadowRadio:g,bubble:f,closeBubble:b,dockBubble:S,dockFontShow:C,legendShow:M,shadowBodyShow:D,shadowBodyFilter:R,filterChanged:x,extrudeHeight:L,spacing:P}=function(o){let l=e({timeValue:[24,64],currentDate:new Date,shadowShow:!0,marks:{0:"0:00",8:"",16:"",24:"6:00",32:"",40:"",48:"12:00",56:"",64:"",72:"18:00",80:"",88:"",96:"24:00"},timeInterval:60,spacing:10,bottomHeight:1,extrudeHeight:30,shadowQueryRegion:[],layerShadowType:SuperMap3D.ShadowType.ALL,terrainShadows:SuperMap3D.ShadowMode.RECEIVE_ONLY,showStartImgForTime:!0,showStartImgForDate:!0,shadowRadio:{shadowRadio:"",longitude:"",latitude:"",height:"",isShow:!1},dockFontShow:!0,legendShow:!1,shadowBodyShow:!1,shadowBodyFilter:[0,100]});if(o)for(let e in o)l.hasOwnProperty(e)?l[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);o&&o.shadowQueryRegion&&x(o.shadowQueryRegion);let i,n,r,d,p=!0,c=[...l.timeValue];const u=v(null);let m,y,h,w="public/data/s3m/box.s3m",g=[],f=we.gradientColors,b=["#0000ff"];function S(){let e=viewer.scene;viewer.shadows=l.shadowShow,viewer.terrainShadows=l.terrainShadows,n=viewer.scene.layers.layerQueue,e.globe.enableLighting=!0,e.skyBox.show=!0,viewer.clock.multiplier=1,viewer.clock.shouldAnimate=!0,i=new SuperMap3D.ShadowQueryPoints(e),m=new SuperMap3D.S3MInstanceCollection(e._context),m.setCullEnabled(w,!0),e.primitives.add(m),i.queryPointsEvent.addEventListener((function(e){g=e,l.shadowBodyShow&&E()})),V.changeLayers&&C()}function C(){for(let e=0;e<n.length;e++)n[e].shadowType=l.layerShadowType,y=!0}function M(e){let t;t=c[0]===e[0]?D(e[1]):D(e[0]),viewer.clock.currentTime=SuperMap3D.JulianDate.fromDate(t),c=e}function D(e){let t=parseInt(e/4),o=parseInt(e%4*15),i=l.currentDate;return i.setHours(t),i.setMinutes(o),i}function R(e){l.shadowShow&&(i.startTime=SuperMap3D.JulianDate.fromDate(D(e[0])),i.endTime=SuperMap3D.JulianDate.fromDate(D(e[1]))),l.showStartImgForTime&&l.shadowQueryRegion.length>0&&i.build()}function x(e){R(l.timeValue);let t=[];i.spacing=Number(l.spacing),i.timeInterval=Number(l.timeInterval);let o=Number(l.bottomHeight),n=Number(l.extrudeHeight);for(let o=0,l=SuperMap3D.arrayRemoveDuplicates(e,SuperMap3D.Cartesian3.equalsEpsilon).length;o<l;o++){let l=SuperMap3D.Cartographic.fromCartesian(e[o]),i=SuperMap3D.Math.toDegrees(l.longitude),n=SuperMap3D.Math.toDegrees(l.latitude);t.push(i),t.push(n)}l.shadowQueryRegion=t,i.qureyRegion({position:t,bottom:o,extend:n}),i.build()}function L(e){if(l.shadowBodyShow){let t=scene.pick(e.message.position);if(t&&t.id){let o=g[t.id];if(!o)return;let i=100*o.shadowRatio;(i<l.shadowBodyFilter[0]||i>l.shadowBodyFilter[1])&&(l.shadowRadio.isShow=!1);let n=we.CartesiantoDegrees(o.position);l.shadowRadio={shadowRadio:(100*o.shadowRatio).toFixed(0)+"%",longitude:n[0].toFixed(8),latitude:n[1].toFixed(8),height:n[2].toFixed(8),isShow:!0},u.value.style.top=e.message.position.y-160+"px",u.value.style.left=e.message.position.x+"px"}else l.shadowRadio.isShow=!1}else{let t=scene.pickPosition(e.message.position),o=SuperMap3D.Cartographic.fromCartesian(t),n=i.getShadowRadio(o);if(-1!=n){let t=SuperMap3D.Math.toDegrees(o.longitude),i=SuperMap3D.Math.toDegrees(o.latitude),a=o.height;l.shadowRadio={shadowRadio:(100*n).toFixed(0)+"%",longitude:t.toFixed(8),latitude:i.toFixed(8),height:a.toFixed(8),isShow:!0},u.value.style.top=e.message.position.y-160+"px",u.value.style.left=e.message.position.x+"px"}else l.shadowRadio.isShow=!1}}function P(){l.shadowRadio.isShow=!1}function k(){l.legendShow=!1,be(),l.shadowQueryRegion.length=0,tooltip.setVisible(!1),P(),viewer.eventManager.removeEventListener("CLICK",L),i.clear(),g.length=0,m.removeCollection(w);for(let e=0;e<n.length;e++)n[e].shadowType=SuperMap3D.ShadowType.NONE}function E(){let e=[];if(i._bottom<0||0==g.length)return;let t=Number(l.spacing-.5);for(let o=0,l=g.length;o<l;o++)e.push({position:g[o].position,color:N(g[o].shadowRatio),scale:new SuperMap3D.Cartesian3(t,t,t)});e.length>0&&m.add(w,e),T(l.shadowBodyFilter)}function N(e){let t=parseInt(100*e),o=b[t];return SuperMap3D.Color.fromCssColorString(o)}function T(e){if(!(i._bottom<=0||0==g.length))for(let t=0,o=g.length;t<o;t++){let o=100*g[t].shadowRatio;o<e[0]||o>e[1]?m.getInstance(w,t).visible=!1:m.getInstance(w,t).visible=!0}}function A(e){h&&clearTimeout(h),h=setTimeout((function(){e()}),500)}return b=b.concat(f("#0000ff","#00ffff",20)).concat(f("#00ffff","#00ff00",20)).concat(f("#00ff00","#ffff00",20)).concat(f("#ffff00","#ff7f00",20)).concat(f("#ff7f00","#ff0000",20)),V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element)),S()),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)),S())})),s((()=>V.changeLayers),(e=>{C()})),s((()=>l.timeValue),(e=>{M(e)})),s((()=>l.currentDate),(e=>{M(c)})),s((()=>l.timeInterval),(e=>{A((()=>{i.timeInterval=Number(e)}))})),s((()=>l.spacing),(e=>{A((()=>{i.spacing=Number(e)}))})),s((()=>l.bottomHeight),(e=>{0!==l.shadowQueryRegion.length&&A((()=>{let t=Number(e),o=Number(l.extrudeHeight);i.qureyRegion({position:l.shadowQueryRegion,bottom:t,extend:o}),i.build()}))})),s((()=>l.extrudeHeight),(e=>{0!==l.shadowQueryRegion.length&&A((()=>{let t=Number(l.bottomHeight),o=Number(e);i.qureyRegion({position:l.shadowQueryRegion,bottom:t,extend:o}),i.build()}))})),s((()=>l.shadowShow),(e=>{viewer.shadows=e;for(let e=0,t=n.length;e<t&&n[e].shadowType!=l.layerShadowType;e++)n[e].shadowType=l.layerShadowType})),s((()=>l.shadowBodyShow),(e=>{e?(i.isPointsVisible=!1,E()):(i.isPointsVisible=!0,m.removeCollection(w))})),t((()=>{k(),i.destroy(),i=void 0,viewer.shadows=!1,n=void 0})),{...a(l),timeChanged:R,filterChanged:function(e){T(e)},formatTooltip:function(e){return e===l.timeValue[0]?"开始时间:"+t(D(e).toLocaleTimeString()):"结束时间:"+t(D(e).toLocaleTimeString());function t(e){let t=e.split(":");return t[0]+":"+t[1]}},sunLightForTime:function(e){if(d&&(l.showStartImgForDate=!0,clearInterval(d)),!e)return l.showStartImgForTime=!0,void clearInterval(r);l.showStartImgForTime=!1;let t=[...c],o=t[0],i=t[1],n=o;r=setInterval((()=>{n<i?(n+=.5,l.timeValue=[o,n]):(l.showStartImgForTime=!0,clearInterval(r))}),50)},sunLightForDate:function(e){if(r&&(clearInterval(r),l.showStartImgForTime=!0),!e)return l.showStartImgForDate=!0,void clearInterval(d);l.showStartImgForDate=!1;let t=D(c[1]),o=t.getMonth();d=setInterval((()=>{o<11?o+=1:o=0,t.setMonth(o),l.currentDate=new Date(t)}),1e3)},analysis:function(){l.shadowShow?(tooltip.setVisible(!1),p&&(window.tooltip.showAt(" <p>点击鼠标左键绘制分析区域</p><p>点击鼠标右键结束绘制</p>","350px"),p=!1),y&&n[0].shadowType==l.layerShadowType||C(),window.handlerPolygon||ge("Polygon"),fe("Polygon").then((e=>{let t=window.handlerPolygon;x(e.result.object.positions),t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),viewer.eventManager.addEventListener("CLICK",L,!0)}),(e=>{console.log(e)})),window.handlerPolygon.activate(),l.legendShow=!0):l.shadowShow=!0},clear:k,bubble:u,closeBubble:P,dockBubble:function(e){e?(u.value.classList.add("bubbleDock"),l.dockFontShow=!1):(u.value.classList.remove("bubbleDock"),l.dockFontShow=!0)}}}(o);return{marks:l,timeValue:i,currentDate:n,shadowShow:r,timeChanged:d,formatTooltip:p,sunLightForTime:c,sunLightForDate:u,analysis:m,clear:y,showStartImgForTime:h,showStartImgForDate:w,shadowRadio:g,bubble:f,closeBubble:b,dockBubble:S,dockFontShow:C,legendShow:M,shadowBodyShow:D,shadowBodyFilter:R,filterChanged:x,extrudeHeight:L,spacing:P}}},pl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAD2ElEQVRYR+2XTWwUZRjH/8+7UAxp8WCCdGbrhfoRTGrozkpE2sChGDxoIujFg+GwM0tQ8DMROYgkgkYsUiTsTG8mHlRqojGi9EBDiwT23RKbQPyoF7szKIkHKTFY2fcxs7vY3e3szBQ1jYlznPf5+M3/eZ/3fYawwA8tcH78twC6B6e6hBI9INoCZg2g9oqCfAlEHpiPKaFGxzMdE3GVjaVA96DXI5TaCdDmeIF5SAlxaDyjjUbZRwIYOXcAhGeqgQoEGmbiMwklJjHTUiy/b5lJloTqJKYHGNwHIFURBodlVt8RBhEKYNjF7wHqBPANQAelpTlRX+SvG7ZnAvwcgHsAnpRW8s5mfk0BDMcdA+NBANNKLFo3nrk9dl39ZN2DP3cJdX0MQBsIp6WprwuCCAQw7OLrAL3iO0hLjyxTmCqG7XJ1o+6TVnJ3o+2c4IYztQksPi8bKrVBbusYiSN7Mxvj6NR6CHGyvE7qYWl2HK+1nQOQdtxTzOhh5v2FbLKswt99UrniPiLaRYTRvKn3NgVI2T9uJCS+BHD+t+uLey9uX361MbnheCfB3AlQv7S0g3HgVh253Lp00R+nAKxmlB4qWHecuOFXp0Aq575FhBcBvCst/Ubr1eWYrWn59Rli2pvPal9EgRi2exjA08w4UMjqLwUCGLZ7GsBaYtqcz2ofBwVtAKiUFvRR3tKeCINI57zHmHgIwFfS0v3uqvrWeBm2NwnwygSLe89m2y/GBfjLToinZKb9vSC/NblLq0qkLgD0g7Q0/2wJBJgGuDXx+y23nt1x25V5A4SosWbgl2WlJdd+BeiqtLS2ZgBXAG77lwGmpaUta7YHvgVw102XgKi/dXH77pGtdK1RvdkS4Dtp6XcHA1RabD0Ij0pT/3QeJfggwWJvs33jxzEc9xEwPgHRiDS1Dc0U2O63IIHeyFvarhgAY4ISb54zV3wW1YZp29vP4Jf9VpSWfiQQoDpwfA3CxEwp0TexbcXlxsDVg2glgw4ULG0gKrG/3nX0p+UtidIwGF1KqPtqB5a5d4FdPOYPHnF6O05y3yZtex8y+HGAh6SV3FLrNwegMv2wf2yCmJ7NZ7VDcRMF2aVz3k4mfsdfU4J6G6ek4OvY8d4G8/O+0z92HRP1S1N7oREyZCCpdkQZff7Xcv01XL/zQ0tQu1g/D7KjhHDGM1ohrCTdg15KKGUCZJbtIubCyGnHsN1XAeyZTUrHifC+UHS+dihVglcz40mAN9UA7pGW/loYcCSA77ygY3kt/f05z1CkNoJEX/CPiRoWLE6cy2oybufEUiBusJux+x/gT7q4qzC8oWE0AAAAAElFTkSuQmCC",cl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADfElEQVRYR9WXT2gUdxTHv++3YKSYWOjJmY0XEwsKFbOTFv9EzEHFHHpo1Yu9Zn8p1hRsCrY9qAf1oDaYKO5szl6MORTB0FyS+hfNb7dYULDGS7Mz4qGUxgpGyO/J7GxgdjOzM5pI6MAedt6f3+e933u/3xvCMj+0zOvj/wXQNjT9idCiA0T7wGwAtAYoB/Ec4OcMfQ0QYwVpFpNmNlEG2obcDqH1twB9mcwxj2ghzhe7jZtx+rEAVs4ZAOFwxVGRQGNMfDelxRReryiV3694nZ4TuoWYtjB4F4BM+T1jUPWYvfUg6gJYdukJQC2eAwL98M/sy/6p3tbZuKgs280C6AV4I8BTSqZbo2wiAay8cwuMbX4gfKAg08NxCwfln+WebZgjvlKGINxWWXN7mH0ogGWXTgL0o2egpBm7TVFgVRDgU0qmf6rVXeDcyk/vBYvrZUWtO9XXzRNvE3mtbnUmdJfKNo8GdRYAtOedG8zoADivZFouZvF5W78m2CbCzcmsuSMSIGP/tZuQ+rUcvCCr2G0UgsrzjgCSShr5pDJPz7Id5XUHY25PQa4dm7etykAm55whQh9Ao0oaXbXRW7ZzDMBx76ekeaIaIFpWARgE8A0zzhZ6zO9DASzbuQ1gKxF9NZk1Li8lQHvO/YKJRwDcUdIsd5ff3oHHst0pgNelWGy817Pm0VIC+MWoHwL0VEmjfLaEAbwAeFVqduXqe70fzSwpwMDfTXMNr/4F6D8ljcYogBmAG98zwAsljaaoGngMYP373QL8qaT5cThA3h0H886oo3dRXZB3PgfjFxBNqKzRGZWBQwAuEGh4UhoHlrIG2m33NIOPeq2opHkxFKAycDzwhIJ56/2e9N0gRMYu7SfQlbAM1ZO1DDxp+LDhgzsA2rTQm4rdzX+EAvgHRumqN3hEZaE2K0n+t9vuUQafBnhEyfS+oM2Cu8CffviGp8TgvoJMn0uySJTOfGY8uRa0o3ZKCr+O8+45MB/xjBZzHfsZddg/cehnlTW+qwWtM5D4HVHJxFsPJNal6Z0QYryyeFXl192CoDA4D3o1Qaz7awuzNqK2ITcjtM4C5I1lsXNh7LQT6P3KWjRKhMtC0+/BoVQL3syMgwDvDUAtuDUTb0FQcVnH8iDIpznX0qR3g8Su0A8T5t9SwLW4bUpcA4tpv6S2sTWQ1NG76i07wBsGL9kwcaf0IQAAAABJRU5ErkJggg==";const ul={id:"shadowquery-panel",class:"sm-panel"},ml={class:"sm-function-module-sub-section",style:{margin:"0"}},yl={class:"sm-half-L"},hl={class:"sm-slider-input-box-M"},wl={class:"sm-half-L"},gl={class:"sm-slider-input-box-M",style:{height:"34px"}},fl={class:"sm-half-L"},bl={style:{width:"40%"}},vl={class:"flex flex-start",style:{width:"35%","align-items":"center"}},Sl={style:{width:"auto"}},Cl={class:"sm-half-L"},Ml={style:{width:"40%"}},Dl={class:"boxchild flex-between",style:{padding:"0"}},Rl={class:"flex flex-start",style:{width:"35%","align-items":"center"}},xl={style:{width:"auto"}},Ll={class:"flex flex-end",style:{width:"auto"}},Pl={id:"bubble",class:"bubble",ref:"bubble"},Vl={class:"boxchild flex-between"},kl=p("label",{style:{width:"auto"}},"分析结果",-1),El={class:"flex flex-end",style:{width:"auto"}},Nl={class:"sm-half-L"},Tl=p("label",{class:"label-S"},"采光率",-1),Al={class:"sm-half-L"},Bl=p("label",{class:"label-S"},"经度",-1),Il={class:"sm-half-L"},_l=p("label",{class:"label-S"},"纬度",-1),Fl={class:"sm-half-L"},Ol=p("label",{class:"label-S"},"高程",-1),Ul={class:"legend"},Hl=p("img",{src:"public/img/other/legend_shadow.png",alt:""},null,-1);function zl(o){let l,i,n,r,d,p=e({viewshedSpatialUrl:"http://www.supermapol.com/realspace/services/spatialAnalysis-data_all/restjsr/spatialanalyst/geometry/3d/viewshedbody.json",observerInformation:null,direction:1,pitch:1,addheight:1.8,distance:200,verticalFov:60,horizontalFov:90,hintLineColor:"rgb(212,202,45)",visibleAreaColor:"rgba(9,199,112,0.5)",hiddenAreaColor:"rgba(238,114,22,0.5)",visibleBodyColor:"rgba(9,199,112,0.7)",invisibleBodyColor:"rgba(238,114,22,0.7)",visibleBody:!1,invisibleBody:!1,viewshedAnimation:!1,DynamicLine:[],DynamicSpeed:10});if(o)for(let e in o)p.hasOwnProperty(e)?p[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let c,u,m=!0,y=["public/data/s3m/car1.s3m"];function h(){console.log("可视域分析"),r=viewer.scene,l=new SuperMap3D.ViewShed3D(r),i=new SuperMap3D.ScreenSpaceEventHandler(r.canvas),l.hintLineColor=SuperMap3D.Color.fromCssColorString(p.hintLineColor),l.visibleAreaColor=SuperMap3D.Color.fromCssColorString(p.visibleAreaColor),l.hiddenAreaColor=SuperMap3D.Color.fromCssColorString(p.hiddenAreaColor),n=new SuperMap3D.S3MInstanceCollection(r._context),viewer.scene.primitives.add(n),u=new SuperMap3D.DynamicLayer3D(r.context,y),u.updateInterval=100,u.setCullEnabled(y[0],SuperMap3D.CullFace.BACK),u.maxVisibleAltitude=2e3,u.minVisibleAltitude=0,r.primitives.add(u)}V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element)),h()),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)),h())}));let w=null;function g(e){switch(e){case"LEFT_CLICK":i.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK);break;case"MOUSE_MOVE":i.removeInputAction(SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE);break;case"RIGHT_CLICK":i.removeInputAction(SuperMap3D.ScreenSpaceEventType.RIGHT_CLICK);break;case"ALL":default:i.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),i.removeInputAction(SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),i.removeInputAction(SuperMap3D.ScreenSpaceEventType.RIGHT_CLICK)}}function f(){let e=l.getViewshedParameter(),t={viewerPoint:e.viewPosition,point3DsList:e.point3DList,radius:e.distance,lonlat:!0,viewShedType:"VISIBLEBODY"},o=JSON.stringify(t),i=SuperMap3D.Color.fromCssColorString(p.visibleBodyColor);window.axios.post(p.viewshedSpatialUrl,o).then((function(e){window.axios.get(e.data.newResourceLocation+".json").then((function(e){let t=e.data;if(null==t.geometry)return void we.Message.errorMsg("获取geometry失败");let o=new Uint8Array(t.geometry.model).buffer;n.add("VeiwshedBody",{id:1,position:SuperMap3D.Cartesian3.fromDegrees(t.geometry.position.x,t.geometry.position.y,t.geometry.position.z),hpr:new SuperMap3D.HeadingPitchRoll(0,0,0),color:i},o,!1),t.geometry.model=[4,0,0,0].concat(t.geometry.model),l.visibleAreaColor=SuperMap3D.Color.fromCssColorString("rgba(0,0,0,0)"),l.hiddenAreaColor=SuperMap3D.Color.fromCssColorString("rgba(0,0,0,0)"),t.geometry.name=ce.VeiwshedBody,E.geometrys.VeiwshedBody=t.geometry,k.setGeometrys()})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}function b(){let e=l.getViewshedParameter(),t={viewerPoint:e.viewPosition,point3DsList:e.point3DList,radius:e.distance,lonlat:!0,viewShedType:"HIDDENBODY"},o=JSON.stringify(t),i=SuperMap3D.Color.fromCssColorString(p.invisibleBodyColor);window.axios.post(p.viewshedSpatialUrl,o).then((function(e){window.axios.get(e.data.newResourceLocation+".json").then((function(e){let t=e.data;if(null==t.geometry)return void we.Message.errorMsg("获取geometry失败");let o=new Uint8Array(t.geometry.model).buffer;n.add("VeiwshedBodyHidden",{id:1,position:SuperMap3D.Cartesian3.fromDegrees(t.geometry.position.x,t.geometry.position.y,t.geometry.position.z),hpr:new SuperMap3D.HeadingPitchRoll(0,0,0),color:i},o,!1),t.geometry.model=[4,0,0,0].concat(t.geometry.model),l.visibleAreaColor=SuperMap3D.Color.fromCssColorString("rgba(0,0,0,0)"),l.hiddenAreaColor=SuperMap3D.Color.fromCssColorString("rgba(0,0,0,0)"),t.geometry.name=ce.VeiwshedBodyHidden,E.geometrys.VeiwshedBodyHidden=t.geometry,k.setGeometrys()})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}function v(){S(),u.clearState(y[0],[1]),clearInterval(c),c=null,p.viewshedAnimation=!1,be("Polyline")}function S(){tooltip.setVisible(!1),viewer.entities.removeById("viewshedPoint"),document.body.classList.remove("measureCur"),l.distance=1e-5,l.viewPosition=[0,0,0],p.visibleBody=!1,p.invisibleBody=!1,p.observerInformation=null}function C(){l.distance=p.distance,l.build();let e=p.DynamicLine,t=[];for(let o=1,l=e.length;o<l;o++){let l=e[o-1],i=e[o],n=SuperMap3D.Cartesian3.distance(l,i),a=parseInt(n/(.05*p.DynamicSpeed))+1;for(let e=1,o=a;e<=o;e++)t.push(SuperMap3D.Cartesian3.lerp(l,i,e/a,new SuperMap3D.Cartesian3))}let o=we.CartesiantoDegreesObjs(t),i=new SuperMap3D.DynamicObjectState({id:1,longitude:o[0].longitude,latitude:o[0].latitude,altitude:o[0].height,scale:new SuperMap3D.Cartesian3(1,1,1)});u.updateObjectWithModel(y[0],[i]);let n=1;c=setInterval((()=>{if(n>=o.length)return void clearInterval(c);i.longitude=o[n].longitude,i.latitude=o[n].latitude,i.altitude=o[n].height,u.updateObjectWithModel(y[0],[i]);let e=we.getAngleAndRadian(t[n-1],t[n]);l.direction=e.angle,l.viewPosition=[i.longitude,i.latitude,i.altitude+Number(p.addheight)],n+=1}),50)}function M(e){if(""!=e)return SuperMap3D.Color.fromCssColorString(e)}return s((()=>p.visibleBody),(e=>{e&&p.observerInformation?f():(n.removeCollection("VeiwshedBody"),p.invisibleBody||(l.visibleAreaColor=SuperMap3D.Color.fromCssColorString(p.visibleAreaColor),l.hiddenAreaColor=SuperMap3D.Color.fromCssColorString(p.hiddenAreaColor)),E.geometrys.VeiwshedBody&&(delete E.geometrys.VeiwshedBody,k.setGeometrys()))})),s((()=>p.invisibleBody),(e=>{e&&p.observerInformation?b():(n.removeCollection("VeiwshedBodyHidden"),p.visibleBody||(l.visibleAreaColor=SuperMap3D.Color.fromCssColorString(p.visibleAreaColor),l.hiddenAreaColor=SuperMap3D.Color.fromCssColorString(p.hiddenAreaColor)),E.geometrys.VeiwshedBodyHidden&&(delete E.geometrys.VeiwshedBodyHidden,k.setGeometrys()))})),s((()=>p.addheight),(e=>{(""===e||e<0)&&(e=0),p.observerInformation&&(p.observerInformation[2]=w+parseFloat(e),l.viewPosition=p.observerInformation)})),s((()=>p.pitch),(e=>{(""===e||e<0)&&(e=0),l.pitch=parseFloat(e)})),s((()=>p.direction),(e=>{(""===e||e<0)&&(e=0),l.direction=parseFloat(e)})),s((()=>p.distance),(e=>{(""===e||e<0)&&(e=0),l.distance=parseFloat(e)})),s((()=>p.verticalFov),(e=>{(""===e||e<0)&&(e=0),l.verticalFov=parseFloat(e)})),s((()=>p.horizontalFov),(e=>{(""===e||e<0)&&(e=0),l.horizontalFov=parseFloat(e)})),s((()=>p.hintLineColor),(e=>{l.hintLineColor=M(e)})),s((()=>p.visibleAreaColor),(e=>{l.visibleAreaColor=M(e)})),s((()=>p.visibleBodyColor),(e=>{n.getInstance("VeiwshedBody",1).updateColor(M(e))})),s((()=>p.hiddenAreaColor),(e=>{l.hiddenAreaColor=M(e)})),s((()=>p.invisibleBodyColor),(e=>{n.getInstance("VeiwshedBodyHidden",1).updateColor(M(e))})),s((()=>p.viewshedAnimation),(e=>{e?(S(),tooltip.showAt("<p>点击分析按钮激活事件</p><p>点击鼠标左键确认模型移动路线</p><p>单击右键结束分析</p>","450px"),setTimeout((()=>{tooltip.setVisible(!1)}),3e3)):v()})),t((()=>{v(),n.destroy(),l.destroy(),i.destroy(),DynamicLayer3D.destroy(),l=void 0,i=void 0,n=void 0})),{...a(p),analysis:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),p.viewshedAnimation?(c&&(v(),p.viewshedAnimation=!0,document.body.classList.add("measureCur")),function(){window.handlerPolyline||ge("Polyline");if(o.DynamicLine)return void C();fe("Polyline",SuperMap3D.ClampMode.Ground).then((e=>{let t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!0,t.deactivate(),p.DynamicLine=e.result.object.positions,tooltip.setVisible(!1),p.DynamicLine.length<2?we.Message.warnMsg("至少需要两个点！"):C()}),(e=>{console.log(e)})),window.handlerPolyline.activate()}()):(m&&(window.tooltip.showAt(" <p>点击鼠标左键确认观察者位置</p> <p>右键单击结束分析</p>","450px"),m=!1),n.removeCollection("VeiwshedBody"),n.removeCollection("VeiwshedBodyHidden"),l.distance=1e-5,l.visibleAreaColor=SuperMap3D.Color.fromCssColorString(p.visibleAreaColor),l.hiddenAreaColor=SuperMap3D.Color.fromCssColorString(p.hiddenAreaColor),i.setInputAction((function(e){w=null;let t=r.pickPosition(e.position);d=t;let o=we.CartesiantoDegrees(t);w=o[2],o[2]+=Number(p.addheight),l.viewPosition=o,l.build(),p.observerInformation=o,document.body.classList.remove("measureCur"),g("LEFT_CLICK"),i.setInputAction((function(e){let t=e.endPosition,o=r.pickPosition(t);if(SuperMap3D.Cartesian3.distance(d,o)>0){let e=we.CartesiantoDegrees(o);l.setDistDirByPoint(e)}}),SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),i.setInputAction((function(e){p.direction=l.direction.toFixed(2),p.pitch=l.pitch.toFixed(2),p.distance=l.distance.toFixed(2),p.horizontalFov=l.horizontalFov,p.verticalFov=l.verticalFov,p.visibleBody&&f(),p.invisibleBody&&b(),tooltip.setVisible(!1),g("MOUSE_MOVE"),g("RIGHT_CLICK")}),SuperMap3D.ScreenSpaceEventType.RIGHT_CLICK),function(e){viewer.entities.removeById("viewshedPoint"),viewer.entities.add(new SuperMap3D.Entity({id:"viewshedPoint",point:new SuperMap3D.PointGraphics({color:M(p.hiddenAreaColor),pixelSize:8}),position:e}))}(SuperMap3D.Cartesian3.fromDegrees(o[0],o[1],o[2]))}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK))},clear:v}}dl.render=function(e,t,o,n,a,s){const c=g("el-slider"),u=g("el-date-picker"),f=r("stopdrag"),v=r("drag");return l(),i(S,null,[d(p("div",ul,[d(p("div",ml,[p("div",yl,[p("div",hl,[p(c,{modelValue:n.timeValue,"onUpdate:modelValue":t[1]||(t[1]=e=>n.timeValue=e),max:96,step:.5,range:"",marks:n.marks,"tooltip-class":"tooltip-class","format-tooltip":n.formatTooltip,onChange:n.timeChanged},null,8,["modelValue","step","marks","format-tooltip","onChange"])]),d(p("img",{src:pl,title:e.Resource.title1,style:{width:"36px",height:"36px","margin-top":"-20px"},onClick:t[2]||(t[2]=e=>n.sunLightForTime(!0))},null,8,["title"]),[[h,n.showStartImgForTime]]),d(p("img",{src:cl,title:e.Resource.title0,style:{width:"36px",height:"36px","margin-top":"-20px"},onClick:t[3]||(t[3]=e=>n.sunLightForTime(!1))},null,8,["title"]),[[h,!n.showStartImgForTime]])]),p("div",wl,[p("div",gl,[p(u,{modelValue:n.currentDate,"onUpdate:modelValue":t[4]||(t[4]=e=>n.currentDate=e),type:"date",size:"small",clearable:!1},null,8,["modelValue"])]),d(p("img",{src:pl,title:e.Resource.title2,style:{width:"36px",height:"36px"},onClick:t[5]||(t[5]=e=>n.sunLightForDate(!0))},null,8,["title"]),[[h,n.showStartImgForDate]]),d(p("img",{src:cl,title:e.Resource.title0,style:{width:"36px",height:"36px"},onClick:t[6]||(t[6]=e=>n.sunLightForDate(!1))},null,8,["title"]),[[h,!n.showStartImgForDate]])]),p("div",fl,[p("label",bl,m(e.Resource.stretchHeight),1),p(c,{modelValue:n.extrudeHeight,"onUpdate:modelValue":t[7]||(t[7]=e=>n.extrudeHeight=e),min:0,max:150,step:1,"input-size":"mini",debounce:500,"format-tooltip":s.formatTooltip3,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue","format-tooltip"]),b(' <input class="sm-input-S" min="1" step="1" type="number" v-model="clipWidth" /> ')]),b(' <div class="sm-half-L">\r\n        <label style="width: 40%;">分析间距</label>\r\n        <el-slider\r\n          v-model="spacing"\r\n          :min="0.5"\r\n          :max="50"\r\n          :step="0.5"\r\n          input-size="mini"\r\n          :debounce="500"\r\n          :format-tooltip="formatTooltip3"\r\n          tooltip-class="tooltip-class"\r\n          style="width:58%"\r\n        ></el-slider>\r\n      </div> '),p("div",vl,[d(p("input",{checked:"",type:"checkbox",style:{"margin-right":"10%"},"onUpdate:modelValue":t[8]||(t[8]=e=>n.shadowBodyShow=e)},null,512),[[w,n.shadowBodyShow]]),p("label",Sl,m(e.Resource.bodyShow),1)]),d(p("div",Cl,[p("label",Ml,m(e.Resource.daylightFilter),1),p(c,{modelValue:n.shadowBodyFilter,"onUpdate:modelValue":t[9]||(t[9]=e=>n.shadowBodyFilter=e),min:0,max:100,range:"",step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",onChange:n.filterChanged,"format-tooltip":s.formatTooltip2,style:{width:"58%"}},null,8,["modelValue","onChange","format-tooltip"])],512),[[h,n.shadowBodyShow]]),p("div",Dl,[p("div",Rl,[d(p("input",{checked:"",type:"checkbox",style:{"margin-right":"10%"},"onUpdate:modelValue":t[10]||(t[10]=e=>n.shadowShow=e)},null,512),[[w,n.shadowShow]]),p("label",xl,m(e.Resource.shadowShow),1)]),p("div",Ll,[p("button",{onClick:t[11]||(t[11]=(...e)=>n.analysis&&n.analysis(...e)),class:"tbtn tbtn-width",type:"button",style:""},m(e.Resource.analyze),1),p("button",{onClick:t[12]||(t[12]=(...e)=>n.clear&&n.clear(...e)),class:"tbtn tbtn-width tbtn-margin-left",type:"button"},m(e.Resource.clear),1)])])],512),[[f]])],512),[[v]]),d(p("div",Pl,[p("div",Vl,[kl,p("div",El,[d(p("i",{class:"el-icon-position",title:"停靠",style:{"margin-right":"8px"},onClick:t[13]||(t[13]=e=>n.dockBubble(!0))},null,512),[[h,n.dockFontShow]]),d(p("i",{class:"el-icon-chat-square",title:"悬浮",style:{"margin-right":"8px"},onClick:t[14]||(t[14]=e=>n.dockBubble(!1))},null,512),[[h,!n.dockFontShow]]),p("i",{class:"el-icon-close",title:"关闭",onClick:t[15]||(t[15]=(...e)=>n.closeBubble&&n.closeBubble(...e))})])]),p("div",Nl,[Tl,d(p("input",{class:"sm-input-M",style:{width:"70%",height:"20px"},type:"text","onUpdate:modelValue":t[16]||(t[16]=e=>n.shadowRadio.shadowRadio=e)},null,512),[[y,n.shadowRadio.shadowRadio]])]),p("div",Al,[Bl,d(p("input",{class:"sm-input-M",style:{width:"70%",height:"20px"},type:"text","onUpdate:modelValue":t[17]||(t[17]=e=>n.shadowRadio.longitude=e)},null,512),[[y,n.shadowRadio.longitude]])]),p("div",Il,[_l,d(p("input",{class:"sm-input-M",style:{width:"70%",height:"20px"},type:"text","onUpdate:modelValue":t[18]||(t[18]=e=>n.shadowRadio.latitude=e)},null,512),[[y,n.shadowRadio.latitude]])]),p("div",Fl,[Ol,d(p("input",{class:"sm-input-M",style:{width:"70%",height:"20px"},type:"text","onUpdate:modelValue":t[19]||(t[19]=e=>n.shadowRadio.height=e)},null,512),[[y,n.shadowRadio.height]])])],512),[[h,n.shadowRadio.isShow]]),d(p("div",Ul,[Hl],512),[[h,n.legendShow]])],64)},dl.__file="src/components/analysis_3d/shadow-query/shadow-query.vue",dl.install=function(e){e.component(dl.name,dl)};var Gl={name:"Sm3dViewshed",props:{viewshedSpatialUrl:{type:String},observerInformation:{type:Object},direction:{type:Number},pitch:{type:Number},addheight:{type:Number},distance:{type:Number},verticalFov:{type:Number},horizontalFov:{type:Number},hintLineColor:{type:String},visibleAreaColor:{type:String},hiddenAreaColor:{type:String},visibleBodyColor:{type:String},invisibleBodyColor:{type:String},visibleBody:{type:Boolean},invisibleBody:{type:Boolean},viewshedAnimation:{type:Boolean},DynamicLine:{type:Array},DynamicSpeed:{type:Number}},setup(e){let{visibleBody:t,invisibleBody:o,viewshedAnimation:l,analysis:i,clear:n,addheight:a,verticalFov:s,horizontalFov:r,hintLineColor:d,visibleAreaColor:p,hiddenAreaColor:c,visibleBodyColor:u,invisibleBodyColor:m}=zl(e);return{addheight:a,verticalFov:s,horizontalFov:r,hintLineColor:d,visibleAreaColor:p,hiddenAreaColor:c,visibleBodyColor:u,invisibleBodyColor:m,visibleBody:t,invisibleBody:o,viewshedAnimation:l,analysis:i,clear:n}}};const Wl={id:"viewshed",class:"sm-panel"},jl={class:"sm-function-module-sub-section",style:{margin:"0"}},Kl={class:"sm-half-L"},Ql={style:{width:"35%"}},Xl={class:"sm-half-L"},Yl={style:{width:"35%"}},Zl={class:"sm-half-L"},ql={style:{width:"35%"}},Jl={class:"sm-half-L"},$l={style:{width:"35%"}},ei={class:"sm-half-L"},ti={style:{width:"35%"}},oi={class:"sm-half-L"},li={style:{width:"35%"}},ii={class:"sm-half-L"},ni={style:{width:"35%"}},ai={class:"sm-half-L"},si={style:{width:"35%"}},ri={class:"sm-half-L"},di={style:{width:"auto"}},pi={style:{width:"auto"}},ci={style:{width:"auto"}},ui={class:"boxchild"};function mi(l){let i,n,r,d=e({profile2d:!0,polylineColor:"rgb(250, 213, 6)",polylineWidth:5,initEchartsOption:null,updateEchartsOption:null});if(l)for(let e in l)d.hasOwnProperty(e)?d[e]=l[e]:we.Message.errorMsg(ce.AttributeError+e);let p=!0,c=[],u=[],m=null;const y=v(null);function h(){window.echarts?(i||(i=window.echarts.init(y.value),window.onresize=function(){i.resize()}),d.initEchartsOption?i.setOption(d.initEchartsOption):i.setOption({title:{text:"剖面分析",textStyle:{fontSize:14}},grid:{left:30,right:0,top:30,bottom:8},tooltip:{},xAxis:{data:[]},yAxis:{data:[]},series:[{type:"bar",data:[]}]})):we.Message.warnMsg(ce.EchartsErr)}function w(e,t){d.profile2d=!0,i.clear(),i.showLoading(),c.length=0,u.length=0;let o=[];for(let e=1,l=t.length;e<l;e++){let l=t[e-1],i=t[e],a=SuperMap3D.Cartesian3.distance(l,i);g(parseInt(a));for(let e=1,t=n;e<=t;e++)o.push(SuperMap3D.Cartesian3.lerp(l,i,e/n,new SuperMap3D.Cartesian3))}viewer.scene.clampToHeightMostDetailed(o).then((e=>{u=e,c=we.CartesiantoDegreesObjs(u),function(){if(i.hideLoading(),i.clear(),d.updateEchartsOption)return void i.setOption(d.updateEchartsOption);let e={title:{text:"剖面信息",textStyle:{fontSize:14}},grid:{left:50,right:8,top:40,bottom:20},tooltip:{trigger:"axis",backgroundColor:"#ffffff",textStyle:{color:"#000"},formatter:e=>{let t=e[0].dataIndex;return r=u[t],['当前位置: <hr size=1 style="margin: 3px 0">',"经度: "+c[t].longitude.toFixed(6)+"<br/>","纬度: "+c[t].latitude.toFixed(6)+"<br/>","海拔: "+c[t].height.toFixed(2)+"米<br/>"].join("")}},xAxis:{data:c.map((function(e,t){return t})),show:!1},yAxis:{min:function(e){return e.min<20?0:Math.floor(e.min)},axisLabel:{interval:"auto",formatter:function(e,t){return e>999?(e/1e3).toFixed(2)+"km":e+"m"}},splitLine:{show:!0}},toolbox:{left:"right",feature:{saveAsImage:{}}},dataZoom:[{type:"inside",xAxisIndex:0,filterMode:"filter",start:0,end:100}],series:{name:"height",type:"line",data:c.map((function(e){return e.height})),areaStyle:{}}};i.setOption(e)}()}))}function g(e){n=e/1e4>1?parseInt(e/100):e/1e3>5?parseInt(e/10):e/1e3>2?parseInt(e/5):e/1e3>1?parseInt(e/2):e/100>5?parseInt(e/1.5):e/100>2?e:2*e}function f(){d.profile2d=!1,viewer.entities.removeById("location4"),viewer.entities.removeById("polyline-profile"),i.clear(),c.length=0,u.length=0,be("Polyline"),Re(),h(),tooltip.setVisible(!1)}return o((()=>{h()})),V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element))),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)))})),s((()=>d.profile2d),(e=>{e&&i?setTimeout((()=>{i.resize()}),200):d.getSkyline2d=!1})),t((()=>{f(),i.clear(),c.length=0,u.length=0})),{...a(d),echarts_box:y,myChart:i,Entypositions:r,LatAndLons:c,Cartesians:u,analysis:function(){p&&(tooltip.showAt(" <p>点击鼠标左键开始绘制</p> <p>单击右键结束分析</p><p>选中可进行编辑</p>","250px"),p=!1),window.handlerPolyline||ge("Polyline"),fe("Polyline").then((e=>{i.showLoading(),m=e.positions,function(e){viewer.entities.removeById("polyline-profile"),viewer.entities.removeById("location4");let t=SuperMap3D.Color.fromCssColorString(d.polylineColor);viewer.entities.add({id:"polyline-profile",polyline:{positions:SuperMap3D.Cartesian3.fromDegreesArrayHeights(e),width:d.polylineWidth,material:t,clampToGround:!0}}),function(){if(viewer.entities.getById("location4"))return;viewer.entities.add({id:"location4",position:new SuperMap3D.CallbackProperty((()=>r),!1),billboard:{image:"src/style/images/location4.png",width:30,height:40,scaleByDistance:new SuperMap3D.NearFarScalar(10,1,2e3,.6),eyeOffset:new SuperMap3D.Cartesian3(0,1,-5)}})}()}(e.positions);let t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),w("",e.result.positions),De(m,!1,w),tooltip.setVisible(!1)}),(e=>{console.log(e)})),window.handlerPolyline.activate()},clear:f}}Gl.render=function(e,t,o,n,a,s){const c=g("el-slider"),y=g("el-color-picker"),f=r("stopdrag"),b=r("drag");return d((l(),i("div",Wl,[d(p("div",jl,[p("div",Kl,[p("label",Ql,m(e.Resource.addheight),1),p(c,{modelValue:n.addheight,"onUpdate:modelValue":t[1]||(t[1]=e=>n.addheight=e),min:1,step:.1,max:10,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",Xl,[p("label",Yl,m(e.Resource.verticalFov),1),p(c,{modelValue:n.verticalFov,"onUpdate:modelValue":t[2]||(t[2]=e=>n.verticalFov=e),min:1,max:179,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])]),p("div",Zl,[p("label",ql,m(e.Resource.horizontalFov),1),p(c,{modelValue:n.horizontalFov,"onUpdate:modelValue":t[3]||(t[3]=e=>n.horizontalFov=e),min:1,max:179,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])]),p("div",Jl,[p("label",$l,m(e.Resource.hintLineColor),1),p(y,{modelValue:n.hintLineColor,"onUpdate:modelValue":t[4]||(t[4]=e=>n.hintLineColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])]),d(p("div",ei,[p("label",ti,m(e.Resource.visibleAreaColor),1),p(y,{modelValue:n.visibleAreaColor,"onUpdate:modelValue":t[5]||(t[5]=e=>n.visibleAreaColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])],512),[[h,!n.visibleBody&&!n.invisibleBody]]),d(p("div",oi,[p("label",li,m(e.Resource.hiddenAreaColor),1),p(y,{modelValue:n.hiddenAreaColor,"onUpdate:modelValue":t[6]||(t[6]=e=>n.hiddenAreaColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])],512),[[h,!n.visibleBody&&!n.invisibleBody]]),d(p("div",ii,[p("label",ni,m(e.Resource.visibleBodyColor),1),p(y,{modelValue:n.visibleBodyColor,"onUpdate:modelValue":t[7]||(t[7]=e=>n.visibleBodyColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])],512),[[h,n.visibleBody]]),d(p("div",ai,[p("label",si,m(e.Resource.invisibleBodyColor),1),p(y,{modelValue:n.invisibleBodyColor,"onUpdate:modelValue":t[8]||(t[8]=e=>n.invisibleBodyColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])],512),[[h,n.invisibleBody]]),p("div",ri,[p("label",di,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=e=>n.visibleBody=e)},null,512),[[w,n.visibleBody]]),u(" "+m(e.Resource.displayVisualsBody),1)]),p("label",pi,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=e=>n.invisibleBody=e)},null,512),[[w,n.invisibleBody]]),u(" "+m(e.Resource.displayInvisibleBody),1)]),p("label",ci,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=e=>n.viewshedAnimation=e)},null,512),[[w,n.viewshedAnimation]]),u(" "+m(e.Resource.viewshedAnimation),1)])]),p("div",ui,[p("button",{type:"button",class:"tbtn",onClick:t[12]||(t[12]=(...e)=>n.analysis&&n.analysis(...e))},m(e.Resource.analyze),1),p("button",{type:"button",class:"tbtn tbtn-margin-left",onClick:t[13]||(t[13]=(...e)=>n.clear&&n.clear(...e))},m(e.Resource.clear),1)])],512),[[f]])],512)),[[b]])},Gl.__file="src/components/analysis_3d/viewshed/viewshed.vue",Gl.install=function(e){e.component(Gl.name,Gl)};var yi={name:"Sm3dProfile",props:{profile2d:{type:Boolean,default:!0},polylineColor:{type:String},polylineWidth:{type:Number},initEchartsOption:{type:Object},updateEchartsOption:{type:Object}},setup(e){let{profile2d:t,analysis:o,clear:l,echarts_box:i}=mi(e);return{profile2d:t,analysis:o,clear:l,echarts_box:i}}};const hi={id:"profile",class:"sm-panel"},wi={class:"sm-function-module-sub-section",style:{margin:"0"}},gi={class:"sm-half-L"},fi={style:{width:"80%"}},bi={class:"boxchild flex-between"},vi={ref:"echarts_box",id:"echarts_box"};yi.render=function(e,t,o,n,a,s){const c=r("stopdrag"),u=r("drag");return l(),i(S,null,[d(p("div",hi,[d(p("div",wi,[p("div",gi,[d(p("input",{checked:"",type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=e=>n.profile2d=e)},null,512),[[w,n.profile2d]]),p("label",fi,m(e.Resource.profileInformation),1)]),p("div",bi,[p("button",{type:"button",class:"tbtn",onClick:t[2]||(t[2]=(...e)=>n.analysis&&n.analysis(...e))},m(e.Resource.analyze),1),p("button",{type:"button",class:"tbtn tbtn-margin-left",onClick:t[3]||(t[3]=(...e)=>n.clear&&n.clear(...e))},m(e.Resource.clear),1)])],512),[[c]])],512),[[u]]),d(p("div",vi,null,512),[[h,n.profile2d]])],64)},yi.__file="src/components/analysis_3d/profile/profile.vue",yi.install=function(e){e.component(yi.name,yi)};class Si{constructor(e,t,o,l){this.viewer=e,this.id_type=t,this.pickedEntity=null,this.leftDownFlag=!1,this.moveEndCallBack=o||void 0,this.leftUpCallBack=l||void 0,this.movePickedEntity=null,this.layers=e.scene.layers.layerQueue}addEventListener(){let e=this;for(let t=0;t<e.layers.length;t++)e.layers[t].selectEnabled=!1;e.viewer.screenSpaceEventHandler.setInputAction((function(t){let o=e.viewer.scene.pick(t.position);if(e.leftDownFlag=!0,o){let t=SuperMap3D.defaultValue(o.id,o.primitive.id);t.id&&t.id.includes(e.id_type)&&(e.pickedEntity=t,e.viewer.scene.screenSpaceCameraController.enableRotate=!1)}}),SuperMap3D.ScreenSpaceEventType.LEFT_DOWN),e.viewer.screenSpaceEventHandler.setInputAction((function(t){e.leftDownFlag=!1,e.viewer.scene.screenSpaceCameraController.enableRotate=!0,e.leftUpCallBack&&e.pickedEntity&&e.leftUpCallBack(e.pickedEntity);e.pickedEntity=null}),SuperMap3D.ScreenSpaceEventType.LEFT_UP),e.viewer.screenSpaceEventHandler.setInputAction((function(t){if(e.leftDownFlag){if(e.pickedEntity){let o=e.viewer.scene.pickPosition(t.endPosition);e.pickedEntity.position=o,e.moveEndCallBack&&e.moveEndCallBack(e.pickedEntity)}}else{let o=e.viewer.scene.pick(t.endPosition);if(o){let t=SuperMap3D.defaultValue(o.id,o.primitive.id);t.id&&t.id.includes(e.id_type)?(e.movePickedEntity=t,t.point.pixelSize=20):e.movePickedEntity&&(e.movePickedEntity.point.pixelSize=10)}else e.movePickedEntity&&(e.movePickedEntity.point.pixelSize=10)}}),SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE)}removeEventListener(){this.viewer.screenSpaceEventHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_DOWN),this.viewer.screenSpaceEventHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),this.viewer.screenSpaceEventHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_UP)}}function Ci(o){let l,i,n,r=e({viewPosition:null,visibleColor:"rgb(0, 200, 0)",hiddenColor:"rgb(200, 0, 0)",barrierColor:"rgba(255, 186, 1, 1)",highlightBarrier:!1,lineWidth:3,showBarrierPoints:!0});if(o)for(let e in o)r.hasOwnProperty(e)?null!=o[e]&&(r[e]=o[e]):we.Message.errorMsg(ce.AttributeError+e);let d,p,c=!0,u=!1,m=[],y=0,h=[],w=[],g=[];function f(){l=viewer.scene,i=new SuperMap3D.Sightline(l),i.visibleColor=SuperMap3D.Color.fromCssColorString(r.visibleColor),i.hiddenColor=SuperMap3D.Color.fromCssColorString(r.hiddenColor),i.lineWidth=Number(r.lineWidth),n=new Si(viewer,"sightPoint_",M,D)}function b(e){u=!0,clearTimeout(d),d=setTimeout((()=>{u=!1}),20);let t=l.pickPosition(e.message.position),o=we.CartesiantoDegrees(t);o[2]<0&&(o[2]=0,t=SuperMap3D.Cartesian3.fromDegrees(o[0],o[1],o[2])),r.viewPosition?(i.addTargetPoint({position:o,name:"sightPoint_Target"+y}),h.push(t),requestAnimationFrame((()=>{requestAnimationFrame((()=>{i.getBarrierPoint("sightPoint_Target"+y,(e=>{var t;if(t=y,viewer.entities.add(new SuperMap3D.Entity({id:"sightPoint_Target"+t,point:new SuperMap3D.PointGraphics({color:new SuperMap3D.CallbackProperty((()=>SuperMap3D.Color.fromCssColorString(g[t])),!1),pixelSize:10}),position:new SuperMap3D.CallbackProperty((()=>h[t]),!1)})),e&&e.position){e.position.height+=2;let t=SuperMap3D.Cartographic.toCartesian(e.position);w.push(t);let o=i.getObjectIds();m.push(o),g.push(r.hiddenColor)}else w.push({x:6378137,y:0,z:0}),g.push(r.visibleColor);!function(e){let t=viewer.entities.add({name:"Point_Barrier"+e,position:new SuperMap3D.CallbackProperty((()=>w[e]),!1),cylinder:{length:3,topRadius:2,bottomRadius:0,material:SuperMap3D.Color.fromCssColorString("#d60000")}});v.push(t)}(y),y+=1}))}))}))):(i.viewPosition=o,r.viewPosition=o,i.build(),viewer.entities.add(new SuperMap3D.Entity({id:"sightPoint_view",point:new SuperMap3D.PointGraphics({color:SuperMap3D.Color.fromCssColorString(r.barrierColor),pixelSize:10}),position:new SuperMap3D.CallbackProperty((()=>p),!1)})),p=t)}V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element)),f()),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)),f())}));let v=[];function S(e){if(!r.viewPosition||u)return;let t=l.pickPosition(e.message.endPosition),o=we.CartesiantoDegrees(t);i.addTargetPoint({position:o,name:"point"})}function C(){window.tooltip.setVisible(!1),document.body.classList.remove("measureCur"),r.highlightBarrier&&R(),i.removeTargetPoint("point"),i.build(),n.addEventListener(),viewer.eventManager.removeEventListener("CLICK",b),viewer.eventManager.removeEventListener("MOUSE_MOVE",S),viewer.eventManager.removeEventListener("RIGHT_CLICK",C)}function M(e){if(e.id)if(e.id.includes("sightPoint_Target")){let t=we.CartesiantoDegrees(e.position._value);i.addTargetPoint({position:t,name:e.id})}else if(e.id.includes("sightPoint_view")){let t=we.CartesiantoDegrees(e.position._value);i.viewPosition=t}}function D(e){requestAnimationFrame((()=>{requestAnimationFrame((()=>{if(e.id)if(e.id.includes("sightPoint_view"))for(let e=0,o=w.length;e<o;e++)t("sightPoint_Target"+e,!0);else e.id.includes("sightPoint_Target")&&t(e.id);function t(t,o){i.getBarrierPoint(t,(n=>{let a=t.charAt(t.length-1);if(n&&n.position){n.position.height+=2;let t,s=SuperMap3D.Cartographic.toCartesian(n.position);if(o){let e=i._targetPoints.values[a],o=SuperMap3D.Cartesian3.fromDegrees(e[0],e[1],e[2]);t=SuperMap3D.Cartesian3.distance(o,s)}else t=SuperMap3D.Cartesian3.distance(e.position._value,s);t>=2.5?(w[a]=s,g[a]=r.hiddenColor):(w[a]={x:6378137,y:0,z:0},g[a]=r.visibleColor);let d=i.getObjectIds();if(m.splice(a,1,d),r.highlightBarrier){for(let e of l.layers.layerQueue)e.removeAllObjsColor();R()}}else w[a]={x:6378137,y:0,z:0},g[a]=r.visibleColor}))}}))}))}function R(e){let t=SuperMap3D.defaultValue(e,SuperMap3D.Color.fromCssColorString(r.barrierColor)),o=viewer.scene.layers.layerQueue,l=m[m.length-1],i=l[String(Object.keys(l))];console.log("barrierIds:",i),o.forEach((e=>{"Building@CBD"===e._name&&e.setObjsColor(i,t)}))}function x(){i.removeAllTargetPoint();for(let e of l.layers.layerQueue)e.removeAllObjsColor();y=0,m.length=0,h.length=0,w.length=0,g.length=0,n.removeEventListener(),viewer.entities.removeAll(),document.body.classList.remove("measureCur"),window.tooltip.setVisible(!1),r.viewPosition=null,v.length=0,viewer.eventManager.removeEventListener("CLICK",b),viewer.eventManager.removeEventListener("MOUSE_MOVE",S),viewer.eventManager.removeEventListener("RIGHT_CLICK",C)}return s((()=>r.lineWidth),(e=>{i&&(i.lineWidth=Number(e))})),s((()=>r.visibleColor),(e=>{i&&(i.visibleColor=SuperMap3D.Color.fromCssColorString(e))})),s((()=>r.hiddenColor),(e=>{i&&(i.hiddenColor=SuperMap3D.Color.fromCssColorString(e))})),s((()=>r.barrierColor),(e=>{if(0===m.length)return;R(SuperMap3D.Color.fromCssColorString(e))})),s((()=>r.highlightBarrier),(e=>{if(e)R();else for(let e of l.layers.layerQueue)e.removeAllObjsColor()})),s((()=>r.showBarrierPoints),(e=>{0!==v.length&&v.forEach((t=>{t.show=e}))})),t((()=>{x(),i=void 0})),{...a(r),analysis:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),c&&(window.tooltip.showAt(" <p>点击鼠标左键确认观察者位置</p><p>再点击左键确认目标位置</p> <p>右键单击结束分析</p>","400px"),c=!1),n.removeEventListener(),viewer.eventManager.addEventListener("CLICK",b,!0),viewer.eventManager.addEventListener("MOUSE_MOVE",S),viewer.eventManager.addEventListener("RIGHT_CLICK",C,!0)},clear:x}}var Mi={name:"Sm3dSightline",props:{viewPosition:{type:Array},visibleColor:{type:String,default:"rgb(0, 200, 0)"},hiddenColor:{type:String,default:"rgb(200, 0, 0)"},barrierColor:{type:String,default:"rgba(255, 186, 1, 1)"},highlightBarrier:{type:Boolean,default:!1},lineWidth:{type:Number,default:3},showBarrierPoints:{type:Boolean,default:!0}},setup(e){let{lineWidth:t,visibleColor:o,hiddenColor:l,barrierColor:i,highlightBarrier:n,showBarrierPoints:a,analysis:s,clear:r}=Ci(e);return{lineWidth:t,visibleColor:o,hiddenColor:l,barrierColor:i,highlightBarrier:n,showBarrierPoints:a,analysis:s,clear:r}}};const Di={id:"sight-line",class:"sm-panel"},Ri={class:"sm-function-module-sub-section",style:{margin:"0"}},xi={class:"sm-half-L"},Li={style:{width:"35%"}},Pi={class:"sm-half-L"},Vi={style:{width:"35%"}},ki={class:"sm-half-L"},Ei={style:{width:"35%"}},Ni={class:"sm-half-L"},Ti={style:{width:"35%"}},Ai={class:"sm-half-L"},Bi={style:{width:"auto"}},Ii={style:{width:"auto"}},_i={class:"boxchild "};function Fi(o){let l=e({addHeight:1,viewPosition:null,viewDomeRadius:100,domeType:"ALLDOME",isClosed:!1,visibleAreaColor:"rgba(9,199,112,0.5)",hiddenAreaColor:"rgba(238,114,22,0.5)",startAngle:0,endAngle:360});if(o)for(let e in o)l.hasOwnProperty(e)?l[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let i,n,r,d=!0;function p(){i=viewer.scene,n=new SuperMap3D.ViewDome(i),n.viewPosition=[0,0,0],n.distance=Number(l.viewDomeRadius),n.domeType=SuperMap3D.ViewDomeType[l.domeType],n.visibleAreaColor=SuperMap3D.Color.fromCssColorString(l.visibleAreaColor),n.hiddenAreaColor=SuperMap3D.Color.fromCssColorString(l.hiddenAreaColor),n.startAngle=Number(l.startAngle),n.endAngle=Number(l.endAngle),n.isClosed=l.isClosed,n.build()}function c(e){viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");let t=i.pickPosition(e.message.position),o=we.CartesiantoDegrees(t);o[2]+=Number(l.addHeight),l.viewPosition={longitude:o[0].toFixed(6),latitude:o[1].toFixed(6),height:o[2].toFixed(2)},n.viewPosition=o,n.build(),window.tooltip.setVisible(!1),viewer.eventManager.removeEventListener("CLICK",c),viewer.eventManager.removeEventListener("MOUSE_MOVE",u),n.startAngle=Number(l.startAngle)}function u(e){r=i.pickPosition(e.message.endPosition)}function m(){viewer.entities.removeById("opennessPoint"),document.body.classList.remove("measureCur"),window.tooltip.setVisible(!1),l.viewPosition=null,n.viewPosition=[0,0,0],n.startAngle=Number(l.startAngle)}return V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element)),p()),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)),p())})),s((()=>l.viewDomeRadius),(e=>{""!=e&&(n.distance=Number(e))})),s((()=>l.domeType),(e=>{""!=e&&(n.domeType=SuperMap3D.ViewDomeType[e])})),s((()=>l.isClosed),(e=>{""!=e&&(n.isClosed=e)})),s((()=>l.startAngle),(e=>{""!=e&&(n.startAngle=Number(e))})),s((()=>l.endAngle),(e=>{""!=e&&(n.endAngle=Number(e))})),s((()=>l.visibleAreaColor),(e=>{if(""==e)return;let t=SuperMap3D.Color.fromCssColorString(e);n.visibleAreaColor=t})),s((()=>l.hiddenAreaColor),(e=>{if(""==e)return;let t=SuperMap3D.Color.fromCssColorString(e);n.hiddenAreaColor=t})),s((()=>l.addHeight),((e,t)=>{let o=e-t;o=SuperMap3D.defaultValue(o,0),n.viewPosition[2]+=Number(o),r=SuperMap3D.Cartesian3.fromDegrees(n.viewPosition[0],n.viewPosition[1],n.viewPosition[2]),n.startAngle=Number(l.startAngle)})),t((()=>{m(),n.destroy(),n=void 0})),{...a(l),analysis:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),d&&(window.tooltip.showAt(" <p>点击鼠标左键确认分析位置</p>","250px"),d=!1),viewer.entities.removeById("opennessPoint"),viewer.entities.add(new SuperMap3D.Entity({id:"opennessPoint",point:new SuperMap3D.PointGraphics({color:SuperMap3D.Color.fromCssColorString("rgba(238,114,22,1)"),pixelSize:8}),position:new SuperMap3D.CallbackProperty((()=>r),!1)})),viewer.eventManager.addEventListener("CLICK",c,!0),viewer.eventManager.addEventListener("MOUSE_MOVE",u,!0)},clear:m}}Mi.render=function(e,t,o,n,a,s){const c=g("el-slider"),y=g("el-color-picker"),h=r("stopdrag"),f=r("drag");return d((l(),i("div",Di,[d(p("div",Ri,[p("div",xi,[p("label",Li,m(e.Resource.lineWidth),1),p(c,{modelValue:n.lineWidth,"onUpdate:modelValue":t[1]||(t[1]=e=>n.lineWidth=e),min:1,step:1,max:10,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])]),p("div",Pi,[p("label",Vi,m(e.Resource.visibleColor),1),p(y,{modelValue:n.visibleColor,"onUpdate:modelValue":t[2]||(t[2]=e=>n.visibleColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])]),p("div",ki,[p("label",Ei,m(e.Resource.hiddenColor),1),p(y,{modelValue:n.hiddenColor,"onUpdate:modelValue":t[3]||(t[3]=e=>n.hiddenColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])]),p("div",Ni,[p("label",Ti,m(e.Resource.barrierColor),1),p(y,{modelValue:n.barrierColor,"onUpdate:modelValue":t[4]||(t[4]=e=>n.barrierColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])]),p("div",Ai,[p("label",Bi,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=e=>n.showBarrierPoints=e)},null,512),[[w,n.showBarrierPoints]]),u(" "+m(e.Resource.showBarrierPoints),1)]),p("label",Ii,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=e=>n.highlightBarrier=e)},null,512),[[w,n.highlightBarrier]]),u(" "+m(e.Resource.highlightBarrier),1)])]),p("div",_i,[p("button",{type:"button",class:"tbtn",onClick:t[7]||(t[7]=(...e)=>n.analysis&&n.analysis(...e))},m(e.Resource.analyze),1),p("button",{type:"button",class:"tbtn tbtn-margin-left",onClick:t[8]||(t[8]=(...e)=>n.clear&&n.clear(...e))},m(e.Resource.clear),1)])],512),[[h]])],512)),[[f]])},Mi.__file="src/components/analysis_3d/sight-line/sight-line.vue",Mi.install=function(e){e.component(Mi.name,Mi)};var Oi={name:"Sm3dOpenness",props:{addHeight:{type:Number},viewPosition:{type:Array},viewDomeRadius:{type:Number},domeType:{type:String},isClosed:{type:Boolean},visibleAreaColor:{type:String},hiddenAreaColor:{type:String},startAngle:{type:Number},endAngle:{type:Number}},methods:{formatTooltip:e=>e+"米"},setup(e){let{addHeight:t,viewDomeRadius:o,domeType:l,isClosed:i,visibleAreaColor:n,hiddenAreaColor:a,startAngle:s,endAngle:r,analysis:d,clear:p}=Fi(e);return{addHeight:t,viewDomeRadius:o,domeType:l,isClosed:i,visibleAreaColor:n,hiddenAreaColor:a,startAngle:s,endAngle:r,analysis:d,clear:p}}};const Ui=D("data-v-8f58fc18");C("data-v-8f58fc18");const Hi={id:"openness-panel",class:"sm-panel"},zi={class:"sm-function-module-sub-section",style:{margin:"0"}},Gi={class:"sm-half-L"},Wi={style:{width:"35%"}},ji={class:"sm-half-L"},Ki={style:{width:"35%"}},Qi={class:"sm-half-L"},Xi={style:{width:"35%"}},Yi={class:"sm-half-L"},Zi={style:{width:"35%"}},qi={class:"sm-half-L"},Ji={style:{width:"35%"}},$i={class:"sm-half-L"},en={style:{width:"35%"}},tn={class:"sm-half-L"},on={style:{width:"35%"}},ln={value:"ALLDOME"},nn={value:"VISIBLEDOME"},an={value:"HIDDENDOME"},sn={class:"sm-half-L"},rn={style:{width:"auto"}},dn={class:"boxchild"};M();const pn=Ui(((e,t,o,n,a,s)=>{const c=g("el-slider"),y=g("el-color-picker"),h=r("stopdrag"),v=r("drag");return d((l(),i("div",Hi,[d(p("div",zi,[p("div",Gi,[p("label",Wi,m(e.Resource.addheight),1),p(c,{modelValue:n.addHeight,"onUpdate:modelValue":t[1]||(t[1]=e=>n.addHeight=e),min:0,step:.1,max:10,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",ji,[p("label",Ki,m(e.Resource.startAngle),1),p(c,{modelValue:n.startAngle,"onUpdate:modelValue":t[2]||(t[2]=e=>n.startAngle=e),min:0,max:360,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])]),p("div",Qi,[p("label",Xi,m(e.Resource.endAngle),1),p(c,{modelValue:n.endAngle,"onUpdate:modelValue":t[3]||(t[3]=e=>n.endAngle=e),min:0,max:360,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])]),p("div",Yi,[p("label",Zi,m(e.Resource.observeRadius),1),p(c,{modelValue:n.viewDomeRadius,"onUpdate:modelValue":t[4]||(t[4]=e=>n.viewDomeRadius=e),min:1,step:1,max:1e3,"input-size":"mini",debounce:500,"format-tooltip":s.formatTooltip,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","format-tooltip"]),b(' <input class="sm-input-S" min="1" step="1" type="number" v-model="clipWidth" /> ')]),p("div",qi,[p("label",Ji,m(e.Resource.visibleAreaColor),1),p(y,{modelValue:n.visibleAreaColor,"onUpdate:modelValue":t[5]||(t[5]=e=>n.visibleAreaColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])]),p("div",$i,[p("label",en,m(e.Resource.hiddenAreaColor),1),p(y,{modelValue:n.hiddenAreaColor,"onUpdate:modelValue":t[6]||(t[6]=e=>n.hiddenAreaColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])]),p("div",tn,[p("label",on,m(e.Resource.displayMode),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[7]||(t[7]=e=>n.domeType=e)},[p("option",ln,m(e.Resource.allShow),1),p("option",nn,m(e.Resource.visibleShow),1),p("option",an,m(e.Resource.hiddenShow),1)],512),[[f,n.domeType]])]),p("div",sn,[p("label",rn,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>n.isClosed=e)},null,512),[[w,n.isClosed]]),u(" "+m(e.Resource.isClosed),1)])]),p("div",dn,[p("button",{class:"tbtn",type:"button",onClick:t[9]||(t[9]=(...e)=>n.analysis&&n.analysis(...e))},m(e.Resource.analyze),1),p("button",{onClick:t[10]||(t[10]=(...e)=>n.clear&&n.clear(...e)),class:"tbtn",style:{"margin-left":"4px"},type:"button"},m(e.Resource.clear),1)])],512),[[h]])],512)),[[v]])}));function cn(o){let l=e({layerNames:[],selectedLayerName:null,scale:3,positionMode:"intersects",Xpitch:0,Yroll:0,Zheading:0,geometryType:"box",drawType:"Fill_And_WireFrame",FillColor:"rgba(192,211,25,0.5)",WireFrameColor:"rgba(89,129,228,0.8)",searchColor:"rgba(255, 186, 1, 1)",GeometryBodyNames:[],boxParameters:[100,100,100],sphereParameters:[100],coneParameters:[100,200],cylinderParameters:[100,100,200],ellicpseParameters:[100,50,50],rotateOrigin:null});if(o)for(let e in o)l.hasOwnProperty(e)?l[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let i,n,r,d,p,c=!0,u=[];function m(){if(l.GeometryBodyNames=[],u=[],E.geometrys)for(const e in E.geometrys){u.push(e);let t=E.geometrys[e].name;l.GeometryBodyNames.includes(t)||l.GeometryBodyNames.push(t)}0===l.GeometryBodyNames.length&&(o&&o.geometryType?l.geometryType=o.geometryType:l.geometryType="box")}function y(){i=viewer.scene,n=viewer.scene.layers.layerQueue,r=new SuperMap3D.SpatialQuery3D(i),r.outlineColor=SuperMap3D.Color.fromCssColorString(l.WireFrameColor),r.fillColor=SuperMap3D.Color.fromCssColorString(l.FillColor),r.fillStyle=SuperMap3D.FillStyle[l.drawType],f(l.geometryType),b(l.positionMode),r.build(),setTimeout((()=>{0===l.layerNames.length&&h()}),1e3),p=new SuperMap3D.S3MInstanceCollection(i._context),viewer.scene.primitives.add(p)}function h(){let e=g(l.selectedLayerName);r&&r.layers&&(r.layers=e?[e]:[]),l.layerNames.length=0,n&&n.length>0&&(n.forEach(((e,t)=>{l.layerNames.includes(e._name)||l.layerNames.push(e._name)})),l.selectedLayerName||(l.selectedLayerName=l.layerNames[0]))}function w(e){document.body.classList.remove("measureCur");let t=i.pickPosition(e.message.position);v(we.CartesiantoDegrees(t)),tooltip.setVisible(!1),viewer.eventManager.removeEventListener("CLICK",w)}function g(e){return n.find((function(t,o){return t._name===e}))}function f(e){switch(e){case"box":{let e=l.boxParameters;d=new SuperMap3D.GeoBox(e[0],e[1],e[2])}break;case"sphere":{let e=l.sphereParameters;d=new SuperMap3D.GeoSphere(e[0])}break;case"cone":{let e=l.coneParameters;d=new SuperMap3D.GeoCone(e[0],e[1]),l.rotateOrigin&&(d.rotateOrigin="APEX"==l.rotateOrigin?SuperMap3D.RotationOrigin.APEX:SuperMap3D.RotationOrigin.CENTER)}break;case"cylinder":{let e=l.cylinderParameters;d=new SuperMap3D.GeoCylinder(e[0],e[1],e[2])}break;case"ellicpse":{let e=l.ellicpseParameters;d=new SuperMap3D.GeoEllipsoid(e[0],e[1],e[2])}break;default:d=new SuperMap3D.GeoModel3D,d.geoModel=E.geometrys.SkyLineBody,r.clear()}r.geometry=d}function b(e){let t;switch(e){case"intersects":t=SuperMap3D.PositionMode.Intersects;break;case"disjoint":t=SuperMap3D.PositionMode.Disjoint;break;case"contains":t=SuperMap3D.PositionMode.Contains;break;default:t=SuperMap3D.PositionMode.Intersects}r.positionMode=t}function v(e){r&&r.geometry&&(r.geometry.geoPosition=new SuperMap3D.Point3D(e[0],e[1],e[2]))}function S(){let e=g(l.selectedLayerName);e&&(e.selectedColor=new SuperMap3D.Color(.7,.7,1,1),e.setSelection([]),e.selectColorType=SuperMap3D.SelectColorType.MIX),r.clear(),tooltip.setVisible(!1),document.body.classList.remove("measureCur"),r.geometry.geoPosition=new SuperMap3D.Point3D(0,0,0),viewer.eventManager.removeEventListener("CLICK",w)}return V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element)),y()),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)),y())})),s((()=>V.changeLayers),(e=>{h()})),V.changeGeometrys&&m(),s((()=>V.changeGeometrys),(e=>{m()})),s((()=>l.Xpitch),(e=>{""!=e&&(d.geoRotationX=parseFloat(e))})),s((()=>l.Yroll),(e=>{""!=e&&(d.geoRotationY=parseFloat(e))})),s((()=>l.Zheading),(e=>{""!=e&&(d.geoRotationZ=parseFloat(e))})),s((()=>l.scale),(e=>{""!=e&&(d.geoScaleX=parseFloat(e),d.geoScaleY=parseFloat(e),d.geoScaleZ=parseFloat(e))})),s((()=>l.positionMode),(e=>{""!=e&&b(e)})),s((()=>l.geometryType),(e=>{""!==e&&f(e)})),s((()=>l.drawType),(e=>{""!=e&&(r.fillStyle=SuperMap3D.FillStyle[e])})),s((()=>l.FillColor),(e=>{""!=e&&(r.fillColor=SuperMap3D.Color.fromCssColorString(e))})),s((()=>l.WireFrameColor),(e=>{""!=e&&(r.outlineColor=SuperMap3D.Color.fromCssColorString(e))})),s((()=>l.searchColor),(e=>{""!=e&&(g(l.selectedLayerName).selectedColor=SuperMap3D.Color.fromCssColorString(e))})),s((()=>l.selectedLayerName),((e,t)=>{let o=g(t);o&&(o.selectedColor=new SuperMap3D.Color(.7,.7,1,1),o.setSelection([]),o.selectColorType=SuperMap3D.SelectColorType.MIX),S()})),t((()=>{r.destroy(),r=void 0,n=void 0,d=void 0})),{...a(l),setPosition:v,getQueryIDs:function(){return r.getQueryIDs()},analysis:function(){try{let t=g(l.selectedLayerName);if(!t)return void we.Message.warnMsg("请选择需要查询的图层！");if(r.layers=[t],tooltip.setVisible(!1),t.selectedColor=SuperMap3D.Color.fromCssColorString(l.searchColor),t.selectColorType=SuperMap3D.SelectColorType.REPLACE,t.selectEnabled=!1,r.geometry){var e=r.getQueryIDs();console.log(e)}if("number"==typeof l.geometryType)return f(l.geometryType),void r.build();r.build(),viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),c&&(window.tooltip.showAt(" <p>点击鼠标左键确认查询位置</p>","300px"),c=!1),viewer.eventManager.addEventListener("CLICK",w,!0)}catch(e){console.error(e)}},clear:S}}Oi.render=pn,Oi.__scopeId="data-v-8f58fc18",Oi.__file="src/components/analysis_3d/openness/openness.vue",Oi.install=function(e){e.component(Oi.name,Oi)};var un={name:"Sm3dSpatialQuery3d",props:{selectedLayerName:{type:String},Xpitch:{type:Number},Yroll:{type:Number},Zheading:{type:Number},scale:{type:Number},positionMode:{type:String},geometryType:{type:String},drawType:{type:String},FillColor:{type:String},WireFrameColor:{type:String},searchColor:{type:String},boxParameters:{type:Array},sphereParameters:{type:Array},coneParameters:{type:Array},cylinderParameters:{type:Array},ellicpseParameters:{type:Array},rotateOrigin:{type:String}},setup(e){let{scale:t,selectedLayerName:o,layerNames:l,positionMode:i,GeometryBodyNames:n,geometryType:a,analysis:s,clear:r}=cn(e);return{scale:t,selectedLayerName:o,layerNames:l,positionMode:i,GeometryBodyNames:n,geometryType:a,analysis:s,clear:r}}};const mn={id:"openness-panel",class:"sm-panel"},yn={class:"sm-function-module-sub-section",style:{margin:"0"}},hn={class:"sm-half-L"},wn={style:{width:"40%"}},gn={class:"sm-half-L"},fn={style:{width:"40%"}},bn={class:"sm-half-L"},vn={style:{width:"40%"}},Sn={value:"intersects"},Cn={value:"disjoint"},Mn={value:"contains"},Dn={class:"sm-half-L"},Rn={style:{width:"40%"}},xn={value:"box"},Ln={class:"boxchild"};function Pn(l){let i,n,r,d=e({multiViewport:"NONE",selectedViewport:"0",TreeDatas:[]});if(l)for(let e in l)d.hasOwnProperty(e)?d[e]=l[e]:we.Message.errorMsg(ce.AttributeError+e);let p=v(null),c={KeysViewport1:[],KeysViewport2:[],KeysViewport3:[],KeysViewport4:[]};function u(){i=viewer.scene.layers.layerQueue,n=viewer.imageryLayers._layers,r=viewer.scene._vectorTileMaps._layerQueue,viewer.terrainProvider,d.TreeDatas.length=0,function(){if(0==i.length)return;let e={id:"s3m",label:"S3M图层",children:[]};i.forEach(((t,o)=>{let l={id:"s3m-"+o,label:t._name};e.children.push(l)})),d.TreeDatas[0]=e}(),function(){if(1==n.length)return;let e={id:"img",label:"IMG图层",children:[]};n.forEach(((t,o)=>{let l=t._imageryProvider instanceof SuperMap3D.MvtProviderGL;if(0===o||l)return!0;let i={id:"img-"+o,label:ce.BaseMapImg};t._imageryProvider.tablename&&(i.label=t._imageryProvider.tablename),e.children.unshift(i)})),e.children.length>0&&(d.TreeDatas[1]=e)}(),function(){if(console.log(r),0==r.length)return;let e={id:"mvt",label:"MVT图层",children:[]};r.forEach(((t,o)=>{let l={id:"mvt-"+o,label:t.name};e.children.unshift(l)})),d.TreeDatas[2]=e}(),setTimeout((()=>{p.value.setCheckedNodes(d.TreeDatas);let e=p.value.getCheckedKeys(!0);c.KeysViewport1=[...e],c.KeysViewport2=[...e],c.KeysViewport3=[...e],c.KeysViewport4=[...e]}),500)}return o((()=>{setTimeout((()=>{u()}),500)})),s((()=>V.changeLayers),(e=>{u()})),s((()=>d.multiViewport),(e=>{viewer.scene.multiViewportMode=SuperMap3D.MultiViewportMode[e]})),s((()=>d.selectedViewport),((e,t)=>{let o=p.value.getCheckedKeys(!0);c["KeysViewport"+t]=o,p.value.setCheckedKeys(c["KeysViewport"+e],!0)})),t((()=>{i=null,n=null,r=null,c=null})),{...a(d),tree:p,checkNode:function(e){let t=p.value.getNode(e);!function(e,t){let o=e[0],l=e[1];switch(o){case"s3m":if(!l){for(let e=0;e<i.length;e++)i[e].setVisibleInViewport(Number(d.selectedViewport),t);return}i[l].setVisibleInViewport(Number(d.selectedViewport),t);break;case"img":if(!l){for(let e=0;e<n.length;e++)n[e].setVisibleInViewport(Number(d.selectedViewport),t);return}n[l].setVisibleInViewport(Number(d.selectedViewport),t);break;case"mvt":if(!l){for(let e=0;e<r.length;e++)r[e].setVisibleInViewport(Number(d.selectedViewport),t);return}r[l].setVisibleInViewport(Number(d.selectedViewport),t)}}(e.id.split("-"),t.checked)}}}un.render=function(e,t,o,n,a,s){const c=g("el-slider"),u=r("stopdrag"),y=r("drag");return d((l(),i("div",mn,[d(p("div",yn,[p("div",hn,[p("label",wn,m(e.Resource.scale),1),p(c,{modelValue:n.scale,"onUpdate:modelValue":t[1]||(t[1]=e=>n.scale=e),min:.2,max:10,step:.2,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue","min","step"]),b(' <input class="sm-input-S" min="1" step="1" type="number" v-model="clipWidth" /> ')]),p("div",gn,[p("label",fn,m(e.Resource.searchLayers),1),d(p("select",{class:"sm-select",style:{width:"58%"},"onUpdate:modelValue":t[2]||(t[2]=e=>n.selectedLayerName=e)},[(l(!0),i(S,null,R(n.layerNames,((e,t)=>(l(),i("option",{key:t,value:e},m(e),9,["value"])))),128))],512),[[f,n.selectedLayerName]])]),p("div",bn,[p("label",vn,m(e.Resource.positionMode),1),d(p("select",{class:"sm-select",style:{width:"58%"},"onUpdate:modelValue":t[3]||(t[3]=e=>n.positionMode=e)},[p("option",Sn,m(e.Resource.intersects),1),p("option",Cn,m(e.Resource.disjoint),1),p("option",Mn,m(e.Resource.contains),1)],512),[[f,n.positionMode]])]),d(p("div",Dn,[p("label",Rn,m(e.Resource.geometryType),1),d(p("select",{class:"sm-select",style:{width:"58%"},"onUpdate:modelValue":t[4]||(t[4]=e=>n.geometryType=e)},[p("option",xn,m(e.Resource.box),1),(l(!0),i(S,null,R(n.GeometryBodyNames,((e,t)=>(l(),i("option",{key:t,value:t},m(e),9,["value"])))),128))],512),[[f,n.geometryType]])],512),[[h,n.GeometryBodyNames.length>0]]),p("div",Ln,[p("button",{class:"tbtn",type:"button",onClick:t[5]||(t[5]=(...e)=>n.analysis&&n.analysis(...e))},m(e.Resource.search),1),p("button",{onClick:t[6]||(t[6]=(...e)=>n.clear&&n.clear(...e)),class:"tbtn",style:{"margin-left":"4px"},type:"button"},m(e.Resource.clear),1)])],512),[[u]])],512)),[[y]])},un.__file="src/components/space-search/spatial-query3d/spatial-query3d.vue",un.install=function(e){e.component(un.name,un)};var Vn={name:"Sm3dSplitScreen",setup(e){let{multiViewport:t,selectedViewport:o,TreeDatas:l,tree:i,checkNode:n}=Pn(e);return{multiViewport:t,selectedViewport:o,TreeDatas:l,tree:i,checkNode:n}}};const kn={id:"split-screen-panel",class:"sm-panel"},En={class:"sm-function-module-sub-section",style:{margin:"0"}},Nn={class:"sm-half-L"},Tn={style:{width:"40%"}},An={value:"NONE"},Bn={value:"HORIZONTAL"},In={value:"VERTICAL"},_n={value:"TRIPLE"},Fn={value:"QUAD"},On={class:"sm-half-L flex-start"},Un={style:{width:"40%"}},Hn={style:{width:"auto"}},zn={class:"sm-half-L flex-start"},Gn={style:{width:"40%"}},Wn={style:{width:"auto"}},jn={class:"sm-half-L"};function Kn(l){let i,n,r,d=e({useRoller:!1,rollerMode:"lrRoller",lrRoller:"1",tbRoller:"4",TreeDatas:[]});if(l)for(let e in l)d.hasOwnProperty(e)?d[e]=l[e]:we.Message.errorMsg(ce.AttributeError+e);let p=document.getElementById("SuperMap3DContainer"),c=document.body.clientWidth-p.clientWidth,u=document.body.clientHeight-p.clientHeight,m=p.clientWidth,y=p.clientHeight,h=v(null),w=v(null),g=v(null),f=v(null),b=v(null),S=new SuperMap3D.BoundingRectangle,C={startX:.33,startY:.33,endX:.66,endY:.66,index:1,mode:1};function M(){i=viewer.scene.layers.layerQueue,n=viewer.imageryLayers._layers,r=viewer.scene._vectorTileMaps._layerQueue,viewer.terrainProvider,d.TreeDatas.length=0,function(){if(0==i.length)return;let e={id:"s3m",label:"S3M图层",children:[]};i.forEach(((t,o)=>{let l={id:"s3m-"+o,label:t._name};e.children.push(l)})),d.TreeDatas[0]=e}(),function(){if(1==n.length)return;let e={id:"img",label:"IMG图层",children:[]};n.forEach(((t,o)=>{if(0===o)return!0;if(t._imageryProvider instanceof SuperMap3D.MvtProviderGL)return!0;let l={id:"img-"+o,label:ce.BaseMapImg};t._imageryProvider.tablename&&(l.label=t._imageryProvider.tablename),e.children.unshift(l)})),e.children.length>0&&(d.TreeDatas[1]=e)}(),function(){if(0==r.length)return;let e={id:"mvt",label:"MVT图层",children:[]};r.forEach(((t,o)=>{let l={id:"mvt-"+o,label:t.name};e.children.unshift(l)})),d.TreeDatas[2]=e}(),function(){let e={id:"globe",label:"地球",children:[]},t={id:"globe-0",label:"地表"};e.children.push(t),d.TreeDatas[4]=e}(),setTimeout((()=>{h.value.setCheckedNodes(d.TreeDatas)}),500)}function D(){let e=C.startX,t=C.startY,o=C.endX,l=C.endY;switch(C.mode){case 1:SuperMap3D.BoundingRectangle.unpack([e,0,1,1],0,S);break;case 2:SuperMap3D.BoundingRectangle.unpack([0,0,e,1],0,S);break;case 4:SuperMap3D.BoundingRectangle.unpack([0,t,1,1],0,S);break;case 8:SuperMap3D.BoundingRectangle.unpack([0,0,1,t],0,S);break;case 15:SuperMap3D.BoundingRectangle.unpack([e,t,o-e,l-t],0,S);break;default:SuperMap3D.BoundingRectangle.unpack([0,0,1,1],0,S)}h.value.getCheckedKeys(!0).forEach((e=>{R(e.split("-"),!0)}))}function R(e,t){let o=e[0],l=e[1];switch(o){case"s3m":if(!l){for(let e=0;e<i.length;e++)i[e].swipeEnabled=t,i[e].swipeRegion=S;return}i[l].swipeEnabled=t,i[l].swipeRegion=S;break;case"img":if(!l){for(let e=1;e<n.length;e++)n[e].swipeEnabled=t,n[e].swipeRegion=S;return}n[l].swipeEnabled=t,n[l].swipeRegion=S;break;case"mvt":if(!l){for(let e=0;e<r.length;e++)r[e].swipeEnabled=t,r[e].swipeRegion=S;return}r[l].swipeEnabled=t,r[l].swipeRegion=S;break;case"globe":viewer.scene.globe.swipeEnabled=t,viewer.scene.globe.swipeRegion=S}}function x(e){w.value.style.display="none",g.value.style.display="none",f.value.style.display="none",b.value.style.display="none",1&e&&(w.value.style.display="block"),2&e&&(g.value.style.display="block"),4&e&&(f.value.style.display="block"),8&e&&(b.value.style.display="block")}return s((()=>V.changeLayers),(e=>{M()})),o((()=>{!function(){function e(e){document.removeEventListener("mousemove",o,!1)}function t(e,t){C.index=t,document.addEventListener("mousemove",o,!1)}function o(e){switch(e.preventDefault?e.preventDefault():e.returnValue=!1,C.index){case 1:w.value.style.left=e.clientX-c+"px",C.startX=(e.clientX-c)/m;break;case 2:f.value.style.top=e.clientY-u+"px",C.startY=(e.clientY-u)/y;break;case 3:g.value.style.left=e.clientX-c+"px",C.endX=(e.clientX-c)/m;break;case 4:b.value.style.top=e.clientY-u+"px",C.endY=(e.clientY-u)/y}D()}w.value.addEventListener("mousedown",(function(e){t(e,1)}),!1),g.value.onmousedown=function(e){t(e,3)},f.value.onmousedown=function(e){t(e,2)},b.value.onmousedown=function(e){t(e,4)},window.addEventListener("resize",(function(){m=document.body.clientWidth-c,y=document.body.clientHeight-u})),document.addEventListener("mouseup",e,!1)}(),setTimeout((()=>{M()}),500)})),s((()=>d.multiViewport),(e=>{viewer.scene.multiViewportMode=SuperMap3D.MultiViewportMode[e]})),s((()=>d.selectedViewport),((e,t)=>{let o=h.value.getCheckedKeys(!0);d["KeysViewport"+t]=o,h.value.setCheckedKeys(d["KeysViewport"+e],!0)})),s((()=>d.useRoller),(e=>{e?(1!=C.mode&&2!=C.mode||x(1),4!=C.mode&&8!=C.mode||x(4),15==C.mode&&x(15),D()):(x(0),R(["s3m"],!1),R(["img"],!1),R(["mvt"],!1),R(["globe"],!1))})),s((()=>d.rollerMode),(e=>{switch(e){case"lrRoller":d.useRoller&&x(1),C.mode=Number(d.lrRoller);break;case"tbRoller":d.useRoller&&x(4),C.mode=Number(d.tbRoller);break;case"customRoller":d.useRoller&&x(15),C.mode=15}d.useRoller&&D()})),s((()=>d.lrRoller),(e=>{d.useRoller&&(C.mode=Number(e),D())})),s((()=>d.tbRoller),(e=>{d.useRoller&&(C.mode=Number(e),D())})),t((()=>{i=void 0,n=void 0,r=void 0})),{...a(d),tree:h,checkNode:function(e){let t=h.value.getNode(e);R(e.id.split("-"),t.checked)},verticalSliderLeft:w,verticalSliderRight:g,horizontalSliderTop:f,horizontalSliderBottom:b}}Vn.render=function(e,t,o,n,a,s){const y=g("el-tree"),w=r("stopdrag"),b=r("drag");return d((l(),i("div",kn,[d(p("div",En,[p("div",Nn,[p("label",Tn,m(e.Resource.multiViewport),1),d(p("select",{class:"sm-select-m",style:{width:"60%"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.multiViewport=e)},[p("option",An,m(e.Resource.onePort),1),p("option",Bn,m(e.Resource.horizontalSnap),1),p("option",In,m(e.Resource.verticalSnap),1),p("option",_n,m(e.Resource.tripeSnap),1),p("option",Fn,m(e.Resource.quadSnap),1)],512),[[f,n.multiViewport]])]),d(p("div",On,[p("label",Un,[d(p("input",{type:"radio",value:"0","onUpdate:modelValue":t[2]||(t[2]=e=>n.selectedViewport=e)},null,512),[[c,n.selectedViewport]]),u(" "+m(e.Resource.viewportOne),1)]),p("label",Hn,[d(p("input",{type:"radio",value:"1","onUpdate:modelValue":t[3]||(t[3]=e=>n.selectedViewport=e)},null,512),[[c,n.selectedViewport]]),u(" "+m(e.Resource.viewportTwo),1)])],512),[[h,"NONE"!=n.multiViewport]]),d(p("div",zn,[p("label",Gn,[d(p("input",{type:"radio",value:"2","onUpdate:modelValue":t[4]||(t[4]=e=>n.selectedViewport=e)},null,512),[[c,n.selectedViewport]]),u(" "+m(e.Resource.viewportThree),1)]),d(p("label",Wn,[d(p("input",{type:"radio",value:"3","onUpdate:modelValue":t[5]||(t[5]=e=>n.selectedViewport=e)},null,512),[[c,n.selectedViewport]]),u(" "+m(e.Resource.viewportFour),1)],512),[[h,"QUAD"==n.multiViewport]])],512),[[h,"TRIPLE"==n.multiViewport||"QUAD"==n.multiViewport]]),d(p("div",jn,[p(y,{data:n.TreeDatas,"show-checkbox":"","node-key":"id",accordion:"",ref:"tree",onCheck:n.checkNode},null,8,["data","onCheck"])],512),[[h,"NONE"!=n.multiViewport]])],512),[[w]])],512)),[[b]])},Vn.__file="src/components/scene/split-screen/split-screen.vue",Vn.install=function(e){e.component(Vn.name,Vn)};var Qn={name:"Sm3dRoller",props:{rollerMode:{type:String}},setup(e){let{useRoller:t,rollerMode:o,lrRoller:l,tbRoller:i,TreeDatas:n,tree:a,checkNode:s,verticalSliderLeft:r,verticalSliderRight:d,horizontalSliderTop:p,horizontalSliderBottom:c}=Kn(e);return{useRoller:t,rollerMode:o,lrRoller:l,tbRoller:i,TreeDatas:n,tree:a,checkNode:s,verticalSliderLeft:r,verticalSliderRight:d,horizontalSliderTop:p,horizontalSliderBottom:c}}};const Xn={id:"split-screen-panel",class:"sm-panel"},Yn={class:"sm-function-module-sub-section",style:{margin:"0"}},Zn={class:"sm-half-L"},qn={style:{width:"40%"}},Jn={value:"lrRoller"},$n={value:"tbRoller"},ea={value:"customRoller"},ta={class:"sm-half-L"},oa={style:{width:"auto"}},la={class:"sm-half-L"},ia={style:{width:"auto"}},na={style:{width:"auto"}},aa={class:"sm-half-L"},sa={style:{width:"auto"}},ra={style:{width:"auto"}},da={class:"sm-half-L"},pa={id:"verticalSliderLeft",ref:"verticalSliderLeft"},ca={id:"verticalSliderRight",ref:"verticalSliderRight"},ua={id:"horizontalSliderTop",ref:"horizontalSliderTop"},ma={id:"horizontalSliderBottom",ref:"horizontalSliderBottom"};Qn.render=function(e,t,o,n,a,s){const y=g("el-tree"),b=r("stopdrag"),v=r("drag");return l(),i(S,null,[d(p("div",Xn,[d(p("div",Yn,[p("div",Zn,[p("label",qn,m(e.Resource.rollerMode),1),d(p("select",{class:"sm-select-m",style:{width:"60%"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.rollerMode=e)},[p("option",Jn,m(e.Resource.lrRoller),1),p("option",$n,m(e.Resource.tbRoller),1),p("option",ea,m(e.Resource.customRoller),1)],512),[[f,n.rollerMode]])]),p("div",ta,[p("label",oa,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>n.useRoller=e)},null,512),[[w,n.useRoller]]),u(" "+m(e.Resource.useRoller),1)])]),d(p("div",la,[p("label",ia,[d(p("input",{type:"radio",value:"1","onUpdate:modelValue":t[3]||(t[3]=e=>n.lrRoller=e)},null,512),[[c,n.lrRoller]]),u(" "+m(e.Resource.shieldLeft),1)]),p("label",na,[d(p("input",{type:"radio",value:"2","onUpdate:modelValue":t[4]||(t[4]=e=>n.lrRoller=e)},null,512),[[c,n.lrRoller]]),u(" "+m(e.Resource.shieldRight),1)])],512),[[h,"lrRoller"==n.rollerMode&&n.useRoller]]),d(p("div",aa,[p("label",sa,[d(p("input",{type:"radio",value:"4","onUpdate:modelValue":t[5]||(t[5]=e=>n.tbRoller=e)},null,512),[[c,n.tbRoller]]),u(" "+m(e.Resource.shieldTop),1)]),p("label",ra,[d(p("input",{type:"radio",value:"8","onUpdate:modelValue":t[6]||(t[6]=e=>n.tbRoller=e)},null,512),[[c,n.tbRoller]]),u(" "+m(e.Resource.shieldBottom),1)])],512),[[h,"tbRoller"==n.rollerMode&&n.useRoller]]),d(p("div",da,[p(y,{data:n.TreeDatas,"show-checkbox":"","node-key":"id",accordion:"",ref:"tree",onCheck:n.checkNode},null,8,["data","onCheck"])],512),[[h,n.useRoller]])],512),[[b]])],512),[[v]]),p("div",pa,null,512),p("div",ca,null,512),p("div",ua,null,512),p("div",ma,null,512)],64)},Qn.__file="src/components/scene/roller/roller.vue",Qn.install=function(e){e.component(Qn.name,Qn)};var ya={name:"Sm3dCustomService",props:{addCallback:{type:Function},clearCallback:{type:Function},getLayerName:{type:Function}},setup(t){let o=e({layersType:"SCENE",layerURL:null,layerName:null,isAddToken:!1,token:null,isSct:!1}),l=()=>{},i=()=>{},n=()=>{};function s(){return o.layerURL&&""!==o.layerURL?"SCENE"==o.layersType||o.layerName&&""!==o.layerName?!(o.isAddToken&&!o.token)||(we.Message.warnMsg("勾选token后请填写token"),!1):(we.Message.warnMsg("请补充图层名称"),!1):(we.Message.warnMsg("请填写正确的URL"),!1)}function r(){o.layerURL=null,o.layerName=null,o.isAddToken=!1,o.token=null,o.isSct=!1}return t&&t.clearCallback&&(i=t.clearCallback),t&&t.addCallback&&(l=t.addCallback),t&&t.getLayerName&&(n=t.getLayerName),{...a(o),addLayer:function(){if(function(){let e=o.layerURL.split("/"),t=e[e.length-1];return!("realspace"===t&&"SCENE"!=o.layersType||"config"===t&&"S3M"!=o.layersType||"image"===t&&"IMG"!=o.layersType)}()){switch(n(o.layerName),o.layersType){case"SCENE":if(s()){let e={};o.isAddToken&&(e.SceneToken=token),J.addScene(o.layerURL,e,l)}break;case"S3M":if(s()){let e=[{url:o.layerURL,options:{name:o.layerName}}];J.addS3mLayers(e,l)}break;case"IMG":if(s()){let e=J.addImageLayer(o.layerURL);l(e,"IMG")}break;case"TERRAIN":s()&&(J.addTerrainLayer(o.layerURL,o.isSct),l(viewer.terrainProvider,"TERRAIN"));break;case"MVT":if(s()){let e=J.addMvtLayer(o.layerURL,o.layerName);l(e,"MVT")}}r()}else we.Message.warnMsg("请检查添加类型是否正常？")},clear:function(){r(),i()}}}};const ha={id:"CustomService-panel",class:"sm-panel"},wa={class:"sm-function-module-sub-section",style:{margin:"0"}},ga={class:"sm-half-L"},fa=p("label",{style:{width:"40%"}},"打开图层",-1),ba=x('<option value="SCENE">场景</option><option value="S3M">S3M</option><option value="IMG">影像</option><option value="TERRAIN">地形</option><option value="MVT">矢量瓦片</option>',5),va={class:"sm-half-L flex-start"},Sa=p("label",{class:"label-S"},"添加token",-1),Ca={class:"sm-half-L flex-start"},Ma=p("label",{class:"label-S"},"isSct",-1),Da={class:"boxchild"};function Ra(l){let i,n,r,d,p,c,u=e({TreeDatas:[],expandedKeys:[]}),m=v(null),y=v(null),h=()=>{},w=document.getElementById("SuperMap3DContainer"),g=document.body.clientWidth-w.clientWidth,f=document.body.clientHeight-w.clientHeight;function b(){i=viewer.scene.layers.layerQueue,n=viewer.imageryLayers._layers,d=viewer.scene._vectorTileMaps._layerQueue,r=viewer.terrainProvider,u.TreeDatas.length=0,S(),C(),M(),function(){if(!r.tablename)return;let e={id:"terrain",label:"地形图层",children:[]},t={id:"terrain-0",label:r.tablename};e.children.push(t),u.TreeDatas[3]=e}(),setTimeout((()=>{m.value.setCheckedNodes(u.TreeDatas)}),500),console.log(d)}function S(){if(0==i.length)return void(u.TreeDatas[0]&&m.value.remove(u.TreeDatas[0]));let e={id:"s3m",label:"S3M图层",children:[]};i.forEach(((t,o)=>{let l={id:"s3m-"+o,label:t._name};e.children.push(l)})),u.TreeDatas[0]=e}function C(){if(1==n.length)return void(u.TreeDatas[1]&&m.value.remove(u.TreeDatas[1]));let e={id:"img",label:"IMG图层",children:[]};n.forEach(((t,o)=>{let l=t._imageryProvider instanceof SuperMap3D.MvtProviderGL;if(0===o||l)return!0;let i={id:"img-"+o,label:ce.BaseMapImg};t._imageryProvider.tablename&&(i.label=t._imageryProvider.tablename),e.children.unshift(i)})),e.children.length>0&&(u.TreeDatas[1]=e)}function M(){if(0==d.length)return void(u.TreeDatas[2]&&m.value.remove(u.TreeDatas[2]));let e={id:"mvt",label:"MVT图层",children:[]};d.forEach(((t,o)=>{let l={id:"mvt-"+o,label:t.name};e.children.unshift(l)})),u.TreeDatas[2]=e}return l&&l.deleteCallback&&(h=l.deleteCallback),s((()=>V.changeLayers),(e=>{b()})),o((()=>{setTimeout((()=>{b()}),500)})),document.onclick=function(e){e.stopPropagation(),y.value.style.display="none"},t((()=>{document.onclick=()=>{}})),{...a(u),tree:m,domContextmenu:y,checkNode:function(e){let t=m.value.getNode(e);!function(e,t){let o=e[0],l=e[1];switch(o){case"s3m":if(!l){for(let e=0;e<i.length;e++)i[e].visible=t;return}i[l].visible=t;break;case"img":if(!l){for(let e=1;e<n.length;e++)n[e].show=t;return}n[l].show=t;break;case"mvt":if(!l){for(let e=0;e<d.length;e++)d[e].show=t;return}d[l].show=t;break;case"terrain":t?viewer.terrainProvider=p:(p=viewer.terrainProvider,viewer.terrainProvider=new SuperMap3D.EllipsoidTerrainProvider)}}(e.id.split("-"),t.checked)},nodeContextmenu:function(e,t){t.id.split("-")[1]&&(c=t,y.value.style.left=e.clientX+30-g+"px",e.clientX>=1810&&(y.value.style.left=e.clientX-80-g+"px"),y.value.style.top=e.clientY-f+"px",y.value.style.display="block")},nodeClick:function(e){!function(e){let t,o=e[0],l=e[1];switch(o){case"s3m":l&&(t=i[l]);break;case"img":l&&(t=n[l]);break;case"mvt":l&&(t=d[l])}t&&viewer.flyTo(t)}(e.id.split("-"))},deleteLayer:function(){y.value.style.display="none";let e=c.id.split("-"),t=e[0],o=e[1];switch(t){case"s3m":o&&(viewer.scene.layers.remove(i[o]._name),S(),setTimeout((()=>{u.expandedKeys=["s3m"],m.value.setCheckedNodes(u.TreeDatas)}),50));break;case"img":o&&(viewer.imageryLayers.remove(n[o]),C(),setTimeout((()=>{m.value.setCheckedNodes(u.TreeDatas)}),50));break;case"mvt":o&&(viewer.scene.removeVectorTilesMap(d[o].name),M(),setTimeout((()=>{m.value.setCheckedNodes(u.TreeDatas)}),100));break;case"terrain":viewer.terrainProvider=new SuperMap3D.EllipsoidTerrainProvider,p=null;let e=m.value.getNode(t);m.value.remove(e)}k.setChangeLayers(),h(c)}}}ya.render=function(e,t,o,n,a,s){const c=r("stopdrag"),u=r("drag");return d((l(),i("div",ha,[d(p("div",wa,[p("div",ga,[fa,d(p("select",{class:"sm-select",style:{width:"58%"},"onUpdate:modelValue":t[1]||(t[1]=t=>e.layersType=t)},[ba],512),[[f,e.layersType]])]),p("div",va,[d(p("input",{type:"text",class:"sm-input sm-margin-M",style:{width:"100%"},placeholder:"URL","onUpdate:modelValue":t[2]||(t[2]=t=>e.layerURL=t)},null,512),[[y,e.layerURL]]),d(p("input",{type:"text",class:"sm-input sm-margin-M",style:{width:"100%"},placeholder:"自定义名称","onUpdate:modelValue":t[3]||(t[3]=t=>e.layerName=t)},null,512),[[y,e.layerName]]),b(" v-show=\"layersType === 'S3M'\" "),Sa,d(p("input",{checked:"",type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=t=>e.isAddToken=t)},null,512),[[w,e.isAddToken]]),d(p("input",{type:"text",class:"sm-input sm-margin-M",style:{width:"100%"},placeholder:"token","onUpdate:modelValue":t[5]||(t[5]=t=>e.token=t)},null,512),[[y,e.token],[h,e.isAddToken]])]),d(p("div",Ca,[Ma,d(p("input",{checked:"",type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=t=>e.isSct=t)},null,512),[[w,e.isSct]])],512),[[h,"TERRAIN"===e.layersType]]),p("div",Da,[p("button",{class:"tbtn tbtn-margin-left",type:"button",onClick:t[7]||(t[7]=(...e)=>n.addLayer&&n.addLayer(...e))},"添加"),p("button",{onClick:t[8]||(t[8]=(...e)=>n.clear&&n.clear(...e)),class:"tbtn tbtn-margin-left",type:"button"},"取消")])],512),[[c]])],512)),[[u]])},ya.__file="src/components/layer/custom-service/custom-service.vue",ya.install=function(e){e.component(ya.name,ya)};var xa={name:"Sm3dLayerManage",props:{deleteCallback:{type:Function}},setup(e){let{nodeContextmenu:t,nodeClick:o,TreeDatas:l,tree:i,domContextmenu:n,checkNode:a,deleteLayer:s,expandedKeys:r}=Ra(e);return{nodeContextmenu:t,nodeClick:o,TreeDatas:l,tree:i,domContextmenu:n,checkNode:a,deleteLayer:s,expandedKeys:r}}};const La={id:"layer-manage-panel",class:"sm-panel"},Pa={class:"sm-function-module-sub-section",style:{margin:"0"}},Va={class:"sm-half-L"},ka={id:"contextmenu",ref:"domContextmenu"};function Ea(o){let l,i,n,r=e({layerNames:[],selectedLayerIndex:"none",childLayerNames:[],selectedChildLayerIndex:"none",mvtAlpha:1,showLayer:!0,textAvoidance:!0,openFilter:!1,propertyKeys:[],symbols:[],clickGetFeature:{layer:{id:null},id:null},isClickShowProperty:!0,dockFontShow:!0,bubbleShow:!1,selectedPropertyKeys:[""],selectedSymbols:[""],inputPropertys:[""],inputSymbols:[""],inputValues:[""]}),d=[],p=!1;const c=v(null);function u(){l=viewer.scene._vectorTileMaps._layerQueue,l&&l.length>0?(l.forEach(((e,t)=>{r.layerNames.includes(e.name)||r.layerNames.push(e.name)})),console.log("init"),(r.selectedLayerIndex="none")&&(r.selectedLayerIndex=0)):r.selectedLayerIndex="none",viewer.eventManager.addEventListener("CLICK",w,!0)}function m(e){return e.slice(0,e.length-1)}function y(){if(""==r.inputPropertys[0])return!1;let e=["any"];return r.inputPropertys.forEach(((t,o)=>{let l=[];l[0]=r.inputSymbols[o],l[1]=t,l[2]=r.inputValues[o],"number"==typeof Number(l[2])&&(l[2]=Number(l[2])),e.push(l)})),!(e.length<2)&&e}let h;function w(e){let t=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(!SuperMap3D.defined(t)||!SuperMap3D.defined(t.pickResult))return void(r.bubbleShow=!1);let o=document.body.clientWidth-e.message.position.x;c.value.style.left=o>=300?e.message.position.x+"px":e.message.position.x-250+"px",c.value.style.top=e.message.position.y-220+"px",r.bubbleShow=!0;let l=null;for(var i in t.pickResult){l=t.pickResult[i];break}let n=l[0].feature;n&&(r.clickGetFeature=n),console.log(n)}function g(){h&&(i.removeLayer(h.id),h=null)}return r.symbols=["!","!=",">",">=","<","<=","==","in","like","!like","left","right"],V.isViewer&&setTimeout((()=>u()),500),s((()=>V.isViewer),(e=>{u()})),s((()=>V.changeLayers),(e=>{u()})),s((()=>r.selectedLayerIndex),(e=>{"none"!==e&&(d.length=0,i=l[e],r.showLayer=i.show,i.readyPromise.then((e=>{e&&(i.mapboxStyle.layers.forEach(((e,t)=>{r.childLayerNames.includes(e.id)||r.childLayerNames.push(e.id);let o=i.getLayoutProperty(e.id,"visibility");d.push(o)})),r.selectedChildLayerIndex=0)})))})),s((()=>r.selectedChildLayerIndex),(e=>{n=i.mapboxStyle.layers[e];let t=i.querySourceFeatures({sourceLayer:n.id,filter:["<","$id",10]});0==t.length?r.propertyKeys=[]:r.propertyKeys=t[0]._keys.length>0?t[0]._keys:[]})),s((()=>r.mvtAlpha),(e=>{i&&(i.alpha=Number(e))})),s((()=>r.showLayer),(e=>{i&&(i.show=e)})),s((()=>r.textAvoidance),(e=>{if(!i)return;let t=i.mapboxStyle.layers;for(let o=0;o<t.length;o++)t[o].isOverlapDisplayed=e})),s((()=>r.isClickShowProperty),(e=>{if(e)return viewer.eventManager.addEventListener("CLICK",w,!0),void(r.bubbleShow=!0);viewer.eventManager.removeEventListener("CLICK",w),r.bubbleShow=!1})),s((()=>r.selectedPropertyKeys),((e,t)=>{e.length===t.length&&e.forEach(((e,t)=>{r.inputPropertys[t]=e}))}),{deep:!0}),s((()=>r.selectedSymbols),((e,t)=>{e.length===t.length&&e.forEach(((e,t)=>{if("left"===e||"right"===e)return""===r.inputPropertys[t]||r.inputPropertys[t].includes("left(")||r.inputPropertys[t].includes("right(")?void(r.inputPropertys[t]=e+"()"):void(r.inputPropertys[t]=e+"("+r.inputPropertys[t]+",2)");r.inputSymbols[t]=e}))}),{deep:!0}),t((()=>{l=null,i=null,n=null})),{...a(r),addCondition:function(e){if(!e)return r.selectedPropertyKeys=m(r.selectedPropertyKeys),r.selectedSymbols=m(r.selectedSymbols),r.inputSymbols=m(r.inputSymbols),r.inputPropertys=m(r.inputPropertys),void(r.inputValues=m(r.inputValues));r.selectedPropertyKeys=r.selectedPropertyKeys.concat([""]),r.selectedSymbols=r.selectedSymbols.concat([""]),r.inputSymbols=r.inputSymbols.concat([""]),r.inputPropertys=r.inputPropertys.concat([""]),r.inputValues=r.inputValues.concat([""])},propertySearch:function(){let e=y();e&&function(e){h&&g();if(!n)return;let t=n.id+"_highlight";h||(h=SuperMap3D.clone(n,!0),h.id=t,"line"==n.type?h.paint["line-color"]="rgba(0,255,255,1.00)":"fill"==n.type?h.paint["fill-color"]="rgba(0,255,255,1.00)":h.paint["text-color"]="rgba(255,0,0,1.00)",h.layout.visibility="visible",h.minzoom=3,i.addLayer(h),i.setFilter(h.id,e))}(e)},propertyFilter:function(){let e=y();p=!0,i&&(i.mapboxStyle.layers.forEach((e=>{i.setLayoutProperty(e.id,"visibility","none")})),i.setLayoutProperty(n.id,"visibility","visible"),e&&i.setFilter(n.id,e))},clear:function(){g(),p&&(i.mapboxStyle.layers.forEach(((e,t)=>{i.setLayoutProperty(e.id,"visibility",d[t])})),i.setFilter(n.id,null),i.refresh(),p=!1)},bubble:c,closeBubble:function(){r.bubbleShow=!1},dockBubble:function(e){e?(c.value.classList.add("bubbleDock"),r.dockFontShow=!1):(c.value.classList.remove("bubbleDock"),r.dockFontShow=!0)}}}xa.render=function(e,t,o,n,a,s){const c=g("el-tree"),u=r("stopdrag"),y=r("drag");return l(),i(S,null,[d(p("div",La,[d(p("div",Pa,[p("div",Va,[p(c,{data:n.TreeDatas,"show-checkbox":"","node-key":"id",accordion:"",ref:"tree","default-expanded-keys":n.expandedKeys,"highlight-current":!0,onCheck:n.checkNode,onNodeContextmenu:n.nodeContextmenu,onNodeClick:n.nodeClick},null,8,["data","default-expanded-keys","onCheck","onNodeContextmenu","onNodeClick"])])],512),[[u]])],512),[[y]]),p("div",ka,[b(" <span>图层属性</span><br>\r\n          <span>图层风格</span><br>\r\n    <span>图层操作</span><br>"),p("span",{onClick:t[1]||(t[1]=(...e)=>n.deleteLayer&&n.deleteLayer(...e)),style:{color:"red"}},m(e.Resource.delete),1)],512)],64)},xa.__file="src/components/layer/layer-manage/layer-manage.vue",xa.install=function(e){e.component(xa.name,xa)};var Na={name:"Sm3dMvtlayerStyle",setup(e){let{layerNames:t,selectedLayerIndex:o,childLayerNames:l,selectedChildLayerIndex:i,mvtAlpha:n,showLayer:a,textAvoidance:s,propertyKeys:r,symbols:d,openFilter:p,propertySearch:c,propertyFilter:u,clear:m,isClickShowProperty:y,clickGetFeature:h,bubble:w,closeBubble:g,dockBubble:f,dockFontShow:b,bubbleShow:v,selectedPropertyKeys:S,selectedSymbols:C,inputPropertys:M,inputSymbols:D,inputValues:R,addCondition:x}=Ea();return{layerNames:t,selectedLayerIndex:o,childLayerNames:l,selectedChildLayerIndex:i,mvtAlpha:n,showLayer:a,textAvoidance:s,propertyKeys:r,symbols:d,openFilter:p,propertySearch:c,propertyFilter:u,clear:m,isClickShowProperty:y,clickGetFeature:h,bubble:w,closeBubble:g,dockBubble:f,dockFontShow:b,bubbleShow:v,selectedPropertyKeys:S,selectedSymbols:C,inputPropertys:M,inputSymbols:D,inputValues:R,addCondition:x}}};const Ta={id:"mvtlayer-panel",class:"sm-panel"},Aa={class:"sm-function-module-sub-section",style:{margin:"0"}},Ba={class:"sm-half-L"},Ia=p("label",{style:{width:"28%"}},"选择图层",-1),_a={value:"none"},Fa={class:"sm-half-L"},Oa=p("label",{style:{width:"28%"}},"透明度",-1),Ua={class:"sm-half-L"},Ha={style:{width:"auto"}},za=u("图层显隐 "),Ga={style:{width:"auto"}},Wa=u("文字避让 "),ja={style:{width:"auto"}},Ka=u("图层属性 "),Qa={style:{width:"auto"}},Xa=u("查询过滤 "),Ya={style:{width:"100%"}},Za={class:"sm-half-L",style:{"margin-top":"5px"}},qa=p("label",{style:{width:"28%"}},"选择子图层",-1),Ja={class:"sm-half-L",style:{padding:"6px 0 6px 0"}},$a=p("label",{style:{width:"28%"}},"设置条件",-1),es={class:"sm-half-L"},ts={class:"tab tab2"},os=p("tr",null,[p("th",null,"属性"),p("th",null,"条件"),p("th",null,"值")],-1),ls={style:{position:"relative"}},is={style:{position:"relative"}},ns={class:"boxchild"},as={id:"mvtlayer-drop-left-panel",class:"sm-panel"},ss={id:"bubble",class:"bubble-tabel",ref:"bubble"},rs={class:"boxchild flex-between"},ds=p("label",{style:{width:"auto"}},"对象属性",-1),ps={class:"flex flex-end",style:{width:"auto"}},cs={class:"tab"},us=p("tr",null,[p("th",null,"属性"),p("th",null,"值")],-1),ms=p("td",null,"图层",-1),ys=p("td",null,"$id",-1);Na.render=function(e,t,o,n,a,s){const c=g("el-slider"),u=r("stopdrag"),b=r("drag");return l(),i(S,null,[d(p("div",Ta,[d(p("div",Aa,[p("div",Ba,[Ia,d(p("select",{class:"sm-select",style:{width:"70%"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.selectedLayerIndex=e)},[(l(!0),i(S,null,R(n.layerNames,((e,t)=>(l(),i("option",{key:t,value:t},m(e),9,["value"])))),128)),d(p("option",_a,"暂无mvt图层",512),[[h,0==n.layerNames.length]])],512),[[f,n.selectedLayerIndex]])]),p("div",Fa,[Oa,p(c,{modelValue:n.mvtAlpha,"onUpdate:modelValue":t[2]||(t[2]=e=>n.mvtAlpha=e),min:0,max:1,step:.05,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"70%"}},null,8,["modelValue","step"])]),p("div",Ua,[p("label",Ha,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>n.showLayer=e)},null,512),[[w,n.showLayer]]),za]),p("label",Ga,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>n.textAvoidance=e)},null,512),[[w,n.textAvoidance]]),Wa]),p("label",ja,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=e=>n.isClickShowProperty=e)},null,512),[[w,n.isClickShowProperty]]),Ka]),p("label",Qa,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=e=>n.openFilter=e)},null,512),[[w,n.openFilter]]),Xa])]),d(p("div",Ya,[p("div",Za,[qa,d(p("select",{class:"sm-select",style:{width:"70%"},"onUpdate:modelValue":t[7]||(t[7]=e=>n.selectedChildLayerIndex=e)},[(l(!0),i(S,null,R(n.childLayerNames,((e,t)=>(l(),i("option",{key:t,value:t},m(e),9,["value"])))),128))],512),[[f,n.selectedChildLayerIndex]])]),p("div",Ja,[$a,p("div",null,[p("button",{class:"tbtn",type:"button",style:{width:"auto"},onClick:t[8]||(t[8]=e=>n.addCondition(!0))},"增行"),p("button",{class:"tbtn tbtn-margin-left",type:"button",style:{width:"auto"},onClick:t[9]||(t[9]=e=>n.addCondition(!1))},"删行")])]),p("div",es,[p("table",ts,[p("tbody",null,[os,(l(!0),i(S,null,R(n.selectedPropertyKeys,((e,t)=>(l(),i("tr",{key:t},[p("td",ls,[d(p("select",{class:"sm-select","onUpdate:modelValue":e=>n.selectedPropertyKeys[t]=e},[(l(!0),i(S,null,R(n.propertyKeys,(e=>(l(),i("option",{key:e,value:e},m(e),9,["value"])))),128))],8,["onUpdate:modelValue"]),[[f,n.selectedPropertyKeys[t]]]),d(p("input",{type:"text",class:"input","onUpdate:modelValue":e=>n.inputPropertys[t]=e},null,8,["onUpdate:modelValue"]),[[y,n.inputPropertys[t]]])]),p("td",is,[d(p("select",{class:"sm-select","onUpdate:modelValue":e=>n.selectedSymbols[t]=e},[(l(!0),i(S,null,R(n.symbols,(e=>(l(),i("option",{key:e,value:e},m(e),9,["value"])))),128))],8,["onUpdate:modelValue"]),[[f,n.selectedSymbols[t]]]),d(p("input",{type:"text",class:"input","onUpdate:modelValue":e=>n.inputSymbols[t]=e},null,8,["onUpdate:modelValue"]),[[y,n.inputSymbols[t]]])]),p("td",null,[d(p("input",{type:"text",class:"input2","onUpdate:modelValue":e=>n.inputValues[t]=e},null,8,["onUpdate:modelValue"]),[[y,n.inputValues[t]]])])])))),128))])])]),p("div",ns,[p("button",{class:"tbtn",type:"button",style:{width:"auto"},onClick:t[10]||(t[10]=(...e)=>n.propertySearch&&n.propertySearch(...e))},"查询"),p("button",{class:"tbtn tbtn-margin-left",type:"button",style:{width:"auto"},onClick:t[11]||(t[11]=(...e)=>n.propertyFilter&&n.propertyFilter(...e))},"过滤"),p("button",{class:"tbtn tbtn-margin-left",style:{width:"auto"},type:"button ",onClick:t[12]||(t[12]=(...e)=>n.clear&&n.clear(...e))},"清除")])],512),[[h,n.openFilter]])],512),[[u]])],512),[[b]]),d(p("div",as,null,512),[[h,e.isShowproPerties&&n.propertyKeys.length>0],[b]]),d(p("div",ss,[p("div",rs,[ds,p("div",ps,[d(p("i",{class:"el-icon-position",title:"停靠",style:{"margin-right":"8px"},onClick:t[13]||(t[13]=e=>n.dockBubble(!0))},null,512),[[h,n.dockFontShow]]),d(p("i",{class:"el-icon-chat-square",title:"悬浮",style:{"margin-right":"8px"},onClick:t[14]||(t[14]=e=>n.dockBubble(!1))},null,512),[[h,!n.dockFontShow]]),p("i",{class:"el-icon-close",title:"关闭",onClick:t[15]||(t[15]=(...e)=>n.closeBubble&&n.closeBubble(...e))})])]),p("table",cs,[p("tbody",null,[us,p("tr",null,[ms,p("td",null,m(n.clickGetFeature.layer.id),1)]),p("tr",null,[ys,p("td",null,m(n.clickGetFeature.id),1)]),(l(!0),i(S,null,R(n.clickGetFeature.properties,((e,t,o)=>(l(),i("tr",{key:o},[p("td",null,m(t),1),p("td",null,m(e),1)])))),128))])])],512),[[b],[h,n.bubbleShow]])],64)},Na.__file="src/components/layer/mvtlayer-style/mvtlayer-style.vue",Na.install=function(e){e.component(Na.name,Na)};var hs={name:"Sm3dS3mlayerAttribute",props:{selectedLayerName:{type:String},brightness:{type:Number},contrast:{type:Number},hue:{type:Number},saturation:{type:Number},gamma:{type:Number},shadowMode:{type:String},shadowDarkness:{type:Number},multiChoose:{type:Boolean},cullEnabled:{type:Boolean},visibility:{type:String}},setup(o){let{layerNames:l,selectedLayerName:i,brightness:n,contrast:r,hue:d,saturation:p,gamma:c,shadowMode:u,shadowDarkness:m,selectEnabled:y,multiChoose:h,cullEnabled:w,visibility:g}=function(o){let l,i,n=e({layerNames:[],selectedLayerName:"none",brightness:1,contrast:1,hue:0,saturation:1,gamma:1,shadowMode:"noShadow",shadowDarkness:.3,selectEnabled:!0,multiChoose:!1,cullEnabled:!1,visibility:"showAll"});if(o)for(let e in o)n.hasOwnProperty(e)?n[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);function r(){viewer.scene,l=viewer.scene.layers.layerQueue,l&&l.length>0?(l.forEach(((e,t)=>{n.layerNames.includes(e._name)||n.layerNames.push(e._name)})),(n.selectedLayerName="none")&&(n.selectedLayerName=n.layerNames[0],i=l[0])):n.layerNames=[]}return V.isViewer&&r(),s((()=>V.isViewer),(e=>{e&&r()})),s((()=>V.changeLayers),(e=>{r()})),t((()=>{l=null})),s((()=>n.selectedLayerName),(e=>{let t=n.layerNames.indexOf(e);-1!=t&&(i=l[t])})),s((()=>n.brightness),(e=>{i&&(i.brightness=Number(e))})),s((()=>n.contrast),(e=>{i&&(i.contrast=Number(e))})),s((()=>n.hue),(e=>{i&&(i.hue=Number(e))})),s((()=>n.saturation),(e=>{i&&(i.saturation=Number(e))})),s((()=>n.gamma),(e=>{i&&(i.gamma=Number(e))})),s((()=>n.shadowMode),(e=>{if(i)switch(e){case"noShadow":viewer.shadows=!1,i.shadowType=SuperMap3D.ShadowType.NONE;break;case"chooseShadow":viewer.shadows=!0,i.shadowType=SuperMap3D.ShadowType.SELECTION,i.refresh();break;case"allShadow":viewer.shadows=!0,i.shadowType=SuperMap3D.ShadowType.ALL,i.refresh()}})),s((()=>n.shadowDarkness),(e=>{viewer.scene.shadowMap.darkness=Number(e)})),s((()=>n.multiChoose),(e=>{i&&(i.multiChoose=e)})),s((()=>n.selectEnabled),(e=>{i&&(i.selectEnabled=e)})),s((()=>n.cullEnabled),(e=>{i&&(i.cullEnabled=e)})),s((()=>n.visibility),(e=>{if(i)switch(e){case"showAll":i.setObjsVisible([],!1);break;case"onlyHideSlection":let e=i.getSelection();i.setObjsVisible(e,!1);break;case"onlyShowSlection":let t=i.getSelection();i.setObjsVisible(t,!0)}})),{...a(n)}}(o);return{layerNames:l,selectedLayerName:i,brightness:n,contrast:r,hue:d,saturation:p,gamma:c,shadowMode:u,shadowDarkness:m,selectEnabled:y,multiChoose:h,cullEnabled:w,visibility:g}}};const ws={id:"s3mlayer-attribute-panel",class:"sm-panel"},gs={class:"sm-function-module-sub-section",style:{margin:"0"}},fs={class:"sm-half-L"},bs={style:{width:"35%"}},vs={class:"sm-half-L"},Ss={style:{width:"35%"}},Cs={class:"sm-half-L"},Ms={style:{width:"35%"}},Ds={class:"sm-half-L"},Rs={style:{width:"35%"}},xs={class:"sm-half-L"},Ls={style:{width:"35%"}},Ps={class:"sm-half-L"},Vs={style:{width:"35%"}},ks={class:"sm-half-L",style:{"margin-top":"6px"}},Es={style:{width:"35%"}},Ns={style:{width:"auto"}},Ts={class:"sm-half-L"},As={style:{width:"35%"}},Bs={class:"sm-half-L"},Is={style:{width:"auto"}},_s={style:{width:"auto"}},Fs={style:{width:"auto"}},Os={class:"sm-half-L"},Us={style:{width:"35%"}},Hs={value:"onlyShowSlection"},zs={value:"onlyHideSlection"},Gs={value:"showAll"};hs.render=function(e,t,o,n,a,s){const y=g("el-slider"),b=r("stopdrag"),v=r("drag");return d((l(),i("div",ws,[d(p("div",gs,[p("div",fs,[p("label",bs,m(e.Resource.selectedLayer),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.selectedLayerName=e)},[(l(!0),i(S,null,R(n.layerNames,((e,t)=>(l(),i("option",{key:t,value:e},m(e),9,["value"])))),128)),d(p("option",{value:"none"},m(e.Resource.noS3mLayer),513),[[h,0==n.layerNames.length]])],512),[[f,n.selectedLayerName]])]),p("div",vs,[p("label",Ss,m(e.Resource.brightness),1),p(y,{modelValue:n.brightness,"onUpdate:modelValue":t[2]||(t[2]=e=>n.brightness=e),min:0,max:3,step:.05,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",Cs,[p("label",Ms,m(e.Resource.contrast),1),p(y,{modelValue:n.contrast,"onUpdate:modelValue":t[3]||(t[3]=e=>n.contrast=e),min:0,max:3,step:.05,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",Ds,[p("label",Rs,m(e.Resource.hue),1),p(y,{modelValue:n.hue,"onUpdate:modelValue":t[4]||(t[4]=e=>n.hue=e),min:0,max:3,step:.05,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",xs,[p("label",Ls,m(e.Resource.saturation),1),p(y,{modelValue:n.saturation,"onUpdate:modelValue":t[5]||(t[5]=e=>n.saturation=e),min:0,max:3,step:.05,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",Ps,[p("label",Vs,m(e.Resource.gamma),1),p(y,{modelValue:n.gamma,"onUpdate:modelValue":t[6]||(t[6]=e=>n.gamma=e),min:0,max:3,step:.05,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",ks,[p("label",Es,[d(p("input",{type:"radio",value:"noShadow","onUpdate:modelValue":t[7]||(t[7]=e=>n.shadowMode=e)},null,512),[[c,n.shadowMode]]),u(m(e.Resource.closeShadow),1)]),p("label",Ns,[d(p("input",{type:"radio",value:"allShadow","onUpdate:modelValue":t[8]||(t[8]=e=>n.shadowMode=e)},null,512),[[c,n.shadowMode]]),u(m(e.Resource.openShadow),1)])]),p("div",Ts,[p("label",As,m(e.Resource.shadowDarkness),1),p(y,{modelValue:n.shadowDarkness,"onUpdate:modelValue":t[9]||(t[9]=e=>n.shadowDarkness=e),min:0,max:1,step:.05,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",Bs,[p("label",Is,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=e=>n.selectEnabled=e)},null,512),[[w,n.selectEnabled]]),u(m(e.Resource.selectEnabled),1)]),d(p("label",_s,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=e=>n.multiChoose=e)},null,512),[[w,n.multiChoose]]),u(m(e.Resource.multiChoose),1)],512),[[h,n.selectEnabled]]),p("label",Fs,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[12]||(t[12]=e=>n.cullEnabled=e)},null,512),[[w,n.cullEnabled]]),u(m(e.Resource.cullEnabled),1)])]),p("div",Os,[p("label",Us,m(e.Resource.visibility),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[13]||(t[13]=e=>n.visibility=e)},[p("option",Hs,m(e.Resource.onlyShowSlection),1),p("option",zs,m(e.Resource.onlyHideSlection),1),p("option",Gs,m(e.Resource.showAll),1)],512),[[f,n.visibility]])])],512),[[b]])],512)),[[v]])},hs.__file="src/components/layer/s3mlayer-attribute/s3mlayer-attribute.vue",hs.install=function(e){e.component(hs.name,hs)};var Ws={name:"Sm3dS3mlayerStyle",props:{selectedLayerName:{type:String},foreColor:{type:String},lineColor:{type:String},selectedColor:{type:String},selectColorMode:{type:String},bottomAltitude:{type:Number},LODScale:{type:Number},layerTrans:{type:Number},fillStyle:{type:String},visibleDistanceMin:{type:Number},visibleDistanceMax:{type:Number}},setup(o){let{layerNames:l,selectedLayerName:i,foreColor:n,lineColor:r,selectedColor:d,selectColorMode:p,bottomAltitude:c,LODScale:u,layerTrans:m,fillStyle:y,visibleDistanceMin:h,visibleDistanceMax:w}=function(o){let l,i,n=e({layerNames:[],selectedLayerName:"none",foreColor:"#ffffff",lineColor:"rgba(27, 27, 27, 1)",selectedColor:"#A40FF4",selectColorMode:"mix",bottomAltitude:0,LODScale:5,layerTrans:1,fillStyle:"fill-and-wireframe",visibleDistanceMin:0,visibleDistanceMax:1e4});if(o)for(let e in o)n.hasOwnProperty(e)?n[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);function r(){viewer.scene,l=viewer.scene.layers.layerQueue,l&&l.length>0?(l.forEach(((e,t)=>{n.layerNames.includes(e._name)||n.layerNames.push(e._name)})),(n.selectedLayerName="none")&&(n.selectedLayerName=n.layerNames[0],i=l[0])):n.layerNames=[]}return V.isViewer&&r(),s((()=>V.isViewer),(e=>{e&&r()})),s((()=>V.changeLayers),(e=>{r()})),t((()=>{l=null})),s((()=>n.selectedLayerName),(e=>{let t=n.layerNames.indexOf(e);-1!=t&&(i=l[t])})),s((()=>n.foreColor),(e=>{i&&(i.style3D.fillForeColor=SuperMap3D.Color.fromCssColorString(e))})),s((()=>n.lineColor),(e=>{i&&(i.style3D.lineColor=SuperMap3D.Color.fromCssColorString(e))})),s((()=>n.selectedColor),(e=>{i&&(i.selectedColor=SuperMap3D.Color.fromCssColorString(e))})),s((()=>n.selectColorMode),(e=>{i&&(i.selectColorType="mix"===e?0:1)})),s((()=>n.bottomAltitude),(e=>{i&&(i.style3D.bottomAltitude=Number(e)),i.refresh()})),s((()=>n.fillStyle),(e=>{if(i)switch(e){case"fill":i.style3D.fillStyle=SuperMap3D.FillStyle.Fill;break;case"wireframe":i.style3D.fillStyle=SuperMap3D.FillStyle.WireFrame,i.style3D.lineColor=SuperMap3D.Color.fromCssColorString(n.lineColor);break;case"fill-and-wireframe":i.style3D.fillStyle=SuperMap3D.FillStyle.Fill_And_WireFrame,i.style3D.lineColor=SuperMap3D.Color.fromCssColorString(n.lineColor)}i.refresh()})),s((()=>n.LODScale),(e=>{i&&(i.lodRangeScale=Number(e))})),s((()=>n.layerTrans),(e=>{i&&(i.style3D.fillForeColor.alpha=Number(e))})),s((()=>n.visibleDistanceMin),(e=>{""==e&&(e=0),i&&(i.visibleDistanceMin=Number(e))})),s((()=>n.visibleDistanceMax),(e=>{""==e&&(e=this.maxNumber),i&&(i.cullEnabled=e),i.visibleDistanceMax=Number(e)})),{...a(n)}}(o);return{layerNames:l,selectedLayerName:i,foreColor:n,lineColor:r,selectedColor:d,selectColorMode:p,bottomAltitude:c,LODScale:u,layerTrans:m,fillStyle:y,visibleDistanceMin:h,visibleDistanceMax:w}}};const js={id:"s3mlayer-attribute-panel",class:"sm-panel"},Ks={class:"sm-function-module-sub-section",style:{margin:"0"}},Qs={class:"sm-half-L"},Xs={style:{width:"35%"}},Ys={class:"sm-half-L"},Zs={style:{width:"35%"}},qs={class:"sm-half-L"},Js={style:{width:"35%"}},$s={class:"sm-half-L"},er={style:{width:"35%"}},tr={class:"sm-half-L"},or={style:{width:"35%"}},lr={class:"sm-half",style:{width:"63%"}},ir={style:{width:"auto"}},nr={style:{width:"auto"}},ar={class:"sm-half-L"},sr={style:{width:"35%"}},rr={class:"sm-half-L"},dr=p("label",{style:{width:"35%"}},"LOD",-1),pr={class:"sm-half-L"},cr={style:{width:"35%"}},ur={class:"sm-half-L"},mr={style:{width:"35%"}},yr={value:"fill"},hr={value:"wireframe"},wr={value:"fill-and-wireframe"},gr={class:"sm-half-L"},fr={style:{width:"35%"}},br={class:"sm-half-L"},vr={style:{width:"35%"}};Ws.render=function(e,t,o,n,a,s){const w=g("el-color-picker"),b=g("el-slider"),v=r("stopdrag"),C=r("drag");return d((l(),i("div",js,[d(p("div",Ks,[p("div",Qs,[p("label",Xs,m(e.Resource.selectedLayer),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.selectedLayerName=e)},[(l(!0),i(S,null,R(n.layerNames,((e,t)=>(l(),i("option",{key:t,value:e},m(e),9,["value"])))),128)),d(p("option",{value:"none"},m(e.Resource.noS3mLayer),513),[[h,0==n.layerNames.length]])],512),[[f,n.selectedLayerName]])]),p("div",Ys,[p("label",Zs,m(e.Resource.foreColor),1),p(w,{modelValue:n.foreColor,"onUpdate:modelValue":t[2]||(t[2]=e=>n.foreColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])]),p("div",qs,[p("label",Js,m(e.Resource.lineColor),1),p(w,{modelValue:n.lineColor,"onUpdate:modelValue":t[3]||(t[3]=e=>n.lineColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])]),p("div",$s,[p("label",er,m(e.Resource.selectedColor),1),p(w,{modelValue:n.selectedColor,"onUpdate:modelValue":t[4]||(t[4]=e=>n.selectedColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])]),p("div",tr,[p("label",or,m(e.Resource.selectColorMode),1),p("div",lr,[p("label",ir,[d(p("input",{type:"radio",value:"mix","onUpdate:modelValue":t[5]||(t[5]=e=>n.selectColorMode=e)},null,512),[[c,n.selectColorMode]]),u(" "+m(e.Resource.mix),1)]),p("label",nr,[d(p("input",{type:"radio",value:"replace","onUpdate:modelValue":t[6]||(t[6]=e=>n.selectColorMode=e)},null,512),[[c,n.selectColorMode]]),u(" "+m(e.Resource.replace),1)])])]),p("div",ar,[p("label",sr,m(e.Resource.bottomAltitude),1),p(b,{modelValue:n.bottomAltitude,"onUpdate:modelValue":t[7]||(t[7]=e=>n.bottomAltitude=e),min:0,step:1,max:1e3,"input-size":"mini",debounce:1e3,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])]),p("div",rr,[dr,p(b,{modelValue:n.LODScale,"onUpdate:modelValue":t[8]||(t[8]=e=>n.LODScale=e),min:0,max:10,step:.5,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",pr,[p("label",cr,m(e.Resource.layerTrans),1),p(b,{modelValue:n.layerTrans,"onUpdate:modelValue":t[9]||(t[9]=e=>n.layerTrans=e),min:0,max:1,step:.01,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",ur,[p("label",mr,m(e.Resource.fillStyle),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[10]||(t[10]=e=>n.fillStyle=e)},[p("option",yr,m(e.Resource.fillMode),1),p("option",hr,m(e.Resource.lineMode),1),p("option",wr,m(e.Resource.fillAndLine),1)],512),[[f,n.fillStyle]])]),p("div",gr,[p("label",fr,m(e.Resource.visibleDistanceMin),1),d(p("input",{type:"number",class:"sm-input",style:{width:"63%"},"onUpdate:modelValue":t[11]||(t[11]=e=>n.visibleDistanceMin=e)},null,512),[[y,n.visibleDistanceMin]])]),p("div",br,[p("label",vr,m(e.Resource.visibleDistanceMax),1),d(p("input",{type:"number",class:"sm-input",style:{width:"63%"},"onUpdate:modelValue":t[12]||(t[12]=e=>n.visibleDistanceMax=e)},null,512),[[y,n.visibleDistanceMax]])])],512),[[v]])],512)),[[C]])},Ws.__file="src/components/layer/s3mlayer-style/s3mlayer-style.vue",Ws.install=function(e){e.component(Ws.name,Ws)};var Sr={name:"Sm3dS3mlayerOperation",props:{selectedLayerName:{type:String},selectedoffset:{type:Boolean},offsetX:{type:Number},offsetY:{type:Number},offsetZ:{type:Number},polygonOffset:{type:Boolean},polygonOffsetFactor:{type:Number},polygonOffsetUnit:{type:Number}},setup(o){let{layerNames:l,selectedLayerName:i,selectedoffset:n,offsetX:r,offsetY:d,offsetZ:p,polygonOffset:c,polygonOffsetFactor:u,polygonOffsetUnit:m}=function(o){let l,i,n=e({layerNames:[],selectedLayerName:"none",selectedoffset:!1,offsetX:0,offsetY:0,offsetZ:0,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnit:0});if(o)for(let e in o)n.hasOwnProperty(e)?n[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);function r(){viewer.scene,l=viewer.scene.layers.layerQueue,l&&l.length>0?(l.forEach(((e,t)=>{n.layerNames.includes(e._name)||n.layerNames.push(e._name)})),(n.selectedLayerName="none")&&(n.selectedLayerName=n.layerNames[0],i=l[0])):n.layerNames=[]}function d(){let e=i.getSelection();i.removeAllObjsOffset(),e.length>0&&i.setObjsOffset(e)}return V.isViewer&&r(),s((()=>V.isViewer),(e=>{e&&r()})),s((()=>V.changeLayers),(e=>{r()})),t((()=>{l=null})),s((()=>n.selectedLayerName),(e=>{let t=n.layerNames.indexOf(e);-1!=t&&(i=l[t])})),s((()=>n.selectedoffset),(e=>{if(i)if(e){let e=Number(n.offsetX),t=Number(n.offsetY),o=Number(n.offsetZ);i.selectedTranslate=new SuperMap3D.Cartesian3(e,t,o),viewer.eventManager.addEventListener("CLICK",d,!0),d()}else viewer.eventManager.removeEventListener("CLICK",d),i.selectedTranslate=new SuperMap3D.Cartesian3(0,0,0),i.removeAllObjsOffset(),i.releaseSelection()})),s((()=>n.offsetX),(e=>{if(n.selectedoffset){let t=Number(e),o=Number(n.offsetY),l=Number(n.offsetZ);i.selectedTranslate=new SuperMap3D.Cartesian3(t,o,l)}})),s((()=>n.offsetY),(e=>{if(n.selectedoffset){let e=Number(n.offsetX),t=Number(n.offsetY),o=Number(n.offsetZ);i.selectedTranslate=new SuperMap3D.Cartesian3(e,t,o)}})),s((()=>n.offsetZ),(e=>{if(n.selectedoffset){let e=Number(n.offsetX),t=Number(n.offsetY),o=Number(n.offsetZ);i.selectedTranslate=new SuperMap3D.Cartesian3(e,t,o)}})),s((()=>n.polygonOffset),(e=>{i&&(e?i.setPolygonoffset(Number(n.polygonOffsetFactor),Number(e)):i.setPolygonoffset(0,0))})),s((()=>n.polygonOffsetFactor),(e=>{i&&n.polygonOffset&&i.setPolygonoffset(Number(e),Number(n.polygonOffsetUnit))})),s((()=>n.polygonOffsetUnit),(e=>{i&&n.polygonOffset&&i.setPolygonoffset(Number(n.polygonOffsetFactor),Number(e))})),{...a(n)}}(o);return{layerNames:l,selectedLayerName:i,selectedoffset:n,offsetX:r,offsetY:d,offsetZ:p,polygonOffset:c,polygonOffsetFactor:u,polygonOffsetUnit:m}}};const Cr={id:"s3mlayer-attribute-panel",class:"sm-panel"},Mr={class:"sm-function-module-sub-section",style:{margin:"0"}},Dr={class:"sm-half-L"},Rr={style:{width:"35%"}},xr={class:"sm-half-L"},Lr={style:{width:"100%"}},Pr={class:"sm-half-L"},Vr={style:{width:"35%"}},kr={class:"sm-half-L"},Er={style:{width:"35%"}},Nr={class:"sm-half-L"},Tr={style:{width:"35%"}};function Ar(o){let l,i,n=e({layerNames:[],selectedLayerName:"none",maxHeight:200,minHeight:0,floodHeight:[0,200],currentHeight:0,floodSpeed:1,floodTrans:.8,cheackedBand:"band1",colorBandShow:!1,floodPositions:[],lineVisible:!0});if(o)for(let e in o)n.hasOwnProperty(e)?n[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let r,d=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE,p=new SuperMap3D.HypsometricSetting,c=new SuperMap3D.ColorTable;c.insert(500,new SuperMap3D.Color(0,39/255,148/255)),c.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));let u=[];function m(){viewer.scene,l=viewer.scene.layers.layerQueue,l&&l.length>0&&(l.forEach(((e,t)=>{n.layerNames.includes(e._name)||n.layerNames.push(e._name)})),(n.selectedLayerName="none")&&(n.selectedLayerName=n.layerNames[0],i=l[0]))}function y(e){e&&(u=e),p.CoverageArea=e;let t=Number(n.minHeight);r=setInterval("ModelFlood()",100),window.ModelFlood=()=>{if(t>n.maxHeight)return n.currentHeight=n.maxHeight,void clearInterval(r);n.currentHeight=Number(t.toFixed(2)),p.MaxVisibleValue=t;try{h()}catch(e){console.log(e),clearInterval(r)}t+=parseFloat(n.floodSpeed)/10}}function h(){0!=u.length&&(i.hypsometricSetting={hypsometricSetting:p,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})}return V.isViewer&&m(),s((()=>V.isViewer),(e=>{e&&m()})),s((()=>V.changeLayers),(e=>{m()})),t((()=>{l=null,p.destroy(),c.destroy(),p=void 0,c=void 0})),s((()=>n.selectedLayerName),(e=>{let t=n.layerNames.indexOf(e);-1!=t&&(i=l[t])})),s((()=>n.maxHeight),(e=>{p.MaxVisibleValue=parseInt(e),h()})),s((()=>n.minHeight),(e=>{p.MinVisibleValue=parseInt(e),n.currentHeight=parseInt(e),h()})),s((()=>n.floodHeight),(e=>{n.minHeight=e[0],n.maxHeight=e[1]})),s((()=>n.floodTrans),(e=>{p.Opacity=parseFloat(e),h()})),s((()=>n.cheackedBand),(e=>{c=function(e){let t=new SuperMap3D.ColorTable;switch(e){case"band1":t.insert(500,new SuperMap3D.Color(0,39/255,148/255)),t.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));break;case"band2":t.insert(500,new SuperMap3D.Color(162/255,251/255,194/255)),t.insert(0,new SuperMap3D.Color(1,103/255,103/255));break;case"band3":t.insert(500,new SuperMap3D.Color(230/255,198/255,1)),t.insert(0,new SuperMap3D.Color(157/255,0,1));break;case"band4":t.insert(500,new SuperMap3D.Color(210/255,15/255,15/255)),t.insert(100,new SuperMap3D.Color(221/255,224/255,7/255)),t.insert(50,new SuperMap3D.Color(20/255,187/255,18/255)),t.insert(4e3,new SuperMap3D.Color(0,161/255,1)),t.insert(0,new SuperMap3D.Color(9/255,9/255,212/255));break;case"band5":t.insert(500,new SuperMap3D.Color(186/255,1,229/255)),t.insert(0,new SuperMap3D.Color(26/255,185/255,156/255));break;default:t.insert(500,new SuperMap3D.Color(0,39/255,148/255)),t.insert(0,new SuperMap3D.Color(149/255,232/255,249/255))}return t}(e),p.ColorTable=c,h()})),{...a(n),floodClear:function(e){e.preventDefault(),i.hypsometricSetting.hypsometricSetting.MaxVisibleValue=-1e3,clearInterval(r),u=[],n.currentHeight=Number(n.floodHeight[0]),window.handlerPolygon&&Me("Polygon")},floodBegin:function(e){e.preventDefault(),p.DisplayMode=d,p._lineColor=new SuperMap3D.Color(1,0,0,1),p.MinVisibleValue=Number(n.floodHeight[0]),p.MaxVisibleValue=0,p.ColorTableMinKey=0,p.ColorTableMaxKey=200,p.ColorTable=c,p.Opacity=Number(n.floodTrans),p.LineInterval=10,window.handlerPolygon||Se("Polygon"),o&&o.floodPositions?y(o.floodPositions):(Ce("Polygon",n.lineVisible).then((e=>{let t=window.handlerPolygon;y(e.positions),t.polygon.show=!1,t.deactivate()}),(e=>{console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||we.Message.errorMsg(ce.NoPickPositionSupported))},changeColor:function(e){n.colorBandShow=!1,n.cheackedBand=e},floodPosition:u}}Sr.render=function(e,t,o,n,a,s){const c=g("el-slider"),y=r("stopdrag"),v=r("drag");return d((l(),i("div",Cr,[d(p("div",Mr,[p("div",Dr,[p("label",Rr,m(e.Resource.selectedLayer),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.selectedLayerName=e)},[(l(!0),i(S,null,R(n.layerNames,((e,t)=>(l(),i("option",{key:t,value:e},m(e),9,["value"])))),128)),d(p("option",{value:"none"},m(e.Resource.noS3mLayer),513),[[h,0==n.layerNames.length]])],512),[[f,n.selectedLayerName]])]),p("div",xr,[p("label",Lr,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>n.selectedoffset=e)},null,512),[[w,n.selectedoffset]]),u(" "+m(e.Resource.selectedoffset),1)]),p("div",Pr,[p("label",Vr,m(e.Resource.offsetX),1),p(c,{modelValue:n.offsetX,"onUpdate:modelValue":t[3]||(t[3]=e=>n.offsetX=e),min:-50,max:50,step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])]),p("div",kr,[p("label",Er,m(e.Resource.offsetY),1),p(c,{modelValue:n.offsetY,"onUpdate:modelValue":t[4]||(t[4]=e=>n.offsetY=e),min:-50,max:50,step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])]),p("div",Nr,[p("label",Tr,m(e.Resource.offsetZ),1),p(c,{modelValue:n.offsetZ,"onUpdate:modelValue":t[5]||(t[5]=e=>n.offsetZ=e),min:-50,max:50,step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])])]),b(' <div class="sm-half-L">\r\n        <label style="width:100%">\r\n          <input type="checkbox" v-model="polygonOffset" />\r\n          {{Resource.polygonOffset}}\r\n        </label>\r\n        <div class="sm-half-L">\r\n          <label style="width: 35%;">{{Resource.polygonOffsetFactor}}</label>\r\n          <el-slider\r\n            v-model="polygonOffsetFactor "\r\n            :min="-20"\r\n            :max="20"\r\n            :step="1"\r\n            input-size="mini"\r\n            :debounce="500"\r\n            tooltip-class="tooltip-class"\r\n            style="width:63%"\r\n          ></el-slider>\r\n        </div>\r\n        <div class="sm-half-L">\r\n          <label style="width: 35%;">{{Resource.polygonOffsetUnit}}</label>\r\n          <el-slider\r\n            v-model="polygonOffsetUnit "\r\n            :min="0"\r\n            :max="20"\r\n            :step="1"\r\n            input-size="mini"\r\n            :debounce="500"\r\n            tooltip-class="tooltip-class"\r\n            style="width:63%"\r\n          ></el-slider>\r\n        </div>\r\n      </div> ')],512),[[y]])],512)),[[v]])},Sr.__file="src/components/layer/s3mlayer-operation/s3mlayer-operation.vue",Sr.install=function(e){e.component(Sr.name,Sr)};var Br={name:"Sm3dModelFlood",methods:{formatTooltip:e=>e+Resource.meter,formatTooltip2:e=>e+Resource.meter_second},setup(e){let{layerNames:t,selectedLayerName:o,floodHeight:l,currentHeight:i,floodSpeed:n,floodClear:a,floodBegin:s}=Ar(e);return{layerNames:t,selectedLayerName:o,floodHeight:l,currentHeight:i,floodSpeed:n,floodClear:a,floodBegin:s}}};const Ir={id:"terrain-flood-panel",class:"sm-panel"},_r={class:"sm-function-module-sub-section",style:{margin:"0"}},Fr={class:"sm-half-L"},Or={style:{width:"40%"}},Ur={class:"sm-half-L"},Hr={style:{width:"40%"}},zr={class:"sm-half-L"},Gr={style:{width:"40%"}},Wr={class:"sm-half-L"},jr={style:{width:"40%"}},Kr={class:"boxchild"};Br.render=function(e,t,o,n,a,s){const c=g("el-slider"),u=r("stopdrag"),w=r("drag");return d((l(),i("div",Ir,[d(p("div",_r,[p("div",Fr,[p("label",Or,m(e.Resource.selectedLayer),1),d(p("select",{class:"sm-select",style:{width:"58%"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.selectedLayerName=e)},[(l(!0),i(S,null,R(n.layerNames,((e,t)=>(l(),i("option",{key:t,value:e},m(e),9,["value"])))),128)),d(p("option",{value:"none"},m(e.Resource.noS3mLayer),513),[[h,0==n.layerNames.length]])],512),[[f,n.selectedLayerName]])]),p("div",Ur,[p("label",Hr,m(e.Resource.visibleHeight),1),p(c,{modelValue:n.floodHeight,"onUpdate:modelValue":t[2]||(t[2]=e=>n.floodHeight=e),min:0,max:500,range:"",step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class","format-tooltip":s.formatTooltip,style:{width:"58%"}},null,8,["modelValue","format-tooltip"])]),p("div",zr,[p("label",Gr,m(e.Resource.currentHeight),1),d(p("input",{class:"sm-input",disabled:"",type:"number",style:{width:"58%"},"onUpdate:modelValue":t[3]||(t[3]=e=>n.currentHeight=e)},null,512),[[y,n.currentHeight]])]),p("div",Wr,[p("label",jr,m(e.Resource.floodSpeed),1),p(c,{modelValue:n.floodSpeed,"onUpdate:modelValue":t[4]||(t[4]=e=>n.floodSpeed=e),max:20,min:.1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class","format-tooltip":s.formatTooltip2,style:{width:"58%"}},null,8,["modelValue","min","format-tooltip"])]),p("div",Kr,[p("button",{onClick:t[5]||(t[5]=(...e)=>n.floodBegin&&n.floodBegin(...e)),class:"tbtn",type:"button"},m(e.Resource.analyze),1),p("button",{onClick:t[6]||(t[6]=(...e)=>n.floodClear&&n.floodClear(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.clear),1)])],512),[[u]])],512)),[[w]])},Br.__file="src/components/layer/model-flood/model-flood.vue",Br.install=function(e){e.component(Br.name,Br)};var Qr={name:"Sm3dObliquePhotography",props:{selectedLayerName:{type:String},operationType:{type:String},excavationPositions:{type:Array},flattenPositions:{type:Array},lineVisible:{type:Boolean,default:!0}},setup(o){let{layerNames:l,selectedLayerName:i,operationType:n,startExcavation:r,clearExcavation:d,startFlatten:p,clearFlatten:c}=function(o){let l=e({layerNames:[],selectedLayerName:"none",operationType:"Excavation",lineVisible:!0});if(o)for(let e in o)l.hasOwnProperty(e)?l[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let i,n,r=[],d=[];function p(){viewer.scene,i=viewer.scene.layers.layerQueue,i&&i.length>0&&(i.forEach(((e,t)=>{l.layerNames.includes(e._name)||l.layerNames.push(e._name)})),(l.selectedLayerName="none")&&(l.selectedLayerName=l.layerNames[0],n=i[0]))}function c(e){e&&(r=e),n.addExcavationRegion({position:e,name:"excavation_"+Math.random()})}function u(e){e&&(d=e),n.addFlattenRegion({position:e,name:"flatten"+Math.random()})}return V.isViewer&&p(),s((()=>V.isViewer),(e=>{e&&p()})),s((()=>V.changeLayers),(e=>{p()})),s((()=>l.selectedLayerName),(e=>{let t=l.layerNames.indexOf(e);-1!=t&&(n=i[t])})),t((()=>{i=null})),{...a(l),startExcavation:function(e){e.preventDefault(),window.handlerPolygon||ge("Polygon"),o&&o.excavationPositions?c(o.excavationPositions):(fe("Polygon",l.lineVisible).then((e=>{let t=window.handlerPolygon;c(e.positions),t.polygon.show=!1,t.polyline.show=!1,t.deactivate()}),(e=>{console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||we.Message&&we.Message.errorMsg(ce.NoPickPositionSupported))},clearExcavation:function(e){e.preventDefault(),r=[],window.handlerPolygon&&(n.removeAllExcavationRegion(),be("Polygon"))},startFlatten:function(e){e.preventDefault(),window.handlerPolygon||ge("Polygon"),o&&o.flattenPositions?u(o.flattenPositions):(fe("Polygon",l.lineVisible).then((e=>{let t=window.handlerPolygon;u(e.positions),t.polygon.show=!1,t.polyline.show=!1}),(e=>{console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||we.Message&&we.Message.errorMsg(ce.NoPickPositionSupported))},clearFlatten:function(e){e.preventDefault(),window.handlerPolygon&&(n.removeAllFlattenRegion(),be("Polygon"))},excavationPositions:r,flattenPositions:d}}(o);return{layerNames:l,selectedLayerName:i,operationType:n,startExcavation:r,clearExcavation:d,startFlatten:p,clearFlatten:c}}};const Xr={id:"terrain-operation-panel",class:"sm-panel"},Yr={class:"sm-function-module-sub-section",style:{margin:"0"}},Zr={class:"sm-half-L"},qr={style:{width:"40%"}},Jr={class:"sm-half-L"},$r={style:{width:"auto"}},ed={style:{width:"auto"}},td={class:"boxchild"},od={class:"boxchild"};Qr.render=function(e,t,o,n,a,s){const y=r("stopdrag"),w=r("drag");return d((l(),i("div",Xr,[d(p("div",Yr,[p("div",Zr,[p("label",qr,m(e.Resource.selectedLayer),1),d(p("select",{class:"sm-select",style:{width:"58%"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.selectedLayerName=e)},[(l(!0),i(S,null,R(n.layerNames,((e,t)=>(l(),i("option",{key:t,value:e},m(e),9,["value"])))),128)),d(p("option",{value:"none"},m(e.Resource.noS3mLayer),513),[[h,0==n.layerNames.length]])],512),[[f,n.selectedLayerName]])]),p("div",Jr,[p("label",$r,[d(p("input",{type:"radio",value:"Excavation","onUpdate:modelValue":t[2]||(t[2]=e=>n.operationType=e)},null,512),[[c,n.operationType]]),u(" "+m(e.Resource.excavation),1)]),p("label",ed,[d(p("input",{type:"radio",value:"Flatten","onUpdate:modelValue":t[3]||(t[3]=e=>n.operationType=e)},null,512),[[c,n.operationType]]),u(" "+m(e.Resource.flatten),1)])]),d(p("div",td,[p("button",{onClick:t[4]||(t[4]=(...e)=>n.startExcavation&&n.startExcavation(...e)),class:"tbtn",type:"button"},m(e.Resource.excavation),1),p("button",{onClick:t[5]||(t[5]=(...e)=>n.clearExcavation&&n.clearExcavation(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.clear),1)],512),[[h,"Excavation"===n.operationType]]),d(p("div",od,[p("button",{onClick:t[6]||(t[6]=(...e)=>n.startFlatten&&n.startFlatten(...e)),onTouchstart:t[7]||(t[7]=(...e)=>n.startFlatten&&n.startFlatten(...e)),class:"tbtn",type:"button"},m(e.Resource.flatten),33),p("button",{onClick:t[8]||(t[8]=(...e)=>n.clearFlatten&&n.clearFlatten(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.clear),1)],512),[[h,"Flatten"===n.operationType]])],512),[[y]])],512)),[[w]])},Qr.__file="src/components/layer/oblique-photography/oblique-photography.vue",Qr.install=function(e){e.component(Qr.name,Qr)};var ld={name:"Sm3dImglayerAttribute",props:{selectedLayerName:{type:String},brightness:{type:Number},contrast:{type:Number},hue:{type:Number},saturation:{type:Number},gamma:{type:Number},alpha:{type:Number},transparentBackColor:{type:String},transparentBackColorTolerance:{type:Number}},setup(o){let{layerNames:l,selectedLayerName:i,brightness:n,contrast:r,hue:d,saturation:p,gamma:c,alpha:u,transparentBackColor:m,transparentBackColorTolerance:y}=function(o){let l,i,n=e({layerNames:[],selectedLayerName:"none",brightness:1,contrast:1,hue:0,saturation:1,gamma:1,alpha:1,transparentBackColor:"#eecccc",transparentBackColorTolerance:0});if(o)for(let e in o)n.hasOwnProperty(e)?n[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);function r(){viewer.scene,l=viewer.imageryLayers._layers,l&&l.length>1&&(l.forEach(((e,t)=>{let o=e._imageryProvider instanceof SuperMap3D.MvtProviderGL;if(0===t||o)return!0;n.layerNames.includes(e._imageryProvider.tablename)||n.layerNames.push(e._imageryProvider.tablename)})),(n.selectedLayerName="none")&&(n.selectedLayerName=n.layerNames[0],i=l[1]))}return V.isViewer&&r(),s((()=>V.isViewer),(e=>{e&&r()})),s((()=>V.changeLayers),(e=>{r()})),t((()=>{l=null})),s((()=>n.selectedLayerName),(e=>{let t=n.layerNames.indexOf(e);-1!=t&&(i=l[t+1])})),s((()=>n.brightness),(e=>{i&&(i.brightness=Number(e))})),s((()=>n.contrast),(e=>{i&&(i.contrast=Number(e))})),s((()=>n.hue),(e=>{i&&(i.hue=Number(e))})),s((()=>n.saturation),(e=>{i&&(i.saturation=Number(e))})),s((()=>n.gamma),(e=>{i&&(i.gamma=Number(e))})),s((()=>n.alpha),(e=>{i&&(i.alpha=Number(e))})),s((()=>n.transparentBackColor),(e=>{let t=SuperMap3D.Color.fromCssColorString(e);i&&(i.transparentBackColor=t)})),s((()=>n.transparentBackColorTolerance),(e=>{i&&(i.transparentBackColorTolerance=Number(e))})),{...a(n)}}(o);return{layerNames:l,selectedLayerName:i,brightness:n,contrast:r,hue:d,saturation:p,gamma:c,alpha:u,transparentBackColor:m,transparentBackColorTolerance:y}}};const id={id:"s3mlayer-attribute-panel",class:"sm-panel"},nd={class:"sm-function-module-sub-section",style:{margin:"0"}},ad={class:"sm-half-L"},sd={style:{width:"35%"}},rd={class:"sm-half-L"},dd={style:{width:"35%"}},pd={class:"sm-half-L"},cd={style:{width:"35%"}},ud={class:"sm-half-L"},md={style:{width:"35%"}},yd={class:"sm-half-L"},hd={style:{width:"35%"}},wd={class:"sm-half-L"},gd={style:{width:"35%"}},fd={class:"sm-half-L"},bd={style:{width:"35%"}},vd={class:"sm-half-L"},Sd={style:{width:"35%"}},Cd={class:"sm-half-L"},Md={style:{width:"35%"}};ld.render=function(e,t,o,n,a,s){const c=g("el-slider"),u=g("el-color-picker"),y=r("stopdrag"),w=r("drag");return d((l(),i("div",id,[d(p("div",nd,[p("div",ad,[p("label",sd,m(e.Resource.selectedLayer),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.selectedLayerName=e)},[(l(!0),i(S,null,R(n.layerNames,((e,t)=>(l(),i("option",{key:t,value:e},m(e),9,["value"])))),128)),d(p("option",{value:"none"},m(e.Resource.noImgLayer),513),[[h,0==n.layerNames.length]])],512),[[f,n.selectedLayerName]])]),p("div",rd,[p("label",dd,m(e.Resource.brightness),1),p(c,{modelValue:n.brightness,"onUpdate:modelValue":t[2]||(t[2]=e=>n.brightness=e),min:0,max:3,step:.05,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",pd,[p("label",cd,m(e.Resource.contrast),1),p(c,{modelValue:n.contrast,"onUpdate:modelValue":t[3]||(t[3]=e=>n.contrast=e),min:0,max:3,step:.05,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",ud,[p("label",md,m(e.Resource.hue),1),p(c,{modelValue:n.hue,"onUpdate:modelValue":t[4]||(t[4]=e=>n.hue=e),min:0,max:3,step:.05,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",yd,[p("label",hd,m(e.Resource.saturation),1),p(c,{modelValue:n.saturation,"onUpdate:modelValue":t[5]||(t[5]=e=>n.saturation=e),min:0,max:3,step:.05,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",wd,[p("label",gd,m(e.Resource.gamma),1),p(c,{modelValue:n.gamma,"onUpdate:modelValue":t[6]||(t[6]=e=>n.gamma=e),min:0,max:3,step:.05,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",fd,[p("label",bd,m(e.Resource.alpha),1),p(c,{modelValue:n.alpha,"onUpdate:modelValue":t[7]||(t[7]=e=>n.alpha=e),min:0,max:1,step:.01,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),p("div",vd,[p("label",Sd,m(e.Resource.transparentColor),1),p(u,{modelValue:n.transparentBackColor,"onUpdate:modelValue":t[8]||(t[8]=e=>n.transparentBackColor=e),size:"mini",style:{width:"63%"}},null,8,["modelValue"])]),p("div",Cd,[p("label",Md,m(e.Resource.transparentColorTolerance),1),p(c,{modelValue:n.transparentBackColorTolerance,"onUpdate:modelValue":t[9]||(t[9]=e=>n.transparentBackColorTolerance=e),min:0,max:1,step:.01,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])])],512),[[y]])],512)),[[w]])},ld.__file="src/components/layer/imglayer-attribute/imglayer-attribute.vue",ld.install=function(e){e.component(ld.name,ld)};var Dd={name:"Sm3dSceneAttribute",props:{earthShow:{type:Boolean,default:!0},shadows:{type:Boolean,default:!1},cloud:{type:Boolean,default:!1},skyBox:{type:Boolean,default:!1},sunShow:{type:Boolean,default:!1},timeline:{type:Boolean,default:!1},depthAgainst:{type:Boolean,default:!0},atomsphereRender:{type:Boolean,default:!0},fogEffect:{type:Boolean,default:!0},underground:{type:Boolean,default:!0},frameRate:{type:Boolean,default:!0},skyboxSources:{type:Object},surfaceTransparency:{type:Number},cloudsUrl:{type:String},skyboxType:{type:String},uspeed:{type:Number},vspeed:{type:Number},wspeed:{type:Number},viewMode:{type:String},rainAngle:{type:Number},rainSpeed:{type:Number},snowDesity:{type:Number},snowSpeed:{type:Number},snowAngle:{type:Number},snowType:{type:String},isCompass:{type:Boolean},rain:{type:Boolean},snow:{type:Boolean}},setup(o){let{earthShow:l,shadows:i,cloud:n,skyBox:r,sunShow:d,timeline:p,depthAgainst:c,atomsphereRender:u,fogEffect:m,underground:y,frameRate:h,Facade:w,surfaceTransparency:g,viewMode:f,rain:b,snow:v,snowType:S,isCompass:C,compass:M}=function(o){let l=e({earthShow:!0,shadows:!1,cloud:!1,skyBox:!1,sunShow:!1,timeline:!1,depthAgainst:!0,atomsphereRender:!0,fogEffect:!0,underground:!0,frameRate:!1,rain:!1,snow:!1,surfaceTransparency:1,cloudsUrl:"public/img/skyboxs/clouds/clouds1.png",skyboxSources:null,skyboxType:"bluesky",uspeed:0,vspeed:0,wspeed:.5,viewMode:"3D",rainAngle:45,rainSpeed:8,snowDesity:10,snowSpeed:4,snowAngle:10,snowType:"0",compass:!1,isCompass:""});if(l.skyboxSources={bluesky:{positiveX:"public/img/skyboxs/bluesky/Right.jpg",negativeX:"public/img/skyboxs/bluesky/Left.jpg",positiveY:"public/img/skyboxs/bluesky/Front.jpg",negativeY:"public/img/skyboxs/bluesky/Back.jpg",positiveZ:"public/img/skyboxs/bluesky/Up.jpg",negativeZ:"public/img/skyboxs/bluesky/Down.jpg"},sunsetglow:{positiveX:"public/img/skyboxs/sunsetglow/Right.jpg",negativeX:"public/img/skyboxs/sunsetglow/Left.jpg",positiveY:"public/img/skyboxs/sunsetglow/Front.jpg",negativeY:"public/img/skyboxs/sunsetglow/Back.jpg",positiveZ:"public/img/skyboxs/sunsetglow/Up.jpg",negativeZ:"public/img/skyboxs/sunsetglow/Down.jpg"}},o)for(let e in o)l.hasOwnProperty(e)?l[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let i,n=new SuperMap3D.CloudBox({url:l.cloudsUrl}),r={};for(let e in l.skyboxSources){let t=new SuperMap3D.SkyBox({sources:l.skyboxSources[e]});t.USpeed=l.uspeed,t.VSpeed=l.vspeed,t.WSpeed=l.wspeed,r[e]=t}function d(){if(viewer.scene.frameState.passes.render){for(let e in r)r[e].update(viewer.scene.frameState,!0),r[e].show=!1;viewer.scene.postRender.removeEventListener(d)}}function p(){l.skyBox&&(viewer.scene.camera.positionCartographic.height>22e4?(viewer.scene.skyBox.show=!1,l.atomsphereRender=!0):(viewer.scene.skyBox.show=!0,l.atomsphereRender=!1))}V.isViewer&&(i=viewer.scene.skyBox,viewer.scene.postRender.addEventListener(d),viewer.scene.postProcessStages.snow.uniforms.density=parseFloat(l.snowDesity),viewer.scene.postProcessStages.snow.uniforms.speed=parseFloat(l.snowSpeed),viewer.scene.postProcessStages.rain.uniforms.speed=parseFloat(l.rainSpeed),p());let c=viewer.scene.layers.layerQueue;for(var u=0;u<c.length;u++)c[u].shadowType=2;return s((()=>V.isViewer),(e=>{e&&(i=viewer.scene.skyBox,viewer.scene.postRender.addEventListener(d),viewer.scene.postProcessStages.snow.uniforms.density=parseFloat(l.snowDesity),viewer.scene.postProcessStages.snow.uniforms.speed=parseFloat(l.snowSpeed),viewer.scene.postProcessStages.rain.uniforms.speed=parseFloat(l.rainSpeed),p())})),t((()=>{n.destroy();for(let e in r)r[e].destroy();viewer.scene.skyBox=i})),s((()=>l.earthShow),(e=>{viewer.scene.globe.show=e})),s((()=>l.shadows),(e=>{e?(viewer.shadows=!0,viewer.pcss=!0,viewer.shadowQuality=0,viewer.scene.shadowMap.maximumDistance=2e3,viewer.shadowMap.darkness=.4,viewer.shadowMap.penumbraRatio=.1):viewer.shadows=!1})),s((()=>l.sunShow),(e=>{viewer.scene.globe.enableLighting=e})),s((()=>l.timeline),(e=>{let t=document.getElementsByClassName("supermap3d-viewer-timelineContainer")[0];e?(t.style.visibility="visible",t.style["z-index"]=99999999999):t.style.visibility="hidden"})),s((()=>l.depthAgainst),(e=>{viewer.scene.globe.depthTestAgainstTerrain=e})),s((()=>l.atomsphereRender),(e=>{viewer.scene.skyAtmosphere.show=e})),s((()=>l.fogEffect),(e=>{viewer.scene.fog.enabled=e})),s((()=>l.surfaceTransparency),(e=>{viewer.scene.globe.globeAlpha=parseFloat(e)})),s((()=>l.underground),(e=>{viewer.scene.undergroundMode=e,e?(viewer.scene.screenSpaceCameraController.minimumZoomDistance=-1e3,viewer.scene.terrainProvider.isCreateSkirt=!1):(viewer.scene.screenSpaceCameraController.minimumZoomDistance=1,viewer.scene.terrainProvider.isCreateSkirt=!0)})),s((()=>l.frameRate),(e=>{viewer.scene.debugShowFramesPerSecond=e})),s((()=>l.cloud),(e=>{viewer.scene.cloudBox=e?n:null})),s((()=>l.cloudsUrl),(e=>{viewer.scene.cloudBox.url=e})),s((()=>l.skyBox),(e=>{if(e){let e=viewer.scene.camera.positionCartographic.height;viewer.scene.postRender.addEventListener(p),viewer.scene.skyBox=r[l.skyboxType],e<22e4?(viewer.scene.skyBox.show=!0,l.atomsphereRender=!1):l.atomsphereRender=!0}else l.atomsphereRender=!0,viewer.scene.skyBox.show=!1,viewer.scene.skyBox=i,viewer.scene.postRender.removeEventListener(p)})),s((()=>l.skyboxType),(e=>{l.skyBox&&(r[e].show=!0,viewer.scene.skyBox=r[e])})),s((()=>l.uspeed),(e=>{r[l.skyboxType].USpeed=Number(e),l.skyBox&&(viewer.scene.skyBox.USpeed=Number(e))})),s((()=>l.vspeed),(e=>{r[l.skyboxType].VSpeed=Number(e),l.skyBox&&(viewer.scene.skyBox.VSpeed=Number(e))})),s((()=>l.wspeed),(e=>{r[l.skyboxType].WSpeed=Number(e),l.skyBox&&(viewer.scene.skyBox.WSpeed=Number(e))})),s((()=>l.viewMode),(e=>{viewer.scene.mode="2D"===e?SuperMap3D.SceneMode.SCENE2D:"3D"===e?SuperMap3D.SceneMode.SCENE3D:SuperMap3D.SceneMode.COLUMBUS_VIEW})),s((()=>l.rain),(e=>{viewer.scene.postProcessStages.rain.enabled=e})),s((()=>l.snow),(e=>{viewer.scene.postProcessStages.snow.enabled=e,console.log(viewer.scene.postProcessStages.snow.uniforms)})),s((()=>l.rainAngle),(e=>{viewer.scene.postProcessStages.rain.uniforms.angle=parseFloat(e)})),s((()=>l.rainSpeed),(e=>{viewer.scene.postProcessStages.rain.uniforms.speed=parseFloat(e)})),s((()=>l.snowDesity),(e=>{viewer.scene.postProcessStages.snow.uniforms.density=parseFloat(e)})),s((()=>l.snowSpeed),(e=>{viewer.scene.postProcessStages.snow.uniforms.speed=parseFloat(e)})),s((()=>l.snowAngle),(e=>{viewer.scene.postProcessStages.snow.uniforms.angle=parseFloat(e)})),s((()=>l.snowType),(e=>{switch(e){case"0":l.snowDesity=5,l.snowSpeed=2;break;case"1":l.snowDesity=10,l.snowSpeed=4;break;case"2":l.snowDesity=15,l.snowSpeed=6;break;case"3":l.snowDesity=20,l.snowSpeed=10;break;default:l.snowDesity=5,l.snowSpeed=2}})),s((()=>l.isCompass),(e=>{l.compass=e?"Sm3dCompass":""})),{...a(l)}}(o);return{earthShow:l,shadows:i,cloud:n,skyBox:r,sunShow:d,timeline:p,depthAgainst:c,atomsphereRender:u,fogEffect:m,underground:y,frameRate:h,Facade:w,surfaceTransparency:g,viewMode:f,rain:b,snow:v,snowType:S,isCompass:C,compass:M}}};const Rd={id:"s3mlayer-attribute-panel",class:"sm-panel"},xd={class:"sm-function-module-sub-section",style:{margin:"0"}},Ld={class:"sm-half-L"},Pd={style:{width:"28%"}},Vd={style:{width:"33%"}},kd={style:{width:"33%"}},Ed={style:{width:"28%"}},Nd={style:{width:"33%"}},Td={style:{width:"33%"}},Ad={style:{width:"28%"}},Bd={style:{width:"33%"}},Id={style:{width:"33%"}},_d={style:{width:"28%"}},Fd={style:{width:"33%"}},Od={style:{width:"33%"}},Ud={style:{width:"28%"}},Hd={style:{width:"33%"}},zd=p("label",{style:{width:"33%"}},null,-1),Gd={class:"sm-half-L"},Wd={style:{width:"35%"}},jd=p("option",{value:"3D"},"3D",-1),Kd=p("option",{value:"2.5D"},"2.5D",-1),Qd=p("option",{value:"2D"},"2D",-1),Xd={class:"sm-half-L"},Yd={style:{width:"35%"}},Zd={class:"sm-half-L"},qd=p("label",{style:{width:"35%"}},"下雪类型",-1),Jd=p("option",{value:"0"},"小雪",-1),$d=p("option",{value:"1"},"中雪",-1),ep=p("option",{value:"2"},"大雪",-1),tp=p("option",{value:"3"},"暴雪",-1);function op(o){let l,i,n,r=e({maxDistance:200,maxHeight:100,setLodrange:!1,layerNames:[],selectedLayerName:"none",lodrange:.01});if(o)for(let e in o)r.hasOwnProperty(e)?r[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);function d(){viewer.scene,i=viewer.scene.layers.layerQueue,i&&i.length>0&&(i.forEach(((e,t)=>{r.layerNames.includes(e._name)||r.layerNames.push(e._name)})),(r.selectedLayerName="none")&&(r.selectedLayerName=r.layerNames[0],n=i[0]))}function p(){l.clear(),be("Polyline"),tooltip.setVisible(!1)}return V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element)),l=new SuperMap3D.Facade(viewer.scene),l.build(),d()),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)),l=new SuperMap3D.Facade(viewer.scene),l.build(),d())})),s((()=>V.changeLayers),(e=>{d()})),t((()=>{p(),l.destroy()})),s((()=>r.maxDistance),(e=>{l.farDistance=Number(e)})),s((()=>r.maxHeight),(e=>{l.maxHeight=Number(e)})),s((()=>r.selectedLayerName),(e=>{let t=r.layerNames.indexOf(e);-1!=t&&(n=i[t])})),s((()=>r.lodrange),(e=>{n&&n.setLodRangeScale(Number(e))})),s((()=>r.setLodrange),(e=>{n&&(e?n.setLodRangeScale(Number(r.lodrange)):n.setLodRangeScale(1))})),{...a(r),setRegion:function(){tooltip.showAt(" <p>点击鼠标左键开始绘制起点</p><p>绘制两点确定区域宽度</p> <p>单击右键结束分析</p><p>设置模型精细度调整图片清晰度</p>","350px"),window.handlerPolyline||ge("Polyline"),fe("Polyline").then((e=>{let t=e.result.object.positions[0],o=e.result.object.positions[1];l.startPoint=t,l.endPoint=o;let i=window.handlerPolyline;i.polyline.show=!1,window.polylineTransparent.show=!1,i.deactivate(),tooltip.setVisible(!1)}),(e=>{console.log(e)})),window.handlerPolyline.activate()},execute:function(){l.readyPromise.then((function(e){!function(e){let t=new Image;t.src=e,t.onload=function(){let e=function(e){let t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t}(t).toDataURL("image/jpeg"),o=document.createElement("a"),l=new MouseEvent("click");o.download=(new Date).getTime()+".jpg",o.href=e,o.dispatchEvent(l)}}(e)}))},clear:p}}Dd.render=function(e,t,o,n,a,s){const c=g("el-slider"),y=r("stopdrag"),b=r("drag");return l(),i(S,null,[d(p("div",Rd,[d(p("div",xd,[p("div",Ld,[p("label",Pd,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=e=>n.earthShow=e)},null,512),[[w,n.earthShow]]),u(" "+m(e.Resource.earthShow),1)]),p("label",Vd,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>n.timeline=e)},null,512),[[w,n.timeline]]),u(" "+m(e.Resource.timeline),1)]),p("label",kd,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>n.atomsphereRender=e)},null,512),[[w,n.atomsphereRender]]),u(" "+m(e.Resource.atomsphereRender),1)]),p("label",Ed,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>n.sunShow=e)},null,512),[[w,n.sunShow]]),u(" "+m(e.Resource.sunShow),1)]),p("label",Nd,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=e=>n.fogEffect=e)},null,512),[[w,n.fogEffect]]),u(" "+m(e.Resource.fogEffect),1)]),p("label",Td,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=e=>n.depthAgainst=e)},null,512),[[w,n.depthAgainst]]),u(" "+m(e.Resource.depthAgainst),1)]),p("label",Ad,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>n.shadows=e)},null,512),[[w,n.shadows]]),u(" "+m(e.Resource.shadowMap),1)]),p("label",Bd,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>n.underground=e)},null,512),[[w,n.underground]]),u(" "+m(e.Resource.underground),1)]),p("label",Id,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=e=>n.frameRate=e)},null,512),[[w,n.frameRate]]),u(" "+m(e.Resource.frameRate),1)]),p("label",_d,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=e=>n.cloud=e)},null,512),[[w,n.cloud]]),u(" "+m(e.Resource.cloud),1)]),p("label",Fd,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=e=>n.skyBox=e)},null,512),[[w,n.skyBox]]),u(" "+m(e.Resource.skyBox),1)]),p("label",Od,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[12]||(t[12]=e=>n.rain=e)},null,512),[[w,n.rain]]),u(" "+m(e.Resource.rain),1)]),p("label",Ud,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[13]||(t[13]=e=>n.snow=e)},null,512),[[w,n.snow]]),u(" "+m(e.Resource.snow),1)]),p("label",Hd,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[14]||(t[14]=e=>n.isCompass=e)},null,512),[[w,n.isCompass]]),u(" "+m(e.Resource.compass),1)]),zd]),p("div",Gd,[p("label",Wd,m(e.Resource.viewMode),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[15]||(t[15]=e=>n.viewMode=e)},[jd,Kd,Qd],512),[[f,n.viewMode]])]),p("div",Xd,[p("label",Yd,m(e.Resource.surfaceTransparency),1),p(c,{modelValue:n.surfaceTransparency,"onUpdate:modelValue":t[16]||(t[16]=e=>n.surfaceTransparency=e),min:0,max:1,step:.01,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),d(p("div",Zd,[qd,d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[17]||(t[17]=e=>n.snowType=e)},[Jd,$d,ep,tp],512),[[f,n.snowType]])],512),[[h,!1]])],512),[[y]])],512),[[b]]),(l(),i(L(n.compass)))],64)},Dd.__file="src/components/scene/scene-attribute/scene-attribute.vue",Dd.install=function(e){e.component(Dd.name,Dd)};var lp={name:"Sm3dFacade",props:{maxDistance:{type:Number},maxHeight:{type:Number},setLodrange:{type:Boolean},lodrange:{type:Number},selectedLayerName:{type:String}},methods:{formatTooltip:e=>e+Resource.meter},setup(e){let{maxDistance:t,maxHeight:o,layerNames:l,setLodrange:i,selectedLayerName:n,lodrange:a,setRegion:s,execute:r,clear:d}=op(e);return{maxDistance:t,maxHeight:o,setLodrange:i,layerNames:l,selectedLayerName:n,lodrange:a,setRegion:s,execute:r,clear:d}}};const ip={id:"facade-panel",class:"sm-panel"},np={class:"sm-function-module-sub-section",style:{margin:"0"}},ap={class:"sm-half-L"},sp={style:{width:"35%"}},rp={class:"sm-half-L"},dp={style:{width:"35%"}},pp={class:"sm-half-L"},cp={style:{width:"100%"}},up={class:"sm-half-L"},mp={style:{width:"35%"}},yp={class:"sm-half-L"},hp={style:{width:"35%"}},wp={class:"boxchild flex-between"};function gp(o){let l,i,n=e({resetPosition:"",isfull:!1});if(n.resetPosition=new SuperMap3D.Cartesian3.fromDegrees(110.60396458865515,34.54408834959379,30644793.325518917),o)for(let e in o)n.hasOwnProperty(e)?n[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);n.isfull&&h();let r,d,p=v(null),c=!1;function u(){i=new SuperMap3D.Cartesian2,i.x=l.canvas.clientWidth/2,i.y=l.canvas.clientHeight/2,l.postRender.addEventListener(m),window.addEventListener("resize",(function(){i.x=l.canvas.clientWidth/2,i.y=l.canvas.clientHeight/2}))}function m(){let e=l.camera.heading,t="rotate("+-SuperMap3D.Math.toDegrees(e)+"deg)";p.value.style.transform=t,c&&(e<=.05||e>=6.23)&&(l.camera.stopFlyCircle(),e=0,c=!1)}function y(){let e=l.pickPosition(i),t=viewer.camera.position,o=SuperMap3D.Cartesian3.distance(e,t);return o>=1e3?o/30:o>=20?o/20:o>0?.5:0}function h(){var e;document.fullscreenElement?(n.isfull=!1,document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()):(n.isfull=!0,(e=document.documentElement).requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen())}return V.isViewer&&(l=viewer.scene,u()),s((()=>V.isViewer),(e=>{e&&(l=viewer.scene,u())})),t((()=>{l.postRender.removeEventListener(m)})),{...a(n),compass_dom:p,reduceCompass:function(){let e=l.camera.heading,t=8;if(e<=.05||e>=6.23)return;(e<=.5||e>=5.8)&&(t=2),c=!0;let o=l.pickPosition(i);if(l.camera.heading-SuperMap3D.Math.PI>=0)return l.camera.speedRatio=t,void l.camera.flyCircle(o);l.camera.speedRatio=-t,l.camera.flyCircle(o)},reset:function(){viewer.camera.flyTo({destination:n.resetPosition})},fullscreenchange:h,zoomIn:function(){let e=10;clearInterval(r),r=setInterval((()=>{e=y(),viewer.camera.zoomIn(e)}),30)},mouseup_zoomIn:function(){clearInterval(r)},zoomOut:function(){let e=10;clearInterval(d),d=setInterval((()=>{e=y(),viewer.camera.zoomOut(e)}),30)},mouseup_zoomOut:function(){clearInterval(d)}}}lp.render=function(e,t,o,n,a,s){const c=g("el-slider"),y=r("stopdrag"),b=r("drag");return d((l(),i("div",ip,[d(p("div",np,[p("div",ap,[p("label",sp,m(e.Resource.facadeDistance),1),p(c,{modelValue:n.maxDistance,"onUpdate:modelValue":t[1]||(t[1]=e=>n.maxDistance=e),min:1,max:1e3,step:1,"input-size":"mini",debounce:500,"format-tooltip":s.formatTooltip,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","format-tooltip"])]),p("div",rp,[p("label",dp,m(e.Resource.facadeHeight),1),p(c,{modelValue:n.maxHeight,"onUpdate:modelValue":t[2]||(t[2]=e=>n.maxHeight=e),min:1,max:200,step:1,"input-size":"mini",debounce:500,"format-tooltip":s.formatTooltip,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","format-tooltip"])]),p("div",pp,[p("label",cp,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>n.setLodrange=e)},null,512),[[w,n.setLodrange]]),u(" "+m(e.Resource.setLodrange),1)]),d(p("div",up,[p("label",mp,m(e.Resource.selectedLayer),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[4]||(t[4]=e=>n.selectedLayerName=e)},[(l(!0),i(S,null,R(n.layerNames,((e,t)=>(l(),i("option",{key:t,value:e},m(e),9,["value"])))),128)),d(p("option",{value:"none"},m(e.Resource.noLayer),513),[[h,0==n.layerNames.length]])],512),[[f,n.selectedLayerName]])],512),[[h,n.setLodrange]]),d(p("div",yp,[p("label",hp,m(e.Resource.lodrange),1),p(c,{modelValue:n.lodrange,"onUpdate:modelValue":t[5]||(t[5]=e=>n.lodrange=e),min:.01,max:2,step:.01,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","min","step"])],512),[[h,n.setLodrange]])]),p("div",wp,[p("button",{class:"tbtn",type:"button",style:{width:"auto"},onClick:t[6]||(t[6]=(...e)=>n.setRegion&&n.setRegion(...e))},m(e.Resource.setRegion),1),p("button",{class:"tbtn",type:"button",style:{width:"auto"},onClick:t[7]||(t[7]=(...e)=>n.execute&&n.execute(...e))},m(e.Resource.execute),1),p("button",{onClick:t[8]||(t[8]=(...e)=>n.clear&&n.clear(...e)),class:"tbtn",type:"button"},m(e.Resource.clear),1)])],512),[[y]])],512)),[[b]])},lp.__file="src/components/scene/facade/facade.vue",lp.install=function(e){e.component(lp.name,lp)};var fp={name:"Sm3dCompass",props:{isfull:{type:Boolean,default:!1}},setup(e){let{compass_dom:t,isfull:o,reduceCompass:l,reset:i,fullscreenchange:n,zoomIn:a,mouseup_zoomIn:s,zoomOut:r,mouseup_zoomOut:d}=gp(e);return{compass_dom:t,isfull:o,reduceCompass:l,reset:i,fullscreenchange:n,zoomIn:a,mouseup_zoomIn:s,zoomOut:r,mouseup_zoomOut:d}}};const bp={id:"compass-panel",class:"compass-panel"},vp={id:"compass",style:{transform:"rotate(-45deg)",display:"inline-block"},class:"iconfont iconzhibeizhen",ref:"compass_dom"},Sp=p("span",{class:"iconfont iconzhongzhi"},null,-1),Cp=p("span",{class:"iconfont iconfangda"},null,-1),Mp=p("span",{class:"iconfont iconsuoxiao"},null,-1);fp.render=function(e,t,o,n,a,s){return l(),i("div",bp,[p("div",{class:"btn_box",style:{"border-radius":"50%"},onClick:t[1]||(t[1]=(...e)=>n.reduceCompass&&n.reduceCompass(...e)),title:e.Resource.compass},[p("span",vp,null,512)],8,["title"]),p("div",{class:"btn_box",onClick:t[2]||(t[2]=(...e)=>n.reset&&n.reset(...e)),title:e.Resource.reset},[Sp],8,["title"]),p("div",{class:"btn_box",onMousedown:t[3]||(t[3]=(...e)=>n.zoomIn&&n.zoomIn(...e)),onMouseup:t[4]||(t[4]=(...e)=>n.mouseup_zoomIn&&n.mouseup_zoomIn(...e)),title:e.Resource.zoomIn},[Cp],40,["title"]),p("div",{class:"btn_box",onMousedown:t[5]||(t[5]=(...e)=>n.zoomOut&&n.zoomOut(...e)),onMouseup:t[6]||(t[6]=(...e)=>n.mouseup_zoomOut&&n.mouseup_zoomOut(...e)),title:e.Resource.zoomOut},[Mp],40,["title"]),p("div",{class:"btn_box",onClick:t[7]||(t[7]=(...e)=>n.fullscreenchange&&n.fullscreenchange(...e)),title:e.Resource.fullScreen},[p("span",{class:["iconfont",n.isfull?"iconshouqi1":"iconquanping"]},null,2)],8,["title"])])},fp.__file="src/components/scene/compass/compass.vue",fp.install=function(e){e.component(fp.name,fp)};class Dp{constructor(){}createXMLflyLine(e){let t=new DOMParser;window.parser=t;let o=t.parseFromString("<cusxmlRoute></cusxmlRoute>","text/xml");window.xmlDoc=o;let l=this.createSceneRouteNode(o),i=this.createRouteNode(o,e),n=this.createRouteStyleNode(o);i.appendChild(n);let a=this,s=e.routeStops;if(!(s.length<2)){for(let e=0;e<s.length;e++){let t=s[e],l={longitude:t.point[0],latitude:t.point[1],altitude:t.point[2],heading:t.heading*(180/Math.PI),tilt:t.tilt*(180/Math.PI)+90},n=a.createStopNode(o,l,t,e);i.appendChild(n)}return l.appendChild(i),o.children[0].appendChild(l),o.children[0].innerHTML}console.warn("节点数小于2")}createSceneRouteNode(e){let t=e.createElement("SceneRoute");return t.setAttribute("xmlns","http://www.supermap.com.cn/ugc60"),t}createRouteNode(e,t){let o=e.createElement("route"),l={name:t.routeName||"飞行路线",speed:t.speed||"200",lineType:"0",showroutestop:"False",showrouteline:"False",altitudefree:"False",headingfree:"False",tiltfree:"False",flycircle:"False",alongline:t.isAlongLine||"False"};for(const e in l)o.setAttribute(e,l[e]);return o}createRouteStyleNode(e){let t=e.createElement("style"),o=e.createElement("geostyle3d"),l=e.createElement("linecolor");l.textContent="RGBA(147,112,219,255)";let i=e.createElement("linewidth");i.textContent=2;let n=e.createElement("altitudeMode");n.textContent="Absolute";let a=e.createElement("bottomAltitude");return a.textContent=0,o.appendChild(l),o.appendChild(i),o.appendChild(n),o.appendChild(a),t.appendChild(o),t}createStopNode(e,t,o,l){let i=e.createElement("routestop"),n={name:o.stopName||"Stop"+(l+1),speed:o.speed,excluded:"False",viewType:"camera"};for(const e in n)i.setAttribute(e,n[e]);let a=this.createStopCameraNode(e,t);i.appendChild(a);let s=this.createStopStyleNode(e);i.appendChild(s);let r=this.createStopSettingNode(e,o);return i.appendChild(r),i}createStopCameraNode(e,t){let o=e.createElement("camera");for(const l in t){let i=e.createElement(l);i.textContent=t[l],o.appendChild(i)}return o}createStopStyleNode(e){let t={icon:"",markersize:4.8,markericonscale:1,markercolor:"RGBA(255, 255, 255, 255)"},o=e.createElement("style"),l=e.createElement("geostyle3d");for(const o in t){let i=e.createElement(o);i.textContent=t[o],l.appendChild(i)}return o.appendChild(l),o}createStopSettingNode(e,t){let o=e.createElement("setting"),l={turnTime:t.surroundDuration||1.5,turnSlowly:"False",stopPlayMode:t.stopPlayMode||"StopPause",autoPlay:"False",pauseTime:t.waitTime||0,angularSpeed:1};for(const t in l){let i=e.createElement(t);i.textContent=l[t],o.appendChild(i)}return o}}function Rp(l){let i,n,r=e({routeType:"designatedRoute",fileSrc:"",fpfUrl:null,selectedStopIndex:0,showRoute:!1,showStop:!1,currentStopNames:[],customRouteNames:[],customRouteSelectedIndex:null,routeStops:[],selectedAddedStopIndex:null,setStopName:"Stop-1",setStopSpeed:0,stopPlayMode:"StopPause",waitTime:0,surroundDuration:1,isAlongline:!1,routeSpeed:200});if(l)for(let e in l)r.hasOwnProperty(e)?r[e]=l[e]:we.Message.errorMsg(ce.AttributeError+e);let d,p,c=v(null),u=new FileReader,m=[];function y(){n=new SuperMap3D.RouteCollection(viewer.entities),i=new SuperMap3D.FlyManager({scene:viewer.scene,routes:n}),p=new Dp,r.fpfUrl&&h()}function h(){i.stop(),n.fromFile(r.fpfUrl),i.readyPromise.then((function(){let e=i.currentRoute;e.isLineVisible=r.showRoute,e.isStopVisible=r.showStop,g()}))}function w(){n.readyPromise.then((()=>{i.routes=n;let e=i.currentRoute;e.isLineVisible=r.showRoute,e.isStopVisible=r.showStop,g()}))}function g(){r.currentStopNames.length=0,d=i.getAllRouteStops();for(let e=0,t=d.length;e<t;e++){let t=d[e].stopName||"Stop"+(e+1);r.currentStopNames.push(t)}}function f(){if(i.stop(),m.length<1)return;if(m.splice(r.customRouteSelectedIndex,1),r.customRouteNames.splice(r.customRouteSelectedIndex,1),m.length>0)return void(r.customRouteSelectedIndex=0);r.customRouteSelectedIndex=null,r.currentStopNames.length=0;let e=i.currentRoute;e&&e.clear()}return V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element)),y()),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)),y())})),o((()=>{c.value.addEventListener("change",(e=>{i.stop();let t=i.currentRoute;t&&t.clear(),n=new SuperMap3D.RouteCollection(viewer.entities);let o=e.target.files[0];o&&(r.fileSrc=c.value.value,u.onload=function(e){let t=e.target.result;n.fromXML(t)},u.readAsBinaryString(o),w())}))})),s((()=>r.selectedStopIndex),(e=>{i&&i.stop();let t=Number(e),o=d[t];i.viewToStop(o)})),s((()=>r.showRoute),(e=>{let t=i.currentRoute;t&&(t.isLineVisible=e)})),s((()=>r.showStop),(e=>{let t=i.currentRoute;t&&(t.isStopVisible=e)})),s((()=>r.fpfUrl),(e=>{h()})),s((()=>r.customRouteSelectedIndex),(e=>{if(null===e)return;i&&i.stop();let t=i.currentRoute;t&&t.clear(),n=new SuperMap3D.RouteCollection(viewer.entities),n.fromXML(m[e]),w()})),s((()=>r.selectedAddedStopIndex),(e=>{let t=r.routeStops[e];t&&viewer.camera.setView({destination:SuperMap3D.Cartesian3.fromDegrees(t.point[0],t.point[1],t.point[2]),orientation:{heading:t.heading,pitch:t.tilt,roll:0}})})),s((()=>r.routeType),(e=>{"customRoute"===e?(window.tooltip.showAt(" <p>调整当前相机位置和视角</p><p>以当前相机位置和视角设置站点</p><p>点击添加保存此站点</p>","80%"),setTimeout((()=>{window.tooltip.setVisible(!1)}),5e3)):window.tooltip.setVisible(!1);let t=i.currentRoute;t&&(t.isLineVisible=!1,t.isStopVisible=!1)})),t((()=>{r=null,i=n=null,d=null,p=m=null})),{...a(r),flyFile_dom:c,chooseFile:function(){c.value.click()},flyStart:function(){i.readyPromise.then((()=>{i.play()}))},flyPause:function(){i&&i.pause()},flyStop:function(){i&&i.stop()},addStop:function(){i.stop();let e=viewer.camera.position,t=we.CartesiantoDegrees(e),o={stopName:r.setStopName,point:t,heading:viewer.camera.heading,tilt:viewer.camera.pitch,speed:r.setStopSpeed,stopPlayMode:r.stopPlayMode,surroundDuration:r.surroundDuration,waitTime:r.waitTime};if(r.routeStops.push(o),r.routeStops.length>0){let e=r.routeStops.length,t=r.routeStops[e-1].stopName.split("-")[1]||1,o="Stop-"+(Number(t)+1);r.setStopName=o}r.selectedAddedStopIndex=r.routeStops.length-1},saveStop:function(){if(r.routeStops.length<2)return void we.Message.warnMsg("节点小于2");m.length>0&&f();let e={routeName:"飞行路线_"+(m.length+1),speed:r.routeSpeed,isAlongLine:"False",routeStops:r.routeStops},t=p.createXMLflyLine(e);m.push(t),r.customRouteNames.push(e.routeName),null===r.customRouteSelectedIndex&&(r.customRouteSelectedIndex=0)},restStops:function(){r.routeStops.length=0,r.setStopName="Stop-1",r.setStopSpeed=0,r.stopPlayMode="StopPause",r.waitTime=0,r.surroundDuration=1},downLoad:function(){let e=m[r.customRouteSelectedIndex];if(!e)return;let t=new Blob([e]),o=document.createElement("a");o.download="fly-route.fpf",o.href=URL.createObjectURL(t),o.click()},clearRoute:f,clearStop:function(){r.routeStops.splice(r.selectedAddedStopIndex,1),r.routeStops.length>0?r.selectedAddedStopIndex=r.routeStops.length-1:(r.selectedAddedStopIndex=null,r.setStopName="Stop-1")}}}var xp={name:"Sm3dFlyRoute",props:{fpfUrl:{type:String},showRoute:{type:Boolean},showStop:{type:Boolean},stopPlayMode:{type:String},waitTime:{type:Number},surroundDuration:{type:Number},isAlongline:{type:Boolean},routeSpeed:{type:Number}},setup(e){let{routeType:t,fileSrc:o,fpfUrl:l,selectedStopIndex:i,showRoute:n,showStop:a,flyFile_dom:s,chooseFile:r,currentStopNames:d,flyStart:p,flyPause:c,flyStop:u,routeStops:m,selectedAddedStopIndex:y,routeSpeed:h,clearStop:w,addStop:g,saveStop:f,restStops:b,customRouteNames:v,customRouteSelectedIndex:S,downLoad:C,clearRoute:M}=Rp(e);return{routeType:t,fileSrc:o,fpfUrl:l,selectedStopIndex:i,showRoute:n,showStop:a,flyFile_dom:s,chooseFile:r,currentStopNames:d,flyStart:p,flyPause:c,flyStop:u,routeStops:m,selectedAddedStopIndex:y,routeSpeed:h,clearStop:w,addStop:g,saveStop:f,restStops:b,customRouteNames:v,customRouteSelectedIndex:S,downLoad:C,clearRoute:M}}};const Lp={id:"fly-route-panel",class:"sm-panel"},Pp={class:"sm-function-module-sub-section",style:{margin:"0"}},Vp={class:"sm-half-L"},kp={style:{width:"auto"}},Ep={style:{width:"auto"}},Np={class:"sm-half-L"},Tp={class:"sm-half-L"},Ap={style:{width:"35%"}},Bp={type:"file",accept:".fpf",id:"flyFile",style:{display:"none"},ref:"flyFile_dom"},Ip={class:"sm-half-L"},_p={style:{width:"35%"}},Fp={class:"sm-half-L flex-between"},Op={style:{width:"auto"}},Up={style:{width:"auto"}},Hp={class:"sm-half-L flex-around"},zp={class:"sm-half-L"},Gp={class:"sm-half-L"},Wp={style:{width:"35%"}},jp={class:"sm-half-L"},Kp={style:{width:"35%"}},Qp={class:"boxchild"},Xp={class:"sm-half-L"},Yp={style:{margin:"15px 0 5px 0"}},Zp=p("div",{class:"sm-point"},null,-1),qp={class:"sm-half-L"},Jp={style:{width:"35%"}},$p={class:"sm-half-L"},ec={style:{width:"35%"}},tc={class:"sm-half-L flex-between"},oc={style:{width:"auto"}},lc={style:{width:"auto"}},ic={class:"sm-half-L flex-around"},nc={class:"boxchild",style:{"margin-bottom":"-5px"}};xp.render=function(e,t,o,n,a,s){const g=r("stopdrag"),v=r("drag");return d((l(),i("div",Lp,[d(p("div",Pp,[p("div",Vp,[p("label",kp,[d(p("input",{type:"radio",value:"designatedRoute","onUpdate:modelValue":t[1]||(t[1]=e=>n.routeType=e)},null,512),[[c,n.routeType]]),u(" "+m(e.Resource.designatedRoute),1)]),p("label",Ep,[d(p("input",{type:"radio",value:"customRoute","onUpdate:modelValue":t[2]||(t[2]=e=>n.routeType=e)},null,512),[[c,n.routeType]]),u(" "+m(e.Resource.customRoute),1)])]),b(" 指定路线面板 "),d(p("div",Np,[d(p("div",Tp,[p("label",Ap,m(e.Resource.routeType),1),d(p("input",{type:"text",class:"sm-input",disabled:"",style:{width:"63%",position:"relative","padding-right":"30px"},"onUpdate:modelValue":t[3]||(t[3]=e=>n.fileSrc=e),placeholder:"选择飞行线路文件"},null,512),[[y,n.fileSrc]]),p("span",{class:"iconfont iconwenjianjia fpfFile",onClick:t[4]||(t[4]=(...e)=>n.chooseFile&&n.chooseFile(...e))}),p("input",Bp,null,512)],512),[[h,!n.fpfUrl]]),d(p("div",Ip,[p("label",_p,m(e.Resource.selectStop),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[5]||(t[5]=e=>n.selectedStopIndex=e)},[(l(!0),i(S,null,R(n.currentStopNames,((e,t)=>(l(),i("option",{value:t,key:t},m(e),9,["value"])))),128))],512),[[f,n.selectedStopIndex]])],512),[[h,n.currentStopNames.length>0]]),p("div",Fp,[p("label",Op,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=e=>n.showRoute=e)},null,512),[[w,n.showRoute]]),u(" "+m(e.Resource.showRoute),1)]),p("label",Up,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>n.showStop=e)},null,512),[[w,n.showStop]]),u(" "+m(e.Resource.showStop),1)])]),p("div",Hp,[p("div",null,[p("span",{class:"iconfont iconbofang",style:{"font-size":"32px",color:"var(--theme-bg-color)"},onClick:t[8]||(t[8]=(...e)=>n.flyStart&&n.flyStart(...e)),title:e.Resource.start},null,8,["title"])]),p("div",null,[p("span",{class:"iconfont iconzanting",style:{"font-size":"32px",color:"var(--theme-bg-color)"},onClick:t[9]||(t[9]=(...e)=>n.flyPause&&n.flyPause(...e)),title:e.Resource.pause},null,8,["title"])]),p("div",null,[p("span",{class:"iconfont icontingzhi",style:{"font-size":"32px",color:"var(--theme-bg-color)"},onClick:t[10]||(t[10]=(...e)=>n.flyStop&&n.flyStop(...e)),title:e.Resource.stop},null,8,["title"])])])],512),[[h,"designatedRoute"===n.routeType]]),b(" 自定义路线面板 "),d(p("div",zp,[d(p("div",null,[p("div",Gp,[p("label",Wp,m(e.Resource.flySpeed),1),d(p("input",{type:"number",class:"sm-input",style:{width:"63%"},"onUpdate:modelValue":t[11]||(t[11]=e=>n.routeSpeed=e)},null,512),[[y,n.routeSpeed]])]),d(p("div",jp,[p("label",Kp,m(e.Resource.addedStops),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[12]||(t[12]=e=>n.selectedAddedStopIndex=e)},[(l(!0),i(S,null,R(n.routeStops,((e,t)=>(l(),i("option",{value:t,key:t},m(e.stopName),9,["value"])))),128))],512),[[f,n.selectedAddedStopIndex]])],512),[[h,n.routeStops.length>0]]),p("div",Qp,[p("button",{onClick:t[13]||(t[13]=(...e)=>n.addStop&&n.addStop(...e)),class:"tbtn",type:"button"},m(e.Resource.add),1),p("button",{onClick:t[14]||(t[14]=(...e)=>n.clearStop&&n.clearStop(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.delete),1),p("button",{onClick:t[15]||(t[15]=(...e)=>n.restStops&&n.restStops(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.reset),1),p("button",{onClick:t[16]||(t[16]=(...e)=>n.saveStop&&n.saveStop(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.save),1)])],512),[[h,0==n.customRouteNames.length]]),b(' 保存飞行路线操作  v-show="customRouteNames.length>0" '),d(p("div",Xp,[p("div",Yp,[Zp,u(" "+m(e.Resource.customRouteOperating),1)]),p("div",qp,[p("label",Jp,m(e.Resource.routeType),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[17]||(t[17]=e=>n.customRouteSelectedIndex=e)},[(l(!0),i(S,null,R(n.customRouteNames,((e,t)=>(l(),i("option",{value:t,key:t},m(e),9,["value"])))),128))],512),[[f,n.customRouteSelectedIndex]])]),d(p("div",$p,[p("label",ec,m(e.Resource.selectStop),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[18]||(t[18]=e=>n.selectedStopIndex=e)},[(l(!0),i(S,null,R(n.currentStopNames,((e,t)=>(l(),i("option",{value:t,key:t},m(e),9,["value"])))),128))],512),[[f,n.selectedStopIndex]])],512),[[h,n.currentStopNames.length>0]]),p("div",tc,[p("label",oc,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[19]||(t[19]=e=>n.showRoute=e)},null,512),[[w,n.showRoute]]),u(" "+m(e.Resource.showRoute),1)]),p("label",lc,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[20]||(t[20]=e=>n.showStop=e)},null,512),[[w,n.showStop]]),u(" "+m(e.Resource.showStop),1)])]),p("div",ic,[p("div",null,[p("span",{class:"iconfont iconbofang",style:{"font-size":"32px",color:"var(--theme-bg-color)"},onClick:t[21]||(t[21]=(...e)=>n.flyStart&&n.flyStart(...e)),title:e.Resource.start},null,8,["title"])]),p("div",null,[p("span",{class:"iconfont iconzanting",style:{"font-size":"32px",color:"var(--theme-bg-color)"},onClick:t[22]||(t[22]=(...e)=>n.flyPause&&n.flyPause(...e)),title:e.Resource.pause},null,8,["title"])]),p("div",null,[p("span",{class:"iconfont icontingzhi",style:{"font-size":"32px",color:"var(--theme-bg-color)"},onClick:t[23]||(t[23]=(...e)=>n.flyStop&&n.flyStop(...e)),title:e.Resource.stop},null,8,["title"])]),p("div",nc,[p("button",{onClick:t[24]||(t[24]=(...e)=>n.downLoad&&n.downLoad(...e)),class:"tbtn",type:"button"},m(e.Resource.downLoad),1),p("button",{onClick:t[25]||(t[25]=(...e)=>n.clearRoute&&n.clearRoute(...e)),class:"tbtn tbtn-margin-left",type:"button"},m(e.Resource.clear),1)])])],512),[[h,n.customRouteNames.length>0]])],512),[[h,"customRoute"===n.routeType]])],512),[[g]])],512)),[[v]])},xp.__file="src/components/fly/fly-route/fly-route.vue",xp.install=function(e){e.component(xp.name,xp)};var ac={Iron:"铁",Steel:"钢",Aluminum:"铝",Bronze:"铜",Ceramic:"陶瓷",Concrete:"混凝土",Rubber:"橡胶",Glass:"玻璃",Paint:"油漆",Plastic:"塑料",SelfLuminous:"自发光",Wood:"木材",PVC_White:"PVC"};function sc(o){let l,i,n=e({layerNames:[],selectedLayerName:"none",selectedPbr:"Iron"});if(o)for(let e in o)n.hasOwnProperty(e)?n[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);function r(){viewer.scene,l=viewer.scene.layers.layerQueue,l&&l.length>0&&(l.forEach(((e,t)=>{n.layerNames.includes(e._name)||n.layerNames.push(e._name)})),(n.selectedLayerName="none")&&(n.selectedLayerName=n.layerNames[0],i=l[0])),viewer.terrainProvider instanceof SuperMap3D.EllipsoidTerrainProvider||n.layerNames.includes("地形")||(n.layerNames.push("地形"),(n.selectedLayerName="none")&&(n.selectedLayerName=n.layerNames[0]))}return V.isViewer&&r(),s((()=>V.isViewer),(e=>{e&&r()})),s((()=>V.changeLayers),(e=>{r()})),t((()=>{l=null})),s((()=>n.selectedLayerName),(e=>{if("地形"===e)return;let t=n.layerNames.indexOf(e);i=-1!=t?l[t]:void 0})),{...a(n),pbrLibrary:ac,addPBR:function(){let e="public/data/pbr/jsons/"+n.selectedPbr+".json";"地形"!==n.selectedLayerName?i&&i.setPBRMaterialFromJSON(e):viewer.scene.globe.setPBRMaterialFromJSON(e)},clear:function(){"地形"!==n.selectedLayerName?i&&i.removePBRMaterial():viewer.scene.globe.removePBRMaterial()}}}var rc={name:"Sm3dAddPbr",props:{selectedLayerName:{type:String}},setup(e){let{layerNames:t,selectedLayerName:o,pbrLibrary:l,selectedPbr:i,addPBR:n,clear:a}=sc(e);return{layerNames:t,selectedLayerName:o,pbrLibrary:l,selectedPbr:i,addPBR:n,clear:a}}};const dc={id:"pbr-panel",class:"sm-panel"},pc={class:"sm-function-module-sub-section",style:{margin:"0"}},cc={class:"sm-half-L"},uc={style:{width:"35%"}},mc={class:"sm-half-L"},yc={style:{width:"35%"}},hc={class:"boxchild"};rc.render=function(e,t,o,n,a,s){const c=r("stopdrag"),u=r("drag");return d((l(),i("div",dc,[d(p("div",pc,[p("div",cc,[p("label",uc,m(e.Resource.selectedLayer),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.selectedLayerName=e)},[(l(!0),i(S,null,R(n.layerNames,((e,t)=>(l(),i("option",{key:t,value:e},m(e),9,["value"])))),128)),d(p("option",{value:"none"},m(e.Resource.noLayer),513),[[h,0==n.layerNames.length]])],512),[[f,n.selectedLayerName]])]),p("div",mc,[p("label",yc,m(e.Resource.selectedPbr),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[2]||(t[2]=e=>n.selectedPbr=e)},[(l(!0),i(S,null,R(n.pbrLibrary,((e,t,o)=>(l(),i("option",{key:o,value:t},m(e),9,["value"])))),128))],512),[[f,n.selectedPbr]])]),p("div",hc,[p("button",{type:"button",class:"tbtn",onClick:t[3]||(t[3]=(...e)=>n.addPBR&&n.addPBR(...e))},m(e.Resource.add),1),p("button",{type:"button",class:"tbtn tbtn-margin-left",onClick:t[4]||(t[4]=(...e)=>n.clear&&n.clear(...e))},m(e.Resource.clear),1)])],512),[[c]])],512)),[[u]])},rc.__file="src/components/layer/pbr-material/pbr-material.vue",rc.install=function(e){e.component(rc.name,rc)};var wc={polyline:[{id:"1",iconfont:"iconshixian",lineName:"实线"},{id:"2",iconfont:"iconxuxian",lineName:"虚线"},{id:"3",iconfont:"iconlunkuoxian",lineName:"轮廓线"},{id:"4",iconfont:"iconjiantouxian",lineName:"箭头线"},{id:"5",iconfont:"iconguangyunxian",lineName:"光晕线"},{id:"6",iconfont:"iconweijixian",lineName:"尾迹线"},{},{}],polygon:[{id:"1",iconfont:"iconchunse",faceName:"纯色"},{id:"2",iconfont:"iconwangge",faceName:"网格"},{id:"3",iconfont:"icontiaowen",faceName:"条纹"}]};function gc(o){let l,i,n=e({drawModle:"space",currentId:"1",config:wc,lineColor:"rgba(250, 196, 65, 1)",lineWidth:5,dottedColor:"rgba(250, 196, 65, 0)",dottedLength:30,outLineColor:"rgba(29, 206, 200, 1)",outLineWidth:2,glowStrength:.5,trailPercentage:.3,trailPeroid:2,isEdit:!0,isEditZ:!1,drawType:"polyline",solidColor:"rgba(250, 196, 65, 1)",gridColor:"rgba(250, 196, 65, 1)",gridWidth:1,gridCount:8,gridCellAlpha:.1,stripeEvenColor:"#FFFFFF",stripeOddColor:"#000000",stripeRepeat:12,stripeOffset:0,stripeOrientation:"horizontal"});if(o)for(let e in o)n.hasOwnProperty(e)?n[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let r,d,p,c=!0;SuperMap3D.ClassificationType.TERRAIN;function u(){window.handlerPolyline||ge("Polyline"),window.tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>右键单击结束分析</p><p>选中对象进行编辑或清除</p>","50%"),fe("Polyline").then((e=>{!function(e){let t,o=SuperMap3D.Color.fromCssColorString(n.lineColor),a=Number(n.lineWidth);switch(n.currentId){case"1":t=o;break;case"2":let e=SuperMap3D.Color.fromCssColorString(n.dottedColor),l=Number(n.dottedLength);t=new SuperMap3D.PolylineDashMaterialProperty({color:o,gapColor:e,dashLength:l});break;case"3":let i=SuperMap3D.Color.fromCssColorString(n.outLineColor),a=Number(n.outLineWidth);t=new SuperMap3D.PolylineOutlineMaterialProperty({color:o,outlineWidth:a,outlineColor:i});break;case"4":t=new SuperMap3D.PolylineArrowMaterialProperty(o);break;case"5":let s=Number(n.glowStrength);t=new SuperMap3D.PolylineGlowMaterialProperty({glowPower:s,color:o});break;case"6":let r=Number(n.trailPercentage);t=new SuperMap3D.PolylineTrailMaterialProperty({color:o,trailLength:r,period:n.trailPeroid});break;default:t=o}r=viewer.entities.add({id:"polyline-symbol-line-"+(new Date).getTime(),polyline:{positions:e,width:a,material:t,clampToGround:l,classificationType:i,height:p}})}(e.result.object.positions);let t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),tooltip.setVisible(!1)}),(e=>{console.log(e)})),window.handlerPolyline.activate()}function m(e){let t=viewer.scene.pick(e.message.position);t&&t.id&&t.id.id&&"string"==typeof t.id.id&&(-1!=t.id.id.indexOf("polyline-symbol-line")&&(r=t.id),-1!=t.id.id.indexOf("polygon-symbol-gon")&&(d=t.id))}function y(e,t,o){l=e,i=t,p=o,r&&(r.polyline.clampToGround=l,r.polyline.classificationType=i,r.polyline.height=o)}function h(e,t,o){c=e,i=t,p=o,d&&(d.polygon.perPositionHeight=c,d.classificationType=i,d.polygon.height=o)}return V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element)),viewer.eventManager.addEventListener("CLICK",m,!1),De()),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)),viewer.eventManager.addEventListener("CLICK",m,!1),De())})),t((()=>{viewer&&viewer.eventManager.removeEventListener("CLICK",m)})),s((()=>n.drawModle),(e=>{let t="polyline"===n.drawType;switch(e){case"space":t?y(void 0,void 0,void 0):h(!0,void 0,void 0);break;case"stick":t?y(!0,SuperMap3D.ClassificationType.TERRAIN,0):h(!1,SuperMap3D.ClassificationType.TERRAIN,0);break;case"postObject":t?y(!0,SuperMap3D.ClassificationType.S3M_TILE,void 0):h(!1,SuperMap3D.ClassificationType.S3M_TILE,void 0);break;default:y(void 0,void 0,void 0),h(!0,!1,void 0)}})),s((()=>n.lineColor),(e=>{let t=SuperMap3D.Color.fromCssColorString(e);r&&(r.polyline.material.color=t)})),s((()=>n.lineWidth),(e=>{r&&(r.polyline.width=Number(e))})),s((()=>n.dottedColor),(e=>{let t=SuperMap3D.Color.fromCssColorString(e);r&&(r.polyline.material.gapColor=t)})),s((()=>n.dottedLength),(e=>{r&&(r.polyline.material.dashLength=Number(e))})),s((()=>n.outLineColor),(e=>{let t=SuperMap3D.Color.fromCssColorString(e);r&&(r.polyline.material.outlineColor=t)})),s((()=>n.outLineWidth),(e=>{r&&(r.polyline.material.outlineWidth=Number(e))})),s((()=>n.glowStrength),(e=>{r&&(r.polyline.material.glowPower=Number(e))})),s((()=>n.trailPercentage),(e=>{r&&(r.polyline.material.trailLength=Number(e))})),s((()=>n.isEdit),(e=>{r&&(e?De():Re())})),s((()=>n.isEditZ),(e=>{r&&window.editHandler&&(window.editHandler.isEditZ=e)})),s((()=>n.drawType),(e=>{n.currentId="1"})),s((()=>n.solidColor),(e=>{let t=SuperMap3D.Color.fromCssColorString(e);d&&(d.polygon.material=t)})),s((()=>n.gridColor),(e=>{let t=SuperMap3D.Color.fromCssColorString(e);d&&(d.polygon.material.color=t)})),s((()=>n.gridWidth),(e=>{d&&(d.polygon.material.lineThickness=new SuperMap3D.Cartesian2(Number(e),Number(e)))})),s((()=>n.gridCount),(e=>{d&&(d.polygon.material.lineCount=new SuperMap3D.Cartesian2(Number(e),Number(e)))})),s((()=>n.gridCellAlpha),(e=>{d&&(d.polygon.material.cellAlpha=Number(e))})),s((()=>n.stripeEvenColor),(e=>{let t=SuperMap3D.Color.fromCssColorString(e);d&&(d.polygon.material.evenColor=t)})),s((()=>n.stripeOddColor),(e=>{let t=SuperMap3D.Color.fromCssColorString(e);d&&(d.polygon.material.oddColor=t)})),s((()=>n.stripeRepeat),(e=>{d&&(d.polygon.material.repeat=Number(e))})),s((()=>n.stripeOffset),(e=>{d&&(d.polygon.material.offset=Number(e))})),s((()=>n.stripeOrientation),(e=>{if(!d)return;let t="horizontal"===e?0:1;d.polygon.material.orientation=t})),{...a(n),draw:function(){"polyline"===n.drawType?u():function(){window.handlerPolygon||ge("Polygon");fe("Polygon",!1).then((e=>{let t=window.handlerPolygon;!function(e){let t;switch(console.log(e),n.currentId){case"1":t=SuperMap3D.Color.fromCssColorString(n.solidColor);break;case"2":let e=SuperMap3D.Color.fromCssColorString(n.gridColor),o=Number(n.gridWidth),l=Number(n.gridCount),i=Number(n.gridCellAlpha);t=new SuperMap3D.GridMaterialProperty({color:e,cellAlpha:i,lineCount:new SuperMap3D.Cartesian2(l,l),lineThickness:new SuperMap3D.Cartesian2(o,o)});break;case"3":let a=SuperMap3D.Color.fromCssColorString(n.stripeEvenColor),s=SuperMap3D.Color.fromCssColorString(n.stripeOddColor),r=Number(n.stripeRepeat),d=Number(n.stripeOffset);t=new SuperMap3D.StripeMaterialProperty({evenColor:a,oddColor:s,repeat:r,offset:d,orientation:"horizontal"===n.stripeOrientation?0:1})}d=viewer.entities.add({id:"polygon-symbol-gon-"+(new Date).getTime(),polygon:{hierarchy:{positions:e},material:t,perPositionHeight:c,groundBottomAltitude:0,groundExtrudedHeight:100},classificationType:i,height:p})}(e.result.object.positions),t.polygon.show=!1,t.polyline.show=!1,t.deactivate()}),(e=>{console.log(e)})),window.handlerPolygon.activate()}()},changeSelect:function(e){n.currentId=e},clear:function(){r&&"polyline"===n.drawType&&viewer.entities.removeById(r.id),d&&"polygon"===n.drawType&&viewer.entities.removeById(d.id),window.tooltip.setVisible(!1),be("Polyline"),be("Polygon"),window.editHandler&&window.editHandler.clear(),n.isEdit=!1,n.isEditZ=!1}}}var fc={name:"Sm3dDrawLinePolygon",props:{},setup(e){let{drawModle:t,currentId:o,lineColor:l,lineWidth:i,config:n,draw:a,changeSelect:s,clear:r,isEdit:d,isEditZ:p,dottedColor:c,dottedLength:u,outLineColor:m,outLineWidth:y,glowStrength:h,trailPercentage:w,drawType:g,solidColor:f,gridColor:b,gridWidth:v,gridCount:S,gridCellAlpha:C,stripeEvenColor:M,stripeOddColor:D,stripeRepeat:R,stripeOffset:x,stripeOrientation:L}=gc(e);return{drawModle:t,currentId:o,lineColor:l,lineWidth:i,config:n,draw:a,changeSelect:s,clear:r,isEdit:d,isEditZ:p,dottedColor:c,dottedLength:u,outLineColor:m,outLineWidth:y,glowStrength:h,trailPercentage:w,drawType:g,solidColor:f,gridColor:b,gridWidth:v,gridCount:S,gridCellAlpha:C,stripeEvenColor:M,stripeOddColor:D,stripeRepeat:R,stripeOffset:x,stripeOrientation:L}}};const bc={id:"draw-panel",class:"sm-panel"},vc={class:"sm-function-module-sub-section",style:{margin:"0"}},Sc={class:"sm-half-L"},Cc={style:{width:"auto"}},Mc={style:{width:"auto"}},Dc={class:"sm-half-L"},Rc={style:{width:"35%"}},xc={value:"space"},Lc={value:"stick"},Pc={value:"postObject"},Vc={class:"sm-half-L"},kc={style:{width:"auto"}},Ec={style:{width:"auto"}},Nc={style:{width:"100%"}},Tc={class:"sm-half-L symbolic"},Ac={style:{width:"100%"}},Bc={class:"sm-half-L"},Ic={style:{width:"35%"}},_c={class:"sm-half-L"},Fc={style:{width:"35%"}},Oc={class:"sm-half-L"},Uc={style:{width:"35%"}},Hc={class:"sm-half-L"},zc={style:{width:"35%"}},Gc={class:"sm-half-L"},Wc={style:{width:"35%"}},jc={class:"sm-half-L"},Kc={style:{width:"35%"}},Qc={class:"sm-half-L"},Xc={style:{width:"35%"}},Yc={class:"sm-half-L"},Zc={style:{width:"35%"}},qc={style:{width:"100%"}},Jc={class:"sm-half-L symbolic"},$c={style:{width:"100%"}},eu={class:"sm-half-L"},tu={style:{width:"35%"}},ou={class:"sm-half-L"},lu={style:{width:"35%"}},iu={class:"sm-half-L"},nu={style:{width:"35%"}},au={class:"sm-half-L"},su={style:{width:"35%"}},ru={class:"sm-half-L"},du={style:{width:"35%"}},pu={class:"sm-half-L"},cu={style:{width:"35%"}},uu={class:"sm-half-L"},mu={style:{width:"35%"}},yu={class:"sm-half-L"},hu={style:{width:"35%"}},wu={class:"sm-half-L"},gu={style:{width:"35%"}},fu={class:"sm-half-L"},bu={style:{width:"auto"}},vu={style:{width:"auto"}},Su={class:"boxchild"};fc.render=function(e,t,o,n,a,s){const v=g("el-color-picker"),C=r("stopdrag"),M=r("drag");return d((l(),i("div",bc,[d(p("div",vc,[p("div",Sc,[p("label",Cc,[d(p("input",{type:"radio",value:"polyline","onUpdate:modelValue":t[1]||(t[1]=e=>n.drawType=e)},null,512),[[c,n.drawType]]),u(" "+m(e.Resource.polyline),1)]),p("label",Mc,[d(p("input",{type:"radio",value:"polygon","onUpdate:modelValue":t[2]||(t[2]=e=>n.drawType=e)},null,512),[[c,n.drawType]]),u(" "+m(e.Resource.polygon),1)])]),p("div",Dc,[p("label",Rc,m(e.Resource.drawModle),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[3]||(t[3]=e=>n.drawModle=e)},[p("option",xc,m(e.Resource.space),1),p("option",Lc,m(e.Resource.stick),1),p("option",Pc,m(e.Resource.postObject),1)],512),[[f,n.drawModle]])]),p("div",Vc,[p("label",kc,[d(p("input",{type:"checkbox",style:{"margin-right":"14px"},"onUpdate:modelValue":t[4]||(t[4]=e=>n.isEdit=e)},null,512),[[w,n.isEdit]]),u(" "+m(e.Resource.isEdit),1)]),p("label",Ec,[d(p("input",{type:"checkbox",style:{"margin-right":"14px"},"onUpdate:modelValue":t[5]||(t[5]=e=>n.isEditZ=e)},null,512),[[w,n.isEditZ]]),u(" "+m(e.Resource.isEditZ),1)])]),b(" 线 "),d(p("div",Nc,[p("div",Tc,[(l(!0),i(S,null,R(n.config.polyline,(e=>(l(),i("div",{key:e.id,class:["symbolic-box",{"theme-color":e.id===n.currentId}],onClick:t=>n.changeSelect(e.id)},[p("span",{class:["iconfont",e.iconfont]},null,2),p("label",Ac,m(e.lineName),1)],10,["onClick"])))),128))]),p("div",Bc,[p("label",Ic,m(e.Resource.lineColor),1),p(v,{modelValue:n.lineColor,"onUpdate:modelValue":t[6]||(t[6]=e=>n.lineColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])]),p("div",_c,[p("label",Fc,m(e.Resource.lineWidth),1),d(p("input",{type:"number",class:"sm-input",style:{width:"63%"},"onUpdate:modelValue":t[7]||(t[7]=e=>n.lineWidth=e)},null,512),[[y,n.lineWidth]])]),b(" 虚线 "),d(p("div",Oc,[p("label",Uc,m(e.Resource.dottedColor),1),p(v,{modelValue:n.dottedColor,"onUpdate:modelValue":t[8]||(t[8]=e=>n.dottedColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])],512),[[h,"2"===n.currentId]]),d(p("div",Hc,[p("label",zc,m(e.Resource.dottedLength),1),d(p("input",{type:"number",min:"0",class:"sm-input",style:{width:"63%"},"onUpdate:modelValue":t[9]||(t[9]=e=>n.dottedLength=e)},null,512),[[y,n.dottedLength]])],512),[[h,"2"===n.currentId]]),b(" 轮廓线 "),d(p("div",Gc,[p("label",Wc,m(e.Resource.outLineColor),1),p(v,{modelValue:n.outLineColor,"onUpdate:modelValue":t[10]||(t[10]=e=>n.outLineColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])],512),[[h,"3"===n.currentId]]),d(p("div",jc,[p("label",Kc,m(e.Resource.outLineWidth),1),d(p("input",{type:"number",min:"0",class:"sm-input",style:{width:"63%"},"onUpdate:modelValue":t[11]||(t[11]=e=>n.outLineWidth=e)},null,512),[[y,n.outLineWidth]])],512),[[h,"3"===n.currentId]]),b(" 光晕线 "),d(p("div",Qc,[p("label",Xc,m(e.Resource.glowStrength),1),d(p("input",{type:"number",class:"sm-input",min:"0",step:"0.1",style:{width:"63%"},"onUpdate:modelValue":t[12]||(t[12]=e=>n.glowStrength=e)},null,512),[[y,n.glowStrength]])],512),[[h,"5"===n.currentId]]),b(" 尾迹线 "),d(p("div",Yc,[p("label",Zc,m(e.Resource.trailPercentage),1),d(p("input",{type:"number",class:"sm-input",min:"0",step:"0.1",style:{width:"63%"},"onUpdate:modelValue":t[13]||(t[13]=e=>n.trailPercentage=e)},null,512),[[y,n.trailPercentage]])],512),[[h,"6"===n.currentId]])],512),[[h,"polyline"===n.drawType]]),b(" 面 "),d(p("div",qc,[p("div",Jc,[(l(!0),i(S,null,R(n.config.polygon,(e=>(l(),i("div",{key:e.id,class:["symbolic-box",{"theme-color":e.id===n.currentId}],onClick:t=>n.changeSelect(e.id)},[p("span",{class:["iconfont",e.iconfont]},null,2),p("label",$c,m(e.faceName),1)],10,["onClick"])))),128))]),b(" 纯色 "),d(p("div",eu,[p("label",tu,m(e.Resource.polygonColor),1),p(v,{modelValue:n.solidColor,"onUpdate:modelValue":t[14]||(t[14]=e=>n.solidColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])],512),[[h,"1"===n.currentId]]),b(" 网格 "),d(p("div",ou,[p("label",lu,m(e.Resource.polygonColor),1),p(v,{modelValue:n.gridColor,"onUpdate:modelValue":t[15]||(t[15]=e=>n.gridColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])],512),[[h,"2"===n.currentId]]),d(p("div",iu,[p("label",nu,m(e.Resource.gridWidth),1),d(p("input",{type:"number",min:"0",class:"sm-input",style:{width:"63%"},"onUpdate:modelValue":t[16]||(t[16]=e=>n.gridWidth=e)},null,512),[[y,n.gridWidth]])],512),[[h,"2"===n.currentId]]),d(p("div",au,[p("label",su,m(e.Resource.gridCount),1),d(p("input",{type:"number",min:"0",class:"sm-input",style:{width:"63%"},"onUpdate:modelValue":t[17]||(t[17]=e=>n.gridCount=e)},null,512),[[y,n.gridCount]])],512),[[h,"2"===n.currentId]]),d(p("div",ru,[p("label",du,m(e.Resource.gridCellAlpha),1),d(p("input",{type:"number",class:"sm-input",min:"0",step:"0.1",style:{width:"63%"},"onUpdate:modelValue":t[18]||(t[18]=e=>n.gridCellAlpha=e)},null,512),[[y,n.gridCellAlpha]])],512),[[h,"2"===n.currentId]]),b(" 条纹 "),d(p("div",pu,[p("label",cu,m(e.Resource.stripeEvenColor),1),p(v,{modelValue:n.stripeEvenColor,"onUpdate:modelValue":t[19]||(t[19]=e=>n.stripeEvenColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])],512),[[h,"3"===n.currentId]]),d(p("div",uu,[p("label",mu,m(e.Resource.stripeOddColor),1),p(v,{modelValue:n.stripeOddColor,"onUpdate:modelValue":t[20]||(t[20]=e=>n.stripeOddColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])],512),[[h,"3"===n.currentId]]),d(p("div",yu,[p("label",hu,m(e.Resource.stripeRepeat),1),d(p("input",{type:"number",min:"0",class:"sm-input",style:{width:"63%"},"onUpdate:modelValue":t[21]||(t[21]=e=>n.stripeRepeat=e)},null,512),[[y,n.stripeRepeat]])],512),[[h,"3"===n.currentId]]),d(p("div",wu,[p("label",gu,m(e.Resource.stripeOffset),1),d(p("input",{type:"number",min:"0",class:"sm-input",style:{width:"63%"},"onUpdate:modelValue":t[22]||(t[22]=e=>n.stripeOffset=e)},null,512),[[y,n.stripeOffset]])],512),[[h,"3"===n.currentId]]),d(p("div",fu,[p("label",bu,[d(p("input",{type:"radio",value:"horizontal","onUpdate:modelValue":t[23]||(t[23]=e=>n.stripeOrientation=e)},null,512),[[c,n.stripeOrientation]]),u(" "+m(e.Resource.stripeOrientation),1)]),p("label",vu,[d(p("input",{type:"radio",value:"vertical","onUpdate:modelValue":t[24]||(t[24]=e=>n.stripeOrientation=e)},null,512),[[c,n.stripeOrientation]]),u(" "+m(e.Resource.stripeOrientation),1)])],512),[[h,"3"===n.currentId]])],512),[[h,"polygon"===n.drawType]]),p("div",Su,[p("button",{class:"tbtn",type:"button",style:{width:"auto"},onClick:t[25]||(t[25]=(...e)=>n.draw&&n.draw(...e))},m(e.Resource.draw),1),p("button",{class:"tbtn tbtn-margin-left",style:{width:"auto"},type:"button ",onClick:t[26]||(t[26]=(...e)=>n.clear&&n.clear(...e))},m(e.Resource.clear),1)])],512),[[C]])],512)),[[M]])},fc.__file="src/components/draw/draw-line-surface/draw-line-surface.vue",fc.install=function(e){e.component(fc.name,fc)};var Cu=[{id:0,name:"树木",type:"tree",data:[{id:0,name:"树1",thumbnail:"public/data/s3m/S3MData/tree.png",path:"public/data/s3m/S3MData/tree1.s3m"},{id:1,name:"树2",thumbnail:"public/data/s3m/S3MData/pine.png",path:"public/data/s3m/S3MData/tree2.s3m"},{id:2,name:"树3",thumbnail:"public/data/s3m/S3MData/tree3.png",path:"public/data/s3m/S3MData/tree3.s3m"},{id:3,name:"树4",thumbnail:"public/data/s3m/S3MData/tree2.png",path:"public/data/s3m/S3MData/tree4.s3m"},{id:4,name:"springTree",thumbnail:"public/data/s3m/S3MData/springTree.png",path:"public/data/s3m/S3MData/springTree.s3m"},{id:5,name:"autumnTree",thumbnail:"public/data/s3m/S3MData/autumnTree.png",path:"public/data/s3m/S3MData/autumnTree.s3m"},{id:6,name:"winterTree",thumbnail:"public/data/s3m/S3MData/winterTree.png",path:"public/data/s3m/S3MData/winterTree.s3m"},{},{},{}]},{id:1,name:"公共设施",type:"public-utilities",data:[{id:0,name:"椅子",thumbnail:"public/data/s3m/S3MData/bench.png",path:"public/data/s3m/S3MData/Chair.s3m"},{id:1,name:"垃圾箱",thumbnail:"public/data/s3m/S3MData/Dustbin.png",path:"public/data/s3m/S3MData/Dustbin.s3m"},{id:2,name:"垃圾箱2",thumbnail:"public/data/s3m/S3MData/paper-bucket.png",path:"public/data/s3m/S3MData/Dustbin2.s3m"},{id:3,name:"垃圾桶",thumbnail:"public/data/s3m/S3MData/dustbin1.png",path:"public/data/s3m/S3MData/GarbageCan.s3m"},{id:4,name:"报亭",thumbnail:"public/data/s3m/S3MData/newspaper.png",path:"public/data/s3m/S3MData/NewsStand.s3m"},{id:5,name:"邮政信箱",thumbnail:"public/data/s3m/S3MData/mailbox.png",path:"public/data/s3m/S3MData/PO-Box.s3m"},{id:6,name:"电信电话亭",thumbnail:"public/data/s3m/S3MData/phone-booth.png",path:"public/data/s3m/S3MData/T-TelBooth.s3m"},{},{},{}]},{id:2,name:"交通",type:"traffic",data:[{id:0,name:"限速牌",thumbnail:"public/data/s3m/S3MData/speed-limit.png",path:"public/data/s3m/S3MData/RestrictionBoard.s3m"},{id:1,name:"路灯",thumbnail:"public/data/s3m/S3MData/lamp-post.png",path:"public/data/s3m/S3MData/StreetLight.s3m"},{id:2,name:"红绿灯",thumbnail:"public/data/s3m/S3MData/traffic-light.png",path:"public/data/s3m/S3MData/TrafficLight.s3m"},{},{}]}];class Mu{constructor(){this._positions=null,this.boundingSphere=null,this._geometry=null,this._triangleArrayByWeight=null}initPolygonEmitter(e){if(this._positions=SuperMap3D.defaultValue(e,[new SuperMap3D.Cartesian3,new SuperMap3D.Cartesian3,new SuperMap3D.Cartesian3]),this.boundingSphere=SuperMap3D.BoundingSphere.fromPoints(e),SuperMap3D.defaultValue(e)){var t=SuperMap3D.PolygonGeometry.fromPositions({positions:e,perPositionHeight:!0});this._geometry=SuperMap3D.PolygonGeometry.createGeometry(t),this._triangleArrayByWeight=this.initWeight(this._geometry)}}get positions(){return this._positions}set positions(e){if(SuperMap3D.defaultValue(e)){this._positions=e;var t=SuperMap3D.PolygonGeometry.fromPositions({positions:this._positions,perPositionHeight:!0});this._geometry=SuperMap3D.PolygonGeometry.createGeometry(t),this._triangleArrayByWeight=this.initWeight(this._geometry),this.boundingSphere=SuperMap3D.BoundingSphere.fromPoints(e)}}initWeight(e){var t,o,l=new SuperMap3D.Cartesian3,i=new SuperMap3D.Cartesian3,n=new SuperMap3D.Cartesian3,a=e.indices,s=a.length/3,r=e.attributes.position.values,d=[],p=0;for(t=0;t<s;t++){var c=a[3*t],u=a[3*t+1],m=a[3*t+2];l.x=r[3*c],l.y=r[3*c+1],l.z=r[3*c+2],i.x=r[3*u],i.y=r[3*u+1],i.z=r[3*u+2],n.x=r[3*m],n.y=r[3*m+1],n.z=r[3*m+2];var y=this.triangleArea(l,i,n);p+=y,d.push(y)}var h=Math.max(100,10*s),w=[];for(t=0;t<s;t++){var g=Math.floor(d[t]/p*h);for(g=Math.max(1,g),o=0;o<g;o++)w.push(t)}return w}triangleArea(e,t,o){var l=new SuperMap3D.Cartesian3,i=new SuperMap3D.Cartesian3,n=new SuperMap3D.Cartesian3;return l=SuperMap3D.Cartesian3.subtract(t,e,l),i=SuperMap3D.Cartesian3.subtract(o,e,i),n=SuperMap3D.Cartesian3.cross(l,i,n),.5*SuperMap3D.Cartesian3.magnitude(n)}randomVertex(e,t,o,l,i){return(1-Math.sqrt(e))*o+Math.sqrt(e)*(1-t)*l+Math.sqrt(e)*t*i}getOneRandomPosition(){if(SuperMap3D.defaultValue(this._geometry)){var e=Math.floor(SuperMap3D.Math.randomBetween(0,this._triangleArrayByWeight.length)),t=this._triangleArrayByWeight[e],o=this._geometry.indices[3*t],l=this._geometry.indices[3*t+1],i=this._geometry.indices[3*t+2],n=this._geometry.attributes.position.values,a=n[3*o],s=n[3*o+1],r=n[3*o+2],d=n[3*l],p=n[3*l+1],c=n[3*l+2],u=n[3*i],m=n[3*i+1],y=n[3*i+2],h=SuperMap3D.Math.randomBetween(0,1),w=SuperMap3D.Math.randomBetween(0,1),g=this.randomVertex(h,w,a,d,u),f=this.randomVertex(h,w,s,p,m),b=this.randomVertex(h,w,r,c,y);return SuperMap3D.Cartesian3.fromElements(g,f,b)}}}function Du(o){let l=e({selectedTypeId:0,selectedSymbolId:0,symbolColor:"#ffffff",space:10,density:100,addType:"single"});if(o)for(let e in o)l.hasOwnProperty(e)?l[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let i,n,r,d=Cu[l.selectedTypeId].data,p=null,c=!1,u=[],m=!1,y=!0;function h(e){if(c)return;if(m){tooltip.setVisible(!1),viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");let t=scene.pickPosition(e.message.position),o=SuperMap3D.Color.fromCssColorString(l.symbolColor),n="symbol-"+Cu[l.selectedTypeId].id+"-"+d[l.selectedSymbolId].id+"-"+(new Date).getTime(),a=d[l.selectedSymbolId].path;return i.add(a,{id:n,position:t,color:o}),u.includes(a)||u.push(a),void(m=!1)}let t=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(t&&t.id&&"string"==typeof t.id&&-1!=t.id.indexOf("symbol-")){if(p&&p.id===t.id)return;return n&&n.destroy(),p=t,n=new SuperMap3D.ModelEditor({model:p.primitive,scene:viewer.scene}),void n.activate()}n&&n.destroy(),n=null,p=null}function w(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),m=!0}function g(){c=!0,window.handlerPolyline||ge("Polyline"),fe("Polyline").then((e=>{!function(e,t){let o=[];for(let e=1,l=t.positions.length;e<l;e++){let l=t.positions[e-1],i=t.positions[e],n=SuperMap3D.Cartesian3.distance(l,i),a=f(parseInt(n));for(let e=1,t=a;e<=t;e++)o.push(SuperMap3D.Cartesian3.lerp(l,i,e/a,new SuperMap3D.Cartesian3))}viewer.scene.clampToHeightMostDetailed(o).then((e=>{c=!1;let t=SuperMap3D.Color.fromCssColorString(l.symbolColor),o="symbol-"+Cu[l.selectedTypeId].id+"-"+d[l.selectedSymbolId].id+"-",n=d[l.selectedSymbolId].path;u.includes(n)||u.push(n);for(let l=0,a=e.length;l<=a;l++)i.add(n,{id:o+(new Date).getTime()+l,position:e[l],color:t})}))}(0,e.result.object);let t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),tooltip.setVisible(!1)}),(e=>{console.log(e)})),window.handlerPolyline.activate()}function f(e){let t=Number(l.space);return parseInt(e/t)+1}return V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element)),i=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(i),r=new Mu),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)),i=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(i),r=new Mu)})),t((()=>{d.length=0,i=null,p=null,n&&n.destroy(),u.length=0})),s((()=>l.selectedTypeId),(e=>{d=Cu[l.selectedTypeId].data})),s((()=>l.symbolColor),(e=>{let t=SuperMap3D.Color.fromCssColorString(e);if(p){let e=p.primitive,o=p.id;e.updateColor(t,o)}})),{...a(l),s3mModels:Cu,changeSelect:function(e){l.selectedSymbolId=e},clear:function(){if(p){let e=p.id,t=e.split("-"),o=Cu[t[1]].data[t[2]].path;o&&(i.removeInstance(o,e),p=null)}else u.forEach((e=>{i.removeCollection(e)})),u.length=0;0===u.length&&viewer.eventManager.removeEventListener("CLICK",h),n&&n.destroy(),n=null,window.tooltip.setVisible(!1),be("Polyline"),be("Polygon"),m=!1,viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur")},statrtAdd:function(){switch(y&&(window.tooltip.showAt("<p>选中模型可以编辑和清除选中模型</p><p>未选中模型时清除所有</p>","420px"),y=!1),viewer.eventManager.addEventListener("CLICK",h,!0),l.addType){case"single":w();break;case"line":g();break;case"face":c=!0,window.handlerPolygon||ge("Polygon"),fe("Polygon",!1).then((e=>{tooltip.setVisible(!1);let t=window.handlerPolygon;t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),r.initPolygonEmitter(e.result.object.positions);let o=SuperMap3D.Color.fromCssColorString(l.symbolColor),n="symbol-"+Cu[l.selectedTypeId].id+"-"+d[l.selectedSymbolId].id+"-",a=d[l.selectedSymbolId].path;u.includes(a)||u.push(a);let s=Number(l.density);for(let e=0;e<s;e++){let t=r.getOneRandomPosition();i.add(a,{id:n+(new Date).getTime()+e,position:t,color:o})}c=!1}),(e=>{console.log(e)})),window.handlerPolygon.activate();break;default:w()}}}}var Ru={name:"Sm3dPointSymbol",props:{selectedTypeId:{type:Number},symbolColor:{type:String},space:{type:Number},density:{type:Number}},setup(e){let{s3mModels:t,selectedTypeId:o,selectedSymbolId:l,symbolColor:i,changeSelect:n,space:a,density:s,clear:r,statrtAdd:d,addType:p}=Du(e);return{s3mModels:t,selectedTypeId:o,selectedSymbolId:l,symbolColor:i,changeSelect:n,space:a,density:s,clear:r,statrtAdd:d,addType:p}}};const xu={id:"draw-panel",class:"sm-panel"},Lu={class:"sm-function-module-sub-section",style:{margin:"0"}},Pu={class:"sm-half-L"},Vu={style:{width:"35%"}},ku={class:"sm-half-L symbolic"},Eu={class:"sm-half-L"},Nu={style:{width:"35%"}},Tu={class:"sm-half-L"},Au={style:{width:"35%"}},Bu={value:"single"},Iu={value:"line"},_u={value:"face"},Fu={class:"sm-half-L"},Ou={style:{width:"35%"}},Uu={class:"sm-half-L"},Hu={style:{width:"35%"}},zu={class:"boxchild"};Ru.render=function(e,t,o,n,a,s){const c=g("el-color-picker"),u=r("stopdrag"),w=r("drag");return d((l(),i("div",xu,[d(p("div",Lu,[p("div",Pu,[p("label",Vu,m(e.Resource.symbolType),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.selectedTypeId=e)},[(l(!0),i(S,null,R(n.s3mModels,(e=>(l(),i("option",{key:e.id,value:e.id},m(e.name),9,["value"])))),128))],512),[[f,n.selectedTypeId]])]),p("div",ku,[(l(!0),i(S,null,R(n.s3mModels[n.selectedTypeId].data,((e,t)=>(l(),i("div",{key:e.id,class:["symbolic-box",{"theme-border-color":e.id===n.selectedSymbolId}],style:{width:"40px"},title:e.name,onClick:e=>n.changeSelect(t)},[d(p("img",{src:e.thumbnail,alt:""},null,8,["src"]),[[h,e.name]])],10,["title","onClick"])))),128))]),p("div",Eu,[p("label",Nu,m(e.Resource.symbolColor),1),p(c,{modelValue:n.symbolColor,"onUpdate:modelValue":t[2]||(t[2]=e=>n.symbolColor=e),size:"mini",style:{width:"63%"}},null,8,["modelValue"])]),p("div",Tu,[p("label",Au,m(e.Resource.addType),1),d(p("select",{class:"sm-select",style:{width:"63%"},"onUpdate:modelValue":t[3]||(t[3]=e=>n.addType=e)},[p("option",Bu,m(e.Resource.singleAdd),1),p("option",Iu,m(e.Resource.lineAdd),1),p("option",_u,m(e.Resource.faceAdd),1)],512),[[f,n.addType]])]),d(p("div",Fu,[p("label",Ou,m(e.Resource.spacing),1),d(p("input",{type:"number",class:"sm-input",style:{width:"63%"},min:"1","onUpdate:modelValue":t[4]||(t[4]=e=>n.space=e)},null,512),[[y,n.space]])],512),[[h,"line"===n.addType]]),d(p("div",Uu,[p("label",Hu,m(e.Resource.number),1),d(p("input",{type:"number",class:"sm-input",style:{width:"63%"},min:"1","onUpdate:modelValue":t[5]||(t[5]=e=>n.density=e)},null,512),[[y,n.density]])],512),[[h,"face"===n.addType]]),p("div",zu,[p("button",{class:"tbtn",type:"button ",onClick:t[6]||(t[6]=(...e)=>n.statrtAdd&&n.statrtAdd(...e))},m(e.Resource.add),1),p("button",{class:"tbtn tbtn-margin-left",type:"button ",onClick:t[7]||(t[7]=(...e)=>n.clear&&n.clear(...e))},m(e.Resource.clear),1)])],512),[[u]])],512)),[[w]])},Ru.__file="src/components/draw/add-point-symbol/add-point-symbol.vue",Ru.install=function(e){e.component(Ru.name,Ru)};var Gu=[{id:0,iconfont:"icondianguangyuan",lightName:"点光源"},{id:1,iconfont:"iconjuguangdeng",lightName:"聚光灯"},{id:2,iconfont:"iconpinghangguang",lightName:"平行光"}];function Wu(o){let l,i,n,r=e({lightSelectId:0,lightColor:"#FFFFFF",cutoffDistance:200,lightDecay:5,lightIntensity:5,spotLightAngle:30,visibleModel:!0,dockFontShow:!0,modelPosition:[0,0,0],modelLongitude:"",modelLatitude:"",modelHeight:"",bubbleShow:!1,visiblePositions:!1});if(o)for(let e in o)r.hasOwnProperty(e)?r[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let d,p=!1,c=new Map,u="public/data/s3m/light.s3m";const m=v(null);function y(e,t){let o="light-model-"+(new Date).getTime();n.add(u,{id:o,position:e,scale:new SuperMap3D.Cartesian3(2,2,2)}),l=n.getInstance(u,o),c.set(o,t)}V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element)),n=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(n)),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)),n=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(n))}));let h,w=!1;function g(){window.handlerPolyline||ge("Polyline"),fe("Polyline").then((e=>{1===r.lightSelectId?function(e){let t=b(e[0]),o=e[1],l={color:SuperMap3D.Color.fromCssColorString(r.lightColor),distance:Number(r.cutoffDistance),decay:Number(r.lightDecay),intensity:Number(r.lightIntensity),angle:SuperMap3D.Math.toRadians(Number(r.spotLightAngle))},n=new SuperMap3D.SpotLight(t,o,l);i=n,viewer.scene.addLightSource(n),y(t,n)}(e.result.object.positions):function(e){let t=b(e[0]),o={targetPosition:e[1],color:SuperMap3D.Color.fromCssColorString(r.lightColor),intensity:Number(r.lightIntensity)},l=new SuperMap3D.DirectionalLight(t,o);i=l,viewer.scene.addLightSource(l),y(t,l)}(e.result.object.positions);let t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),tooltip.setVisible(!1)}),(e=>{console.log(e)})),window.handlerPolyline.activate()}function f(e){if(p){p=!1,viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),!function(e){let t=b(e),o={color:SuperMap3D.Color.fromCssColorString(r.lightColor),cutoffDistance:Number(r.cutoffDistance),decay:Number(r.lightDecay),intensity:Number(r.lightIntensity)},l=new SuperMap3D.PointLight(t,o);i=l,viewer.scene.addLightSource(l),y(t,l)}(scene.pickPosition(e.message.position)),tooltip.setVisible(!1)}else{let o=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(o&&o.id&&"string"==typeof o.id&&-1!=o.id.indexOf("light-model-")){if(l&&l.id===o.id.id)return;l=o,i=c.get(o.id),d?d.setEditObject(o.primitive):(t=o.primitive,d=new SuperMap3D.ModelEditor({model:t,scene:viewer.scene,axesShow:{translation:!0,rotation:!1,scale:!0}}),d.activate(),d.changedEvt.addEventListener((e=>{let t=new SuperMap3D.Cartesian3;if(SuperMap3D.Matrix4.getTranslation(e.modelMatrix,t),t){i.position=t,w=!0,C((()=>w=!1));let e=we.CartesiantoDegrees(t);r.modelPosition.length=0,r.modelPosition.push(e[0].toFixed(6),e[1].toFixed(6),e[2].toFixed(2))}}))),m.value.style.top=e.message.position.y-160+"px",m.value.style.left=e.message.position.x+"px",console.log(d);let n=we.CartesiantoDegrees(d._position);return r.modelPosition.length=0,r.modelPosition.push(n[0].toFixed(6),n[1].toFixed(6),n[2].toFixed(2)),void(r.bubbleShow=!0)}l=void 0,i=void 0,d&&d.deactivate(),r.bubbleShow=!1}var t}function b(e){let t=SuperMap3D.Cartographic.fromCartesian(e);return t.height+=.5,SuperMap3D.Cartographic.toCartesian(t)}function S(){r.bubbleShow=!1}function C(e){h&&clearTimeout(h),h=setTimeout((function(){e()}),1e3)}return s((()=>r.lightColor),(e=>{if(!i)return;let t=SuperMap3D.Color.fromCssColorString(e);i.color=t})),s((()=>r.cutoffDistance),(e=>{i&&(1!==i.lightType?2!==i.lightType||(i.distance=Number(e)):i.cutoffDistance=Number(e))})),s((()=>r.lightDecay),(e=>{i&&0!==i.lightType&&(i.decay=Number(e))})),s((()=>r.lightIntensity),(e=>{i&&(i.intensity=Number(e))})),s((()=>r.spotLightAngle),(e=>{i&&2===i.lightType&&(i.angle=SuperMap3D.Math.toRadians(Number(e)))})),s((()=>r.visibleModel),(e=>{l&&(d&&d.deactivate(),n.visible=e)})),s((()=>r.modelPosition),(e=>{l&&!w&&C((()=>{let t=Number(e[0]),o=Number(e[1]),n=Number(e[2]),a=SuperMap3D.Cartesian3.fromDegrees(t,o,n);i.position=a,l.primitive.updatePosition(a),d&&d.setEditObject(l.primitive)}))}),{deep:!0}),t((()=>{})),{...a(r),config:Gu,addLight:function(){let e=0===r.lightSelectId?"<p>点击确认点光源位置</p><p>选中光源模型可编辑与删除</p>":"<p>点击第一点确认光源位置</p><p>第二点确认光源方向</p><p>选中光源模型可编辑与删除</p>";if(window.tooltip.showAt(e,"400px"),viewer.eventManager.addEventListener("CLICK",f,!0),0===r.lightSelectId)return viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),void(p=!0);g()},clearLight:function(){l&&(c.delete(l.id),n.removeInstance(u,l.id),l=null),i&&viewer.scene.removeLightSource(i),0===c.size&&viewer.eventManager.removeEventListener("CLICK",f),d&&d.deactivate(),p=!1,i=null,be(),viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),tooltip.setVisible(!1),S()},bubble:m,closeBubble:S,dockBubble:function(e){e?(m.value.classList.add("bubbleDock"),r.dockFontShow=!1):(m.value.classList.remove("bubbleDock"),r.dockFontShow=!0)}}}var ju={name:"Sm3dLight",props:{lightColor:{type:String},cutoffDistance:{type:Number},lightDecay:{type:Number},lightIntensity:{type:Number},spotLightAngle:{type:Number}},setup(e){let{lightSelectId:t,lightColor:o,cutoffDistance:l,lightDecay:i,lightIntensity:n,spotLightAngle:a,config:s,addLight:r,clearLight:d,visibleModel:p,bubble:c,closeBubble:u,dockBubble:m,dockFontShow:y,modelPosition:h,bubbleShow:w,visiblePositions:g}=Wu(e);return{lightSelectId:t,lightColor:o,cutoffDistance:l,lightDecay:i,lightIntensity:n,spotLightAngle:a,config:s,addLight:r,clearLight:d,visibleModel:p,bubble:c,closeBubble:u,dockBubble:m,dockFontShow:y,modelPosition:h,bubbleShow:w,visiblePositions:g}}};const Ku={id:"draw-panel",class:"sm-panel"},Qu={class:"sm-function-module-sub-section",style:{margin:"0"}},Xu={class:"sm-half-L symbolic"},Yu={style:{width:"100%"}},Zu={class:"sm-half-L"},qu={style:{width:"35%"}},Ju={class:"sm-half-L"},$u={style:{width:"35%"}},em={class:"sm-half-L"},tm={style:{width:"35%"}},om={class:"sm-half-L"},lm={style:{width:"35%"}},im={class:"sm-half-L"},nm={style:{width:"35%"}},am={class:"sm-half-L flex-between"},sm={style:{width:"auto"}},rm={style:{width:"auto"}},dm={class:"boxchild",style:{padding:"0"}},pm={id:"bubble",class:"bubble",ref:"bubble"},cm={class:"boxchild flex-between"},um={style:{width:"auto"}},mm={class:"flex flex-end",style:{width:"auto"}},ym={class:"sm-half-L"},hm={class:"label-S"},wm={class:"sm-half-L"},gm={class:"label-S"},fm={class:"sm-half-L"},bm={class:"label-S"};function vm(l){let i,n,r,d=e({viewlongitude:"",viewlatitude:"",viewheight:"",direction:"",pitch:"",horizontal:20,vertical:10,distance:200,hintLineColor:"rgba(251,250,248,1)",clipMode:"clip-inside",visibleLine:!0,fileText:"",fromInfo:null});if(l)for(let e in l)d.hasOwnProperty(e)?d[e]=l[e]:we.Message.errorMsg(ce.AttributeError+e);let p,c,u,m=v(null),y=new Map,h="public/data/s3m/projector.s3m",w=!1,g=null,f=new FileReader,b=!1;function S(e,t){return new Promise(((o,l)=>{let i=document.getElementById("videoContain"),n=document.createElement("video"),a=document.createElement("source");a.src=e,n.appendChild(a),n.id="trailer-"+t,n.classList.add("videoBox"),n.setAttribute("autoplay","autoplay"),n.setAttribute("loop","loop"),n.setAttribute("crossorigin","crossorigin"),n.setAttribute("controls","controls"),n.setAttribute("muted","muted"),i.appendChild(n),setTimeout((()=>{o(n)}),500)}))}function C(e){if(b)return;if(w){viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");let e=SuperMap3D.Cartesian3.fromDegrees(r.viewPosition[0],r.viewPosition[1],r.viewPosition[2]),t=JSON.parse(JSON.stringify(e));return viewer.eventManager.removeEventListener("MOUSE_MOVE",M),function(e,t){let o="projector-"+(new Date).getTime(),l=r.direction,i=r.pitch,n=SuperMap3D.Math.toRadians(l),a=n>=SuperMap3D.Math.PI?n-SuperMap3D.Math.PI:n+SuperMap3D.Math.PI,s=-SuperMap3D.Math.toRadians(i);p.add(h,{id:o,position:e,hpr:{heading:a,pitch:0,roll:s}}),g=p.getInstance(h,o),y.set(o,r)}(t),void(w=!1)}let t=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(t&&t.id&&"string"==typeof t.id&&-1!=t.id.indexOf("projector-"))return c&&c.destroy(),g=t,r=y.get(t.id),void(r&&(d.horizontal=r.horizontalFov,d.vertical=r.verticalFov,d.distance=r.distance));g=null,r=null}function M(e){let t=0,o=viewer.scene.camera.position,l=n.pickPosition(e.message.endPosition);l&&(t=SuperMap3D.Cartesian3.distance(o,l)),t>0&&t<1e3&&r.setDistDirByPoint(we.CartesiantoDegrees(l))}return V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element)),n=viewer.scene,i=viewer.scene.layers.layerQueue,p=new SuperMap3D.S3MInstanceCollection(n._context),viewer.scene.primitives.add(p),viewer.eventManager.addEventListener("CLICK",C,!0)),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)),n=viewer.scene,i=viewer.scene.layers.layerQueue,p=new SuperMap3D.S3MInstanceCollection(n._context),viewer.scene.primitives.add(p))})),s((()=>V.changeLayers),(e=>{for(let e=0;e<i.length;e++)i[e].selectEnabled=!1})),o((()=>{m.value.addEventListener("change",(e=>{let t=e.target.files[0];if(!t)return;d.fileText=m.value.value;const o=new Blob([t],{type:"video/mp4"});f.readAsDataURL(o),f.onload=function(e){let t=e.target.result,o=document.querySelectorAll("#videoContain>video").length;S(t,o).then((e=>{u=document.getElementById("trailer-"+o)}))}})),u=document.getElementById("trailer-0")})),s((()=>d.fileText),(e=>{if(-1===e.indexOf("http"))return;let t=document.querySelectorAll("#videoContain>video").length;S(e,t).then((e=>{u=document.getElementById("trailer-"+t)}))})),s((()=>d.horizontal),(e=>{""!=e&&r&&(r.horizontalFov=Number(e))})),s((()=>d.vertical),(e=>{""!=e&&r&&(r.verticalFov=Number(e))})),s((()=>d.distance),(e=>{""!=e&&r&&(r.distance=Number(e))})),s((()=>d.visibleLine),(e=>{r&&(p.visible=e,y.forEach((t=>{t.hintLineVisible=e})))})),s((()=>d.hintLineColor),(e=>{r&&(r.hintLineColor=SuperMap3D.Color.fromCssColorString(e))})),s((()=>d.clipMode),(e=>{if(!r)return;let t="clip-outside"===e?SuperMap3D.ModifyRegionMode.CLIP_INSIDE:SuperMap3D.ModifyRegionMode.CLIP_OUTSIDE;r.setClipMode(t)})),s((()=>d.viewlongitude),(e=>{r&&""!=e&&(r.viewPosition[0]=e)})),s((()=>d.viewlatitude),(e=>{r&&""!=e&&(r.viewPosition[1]=e)})),s((()=>d.viewheight),(e=>{r&&""!=e&&(r.viewPosition[2]=e)})),s((()=>d.direction),(e=>{r&&""!=e&&(r.direction=Number(e))})),s((()=>d.pitch),(e=>{r&&""!=e&&(r.pitch=Number(e))})),s((()=>d.fromInfo),(e=>{e&&""!=e&&SuperMap3D.ProjectionImage.fromInfo(n,d.fromInfo.infoUrl,d.fromInfo.baseUrl)})),t((()=>{for(let e=0;e<i.length;e++)i[e].selectEnabled=!0})),{...a(d),chooseFile:function(){m.value.click()},vedioFile_dom:m,startProjection:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur");let e=viewer.scene.camera.position;u.play(),r=new SuperMap3D.ProjectionImage(n),r.setImage({video:u}),r.distance=Number(d.distance),r.horizontalFov=Number(d.horizontal),r.verticalFov=Number(d.vertical),r.viewPosition=we.CartesiantoDegrees(e),r.build(),w=!0,window.tooltip.showAt(" <p>选中投放模型进行编辑和清除</p>","400px"),viewer.eventManager.addEventListener("MOUSE_MOVE",M),viewer.eventManager.addEventListener("CLICK",C,!0)},clear:function(){viewer.eventManager.removeEventListener("MOUSE_MOVE",M),g&&(y.delete(g.id),p.removeInstance(h,g.id),g=null),r&&(r.removeAllClipRegion(),r.destroy()),0===y.size&&viewer.eventManager.removeEventListener("CLICK",C),c&&c.destroy(),c=null,r=null,window.tooltip.setVisible(!1),be(),viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur")},clipProjectImg:function(){b=!0,tooltip.setVisible(!1),window.tooltip.showAt(" <p>点击鼠标左键绘制裁剪区域</p><p>点击鼠标右键结束绘制</p><p>注：只能裁剪当前选中投放对象</p>","400px"),window.handlerPolygon||ge("Polygon"),fe("Polygon").then((e=>{b=!1;let t=window.handlerPolygon;!function(e){if(!r)return;r.addClipRegion({name:"clip-Projector"+(new Date).getTime(),position:e})}(e.positions),t.polygon.show=!1,t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate()}),(e=>{console.log(e)})),window.handlerPolygon.activate()}}}ju.render=function(e,t,o,n,a,s){const c=g("el-color-picker"),f=g("el-slider"),v=r("stopdrag"),C=r("drag");return l(),i(S,null,[d(p("div",Ku,[d(p("div",Qu,[p("div",Xu,[(l(!0),i(S,null,R(n.config,(e=>(l(),i("div",{key:e.id,class:["symbolic-box",{"theme-color":e.id===n.lightSelectId}],onClick:t=>n.lightSelectId=e.id},[p("span",{class:["iconfont",e.iconfont]},null,2),p("label",Yu,m(e.lightName),1)],10,["onClick"])))),128))]),p("div",Zu,[p("label",qu,m(e.Resource.lightColor),1),p(c,{modelValue:n.lightColor,"onUpdate:modelValue":t[1]||(t[1]=e=>n.lightColor=e),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])]),d(p("div",Ju,[p("label",$u,m(e.Resource.cutoffDistance),1),p(f,{modelValue:n.cutoffDistance,"onUpdate:modelValue":t[2]||(t[2]=e=>n.cutoffDistance=e),min:0,max:500,step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])],512),[[h,2!==n.lightSelectId]]),d(p("div",em,[p("label",tm,m(e.Resource.lightDecay),1),p(f,{modelValue:n.lightDecay,"onUpdate:modelValue":t[3]||(t[3]=e=>n.lightDecay=e),min:0,max:10,step:.1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])],512),[[h,2!==n.lightSelectId]]),p("div",om,[p("label",lm,m(e.Resource.lightIntensity),1),p(f,{modelValue:n.lightIntensity,"onUpdate:modelValue":t[4]||(t[4]=e=>n.lightIntensity=e),min:0,max:10,step:.1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),d(p("div",im,[p("label",nm,m(e.Resource.spotLightAngle),1),p(f,{modelValue:n.spotLightAngle,"onUpdate:modelValue":t[5]||(t[5]=e=>n.spotLightAngle=e),min:0,max:90,step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])],512),[[h,1===n.lightSelectId]]),p("div",am,[p("label",sm,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=e=>n.visibleModel=e)},null,512),[[w,n.visibleModel]]),u(" "+m(e.Resource.lightModel),1)]),p("label",rm,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=e=>n.visiblePositions=e)},null,512),[[w,n.visiblePositions]]),u(" "+m(e.Resource.lightPositions),1)])]),p("div",dm,[b(' <div class="flex flex-start" style="width:56%; align-items: center;">\r\n          <input checked type="checkbox" style="margin-right:10%" v-model="showLight" />\r\n          <label style="width:auto">显示光源</label>\r\n        </div>'),p("button",{class:"tbtn",type:"button",style:{width:"auto"},onClick:t[8]||(t[8]=(...e)=>n.addLight&&n.addLight(...e))},m(e.Resource.add),1),p("button",{class:"tbtn tbtn-margin-left",style:{width:"auto"},type:"button ",onClick:t[9]||(t[9]=(...e)=>n.clearLight&&n.clearLight(...e))},m(e.Resource.clear),1)])],512),[[v]])],512),[[C]]),d(p("div",pm,[p("div",cm,[p("label",um,m(e.Resource.visiblePositions),1),p("div",mm,[d(p("i",{class:"el-icon-position",title:"停靠",style:{"margin-right":"8px"},onClick:t[10]||(t[10]=e=>n.dockBubble(!0))},null,512),[[h,n.dockFontShow]]),d(p("i",{class:"el-icon-chat-square",title:"悬浮",style:{"margin-right":"8px"},onClick:t[11]||(t[11]=e=>n.dockBubble(!1))},null,512),[[h,!n.dockFontShow]]),p("i",{class:"el-icon-close",title:"关闭",onClick:t[12]||(t[12]=(...e)=>n.closeBubble&&n.closeBubble(...e))})])]),p("div",ym,[p("label",hm,m(e.Resource.longitude),1),d(p("input",{class:"sm-input-M",style:{width:"70%",height:"20px"},type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>n.modelPosition[0]=e)},null,512),[[y,n.modelPosition[0]]])]),p("div",wm,[p("label",gm,m(e.Resource.latitude),1),d(p("input",{class:"sm-input-M",style:{width:"70%",height:"20px"},type:"text","onUpdate:modelValue":t[14]||(t[14]=e=>n.modelPosition[1]=e)},null,512),[[y,n.modelPosition[1]]])]),p("div",fm,[p("label",bm,m(e.Resource.altitude),1),d(p("input",{class:"sm-input-M",style:{width:"70%",height:"20px"},type:"text","onUpdate:modelValue":t[15]||(t[15]=e=>n.modelPosition[2]=e)},null,512),[[y,n.modelPosition[2]]])])],512),[[h,n.bubbleShow&&n.visiblePositions]])],64)},ju.__file="src/components/scene/light/light.vue",ju.install=function(e){e.component(ju.name,ju)};var Sm={name:"Sm3dProjectionImage",props:{fileText:{type:Number},fromInfo:{type:Object}},setup(e){let{horizontal:t,vertical:o,distance:l,clipMode:i,visibleLine:n,fileText:a,chooseFile:s,vedioFile_dom:r,startProjection:d,clear:p,clipProjectImg:c}=vm(e);return{horizontal:t,vertical:o,distance:l,clipMode:i,visibleLine:n,fileText:a,chooseFile:s,vedioFile_dom:r,startProjection:d,clear:p,clipProjectImg:c}}};const Cm={id:"fly-route-panel",class:"sm-panel"},Mm={class:"sm-function-module-sub-section",style:{margin:"0"}},Dm={class:"sm-half-L"},Rm={style:{width:"30%"}},xm={type:"file",accept:"*.mp4",id:"vedioFile",style:{display:"none"},ref:"vedioFile_dom"},Lm={class:"sm-half-L"},Pm={style:{width:"30%"}},Vm={class:"sm-half-L"},km={style:{width:"30%"}},Em={class:"sm-half-L"},Nm={style:{width:"30%"}},Tm={class:"sm-half-L"},Am={style:{width:"30%"}},Bm={class:"sm-half",style:{width:"68%"}},Im={style:{width:"auto"}},_m={style:{width:"auto"}},Fm={class:"sm-half-L flex-between"},Om={style:{width:"auto"}},Um={class:"boxchild",style:{padding:"0"}},Hm=p("div",{id:"videoContain",style:{width:"0",height:"0"}},[p("video",{id:"trailer-0",style:{visibility:"hidden"},autoplay:"",loop:"",crossorigin:"",controls:"",muted:"",multiple:""},[p("source",{src:"public/data/media/video.mp4",type:"video/mp4"})])],-1);Sm.render=function(e,t,o,n,a,s){const h=g("el-slider"),f=r("stopdrag"),v=r("drag");return d((l(),i("div",Cm,[d(p("div",Mm,[p("div",Dm,[p("label",Rm,m(e.Resource.videoUrl),1),d(p("input",{type:"text",class:"sm-input",style:{width:"65%",position:"relative","padding-right":"30px"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.fileText=e),placeholder:e.Resource.fileType},null,8,["placeholder"]),[[y,n.fileText]]),p("span",{class:"iconfont iconwenjianjia fpfFile",onClick:t[2]||(t[2]=(...e)=>n.chooseFile&&n.chooseFile(...e))}),p("input",xm,null,512)]),p("div",Lm,[p("label",Pm,m(e.Resource.horizontal),1),p(h,{modelValue:n.horizontal,"onUpdate:modelValue":t[3]||(t[3]=e=>n.horizontal=e),min:.5,max:60,step:.5,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"65%"}},null,8,["modelValue","min","step"])]),p("div",Vm,[p("label",km,m(e.Resource.vertical),1),p(h,{modelValue:n.vertical,"onUpdate:modelValue":t[4]||(t[4]=e=>n.vertical=e),min:.5,max:60,step:.5,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"65%"}},null,8,["modelValue","min","step"])]),p("div",Em,[p("label",Nm,m(e.Resource.projectDistance),1),p(h,{modelValue:n.distance,"onUpdate:modelValue":t[5]||(t[5]=e=>n.distance=e),min:1,max:500,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"65%"}},null,8,["modelValue"])]),p("div",Tm,[p("label",Am,m(e.Resource.clipMode),1),p("div",Bm,[p("label",Im,[d(p("input",{type:"radio",value:"clip-inside","onUpdate:modelValue":t[6]||(t[6]=e=>n.clipMode=e)},null,512),[[c,n.clipMode]]),u(" "+m(e.Resource.clipInside),1)]),p("label",_m,[d(p("input",{type:"radio",value:"clip-outside","onUpdate:modelValue":t[7]||(t[7]=e=>n.clipMode=e)},null,512),[[c,n.clipMode]]),u(" "+m(e.Resource.clipOutside),1)])])]),p("div",Fm,[p("label",Om,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>n.visibleLine=e)},null,512),[[w,n.visibleLine]]),u(" "+m(e.Resource.visibleLine),1)]),b(' <label style="width:auto">\r\n          <input type="checkbox" v-model="visibleLine" />显示投放线\r\n        </label>')]),p("div",Um,[p("button",{class:"tbtn",type:"button",onClick:t[9]||(t[9]=(...e)=>n.startProjection&&n.startProjection(...e))},m(e.Resource.projection),1),p("button",{class:"tbtn tbtn-margin-left",type:"button",onClick:t[10]||(t[10]=(...e)=>n.clipProjectImg&&n.clipProjectImg(...e))},m(e.Resource.clip),1),p("button",{class:"tbtn tbtn-margin-left",type:"button ",onClick:t[11]||(t[11]=(...e)=>n.clear&&n.clear(...e))},m(e.Resource.clear),1)]),Hm],512),[[f]])],512)),[[v]])},Sm.__file="src/components/scene/projection-image/projection-image.vue",Sm.install=function(e){e.component(Sm.name,Sm)};var zm=[{name:"线状纹理1",type:"line",url:"public/img/particleSystem/line-1.jpg"},{name:"线状纹理2",type:"line",url:"public/img/particleSystem/line-2.jpg"},{name:"环状纹理1",type:"ring",url:"public/img/particleSystem/ring-1.jpg"},{name:"环状纹理2",type:"ring",url:"public/img/particleSystem/ring-2.jpg"},{name:"环状六边形纹理",type:"ring",url:"public/img/particleSystem/ring-3.jpg"}];function Gm(o){let l=e({scanMode:"lineMode",scanColor:"#0F7AF4",scanTextures:[],selectedTextureIndex:0,bloomShow:!1,openHDR:!1,threshold:.01,intensity:.5,lineWidth:100,period:3,speed:100,addTextures:null,scanShow:!1});if(o)for(let e in o)l.hasOwnProperty(e)?l[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let i=[{name:"无纹理",type:"line",url:""}],n=[{name:"无纹理",type:"ring",url:""}];function r(e){for(let t=0;t<e.length;t++)"line"===e[t].type?i.push(e[t]):n.push(e[t]);l.scanTextures="lineMode"===l.scanMode?i:n}function d(){viewer.scene.scanEffect.color=SuperMap3D.Color.fromCssColorString(l.scanColor),viewer.scene.scanEffect.textureUrl="",viewer.scene.scanEffect.lineWidth=Number(l.lineWidth),viewer.scene.scanEffect.period=Number(l.period),viewer.scene.scanEffect.speed=Number(l.speed),viewer.scene.scanEffect.centerPostion=new SuperMap3D.Cartesian3.fromDegrees(0,0,0)}function p(){window.handlerPolyline||ge("Polyline"),window.tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>绘制两点确定扫描线方向</p><p>鼠标右键结束绘制</p>","350px"),fe("Polyline").then((e=>{!function(e){let t=new SuperMap3D.Cartesian3;if(SuperMap3D.Cartesian3.subtract(e[1],e[0],t),l.scanShow)return viewer.scene.scanEffect.add(e[0]),void(viewer.scene.scanEffect.lineMoveDirection=t);viewer.scene.scanEffect.centerPostion=e[0],viewer.scene.scanEffect.lineMoveDirection=t,l.scanShow=!0}(e.result.object.positions);let t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),tooltip.setVisible(!1)}),(e=>{console.log(e)})),window.handlerPolyline.activate()}function c(e){viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");let t=viewer.scene.pickPosition(e.message.position);l.scanShow?viewer.scene.scanEffect.add(t):(viewer.scene.scanEffect.centerPostion=t,l.scanShow=!0,viewer.eventManager.removeEventListener("CLICK",c))}return r(zm),V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element)),d()),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)),d())})),s((()=>l.scanShow),(e=>{viewer.scene.scanEffect.show=e})),s((()=>l.scanMode),(e=>{if("lineMode"===e)return viewer.scene.scanEffect.mode=SuperMap3D.ScanEffectMode.LINE,void(l.scanTextures=i);viewer.scene.scanEffect.mode=SuperMap3D.ScanEffectMode.CIRCLE,l.scanTextures=n})),s((()=>l.scanColor),(e=>{viewer.scene.scanEffect.color=SuperMap3D.Color.fromCssColorString(e)})),s((()=>l.selectedTextureIndex),(e=>{viewer.scene.scanEffect.textureUrl=l.scanTextures[e].url})),s((()=>l.scanTextures),(e=>{l.selectedTextureIndex=0})),s((()=>l.bloomShow),(e=>{viewer.scene.bloomEffect.show=e,viewer.scene.bloomEffect.threshold=Number(l.threshold),viewer.scene.bloomEffect.bloomIntensity=Number(l.intensity)})),s((()=>l.openHDR),(e=>{viewer.scene.hdrEnabled=e})),s((()=>l.threshold),(e=>{viewer.scene.bloomEffect.threshold=Number(e)})),s((()=>l.intensity),(e=>{viewer.scene.bloomEffect.bloomIntensity=Number(e)})),s((()=>l.lineWidth),(e=>{viewer.scene.scanEffect.lineWidth=Number(e)})),s((()=>l.period),(e=>{viewer.scene.scanEffect.period=Number(e)})),s((()=>l.speed),(e=>{viewer.scene.scanEffect.speed=Number(e)})),s((()=>l.scanShow),(e=>{viewer.scene.scanEffect.scanShow=e})),s((()=>l.addTextures),(e=>{"object"==typeof e?r(e):console.log("addTextures类型不是数组！")})),t((()=>{})),{...a(l),addScans:function(){"lineMode"!==l.scanMode?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.eventManager.addEventListener("CLICK",c,!0)):p()},clear:function(){l.scanShow=!1;let e=viewer.scene.scanEffect.count;for(let t=0;t<e;t++)viewer.scene.scanEffect.remove(t);viewer.eventManager.removeEventListener("CLICK",c),be("Polyline")}}}var Wm={name:"Sm3dScanEffect",props:{scanMode:{type:String},scanColor:{type:String},selectedTextureIndex:{type:Number},bloomShow:{type:Boolean},openHDR:{type:Boolean},threshold:{type:Number},intensity:{type:Number},lineWidth:{type:Number},period:{type:Number},speed:{type:Number},addTextures:{type:Object},scanShow:{type:Boolean}},setup(e){let{scanMode:t,scanTextures:o,selectedTextureIndex:l,addScans:i,clear:n}=Gm(e);return{scanMode:t,scanTextures:o,selectedTextureIndex:l,addScans:i,clear:n}}};const jm={id:"scan-effect-panel",class:"sm-panel"},Km={class:"sm-function-module-sub-section",style:{margin:"0"}},Qm={class:"sm-half-L"},Xm={style:{width:"30%"}},Ym={class:"sm-half",style:{width:"68%"}},Zm={style:{width:"auto"}},qm={style:{width:"auto"}},Jm={class:"sm-half-L"},$m={style:{width:"30%"}},ey={class:"boxchild",style:{"padding-bottom":"0"}};function ty(o){let l=e({operationType:"stretch_cut",stretchHeight:1,modelUrls:null,digHeight:500,drillRadius:400,drillHeight:2e3,clipType:"drawClip",drawClipMode:"KeepInside"});if(l.modelUrls=[{id:1,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer1/features/1.stream",color:new SuperMap3D.Color(179/255,179/255,179/255,1)},{id:2,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer2/features/1.stream",color:new SuperMap3D.Color(94/255,179/255,59/255,1)},{id:3,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer3/features/1.stream",color:new SuperMap3D.Color(52/255,94/255,35/255,1)},{id:4,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer4/features/1.stream",color:new SuperMap3D.Color(115/255,115/255,115/255,1)},{id:5,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer5/features/1.stream",color:new SuperMap3D.Color(171/255,85/255,66/255,1)},{id:6,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer6/features/1.stream",color:new SuperMap3D.Color(68/255,68/255,68/255,1)}],o)for(let e in o)l.hasOwnProperty(e)?l[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let i,n,r,d,p=[],c=0,u=[];function m(){i=viewer.scene,i.logarithmicDepthBuffer=!0,i.camera.frustum.near=.1,i.globe.show=!1,viewer.scene.skyAtmosphere.show=!1,n=new SuperMap3D.SolidModelsProfile(i),n.addModels(l.modelUrls),console.log(n),n.addedEvent.addEventListener((e=>{console.log(n._s3mInstanceCollection.getInstance(l.modelUrls[2].model,3))})),viewer.scene.camera.setView({destination:new SuperMap3D.Cartesian3(-2167835.4408299956,4423497.534529096,4095839.2845661934),orientation:{heading:4.029329438295484,pitch:-.23796647219353817,roll:8.994289757424667e-10}})}function y(){tooltip.setVisible(!1),n.clearProfile(),be("Polyline"),p.forEach((e=>{viewer.entities.removeById(e)})),p.length=0}function h(){window.handlerPolygon||ge("Polygon"),fe("Polygon",!1).then((e=>{let t=window.handlerPolygon;!function(e){let t=new SuperMap3D.Point3Ds;we.CartesiantoDegreesObjs(e).forEach((e=>{let o=new SuperMap3D.Point3D(e.longitude,e.latitude,e.height+1e3);t.add(o)}));let o=new SuperMap3D.GeoRegion3D([t]);if("dig"===l.operationType){n.clippingType=SuperMap3D.ClippingType.KeepOutside,o.extrudedHeight=-Number(l.digHeight);let e=new SuperMap3D.GeoRegion3D([t]);e.isLatLon=!1,e.bottomAltitude=o.extrudedHeight,n.addProfileGeometry(e)}else o.extrudedHeight=-7e3;o.isLatLon=!1,n.setClipGeometry(o);for(let t=0;t<e.length;t++){let o=[];o.push(e[t]),t==e.length-1?o.push(e[0]):o.push(e[t+1]),n.addProfileGeometry(o),n.build()}}(e.result.object.positions),t.polygon.show=!1,t.polyline.show=!1,t.deactivate()}),(e=>{console.log(e)})),window.handlerPolygon.activate()}function w(){tooltip.setVisible(!1),n.clearProfile(),be()}function g(e){let t=viewer.scene.pickPosition(e.message.position);!function(e){c++,viewer.entities.add({id:"Drill_Point-"+c,position:e,cylinder:{length:100,topRadius:Number(l.drillRadius),bottomRadius:Number(l.drillRadius),material:SuperMap3D.Color.fromCssColorString("#d60000")}})}(t),u.push(t)}function f(e){window.tooltip.setVisible(!1),document.body.classList.remove("measureCur"),we.CartesiantoDegreesObjs(u).forEach((e=>{let t=new SuperMap3D.GeoCylinder(Number(l.drillRadius),Number(l.drillRadius),Number(l.drillHeight)),o=Number(l.drillHeight)/2;t.geoPosition=new SuperMap3D.Point3D(e.longitude,e.latitude,e.height-o),n.addProfileGeometry(t)}));for(let e=1;e<=c;e++)viewer.entities.removeById("Drill_Point-"+e);n.build(),viewer.eventManager.removeEventListener("CLICK",g),viewer.eventManager.removeEventListener("RIGHT_CLICK",f)}function b(){tooltip.setVisible(!1),n.clearProfile(),document.body.classList.remove("measureCur");for(let e=1;e<=c;e++)viewer.entities.removeById("Drill_Point-"+e);viewer.eventManager.removeEventListener("CLICK",g),viewer.eventManager.removeEventListener("RIGHT_CLICK",f),c=0,u.length=0}function v(){w(),be("Box"),r&&(r.deactivate(),r.destroy(),r=null)}function S(){y(),v(),b()}return V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element)),m()),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)),m())})),s((()=>l.modelUrls),(e=>{n.addModels(e)})),s((()=>l.stretchHeight),(e=>{if(l.modelUrls&&0!=l.modelUrls.length)for(let t of l.modelUrls){let o=t.model;n._s3mInstanceCollection._group[o].instances._array[0].updateScale(new SuperMap3D.Cartesian3(1,1,Number(e)))}})),s((()=>l.operationType),(e=>{S()})),s((()=>l.drawClipMode),(e=>{n.clippingType=SuperMap3D.ClippingType[e]})),s((()=>l.clipType),(e=>{v()})),t((()=>{n.clear(),viewer.scene.globe.show=!0,viewer.scene.skyAtmosphere.show=!0,S(),i=null,n=null,d=null})),{...a(l),drawLine:function(){window.handlerPolyline||ge("Polyline"),window.tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>鼠标右键结束绘制</p><p>可以绘制多条线段</p>","350px"),fe("Polyline").then((e=>{!function(e){let t=[];if(e.length<2)return;for(let o=0;o<e.length-1;o++)t.length=0,t.push(e[o]),t.push(e[o+1]),n.addProfileGeometry(t)}(e.result.object.positions);let t=window.handlerPolyline;t.polyline.show=!1,t.deactivate(),tooltip.setVisible(!1);let o="geologicalbody_cutline-"+(new Date).getTime();p.push(o),viewer.entities.add({id:o,polyline:{positions:e.result.object.positions,width:2,material:SuperMap3D.Color.fromCssColorString("#51ff00")}})}),(e=>{console.log(e)})),window.handlerPolyline.activate()},startCut:function(){tooltip.setVisible(!1),be("Polyline"),0!==p.length?n.build():window.tooltip.showAt(" <p>请先绘制剖切的线段</p>","350px")},clearCut:y,startDig:function(){w(),h()},clearDig:w,startDrilling:function(){b(),viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),window.tooltip.showAt(" <p>点击鼠标左键确认钻孔位置</p><p>鼠标右键结束绘制并执行钻孔</p>","350px"),console.log(1),viewer.eventManager.addEventListener("CLICK",g,!0),viewer.eventManager.addEventListener("RIGHT_CLICK",f,!0)},clearDrilling:b,startClip:function(){v(),n.clippingType=SuperMap3D.ClippingType[l.drawClipMode],"drawClip"!==l.clipType?function(){r&&r.deactivate();tooltip.showAt(" <p>点击鼠标左键开始绘制box底面</p><p>然后移动鼠标绘制box高度</p><p>点击鼠标右键结束绘制</p>","350px"),window.handlerBox||ge("Box");fe("Box",!1).then((e=>{let t=window.handlerBox;!function(e){e.show=!1;let t=e.box.dimensions.getValue(),o=SuperMap3D.Cartographic.fromCartesian(e.position.getValue(0));if(d=new SuperMap3D.GeoBox(t.x,t.y,t.z),d.geoPosition=new SuperMap3D.Point3D(SuperMap3D.Math.toDegrees(o.longitude),SuperMap3D.Math.toDegrees(o.latitude),o.height),n.addProfileGeometry(d),n.build(),r)r.setEditObject(e);else{r=new SuperMap3D.BoxEditor(viewer,e),r.color=SuperMap3D.Color.WHITE.withAlpha(0),r.hoverColor=SuperMap3D.Color.BLUE;let t=function(e){let t=e.dimensions;d.geoWidth=t.y,d.geoHeight=t.z,d.geoLength=t.x;let o=we.CartesiantoDegrees(e.position);d.geoPosition=new SuperMap3D.Point3D(o[0],o[1],o[2]),d.geoRotationZ=r.hpr.heading*(180/SuperMap3D.Math.PI)};r.editEvt.addEventListener(t)}r.activate()}(e.result.object),t.deactivate()}),(e=>{console.log(e)})),window.handlerBox.activate()}():h()},clearClip:v}}Wm.render=function(e,t,o,n,a,s){const y=r("stopdrag"),w=r("drag");return d((l(),i("div",jm,[d(p("div",Km,[p("div",Qm,[p("label",Xm,m(e.Resource.scanMode),1),p("div",Ym,[p("label",Zm,[d(p("input",{type:"radio",value:"lineMode","onUpdate:modelValue":t[1]||(t[1]=e=>n.scanMode=e),style:{"margin-right":"0"}},null,512),[[c,n.scanMode]]),u(" "+m(e.Resource.lineScan),1)]),p("label",qm,[d(p("input",{type:"radio",value:"ringMode","onUpdate:modelValue":t[2]||(t[2]=e=>n.scanMode=e),style:{"margin-right":"0"}},null,512),[[c,n.scanMode]]),u(" "+m(e.Resource.circularScan),1)])])]),d(p("div",Jm,[p("label",$m,m(e.Resource.scanTexture),1),d(p("select",{class:"sm-select-m",style:{width:"68%"},"onUpdate:modelValue":t[3]||(t[3]=e=>n.selectedTextureIndex=e)},[(l(!0),i(S,null,R(n.scanTextures,((e,t)=>(l(),i("option",{value:t,key:t},m(e.name),9,["value"])))),128))],512),[[f,n.selectedTextureIndex]])],512),[[h,n.scanTextures.length>0]]),p("div",ey,[p("button",{class:"tbtn",type:"button",onClick:t[4]||(t[4]=(...e)=>n.addScans&&n.addScans(...e))},m(e.Resource.add),1),p("button",{class:"tbtn tbtn-margin-left",type:"button ",onClick:t[5]||(t[5]=(...e)=>n.clear&&n.clear(...e))},m(e.Resource.clear),1)])],512),[[y]])],512)),[[w]])},Wm.__file="src/components/special-effects/scan-effect/scan-effect.vue",Wm.install=function(e){e.component(Wm.name,Wm)};var oy={name:"Sm3dGeologicalBody",props:{},setup(e){let{operationType:t,stretchHeight:o,drawLine:l,startCut:i,clearCut:n,digHeight:a,startDig:s,clearDig:r,startDrilling:d,clearDrilling:p,drillHeight:c,drillRadius:u,startClip:m,clearClip:y,clipType:h,drawClipMode:w}=ty(e);return{operationType:t,stretchHeight:o,drawLine:l,startCut:i,clearCut:n,digHeight:a,startDig:s,clearDig:r,startDrilling:d,clearDrilling:p,drillHeight:c,drillRadius:u,startClip:m,clearClip:y,clipType:h,drawClipMode:w}}};const ly={id:"geological-body-panel",class:"sm-panel"},iy={class:"sm-function-module-sub-section",style:{margin:"0"}},ny={class:"sm-half-L"},ay={style:{width:"33%"}},sy={value:"stretch_cut"},ry={value:"dig"},dy={value:"drilling"},py={value:"clip"},cy={class:"sm-half-L"},uy={style:{width:"33%"}},my={class:"boxchild",style:{"padding-bottom":"0"}},yy={class:"sm-half-L"},hy={style:{width:"33%"}},wy={class:"boxchild",style:{"padding-bottom":"0"}},gy={class:"sm-half-L"},fy={style:{width:"33%"}},by={class:"sm-half-L"},vy={style:{width:"33%"}},Sy={class:"boxchild",style:{"padding-bottom":"0"}},Cy={style:{width:"100%"}},My={class:"sm-half-L"},Dy={style:{width:"auto"}},Ry={style:{width:"auto"}},xy={class:"sm-half-L"},Ly={style:{width:"33%"}},Py={value:"KeepInside"},Vy={value:"KeepOutside"},ky={class:"boxchild",style:{"padding-bottom":"0"}};function Ey(e){this.tableName=e.tableName,this.opacityMinValue=e.opacityMinValue,this.opacityMaxValue=e.opacityMaxValue,this.gradientMinOpacity=e.gradientMinOpacity,this.gradientMaxOpacity=e.gradientMaxOpacity,this.visibleMinValue=e.visibleMinValue,this.visibleMaxValue=e.visibleMaxValue}function Ny(o){let l,i=e({dataUrl:"",operationType:"addDate",dimensions:[],variables:[],selectedDateName:null,xDim:100,yDim:200,zDim:9,timeDim:40,drawMode:"volume",opacityInterval:[0,1],useGradientOpacity:!1,gradientOpacityValue:[0,1],gradientOpacity:[0,1],showClipPlane:!1,clipX:.5,clipY:.5,clipRotate:0,xOffset:.5,yOffset:.5,zOffset:.5,contourValue:1,contourRange:[0,1],zScale:0,colorInterval:[0,1],timeOrder:0,timeRange:[0,24],openLight:!1});if(o)for(let e in o)i.hasOwnProperty(e)?i[e]=o[e]:we.Message.errorMsg(ce.AttributeError+e);let n,r=new SuperMap3D.Cartesian3(1,1,1),d=new SuperMap3D.Cartesian3(.5,.5,.5),p=SuperMap3D.Plane.fromPointNormal(new SuperMap3D.Cartesian3(0,0,0),new SuperMap3D.Cartesian3(1,0,0));function c(){if(!i.dataUrl)return we.Message.warnMsg("请先定义数据路径！");let e=viewer.scene.addVoxelGridLayer(i.dataUrl,"test");SuperMap3D.when(e,(function(e){l=e,i.dimensions=l._NetCDFInfo.dimensions,i.variables=l._NetCDFInfo.variables,i.selectedDateName=i.variables[0].name,i.xDim=i.dimensions[0].name,i.yDim=i.dimensions[1].name,i.zDim=i.dimensions[2].name,i.timeDim=i.dimensions[3].name,l.layerBounds=new SuperMap3D.Rectangle(99.95422,32.25671,107.1912,37.1386),l.zBounds=new SuperMap3D.Cartesian2(500,5e4)}))}function u(){let e=l.layerBounds.west+(l.layerBounds.east-l.layerBounds.west)*Number(i.clipX),t=l.layerBounds.south+(l.layerBounds.north-l.layerBounds.south)*Number(i.clipY);viewer.entities.removeById("volume-clip-plane"),viewer.entities.add({id:"volume-clip-plane",position:SuperMap3D.Cartesian3.fromDegrees(e,t,5e4),point:{color:SuperMap3D.Color.YELLOW,pixelSize:10}})}return V.isViewer&&(window.tooltip||(window.tooltip=se(viewer._element)),c()),s((()=>V.isViewer),(e=>{e&&(window.tooltip||(window.tooltip=se(viewer._element)),c())})),t((()=>{viewer.scene.layers.remove(l.name),l=null})),s((()=>i.drawMode),(e=>{l&&(l.volumeRenderMode="slice"===e?1:"gradient"===e?2:0)})),s((()=>i.useGradientOpacity),(e=>{l&&(l.useGradientOpacity=e)})),s((()=>i.gradientOpacityValue),(e=>{l&&(n.gradientMinOpacity=e[0],n.gradientMaxOpacity=e[1],n.setGradientOpacityValue(l))})),s((()=>i.opacityInterval),(e=>{l&&(n.opacityMinValue=e[0],n.opacityMaxValue=e[1],n.setColorTable(l))})),s((()=>i.gradientOpacity),(e=>{l&&(l.gradientOpacityMinOpacity=e[0],l.gradientOpacityMaxOpacity=e[1])})),s((()=>i.zScale),(e=>{l&&(r.z=parseFloat(e),l.scale=r)})),s((()=>i.colorInterval),(e=>{l&&(n.visibleMinValue=e[0],n.visibleMaxValue=e[1],n.setColorTable(l))})),s((()=>i.timeOrder),(e=>{l&&(l.frameIndex=Number(e))})),s((()=>i.openLight),(e=>{l&&(l.enableLighting=e)})),s((()=>i.clipX),(e=>{if(!l)return;u();let t=parseFloat(e),o=parseFloat(i.clipY),n=SuperMap3D.Math.toRadians(i.clipRotate),a=SuperMap3D.Quaternion.fromAxisAngle(SuperMap3D.Cartesian3.UNIT_Z,n),s=new SuperMap3D.Cartesian3(t,o,0),r=new SuperMap3D.TranslationRotationScale(s,a),d=SuperMap3D.Matrix4.fromTranslationRotationScale(r);SuperMap3D.Plane.fromPointNormal(new SuperMap3D.Cartesian3(0,0,0),new SuperMap3D.Cartesian3(1,0,0),p),SuperMap3D.Plane.transform(p,d,p)})),s((()=>i.clipY),(e=>{if(l){u();var t=parseFloat(i.clipX),o=parseFloat(e),n=new SuperMap3D.Cartesian3(t,o,0);SuperMap3D.Plane.fromPointNormal(n,new SuperMap3D.Cartesian3(0,1,0),p)}})),s((()=>i.clipRotate),(e=>{if(l){var t=parseFloat(i.clipX),o=parseFloat(i.clipY),n=SuperMap3D.Math.toRadians(e),a=SuperMap3D.Quaternion.fromAxisAngle(SuperMap3D.Cartesian3.UNIT_Z,n),s=new SuperMap3D.Cartesian3(t,o,0),r=SuperMap3D.Matrix3.fromQuaternion(a),d=SuperMap3D.Matrix4.fromRotationTranslation(r),c=new SuperMap3D.Cartesian3(1,0,0);c=SuperMap3D.Matrix4.multiplyByPoint(d,c,new SuperMap3D.Cartesian3),SuperMap3D.Plane.fromPointNormal(s,c,p)}})),s((()=>i.xOffset),(e=>{l&&(d.x=parseFloat(e),l.sliceCoordinate=d)})),s((()=>i.yOffset),(e=>{l&&(d.y=parseFloat(e),l.sliceCoordinate=d)})),s((()=>i.zOffset),(e=>{l&&(d.z=parseFloat(e),l.sliceCoordinate=d)})),s((()=>i.contourValue),(e=>{l&&(l.contourValue=parseFloat(e))})),{...a(i),startRender:function(){l?i.xDim!=i.yDim&&i.xDim!=i.zDim&&i.yDim!=i.zDim?(n=new Ey({opacityMinValue:0,opacityMaxValue:.8,gradientMinOpacity:1,gradientMaxOpacity:1,visibleMinValue:0,visibleMaxValue:.37}),n.setColorTable(l,0),l.startRender({variableName:i.selectedDateName,xDimName:i.xDim,yDimName:i.yDim,zDimName:i.zDim,timeDimName:i.timeDim}),function(){i.contourRange=[Math.ceil(l.minValue),Math.ceil(l.maxValue)],i.contourValue=Math.ceil(l.minValue);let e=l._NetCDFInfo.recordDimension;e&&e.length>0&&(i.timeRange=[0,e.length])}(),viewer.scene.camera.flyTo({destination:{x:-1688158.0372444934,y:6654029.431965283,z:2998692.1265170774},orientation:{heading:.028840576504810755,pitch:-.8994386458052253,roll:6.283185307179586}})):we.Message.warnMsg("各维度名不能一样"):c()},addClipPlane:function(){!SuperMap3D.defined(l)||l.getNumberOfClipPlanes()>0||(i.showClipPlane=!0,l.addClipPlane(p),u())},removeClipPlane:function(){SuperMap3D.defined(l)&&0!==l.getNumberOfClipPlanes()&&(i.showClipPlane=!1,l.removeAllClipPlanes(),viewer.entities.removeById("volume-clip-plane"))},clear:function(){l&&(viewer.scene.layers.remove(l.name),l=null,c())}}}oy.render=function(e,t,o,n,a,s){const w=r("stopdrag"),g=r("drag");return d((l(),i("div",ly,[d(p("div",iy,[p("div",ny,[p("label",ay,m(e.Resource.operationType),1),d(p("select",{class:"sm-select-m",style:{width:"65%"},"onUpdate:modelValue":t[1]||(t[1]=e=>n.operationType=e)},[p("option",sy,m(e.Resource.stretch_cut),1),p("option",ry,m(e.Resource.excavation),1),p("option",dy,m(e.Resource.drilling),1),p("option",py,m(e.Resource.clip),1),b(' <option value="volume">叠加体元</option> ')],512),[[f,n.operationType]])]),b(" 拉伸与剖切 "),d(p("div",null,[p("div",cy,[p("label",uy,m(e.Resource.stretchHeight),1),d(p("input",{type:"number",class:"sm-input",style:{width:"65%"},min:"1","onUpdate:modelValue":t[2]||(t[2]=e=>n.stretchHeight=e)},null,512),[[y,n.stretchHeight]])]),p("div",my,[p("button",{class:"tbtn",type:"button",onClick:t[3]||(t[3]=(...e)=>n.drawLine&&n.drawLine(...e))},m(e.Resource.drawLine),1),p("button",{class:"tbtn tbtn-margin-left",type:"button ",onClick:t[4]||(t[4]=(...e)=>n.startCut&&n.startCut(...e))},m(e.Resource.cut),1),p("button",{class:"tbtn tbtn-margin-left",type:"button ",onClick:t[5]||(t[5]=(...e)=>n.clearCut&&n.clearCut(...e))},m(e.Resource.clear),1)])],512),[[h,"stretch_cut"===n.operationType]]),b(" 开挖 "),d(p("div",null,[p("div",yy,[p("label",hy,m(e.Resource.terrainExcavationDepth),1),d(p("input",{type:"number",class:"sm-input",style:{width:"65%"},min:"1","onUpdate:modelValue":t[6]||(t[6]=e=>n.digHeight=e)},null,512),[[y,n.digHeight]])]),p("div",wy,[p("button",{class:"tbtn",type:"button",onClick:t[7]||(t[7]=(...e)=>n.startDig&&n.startDig(...e))},m(e.Resource.excavation),1),p("button",{class:"tbtn tbtn-margin-left",type:"button ",onClick:t[8]||(t[8]=(...e)=>n.clearDig&&n.clearDig(...e))},m(e.Resource.clear),1)])],512),[[h,"dig"===n.operationType]]),b(" 钻孔 "),d(p("div",null,[p("div",gy,[p("label",fy,m(e.Resource.drillRadius),1),d(p("input",{type:"number",class:"sm-input",style:{width:"65%"},min:"1","onUpdate:modelValue":t[9]||(t[9]=e=>n.drillRadius=e)},null,512),[[y,n.drillRadius]])]),p("div",by,[p("label",vy,m(e.Resource.drillHeight),1),d(p("input",{type:"number",class:"sm-input",style:{width:"65%"},min:"1","onUpdate:modelValue":t[10]||(t[10]=e=>n.drillHeight=e)},null,512),[[y,n.drillHeight]])]),p("div",Sy,[p("button",{class:"tbtn",type:"button",onClick:t[11]||(t[11]=(...e)=>n.startDrilling&&n.startDrilling(...e))},m(e.Resource.drilling),1),p("button",{class:"tbtn tbtn-margin-left",type:"button ",onClick:t[12]||(t[12]=(...e)=>n.clearDrilling&&n.clearDrilling(...e))},m(e.Resource.clear),1)])],512),[[h,"drilling"===n.operationType]]),b(" 裁剪 "),d(p("div",Cy,[p("div",My,[p("label",Dy,[d(p("input",{type:"radio",value:"drawClip","onUpdate:modelValue":t[13]||(t[13]=e=>n.clipType=e)},null,512),[[c,n.clipType]]),u(" "+m(e.Resource.drawClip),1)]),p("label",Ry,[d(p("input",{type:"radio",value:"boxClip","onUpdate:modelValue":t[14]||(t[14]=e=>n.clipType=e)},null,512),[[c,n.clipType]]),u(" "+m(e.Resource.boxClip),1)])]),d(p("div",xy,[p("label",Ly,m(e.Resource.clipMode),1),d(p("select",{class:"sm-select-m",style:{width:"65%"},"onUpdate:modelValue":t[15]||(t[15]=e=>n.drawClipMode=e)},[p("option",Py,m(e.Resource.clipOutside),1),p("option",Vy,m(e.Resource.clipInside),1)],512),[[f,n.drawClipMode]])],512),[[h,"drawClip"===n.clipType]]),p("div",ky,[p("button",{class:"tbtn",type:"button",onClick:t[16]||(t[16]=(...e)=>n.startClip&&n.startClip(...e))},m(e.Resource.clip),1),p("button",{class:"tbtn tbtn-margin-left",type:"button ",onClick:t[17]||(t[17]=(...e)=>n.clearClip&&n.clearClip(...e))},m(e.Resource.clear),1)])],512),[[h,"clip"===n.operationType]])],512),[[w]])],512)),[[g]])},oy.__file="src/components/model/geological-body/geological-body.vue",oy.install=function(e){e.component(oy.name,oy)},Ey.prototype.setColorTable=function(e,t){if(SuperMap3D.defined(e)){var o=e.minValue,l=e.maxValue,i=this.visibleMinValue,n=this.visibleMaxValue;if(i>n){var a=i;i=n,n=a}this.setOpacityFunction(e,o,l,i,n),this.setColorFunction(e,o,l,i,n,t)}},Ey.prototype.setOpacityFunction=function(e,t,o,l,i){var n=this.opacityMinValue,a=this.opacityMaxValue,s=new SuperMap3D.PiecewiseFunction;s.addPoint(t,0),s.addPoint(t+(o-t)*l,n),s.addPoint(t+(o-t)*i,a),s.addPoint(t+(o-t)*(i+.01),n),s.addPoint(o,0),e.opacityTransferFunction=s},Ey.prototype.setColorFunction=function(e,t,o,l,i,n){var a=new SuperMap3D.ColorTransferFunction,s=(i-l)/15;switch(n){case 1:a.addRGBPoint(t,9/255,9/255,212/255),a.addRGBPoint(t+(o-t)*l,9/255,10/255,1),a.addRGBPoint(t+(o-t)*(l+s),9/255,.2,1),a.addRGBPoint(t+(o-t)*(l+2*s),9/255,.4,1),a.addRGBPoint(t+(o-t)*(l+3*s),9/255,.6,1),a.addRGBPoint(t+(o-t)*(l+4*s),9/255,.8,1),a.addRGBPoint(t+(o-t)*(l+5*s),9/255,1,1),a.addRGBPoint(t+(o-t)*(l+6*s),.2,1,.8),a.addRGBPoint(t+(o-t)*(l+7*s),.4,1,.6),a.addRGBPoint(t+(o-t)*(l+8*s),.6,1,.4),a.addRGBPoint(t+(o-t)*(l+9*s),.8,1,.2),a.addRGBPoint(t+(o-t)*(l+10*s),1,1,0),a.addRGBPoint(t+(o-t)*(l+11*s),1,.8,0),a.addRGBPoint(t+(o-t)*(l+12*s),1,.6,0),a.addRGBPoint(t+(o-t)*(l+13*s),1,.4,0),a.addRGBPoint(t+(o-t)*(l+14*s),1,.2,0),a.addRGBPoint(t+(o-t)*(l+15*s),1,0,0);break;case 2:a.addRGBPoint(t,1,103/255,103/255),a.addRGBPoint(t+(o-t)*l,1,0,1),a.addRGBPoint(t+(o-t)*(l+s),1,.2,1),a.addRGBPoint(t+(o-t)*(l+2*s),1,.4,1),a.addRGBPoint(t+(o-t)*(l+3*s),1,.6,1),a.addRGBPoint(t+(o-t)*(l+4*s),1,.8,1),a.addRGBPoint(t+(o-t)*(l+5*s),1,1,1),a.addRGBPoint(t+(o-t)*(l+6*s),.2,1,.8),a.addRGBPoint(t+(o-t)*(l+7*s),.4,1,.6),a.addRGBPoint(t+(o-t)*(l+8*s),.6,1,.4),a.addRGBPoint(t+(o-t)*(l+9*s),.8,1,.2),a.addRGBPoint(t+(o-t)*(l+10*s),1,1,0),a.addRGBPoint(t+(o-t)*(l+11*s),1,.8,0),a.addRGBPoint(t+(o-t)*(l+12*s),1,.6,0),a.addRGBPoint(t+(o-t)*(l+13*s),1,.4,0),a.addRGBPoint(t+(o-t)*(l+14*s),1,.2,0),a.addRGBPoint(t+(o-t)*(l+15*s),1,0,0);break;case 3:a.addRGBPoint(t,157/255,0,1),a.addRGBPoint(t+(o-t)*l,157/255,0,1),a.addRGBPoint(t+(o-t)*(l+s),157/255,.2,1),a.addRGBPoint(t+(o-t)*(l+2*s),157/255,.4,1),a.addRGBPoint(t+(o-t)*(l+3*s),157/255,.6,1),a.addRGBPoint(t+(o-t)*(l+4*s),157/255,.8,1),a.addRGBPoint(t+(o-t)*(l+5*s),157/255,1,1),a.addRGBPoint(t+(o-t)*(l+6*s),.2,1,.8),a.addRGBPoint(t+(o-t)*(l+7*s),.4,1,.6),a.addRGBPoint(t+(o-t)*(l+8*s),.6,1,.4),a.addRGBPoint(t+(o-t)*(l+9*s),.8,1,.2),a.addRGBPoint(t+(o-t)*(l+10*s),1,1,0),a.addRGBPoint(t+(o-t)*(l+11*s),1,.8,0),a.addRGBPoint(t+(o-t)*(l+12*s),1,.6,0),a.addRGBPoint(t+(o-t)*(l+13*s),1,.4,0),a.addRGBPoint(t+(o-t)*(l+14*s),1,.2,0),a.addRGBPoint(t+(o-t)*(l+15*s),1,0,0);break;case 4:a.addRGBPoint(t,149/255,232/255,249/255),a.addRGBPoint(t+(o-t)*l,149/255,0,1),a.addRGBPoint(t+(o-t)*(l+s),149/255,.2,1),a.addRGBPoint(t+(o-t)*(l+2*s),149/255,.4,1),a.addRGBPoint(t+(o-t)*(l+3*s),149/255,.6,1),a.addRGBPoint(t+(o-t)*(l+4*s),149/255,.8,1),a.addRGBPoint(t+(o-t)*(l+5*s),149/255,1,1),a.addRGBPoint(t+(o-t)*(l+6*s),.2,1,.8),a.addRGBPoint(t+(o-t)*(l+7*s),.4,1,.6),a.addRGBPoint(t+(o-t)*(l+8*s),.6,1,.4),a.addRGBPoint(t+(o-t)*(l+9*s),.8,1,.2),a.addRGBPoint(t+(o-t)*(l+10*s),1,1,0),a.addRGBPoint(t+(o-t)*(l+11*s),1,.8,0),a.addRGBPoint(t+(o-t)*(l+12*s),1,.6,0),a.addRGBPoint(t+(o-t)*(l+13*s),1,.4,0),a.addRGBPoint(t+(o-t)*(l+14*s),1,.2,0),a.addRGBPoint(t+(o-t)*(l+15*s),1,0,0);break;case 5:a.addRGBPoint(t,26/255,1,156/255),a.addRGBPoint(t+(o-t)*l,26/255,0,1),a.addRGBPoint(t+(o-t)*(l+s),26/255,.2,1),a.addRGBPoint(t+(o-t)*(l+2*s),26/255,.4,1),a.addRGBPoint(t+(o-t)*(l+3*s),26/255,.6,1),a.addRGBPoint(t+(o-t)*(l+4*s),26/255,.8,1),a.addRGBPoint(t+(o-t)*(l+5*s),26/255,1,1),a.addRGBPoint(t+(o-t)*(l+6*s),.2,1,.8),a.addRGBPoint(t+(o-t)*(l+7*s),.4,1,.6),a.addRGBPoint(t+(o-t)*(l+8*s),.6,1,.4),a.addRGBPoint(t+(o-t)*(l+9*s),.8,1,.2),a.addRGBPoint(t+(o-t)*(l+10*s),1,1,0),a.addRGBPoint(t+(o-t)*(l+11*s),1,.8,0),a.addRGBPoint(t+(o-t)*(l+12*s),1,.6,0),a.addRGBPoint(t+(o-t)*(l+13*s),1,.4,0),a.addRGBPoint(t+(o-t)*(l+14*s),1,.2,0),a.addRGBPoint(t+(o-t)*(l+15*s),1,0,0);break;default:a.addRGBPoint(t,0,0,1),a.addRGBPoint(t+(o-t)*l,0,0,1),a.addRGBPoint(t+(o-t)*(l+s),0,.2,1),a.addRGBPoint(t+(o-t)*(l+2*s),0,.4,1),a.addRGBPoint(t+(o-t)*(l+3*s),0,.6,1),a.addRGBPoint(t+(o-t)*(l+4*s),0,.8,1),a.addRGBPoint(t+(o-t)*(l+5*s),0,1,1),a.addRGBPoint(t+(o-t)*(l+6*s),.2,1,.8),a.addRGBPoint(t+(o-t)*(l+7*s),.4,1,.6),a.addRGBPoint(t+(o-t)*(l+8*s),.6,1,.4),a.addRGBPoint(t+(o-t)*(l+9*s),.8,1,.2),a.addRGBPoint(t+(o-t)*(l+10*s),1,1,0),a.addRGBPoint(t+(o-t)*(l+11*s),1,.8,0),a.addRGBPoint(t+(o-t)*(l+12*s),1,.6,0),a.addRGBPoint(t+(o-t)*(l+13*s),1,.4,0),a.addRGBPoint(t+(o-t)*(l+14*s),1,.2,0),a.addRGBPoint(t+(o-t)*(l+15*s),1,0,0)}l+15*s<1&&a.addRGBPoint(o,1,0,0),e.colorTransferFunction=a},Ey.prototype.setGradientOpacityValue=function(e){var t=e.minValue,o=e.maxValue,l=this.gradientMinOpacity,i=this.gradientMaxOpacity;if(l>i){var n=l;l=i,i=n}e.gradientOpacityMinValue=.1*Math.abs(o-t)*l,e.gradientOpacityMaxValue=.1*Math.abs(o-t)*i};var Ty={name:"Sm3dVolumeRender",props:{dataUrl:{type:String,required:!0}},setup(e){let{operationType:t,dimensions:o,variables:l,selectedDateName:i,xDim:n,yDim:a,zDim:s,timeDim:r,drawMode:d,opacityInterval:p,useGradientOpacity:c,gradientOpacityValue:u,gradientOpacity:m,openLight:y,showClipPlane:h,clipX:w,clipY:g,clipRotate:f,addClipPlane:b,removeClipPlane:v,xOffset:S,yOffset:C,zOffset:M,contourValue:D,zScale:R,colorInterval:x,timeOrder:L,startRender:P,contourRange:V,timeRange:k,clear:E}=Ny(e);return{operationType:t,dimensions:o,variables:l,selectedDateName:i,xDim:n,yDim:a,zDim:s,timeDim:r,drawMode:d,opacityInterval:p,useGradientOpacity:c,gradientOpacityValue:u,gradientOpacity:m,openLight:y,showClipPlane:h,clipX:w,clipY:g,clipRotate:f,addClipPlane:b,removeClipPlane:v,xOffset:S,yOffset:C,zOffset:M,contourValue:D,zScale:R,colorInterval:x,timeOrder:L,startRender:P,contourRange:V,timeRange:k,clear:E}}};const Ay={id:"volume-panel",class:"sm-panel"},By={class:"sm-function-module-sub-section",style:{margin:"0"}},Iy={class:"sm-half-L"},_y={style:{width:"auto"}},Fy=u(" 数据加载 "),Oy={style:{width:"auto"}},Uy=u(" 数据操作 "),Hy={class:"sm-half-L"},zy=p("label",{style:{width:"auto"}},"数据加载中···",-1),Gy={style:{width:"100%"}},Wy={class:"sm-half-L"},jy=p("label",{style:{width:"30%"}},"数据名称",-1),Ky={class:"sm-half-L"},Qy=p("label",{style:{width:"30%"}},"X轴方向",-1),Xy={class:"sm-half-L"},Yy=p("label",{style:{width:"30%"}},"Y轴方向",-1),Zy={class:"sm-half-L"},qy=p("label",{style:{width:"30%"}},"Z轴方向",-1),Jy={class:"sm-half-L"},$y=p("label",{style:{width:"30%"}},"时间纬度",-1),eh={class:"boxchild",style:{"padding-bottom":"0"}},th={style:{width:"100%"}},oh={class:"sm-half-L"},lh=p("label",{style:{width:"38%"}},"绘制模式",-1),ih=p("option",{value:"volume"},"数值模式",-1),nh=p("option",{value:"slice"},"剖切模式",-1),ah=p("option",{value:"gradient"},"等值面模式",-1),sh={style:{width:"100%"}},rh={class:"sm-half-L"},dh={style:{width:"auto"}},ph=u("使用梯度透明度 "),ch={class:"sm-half-L"},uh=p("label",{style:{width:"40%"}},"梯度作用域",-1),mh={class:"sm-half-L"},yh=p("label",{style:{width:"40%"}},"梯度透明度",-1),hh={class:"sm-half-L"},wh=p("label",{style:{width:"40%"}},"透明范围",-1),gh={style:{width:"100%"}},fh={class:"sm-half-L"},bh=p("label",{style:{width:"40%"}},"沿X轴偏移",-1),vh={class:"sm-half-L"},Sh=p("label",{style:{width:"40%"}},"沿Y轴偏移",-1),Ch={class:"sm-half-L"},Mh=p("label",{style:{width:"40%"}},"沿Z轴偏移",-1),Dh={class:"sm-half-L"},Rh=p("label",{style:{width:"40%"}},"等值面",-1),xh={class:"sm-half-L"},Lh=p("label",{style:{width:"40%"}},"沿Z轴缩放",-1),Ph={class:"sm-half-L"},Vh=p("label",{style:{width:"40%"}},"颜色范围",-1),kh={class:"sm-half-L"},Eh=p("label",{style:{width:"40%"}},"时间序列",-1),Nh={class:"sm-half-L"},Th=p("label",{style:{width:"40%"}},"裁剪面X方向",-1),Ah={class:"sm-half-L"},Bh=p("label",{style:{width:"40%"}},"裁剪面Y方向",-1),Ih={class:"sm-half-L"},_h=p("label",{style:{width:"40%"}},"裁剪面旋转",-1),Fh={class:"sm-half-L"},Oh={style:{width:"auto"}},Uh=u("开启光照 "),Hh={class:"boxchild",style:{"padding-bottom":"0"}};Ty.render=function(e,t,o,n,a,s){const u=g("el-slider"),y=r("stopdrag"),v=r("drag");return d((l(),i("div",Ay,[d(p("div",By,[p("div",Iy,[p("label",_y,[d(p("input",{type:"radio",value:"addDate","onUpdate:modelValue":t[1]||(t[1]=e=>n.operationType=e)},null,512),[[c,n.operationType]]),Fy]),p("label",Oy,[d(p("input",{type:"radio",value:"operation","onUpdate:modelValue":t[2]||(t[2]=e=>n.operationType=e)},null,512),[[c,n.operationType]]),Uy])]),b(" 数据加载 "),d(p("div",Hy,[zy],512),[[h,!n.variables||0===n.variables.length]]),d(p("div",Gy,[p("div",Wy,[jy,d(p("select",{class:"sm-select-m",style:{width:"68%"},"onUpdate:modelValue":t[3]||(t[3]=e=>n.selectedDateName=e)},[(l(!0),i(S,null,R(n.variables,((e,t)=>(l(),i("option",{value:e.name,key:t},m(e.name),9,["value"])))),128))],512),[[f,n.selectedDateName]])]),p("div",Ky,[Qy,d(p("select",{class:"sm-select-m",style:{width:"68%"},"onUpdate:modelValue":t[4]||(t[4]=e=>n.xDim=e)},[(l(!0),i(S,null,R(n.dimensions,((e,t)=>(l(),i("option",{value:e.name,key:t},m(e.name+":"+e.size),9,["value"])))),128))],512),[[f,n.xDim]])]),p("div",Xy,[Yy,d(p("select",{class:"sm-select-m",style:{width:"68%"},"onUpdate:modelValue":t[5]||(t[5]=e=>n.yDim=e)},[(l(!0),i(S,null,R(n.dimensions,((e,t)=>(l(),i("option",{value:e.name,key:t},m(e.name+":"+e.size),9,["value"])))),128))],512),[[f,n.yDim]])]),p("div",Zy,[qy,d(p("select",{class:"sm-select-m",style:{width:"68%"},"onUpdate:modelValue":t[6]||(t[6]=e=>n.zDim=e)},[(l(!0),i(S,null,R(n.dimensions,((e,t)=>(l(),i("option",{value:e.name,key:t},m(e.name+":"+e.size),9,["value"])))),128))],512),[[f,n.zDim]])]),p("div",Jy,[$y,d(p("select",{class:"sm-select-m",style:{width:"68%"},"onUpdate:modelValue":t[7]||(t[7]=e=>n.timeDim=e)},[(l(!0),i(S,null,R(n.dimensions,((e,t)=>(l(),i("option",{value:e.name,key:t},m(e.name+":"+e.size),9,["value"])))),128))],512),[[f,n.timeDim]])]),p("div",eh,[p("button",{class:"tbtn",type:"button",onClick:t[8]||(t[8]=(...e)=>n.startRender&&n.startRender(...e))},"加载"),p("button",{class:"tbtn tbtn-margin-left",type:"button",onClick:t[9]||(t[9]=(...e)=>n.clear&&n.clear(...e))},"清除")])],512),[[h,"addDate"===n.operationType&&n.variables.length>0]]),b(" 操作模式 "),d(p("div",th,[p("div",oh,[lh,d(p("select",{class:"sm-select-m",style:{width:"60%"},"onUpdate:modelValue":t[10]||(t[10]=e=>n.drawMode=e)},[ih,nh,ah],512),[[f,n.drawMode]])]),b(" 数值模式 "),d(p("div",sh,[p("div",rh,[p("label",dh,[d(p("input",{checked:"",type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=e=>n.useGradientOpacity=e)},null,512),[[w,n.useGradientOpacity]]),ph])]),d(p("div",ch,[uh,p(u,{modelValue:n.gradientOpacityValue,"onUpdate:modelValue":t[12]||(t[12]=e=>n.gradientOpacityValue=e),min:0,max:1,range:"",step:.01,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue","step"])],512),[[h,n.useGradientOpacity]]),d(p("div",mh,[yh,p(u,{modelValue:n.gradientOpacity,"onUpdate:modelValue":t[13]||(t[13]=e=>n.gradientOpacity=e),min:0,max:1,range:"",step:.01,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue","step"])],512),[[h,n.useGradientOpacity]]),p("div",hh,[wh,p(u,{modelValue:n.opacityInterval,"onUpdate:modelValue":t[14]||(t[14]=e=>n.opacityInterval=e),min:0,max:1,range:"",step:.01,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue","step"])])],512),[[h,"volume"===n.drawMode]]),b(" 剖切模式 "),d(p("div",gh,[p("div",fh,[bh,p(u,{modelValue:n.xOffset,"onUpdate:modelValue":t[15]||(t[15]=e=>n.xOffset=e),min:0,max:1,step:.01,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue","step"])]),p("div",vh,[Sh,p(u,{modelValue:n.yOffset,"onUpdate:modelValue":t[16]||(t[16]=e=>n.yOffset=e),min:0,max:1,step:.01,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue","step"])]),p("div",Ch,[Mh,p(u,{modelValue:n.zOffset,"onUpdate:modelValue":t[17]||(t[17]=e=>n.zOffset=e),min:0,max:1,step:.01,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue","step"])])],512),[[h,"slice"===n.drawMode]]),b(" 等值面 "),d(p("div",Dh,[Rh,p(u,{modelValue:n.contourValue,"onUpdate:modelValue":t[18]||(t[18]=e=>n.contourValue=e),min:n.contourRange[0],max:n.contourRange[1],step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue","min","max"])],512),[[h,"gradient"===n.drawMode]]),b(" 公共部分 "),d(p("div",xh,[Lh,p(u,{modelValue:n.zScale,"onUpdate:modelValue":t[19]||(t[19]=e=>n.zScale=e),min:1,step:.1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue","step"])],512),[[h,"gradient"!==n.drawMode]]),d(p("div",Ph,[Vh,p(u,{modelValue:n.colorInterval,"onUpdate:modelValue":t[20]||(t[20]=e=>n.colorInterval=e),min:0,max:1,range:"",step:.01,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue","step"])],512),[[h,"gradient"!==n.drawMode]]),p("div",kh,[Eh,p(u,{modelValue:n.timeOrder,"onUpdate:modelValue":t[21]||(t[21]=e=>n.timeOrder=e),min:0,max:n.timeRange[1],"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue","max"])]),d(p("div",Nh,[Th,p(u,{modelValue:n.clipX,"onUpdate:modelValue":t[22]||(t[22]=e=>n.clipX=e),min:0,max:1,step:.01,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue","step"])],512),[[h,n.showClipPlane]]),d(p("div",Ah,[Bh,p(u,{modelValue:n.clipY,"onUpdate:modelValue":t[23]||(t[23]=e=>n.clipY=e),min:0,max:1,step:.01,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue","step"])],512),[[h,n.showClipPlane]]),d(p("div",Ih,[_h,p(u,{modelValue:n.clipRotate,"onUpdate:modelValue":t[24]||(t[24]=e=>n.clipRotate=e),min:-180,max:180,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue"])],512),[[h,n.showClipPlane]]),p("div",Fh,[p("label",Oh,[d(p("input",{type:"checkbox","onUpdate:modelValue":t[25]||(t[25]=e=>n.openLight=e)},null,512),[[w,n.openLight]]),Uh])]),d(p("div",Hh,[p("button",{class:"tbtn",type:"button",onClick:t[26]||(t[26]=(...e)=>n.addClipPlane&&n.addClipPlane(...e)),style:{width:"auto"}},"添加裁剪面"),p("button",{class:"tbtn tbtn-margin-left",type:"button",style:{width:"auto"},onClick:t[27]||(t[27]=(...e)=>n.removeClipPlane&&n.removeClipPlane(...e))},"移除裁剪面")],512),[[h,"volume"===n.drawMode]])],512),[[h,"operation"===n.operationType]])],512),[[y]])],512)),[[v]])},Ty.__file="src/components/scene/volume-render/volume-render.vue",Ty.install=function(e){e.component(Ty.name,Ty)};const zh={class:"sm-function-module-sub-section",style:{margin:"0"}},Gh={class:"sm-half-L "},Wh={style:{width:"35%"}},jh={class:"sm-half-L"},Kh={style:{width:"35%"}},Qh={class:"sm-half-L"},Xh={style:{width:"35%"}},Yh={class:"sm-half-L"},Zh={style:{width:"35%"}},qh={class:"boxchild"};var Jh={expose:[],setup(o){const n=viewer.scene;let a,c,u=e({selectedType:"NONE",selectedId:0,showEditCheck:!0,emitRate:50,lifeRange:[.005,.25],speedRange:[1,10],scaleRange:[1,10],gravity:0}),y=new SuperMap3D.Matrix4;function h(){c=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas),c.setInputAction((function(e){let t=viewer.scene.pickPosition(e.position);var o;SuperMap3D.Transforms.eastNorthUpToFixedFrame(t,void 0,y),o="public/data/particle/Fire.json",SuperMap3D.ParticleHelper.fromJsonUrl(o,n).then((function(e){a=e,a.modelMatrix=y})),c.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)}function w(){SuperMap3D.defaultValue(a)&&n.primitives.remove(a)}return s((()=>u.emitRate),(e=>{a&&(a.emitRate=Number(e))})),s((()=>u.lifeRange),(e=>{e.length>1&&(a.minLifeTime=Number(e[0]),a.maxLifeTime=Number(e[1]))})),s((()=>u.speedRange),(e=>{e.length>1&&(a.minEmitPower=Number(e[0]),a.maxEmitPower=Number(e[1]))})),s((()=>u.scaleRange),(e=>{e.length>1&&(a.minSize=Number(e[0]),a.maxSize=Number(e[1]))})),t((()=>{w()})),(e,t)=>{const o=g("el-slider"),n=r("stopdrag");return l(),i(S,null,[d(p("div",zh,[b(" 参数设置 "),p("div",Gh,[p("label",Wh,m(e.Resource.emitSpeed),1),p(o,{modelValue:P(u).emitRate,"onUpdate:modelValue":t[1]||(t[1]=e=>P(u).emitRate=e),min:1,max:2500,step:20,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])]),p("div",jh,[p("label",Kh,m(e.Resource.lifeCycle),1),p(o,{modelValue:P(u).lifeRange,"onUpdate:modelValue":t[2]||(t[2]=e=>P(u).lifeRange=e),step:.001,range:"",min:.005,max:.25,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step","min","max"])]),p("div",Qh,[p("label",Xh,m(e.Resource.speedRange),1),p(o,{modelValue:P(u).speedRange,"onUpdate:modelValue":t[3]||(t[3]=e=>P(u).speedRange=e),step:1,range:"",min:1,max:100,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])]),p("div",Yh,[p("label",Zh,m(e.Resource.scaleRange),1),p(o,{modelValue:P(u).scaleRange,"onUpdate:modelValue":t[4]||(t[4]=e=>P(u).scaleRange=e),step:1,range:"",min:1,max:100,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])])],512),[[n]]),p("div",qh,[p("button",{type:"button",class:"tbtn",onClick:h},m(e.Resource.addParticle),1),p("button",{type:"button",class:"tbtn tbtn-margin-left",onClick:w},m(e.Resource.clearParticle),1)])],64)}},__file:"src/components/special-effects/particle-system/coms/fire.vue"};const $h={class:"sm-function-module-sub-section",style:{margin:"0"}},ew={class:"sm-half-L"},tw=p("label",{class:"label-S"},"发射类型",-1),ow={selected:"",value:"Cone"},lw={value:"Sphere"},iw={value:"Box"},nw={class:"sm-half-L "},aw={style:{width:"35%"}},sw={class:"sm-half-L "},rw={style:{width:"35%"}},dw={class:"sm-half-L "},pw={style:{width:"35%"}},cw={class:"sm-half-L "},uw={style:{width:"35%"}},mw={class:"sm-half-L "},yw={style:{width:"35%"}},hw={class:"sm-half-L "},ww={style:{width:"35%"}},gw={class:"boxchild"};var fw={expose:[],setup(o){const n=viewer.scene;let a,c,u=e({selectedType:"Cone",selectedId:0,showEditCheck:!0,setParam:!1,emitRate:1500,particleSize:1,lifeRange:[1,4],speedRange:[6,7],scaleRange:[1,4],gravity:-8}),y=new SuperMap3D.Matrix4;function h(){c=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas),c.setInputAction((function(e){let t=viewer.scene.pickPosition(e.position);var o;SuperMap3D.Transforms.eastNorthUpToFixedFrame(t,void 0,y),o="public/data/particle/fountain.json",SuperMap3D.ParticleHelper.fromJsonUrl(o,n).then((function(e){a=e,a.modelMatrix=y,a.start()})),c.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)}function w(){SuperMap3D.defaultValue(a)&&n.primitives.remove(a)}return s((()=>u.selectedType),(e=>{if(a)switch(e){case"Cone":a.createConeEmitter(1,1.05);break;case"Sphere":a.createSphereEmitter(1);break;case"Box":var t=new SuperMap3D.Cartesian3(-1,1,1),o=new SuperMap3D.Cartesian3(1,1,-1),l=new SuperMap3D.Cartesian3(-10,0,-10),i=new SuperMap3D.Cartesian3(10,0,10);a.createBoxEmitter(t,o,l,i)}})),s((()=>u.emitRate),(e=>{a&&(a.emitRate=Number(e))})),s((()=>u.particleSize),(e=>{a&&(a.minScaleX=Number(e),a.minScaleY=Number(e),a.maxScaleX=Number(e),a.maxScaleY=Number(e))})),s((()=>u.lifeRange),(e=>{a&&e.length>1&&(a.minLifeTime=Number(e[0]),a.maxLifeTime=Number(e[1]))})),s((()=>u.speedRange),(e=>{a&&e.length>1&&(a.minEmitPower=Number(e[0]),a.maxEmitPower=Number(e[1]))})),s((()=>u.scaleRange),(e=>{a&&e.length>1&&(a.minSize=Number(e[0]),a.maxSize=Number(e[1]))})),s((()=>u.gravity),(e=>{a&&(a.gravity=new SuperMap3D.Cartesian3(0,0,Number(e)))})),t((()=>{w()})),(e,t)=>{const o=g("el-slider"),n=r("stopdrag");return l(),i(S,null,[d(p("div",$h,[p("div",ew,[tw,d(p("select",{class:"sm-select-m","onUpdate:modelValue":t[1]||(t[1]=e=>P(u).selectedType=e)},[p("option",ow,m(e.Resource.coneEmit),1),p("option",lw,m(e.Resource.sphereEmit),1),p("option",iw,m(e.Resource.boxEmit),1)],512),[[f,P(u).selectedType]])]),p("div",nw,[p("label",aw,m(e.Resource.particleNumber),1),p(o,{modelValue:P(u).emitRate,"onUpdate:modelValue":t[2]||(t[2]=e=>P(u).emitRate=e),min:1,max:2500,step:20,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])]),p("div",sw,[p("label",rw,m(e.Resource.particleSize),1),p(o,{modelValue:P(u).particleSize,"onUpdate:modelValue":t[3]||(t[3]=e=>P(u).particleSize=e),min:1,max:60,step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])]),p("div",dw,[p("label",pw,m(e.Resource.lifeCycle),1),p(o,{modelValue:P(u).lifeRange,"onUpdate:modelValue":t[4]||(t[4]=e=>P(u).lifeRange=e),step:1,range:"",min:.1,max:30,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","min"])]),p("div",cw,[p("label",uw,m(e.Resource.speedRange),1),p(o,{modelValue:P(u).speedRange,"onUpdate:modelValue":t[5]||(t[5]=e=>P(u).speedRange=e),step:1,range:"",min:1,max:30,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])]),p("div",mw,[p("label",yw,m(e.Resource.scaleRange),1),p(o,{modelValue:P(u).scaleRange,"onUpdate:modelValue":t[6]||(t[6]=e=>P(u).scaleRange=e),step:1,range:"",min:1,max:10,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])]),p("div",hw,[p("label",ww,m(e.Resource.gravity),1),p(o,{modelValue:P(u).gravity,"onUpdate:modelValue":t[7]||(t[7]=e=>P(u).gravity=e),step:1,min:-20,max:20,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])])],512),[[n]]),p("div",gw,[p("button",{type:"button",class:"tbtn",onClick:h},m(e.Resource.addParticle),1),p("button",{type:"button",class:"tbtn tbtn-margin-left",onClick:w},m(e.Resource.clearParticle),1)])],64)}},__file:"src/components/special-effects/particle-system/coms/water.vue"};const bw={class:"boxchild"};var vw={expose:[],setup(e){const o=viewer.scene;let n,a=new SuperMap3D.Matrix4,s=[];o.skyAtmosphere=new SuperMap3D.SkyAtmosphere,o.globe.show=!1,o.skyAtmosphere.show=!1;let r=-2100;function d(e,t,l){e.modelMatrix=a,e.worldOffset.x=t.x,e.worldOffset.y=t.y,e.worldOffset.z=t.z;let i=setInterval((()=>{e.start()}),2e3+50*l);o.primitives.add(e),s.push(i)}function c(){o.globe.show=!1,o.skyAtmosphere.show=!1,n=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas),n.setInputAction((function(e){let t=viewer.scene.pickPosition(e.position);SuperMap3D.Transforms.eastNorthUpToFixedFrame(t,void 0,a),function(){for(let e=0;e<8;++e){let t=SuperMap3D.Math.randomBetween(r+300*e,r+300*(e+1)),l=SuperMap3D.Math.randomBetween(0,2e3),i=SuperMap3D.Math.randomBetween(150,550),n=new SuperMap3D.Cartesian3(t,l,i),a="";e%4==0&&(a="public/data/particle/babylon/sparkGravityOne.json"),e%4==1&&(a="public/data/particle/babylon/sparkGravityTwo.json"),e%4==2&&(a="public/data/particle/babylon/sparkGravityThree.json"),e%4==3&&(a="public/data/particle/babylon/sparkGravityFour.json"),SuperMap3D.ParticleHelper.fromJsonUrl(a,o).then((function(t){d(t,n,e)}))}}(),n.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)}function u(){o.globe.show=!0,o.skyAtmosphere.show=!0,s.length>0&&(s.forEach((e=>{clearInterval(e)})),s=[])}return t((()=>{u()})),(e,t)=>(l(),i("div",bw,[p("button",{type:"button",class:"tbtn",onClick:c},m(e.Resource.addParticle),1),p("button",{type:"button",class:"tbtn tbtn-margin-left",onClick:u},m(e.Resource.clearParticle),1)]))},__file:"src/components/special-effects/particle-system/coms/fireworks.vue"},Sw={name:"Sm3dParticleSystem",props:{},data:()=>({}),setup(o){let{particles:l,particleSelectedId:i}=function(o){let l=e({particles:[{id:0,iconfont:"iconhuoyan",particleName:"火焰"},{id:1,iconfont:"iconshui",particleName:"水"},{id:2,iconfont:"iconyanhua",particleName:"烟花"}],particleSelectedId:0});if(o)for(let e in o)l.hasOwnProperty(e)?null!=o[e]&&(l[e]=o[e]):we.Message.errorMsg(ce.AttributeError+e);return t((()=>{})),{...a(l)}}(o);return{particles:l,particleSelectedId:i,Fire:Jh,Water:fw,FireWorks:vw}}};const Cw={id:"scan-effect-panel",class:"sm-panel"},Mw={class:"sm-function-module-sub-section",style:{margin:"0"}},Dw={class:"sm-half-L symbolic"},Rw={style:{width:"100%"}},xw={key:0},Lw={key:1},Pw={key:2};Sw.render=function(e,t,o,n,a,s){const c=r("stopdrag"),u=r("drag");return d((l(),i("div",Cw,[d(p("div",Mw,[p("div",Dw,[(l(!0),i(S,null,R(n.particles,(e=>(l(),i("div",{key:e.id,class:["symbolic-box",{"theme-color":e.id===n.particleSelectedId}],onClick:t=>n.particleSelectedId=e.id},[p("span",{class:["iconfont",e.iconfont]},null,2),p("label",Rw,m(e.particleName),1)],10,["onClick"])))),128))]),0===n.particleSelectedId?(l(),i("div",xw,[p(n.Fire)])):b("v-if",!0),1===n.particleSelectedId?(l(),i("div",Lw,[p(n.Water)])):b("v-if",!0),2===n.particleSelectedId?(l(),i("div",Pw,[p(n.FireWorks)])):b("v-if",!0)],512),[[c]])],512)),[[u]])},Sw.__file="src/components/special-effects/particle-system/particle-system.vue",Sw.install=function(e){e.component(Sw.name,Sw)};const Vw=[ue,xe,Oe,qe,ut,Mt,kt,so,Ft,So,Oo,dl,Gl,yi,Mi,Oi,un,Vn,Qn,ya,xa,Na,hs,Ws,Sr,rc,Br,Qr,ld,Dd,lp,fp,xp,fc,Ru,ju,Sm,Wm,oy,Ty,Sw],kw=(e,t)=>{window.Resource=X,e.config.globalProperties.Resource=X,function(e,t){e.directive("drag",{beforeMount(e,t){let o,l,i,n,a,s,r=!1;const d=e;d.addEventListener("touchstart",(function(e){if(r=!0,!e.changedTouches[0])return;const{clientX:t,clientY:o}=e.changedTouches[0];i=t-e.changedTouches[0].target.x,n=o-e.changedTouches[0].target.y,a=document.body.clientWidth,s=document.body.clientHeight}),{passive:!1}),d.addEventListener("touchmove",j((function(t){t.preventDefault(),o=t.changedTouches[0].clientX-i,l=t.changedTouches[0].clientY-n,o<0&&l<0?(e.style.left="0px",e.style.top="0px"):o<0&&l+e.clientHeight<s?(e.style.left="0px",e.style.top=l+"px"):o<0&&l+e.clientHeight>=s?(e.style.left="0px",e.style.top=s-e.clientHeight+"px"):o+e.clientWidth>a&&l<0?(e.style.left=a-e.clientWidth+"px",e.style.top="0px"):o+e.clientWidth<a&&l+e.clientHeight>=s?(e.style.left=o+"px",e.style.top=s-e.clientHeight+"px"):o+e.clientWidth<a&&l<0?(e.style.left=o+"px",e.style.top="0px"):o+e.clientWidth>a&&l+e.clientHeight<s?(e.style.left=a-e.clientWidth+"px",e.style.top=l+"px"):o+e.clientWidth>a&&l+e.clientHeight>=s?(e.style.left=a-e.clientWidth+"px",e.style.top=s-e.clientHeight+"px"):(e.style.left=o+"px",e.style.top=l+"px")}),5),{passive:!1}),d.addEventListener("touchend",(function(e){r=!1,document.ontouchmove=null,document.ontouchmove=null,e.changedTouches[0].clientX,e.changedTouches[0].clientY}),{passive:!1}),d.onmousedown=function(t){if(a=document.body.clientWidth,s=document.body.clientHeight,r)return;r=!0;const{clientX:i,clientY:n}=t,d=i-e.offsetLeft,p=n-e.offsetTop;document.onmousemove=j((function(t){o=t.clientX-d,l=t.clientY-p,o<0&&l<0?(e.style.left="0px",e.style.top="0px"):o<0&&l+e.clientHeight<s?(e.style.left="0px",e.style.top=l+"px"):o<0&&l+e.clientHeight>=s?(e.style.left="0px",e.style.top=s-e.clientHeight+"px"):o+e.clientWidth>a&&l<0?(e.style.left=a-e.clientWidth+"px",e.style.top="0px"):o+e.clientWidth<a&&l+e.clientHeight>=s?(e.style.left=o+"px",e.style.top=s-e.clientHeight+"px"):o+e.clientWidth<a&&l<0?(e.style.left=o+"px",e.style.top="0px"):o+e.clientWidth>a&&l+e.clientHeight<s?(e.style.left=a-e.clientWidth+"px",e.style.top=l+"px"):o+e.clientWidth>a&&l+e.clientHeight>=s?(e.style.left=a-e.clientWidth+"px",e.style.top=s-e.clientHeight+"px"):(e.style.left=o+"px",e.style.top=l+"px")}),5),document.onmouseup=function(e){document.onmousedown=null,document.onmousemove=null,r=!1}}}}),e.directive("stopdrag",{beforeMount(e,t){e.onmousedown=e=>{"el-input__inner"!=e.target.className&&e.stopPropagation()}}})}(e),t&&(e.config.globalProperties.Resource=t),kw.installed||(kw.installed=!0,Vw.forEach((t=>{e.use(t)})))};window.store=N,"undefined"!=typeof window&&window.Vue&&(window.webgl3d=kw);var Ew={install:kw,components:Vw};export default Ew;
