import{reactive as e,toRefs as o,watch as n,onBeforeUnmount as r,resolveComponent as t,resolveDirective as i,withDirectives as a,openBlock as l,createBlock as s,createVNode as u,toDisplayString as c,Fragment as d,renderList as p,vShow as w,vModelSelect as f,vModelText as y}from"vue";function h(e,o,n){return o in e?Object.defineProperty(e,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[o]=n,e}function m(e,o){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);o&&(r=r.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var o=1;o<arguments.length;o++){var n=null!=arguments[o]?arguments[o]:{};o%2?m(Object(n),!0).forEach((function(o){h(e,o,n[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))}))}return e}function v(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,o){if(!e)return;if("string"==typeof e)return b(e,o);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(e,o)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,o){(null==o||o>e.length)&&(o=e.length);for(var n=0,r=new Array(o);n<o;n++)r[n]=e[n];return r}var M=e({isViewer:!1,changeLayers:0,changeGeometrys:0}),S=function(e){for(var o=[].concat(e),n=[],r=0,t=o.length;r<t;r++){var i=SuperMap3D.Cartographic.fromCartesian(o[r]),a=SuperMap3D.Math.toDegrees(i.longitude),l=SuperMap3D.Math.toDegrees(i.latitude),s=i.height;-1==n.indexOf(a)&&-1==n.indexOf(l)&&(n.push(a),n.push(l),n.push(s))}return n};var D,C,P={errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},H={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},k=(C=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=C,C).toLowerCase();var V=((D=void 0!==k?k:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||D.startsWith("ja"),H);var x=function(e){var o;switch(e){case"Point":o=window.handlerPoint;break;case"Polyline":o=window.handlerPolyline;break;case"Polygon":o=window.handlerPolygon;break;case"Marker":o=window.handlerMarker;break;case"Box":o=window.handlerBox}return o},L=function(e,o){var n,r,t=0;switch(o&&(t=o),e){case"Point":window.handlerPoint=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Point);break;case"Polyline":window.handlerPolyline=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Line,t);break;case"Polygon":window.handlerPolygon=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Polygon,t);break;case"Marker":window.handlerMarker=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Marker,t);break;case"Box":window.handlerBox=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box,t)}window.tooltip||(window.tooltip=(n=viewer._element,(r=function(e){var o=document.createElement("DIV");o.className="twipsy right";var n=document.createElement("DIV");n.className="twipsy-arrow",o.appendChild(n);var r=document.createElement("DIV");r.className="twipsy-inner",o.appendChild(r),this._div=o,this._title=r,this.message="",e.appendChild(o);var t=this;o.onmousemove=function(e){t.showAt({x:e.clientX,y:e.clientY},t.message)}}).prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},r.prototype.showAt=function(e,o){e&&o&&(this.setVisible(!0),this._title.innerHTML=o,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px",this.message=o)},new r(n))),window.polylineCollection||(window.polylineCollection=new SuperMap3D.PolylineCollection({translucentRS:SuperMap3D.RenderState.fromCache({depthMask:!1,depthTest:{enabled:!1}})}),window.polylineTransparent=window.polylineCollection.add({width:2,material:SuperMap3D.Material.fromType(SuperMap3D.Material.ColorType,{color:SuperMap3D.Color.fromCssColorString("#51ff00").withAlpha(.3)})}),viewer.scene.primitives.add(window.polylineCollection))},N=function(e,o,n){var r=!0;!1===o&&(r=o);var t=x(e);return new Promise((function(o,n){var i=window.tooltip,a=t.activeEvt.addEventListener((function(o){1==o?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="","Point"==e||"Marker"==e?document.body.classList.add("measureCur"):document.body.classList.add("drawCur")):(viewer.enableCursorStyle=!0,i.setVisible(!1),"Point"==e||"Marker"==e?document.body.classList.remove("measureCur"):document.body.classList.remove("drawCur"))})),l=t.movingEvt.addEventListener((function(o){if(o.x<200&&o.y<150)i.setVisible(!1);else if(t.polyline&&t.isDrawing){var n=v(t.positions);"Polygon"==e&&n.push(n[0]),window.polylineTransparent.show=!0,window.polylineTransparent.positions=n}})),s=t.drawEvt.addEventListener((function(n){if(!n.object.positions&&"Point"!=e&&"Box"!=e)return i.showAt(n,"<p>请绘制正确的多边形</p>"),t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),void t.activate();if("Box"!=e){if("Point"==e||"Marker"==e)t.clear(),o({result:n});else{if(window.polylineTransparent.show=r,r&&"Polygon"==e&&r){t.polygon._polygon._material._color._value.alpha=.1;var u=v(n.object.positions);u.push(u[0]),window.polylineTransparent.positions=u}var c=S(n.object.positions);o({result:n,positions:c})}a(),l(),s()}else o({result:n})}))}))},O=function(e){var o;(o=e?x(e):window.handlerPolygon)&&(o.deactivate(),o.clear(),viewer.enableCursorStyle=!0,window.tooltip.setVisible(!1),window.polylineTransparent&&(window.polylineTransparent.show=!1))};function T(t){var i,a,l=e({layerNames:[],selectedLayerName:"none",maxHeight:200,minHeight:0,floodHeight:[0,200],currentHeight:0,floodSpeed:1,floodTrans:.8,cheackedBand:"band1",colorBandShow:!1,floodPositions:[],lineVisible:!0});if(t)for(var s in t)l.hasOwnProperty(s)?l[s]=t[s]:P.errorMsg(V.AttributeError+s);var u,c=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE,d=new SuperMap3D.HypsometricSetting,p=new SuperMap3D.ColorTable;p.insert(500,new SuperMap3D.Color(0,39/255,148/255)),p.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));var w=[];function f(){viewer.scene,(i=viewer.scene.layers.layerQueue)&&i.length>0&&(i.forEach((function(e,o){l.layerNames.includes(e._name)||l.layerNames.push(e._name)})),(l.selectedLayerName="none")&&(l.selectedLayerName=l.layerNames[0],a=i[0]))}function y(e){e&&(w=e),d.CoverageArea=e;var o=Number(l.minHeight);u=setInterval("ModelFlood()",100),window.ModelFlood=function(){if(o>l.maxHeight)return l.currentHeight=l.maxHeight,void clearInterval(u);l.currentHeight=Number(o.toFixed(2)),d.MaxVisibleValue=o;try{h()}catch(e){console.log(e),clearInterval(u)}o+=parseFloat(l.floodSpeed)/10}}function h(){0!=w.length&&(a.hypsometricSetting={hypsometricSetting:d,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})}return M.isViewer&&f(),n((function(){return M.isViewer}),(function(e){e&&f()})),n((function(){return M.changeLayers}),(function(e){f()})),r((function(){i=null,d.destroy(),p.destroy(),d=void 0,p=void 0})),n((function(){return l.selectedLayerName}),(function(e){var o=l.layerNames.indexOf(e);-1!=o&&(a=i[o])})),n((function(){return l.maxHeight}),(function(e){d.MaxVisibleValue=parseInt(e),h()})),n((function(){return l.minHeight}),(function(e){d.MinVisibleValue=parseInt(e),l.currentHeight=parseInt(e),h()})),n((function(){return l.floodHeight}),(function(e){l.minHeight=e[0],l.maxHeight=e[1]})),n((function(){return l.floodTrans}),(function(e){d.Opacity=parseFloat(e),h()})),n((function(){return l.cheackedBand}),(function(e){p=function(e){var o=new SuperMap3D.ColorTable;switch(e){case"band1":o.insert(500,new SuperMap3D.Color(0,39/255,148/255)),o.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));break;case"band2":o.insert(500,new SuperMap3D.Color(162/255,251/255,194/255)),o.insert(0,new SuperMap3D.Color(1,103/255,103/255));break;case"band3":o.insert(500,new SuperMap3D.Color(230/255,198/255,1)),o.insert(0,new SuperMap3D.Color(157/255,0,1));break;case"band4":o.insert(500,new SuperMap3D.Color(210/255,15/255,15/255)),o.insert(100,new SuperMap3D.Color(221/255,224/255,7/255)),o.insert(50,new SuperMap3D.Color(20/255,187/255,18/255)),o.insert(4e3,new SuperMap3D.Color(0,161/255,1)),o.insert(0,new SuperMap3D.Color(9/255,9/255,212/255));break;case"band5":o.insert(500,new SuperMap3D.Color(186/255,1,229/255)),o.insert(0,new SuperMap3D.Color(26/255,185/255,156/255));break;default:o.insert(500,new SuperMap3D.Color(0,39/255,148/255)),o.insert(0,new SuperMap3D.Color(149/255,232/255,249/255))}return o}(e),d.ColorTable=p,h()})),g(g({},o(l)),{},{floodClear:function(e){e.preventDefault(),a.hypsometricSetting.hypsometricSetting.MaxVisibleValue=-1e3,clearInterval(u),w=[],l.currentHeight=Number(l.floodHeight[0]),window.handlerPolygon&&O("Polygon")},floodBegin:function(e){e.preventDefault(),d.DisplayMode=c,d._lineColor=new SuperMap3D.Color(1,0,0,1),d.MinVisibleValue=Number(l.floodHeight[0]),d.MaxVisibleValue=0,d.ColorTableMinKey=0,d.ColorTableMaxKey=200,d.ColorTable=p,d.Opacity=Number(l.floodTrans),d.LineInterval=10,window.handlerPolygon||L("Polygon"),t&&t.floodPositions?y(t.floodPositions):(N("Polygon",l.lineVisible).then((function(e){var o=window.handlerPolygon;y(e.positions),o.polygon.show=!1,o.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||P.errorMsg(V.NoPickPositionSupported))},changeColor:function(e){l.colorBandShow=!1,l.cheackedBand=e},floodPosition:w})}var B={name:"Sm3dModelFlood",methods:{formatTooltip:function(e){return e+Resource.meter},formatTooltip2:function(e){return e+Resource.meter_second}},setup:function(e){var o=T(e);return{layerNames:o.layerNames,selectedLayerName:o.selectedLayerName,floodHeight:o.floodHeight,currentHeight:o.currentHeight,floodSpeed:o.floodSpeed,floodClear:o.floodClear,floodBegin:o.floodBegin}}},E={id:"terrain-flood-panel",class:"sm-panel"},j={class:"sm-function-module-sub-section",style:{margin:"0"}},_={class:"sm-half-L"},A={style:{width:"40%"}},I={class:"sm-half-L"},R={style:{width:"40%"}},F={class:"sm-half-L"},U={style:{width:"40%"}},W={class:"sm-half-L"},z={style:{width:"40%"}},G={class:"boxchild"};B.render=function(e,o,n,r,h,m){var g=t("el-slider"),v=i("stopdrag"),b=i("drag");return a((l(),s("div",E,[a(u("div",j,[u("div",_,[u("label",A,c(e.Resource.selectedLayer),1),a(u("select",{class:"sm-select",style:{width:"58%"},"onUpdate:modelValue":o[1]||(o[1]=function(e){return r.selectedLayerName=e})},[(l(!0),s(d,null,p(r.layerNames,(function(e,o){return l(),s("option",{key:o,value:e},c(e),9,["value"])})),128)),a(u("option",{value:"none"},c(e.Resource.noS3mLayer),513),[[w,0==r.layerNames.length]])],512),[[f,r.selectedLayerName]])]),u("div",I,[u("label",R,c(e.Resource.visibleHeight),1),u(g,{modelValue:r.floodHeight,"onUpdate:modelValue":o[2]||(o[2]=function(e){return r.floodHeight=e}),min:0,max:500,range:"",step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class","format-tooltip":m.formatTooltip,style:{width:"58%"}},null,8,["modelValue","format-tooltip"])]),u("div",F,[u("label",U,c(e.Resource.currentHeight),1),a(u("input",{class:"sm-input",disabled:"",type:"number",style:{width:"58%"},"onUpdate:modelValue":o[3]||(o[3]=function(e){return r.currentHeight=e})},null,512),[[y,r.currentHeight]])]),u("div",W,[u("label",z,c(e.Resource.floodSpeed),1),u(g,{modelValue:r.floodSpeed,"onUpdate:modelValue":o[4]||(o[4]=function(e){return r.floodSpeed=e}),max:20,min:.1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class","format-tooltip":m.formatTooltip2,style:{width:"58%"}},null,8,["modelValue","min","format-tooltip"])]),u("div",G,[u("button",{onClick:o[5]||(o[5]=function(){return r.floodBegin&&r.floodBegin.apply(r,arguments)}),class:"tbtn",type:"button"},c(e.Resource.analyze),1),u("button",{onClick:o[6]||(o[6]=function(){return r.floodClear&&r.floodClear.apply(r,arguments)}),class:"tbtn tbtn-margin-left",type:"button"},c(e.Resource.clear),1)])],512),[[v]])],512)),[[b]])},B.__file="src/components/layer/model-flood/model-flood.vue",B.install=function(e){e.component(B.name,B)};export default B;
