import{reactive as e,toRefs as n,watch as t,onBeforeUnmount as r,resolveDirective as o,withDirectives as i,openBlock as a,createBlock as s,createVNode as c,toDisplayString as l,vModelRadio as u,createTextVNode as d,Fragment as p,renderList as f,vModelSelect as w,vShow as y}from"vue";function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function h(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function b(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?h(Object(t),!0).forEach((function(n){m(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):h(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function g(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return S(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return S(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}var M=e({isViewer:!1,changeLayers:0,changeGeometrys:0}),x=function(e){for(var n=[].concat(e),t=[],r=0,o=n.length;r<o;r++){var i=SuperMap3D.Cartographic.fromCartesian(n[r]),a=SuperMap3D.Math.toDegrees(i.longitude),s=SuperMap3D.Math.toDegrees(i.latitude),c=i.height;-1==t.indexOf(a)&&-1==t.indexOf(s)&&(t.push(a),t.push(s),t.push(c))}return t};var C,E,D={errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},P={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},T=(E=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=E,E).toLowerCase();var L=((C=void 0!==T?T:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||C.startsWith("ja"),P);var k=function(e,n){var t=0;switch(n&&(t=n),e){case"Point":window.handlerPoint=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Point);break;case"Polyline":window.handlerPolyline=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Line,t);break;case"Polygon":window.handlerPolygon=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Polygon,t);break;case"Marker":window.handlerMarker=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Marker,t);break;case"Box":window.handlerBox=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box,t)}window.tooltip||(window.tooltip=function(e){var n=function(e){var n=document.createElement("DIV");n.className="twipsy right";var t=document.createElement("DIV");t.className="twipsy-arrow",n.appendChild(t);var r=document.createElement("DIV");r.className="twipsy-inner",n.appendChild(r),this._div=n,this._title=r,this.message="",e.appendChild(n);var o=this;n.onmousemove=function(e){o.showAt({x:e.clientX,y:e.clientY},o.message)}};return n.prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},n.prototype.showAt=function(e,n){e&&n&&(this.setVisible(!0),this._title.innerHTML=n,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px",this.message=n)},new n(e)}(viewer._element)),window.polylineCollection||(window.polylineCollection=new SuperMap3D.PolylineCollection({translucentRS:SuperMap3D.RenderState.fromCache({depthMask:!1,depthTest:{enabled:!1}})}),window.polylineTransparent=window.polylineCollection.add({width:2,material:SuperMap3D.Material.fromType(SuperMap3D.Material.ColorType,{color:SuperMap3D.Color.fromCssColorString("#51ff00").withAlpha(.3)})}),viewer.scene.primitives.add(window.polylineCollection))},j=function(e){var n;switch(e){case"Point":n=window.handlerPoint;break;case"Polyline":n=window.handlerPolyline;break;case"Polygon":n=window.handlerPolygon;break;case"Marker":n=window.handlerMarker;break;case"Box":n=window.handlerBox}return n};function O(e){var n=function(e){var n=document.createElement("DIV");n.className="tooltip",this._div=n,this.message="",e.appendChild(n)};return n.prototype.setVisible=function(e){this._div.style.right=e?"10px":"-300px"},n.prototype.showAt=function(e,n){n&&(this._div.style.top=n),e&&(this.setVisible(!0),this._div.innerHTML=e)},new n(e)}var I=[{name:"线状纹理1",type:"line",url:"public/img/particleSystem/line-1.jpg"},{name:"线状纹理2",type:"line",url:"public/img/particleSystem/line-2.jpg"},{name:"环状纹理1",type:"ring",url:"public/img/particleSystem/ring-1.jpg"},{name:"环状纹理2",type:"ring",url:"public/img/particleSystem/ring-2.jpg"},{name:"环状六边形纹理",type:"ring",url:"public/img/particleSystem/ring-3.jpg"}];function N(o){var i=e({scanMode:"lineMode",scanColor:"#0F7AF4",scanTextures:[],selectedTextureIndex:0,bloomShow:!1,openHDR:!1,threshold:.01,intensity:.5,lineWidth:100,period:3,speed:100,addTextures:null,scanShow:!1});if(o)for(var a in o)i.hasOwnProperty(a)?i[a]=o[a]:D.errorMsg(L.AttributeError+a);var s=[{name:"无纹理",type:"line",url:""}],c=[{name:"无纹理",type:"ring",url:""}];function l(e){for(var n=0;n<e.length;n++)"line"===e[n].type?s.push(e[n]):c.push(e[n]);i.scanTextures="lineMode"===i.scanMode?s:c}function u(){viewer.scene.scanEffect.color=SuperMap3D.Color.fromCssColorString(i.scanColor),viewer.scene.scanEffect.textureUrl="",viewer.scene.scanEffect.lineWidth=Number(i.lineWidth),viewer.scene.scanEffect.period=Number(i.period),viewer.scene.scanEffect.speed=Number(i.speed),viewer.scene.scanEffect.centerPostion=new SuperMap3D.Cartesian3.fromDegrees(0,0,0)}function d(){window.handlerPolyline||k("Polyline"),window.tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>绘制两点确定扫描线方向</p><p>鼠标右键结束绘制</p>","350px"),function(e,n,t){var r=!0;!1===n&&(r=n);var o=j(e);return new Promise((function(n,t){var i=window.tooltip,a=o.activeEvt.addEventListener((function(n){1==n?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="","Point"==e||"Marker"==e?document.body.classList.add("measureCur"):document.body.classList.add("drawCur")):(viewer.enableCursorStyle=!0,i.setVisible(!1),"Point"==e||"Marker"==e?document.body.classList.remove("measureCur"):document.body.classList.remove("drawCur"))})),s=o.movingEvt.addEventListener((function(n){if(n.x<200&&n.y<150)i.setVisible(!1);else if(o.polyline&&o.isDrawing){var t=g(o.positions);"Polygon"==e&&t.push(t[0]),window.polylineTransparent.show=!0,window.polylineTransparent.positions=t}})),c=o.drawEvt.addEventListener((function(t){if(!t.object.positions&&"Point"!=e&&"Box"!=e)return i.showAt(t,"<p>请绘制正确的多边形</p>"),o.polygon.show=!1,o.polyline.show=!1,o.deactivate(),void o.activate();if("Box"!=e){if("Point"==e||"Marker"==e)o.clear(),n({result:t});else{if(window.polylineTransparent.show=r,r&&"Polygon"==e&&r){o.polygon._polygon._material._color._value.alpha=.1;var l=g(t.object.positions);l.push(l[0]),window.polylineTransparent.positions=l}var u=x(t.object.positions);n({result:t,positions:u})}a(),s(),c()}else n({result:t})}))}))}("Polyline").then((function(e){!function(e){var n=new SuperMap3D.Cartesian3;if(SuperMap3D.Cartesian3.subtract(e[1],e[0],n),i.scanShow)return viewer.scene.scanEffect.add(e[0]),void(viewer.scene.scanEffect.lineMoveDirection=n);viewer.scene.scanEffect.centerPostion=e[0],viewer.scene.scanEffect.lineMoveDirection=n,i.scanShow=!0}(e.result.object.positions);var n=window.handlerPolyline;n.polyline.show=!1,window.polylineTransparent.show=!1,n.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()}function p(e){viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");var n=viewer.scene.pickPosition(e.message.position);i.scanShow?viewer.scene.scanEffect.add(n):(viewer.scene.scanEffect.centerPostion=n,i.scanShow=!0,viewer.eventManager.removeEventListener("CLICK",p))}return l(I),M.isViewer&&(window.tooltip||(window.tooltip=O(viewer._element)),u()),t((function(){return M.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=O(viewer._element)),u())})),t((function(){return i.scanShow}),(function(e){viewer.scene.scanEffect.show=e})),t((function(){return i.scanMode}),(function(e){if("lineMode"===e)return viewer.scene.scanEffect.mode=SuperMap3D.ScanEffectMode.LINE,void(i.scanTextures=s);viewer.scene.scanEffect.mode=SuperMap3D.ScanEffectMode.CIRCLE,i.scanTextures=c})),t((function(){return i.scanColor}),(function(e){viewer.scene.scanEffect.color=SuperMap3D.Color.fromCssColorString(e)})),t((function(){return i.selectedTextureIndex}),(function(e){viewer.scene.scanEffect.textureUrl=i.scanTextures[e].url})),t((function(){return i.scanTextures}),(function(e){i.selectedTextureIndex=0})),t((function(){return i.bloomShow}),(function(e){viewer.scene.bloomEffect.show=e,viewer.scene.bloomEffect.threshold=Number(i.threshold),viewer.scene.bloomEffect.bloomIntensity=Number(i.intensity)})),t((function(){return i.openHDR}),(function(e){viewer.scene.hdrEnabled=e})),t((function(){return i.threshold}),(function(e){viewer.scene.bloomEffect.threshold=Number(e)})),t((function(){return i.intensity}),(function(e){viewer.scene.bloomEffect.bloomIntensity=Number(e)})),t((function(){return i.lineWidth}),(function(e){viewer.scene.scanEffect.lineWidth=Number(e)})),t((function(){return i.period}),(function(e){viewer.scene.scanEffect.period=Number(e)})),t((function(){return i.speed}),(function(e){viewer.scene.scanEffect.speed=Number(e)})),t((function(){return i.scanShow}),(function(e){viewer.scene.scanEffect.scanShow=e})),t((function(){return i.addTextures}),(function(e){"object"===v(e)?l(e):console.log("addTextures类型不是数组！")})),r((function(){})),b(b({},n(i)),{},{addScans:function(){"lineMode"!==i.scanMode?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.eventManager.addEventListener("CLICK",p,!0)):d()},clear:function(){i.scanShow=!1;for(var e,n,t=viewer.scene.scanEffect.count,r=0;r<t;r++)viewer.scene.scanEffect.remove(r);viewer.eventManager.removeEventListener("CLICK",p),(n=(e="Polyline")?j(e):window.handlerPolygon)&&(n.deactivate(),n.clear(),viewer.enableCursorStyle=!0,window.tooltip.setVisible(!1),window.polylineTransparent&&(window.polylineTransparent.show=!1))}})}var _={name:"Sm3dScanEffect",props:{scanMode:{type:String},scanColor:{type:String},selectedTextureIndex:{type:Number},bloomShow:{type:Boolean},openHDR:{type:Boolean},threshold:{type:Number},intensity:{type:Number},lineWidth:{type:Number},period:{type:Number},speed:{type:Number},addTextures:{type:Object},scanShow:{type:Boolean}},setup:function(e){var n=N(e);return{scanMode:n.scanMode,scanTextures:n.scanTextures,selectedTextureIndex:n.selectedTextureIndex,addScans:n.addScans,clear:n.clear}}},V={id:"scan-effect-panel",class:"sm-panel"},B={class:"sm-function-module-sub-section",style:{margin:"0"}},A={class:"sm-half-L"},R={style:{width:"30%"}},H={class:"sm-half",style:{width:"68%"}},W={style:{width:"auto"}},U={style:{width:"auto"}},K={class:"sm-half-L"},F={style:{width:"30%"}},q={class:"boxchild",style:{"padding-bottom":"0"}};_.render=function(e,n,t,r,v,m){var h=o("stopdrag"),b=o("drag");return i((a(),s("div",V,[i(c("div",B,[c("div",A,[c("label",R,l(e.Resource.scanMode),1),c("div",H,[c("label",W,[i(c("input",{type:"radio",value:"lineMode","onUpdate:modelValue":n[1]||(n[1]=function(e){return r.scanMode=e}),style:{"margin-right":"0"}},null,512),[[u,r.scanMode]]),d(" "+l(e.Resource.lineScan),1)]),c("label",U,[i(c("input",{type:"radio",value:"ringMode","onUpdate:modelValue":n[2]||(n[2]=function(e){return r.scanMode=e}),style:{"margin-right":"0"}},null,512),[[u,r.scanMode]]),d(" "+l(e.Resource.circularScan),1)])])]),i(c("div",K,[c("label",F,l(e.Resource.scanTexture),1),i(c("select",{class:"sm-select-m",style:{width:"68%"},"onUpdate:modelValue":n[3]||(n[3]=function(e){return r.selectedTextureIndex=e})},[(a(!0),s(p,null,f(r.scanTextures,(function(e,n){return a(),s("option",{value:n,key:n},l(e.name),9,["value"])})),128))],512),[[w,r.selectedTextureIndex]])],512),[[y,r.scanTextures.length>0]]),c("div",q,[c("button",{class:"tbtn",type:"button",onClick:n[4]||(n[4]=function(){return r.addScans&&r.addScans.apply(r,arguments)})},l(e.Resource.add),1),c("button",{class:"tbtn tbtn-margin-left",type:"button ",onClick:n[5]||(n[5]=function(){return r.clear&&r.clear.apply(r,arguments)})},l(e.Resource.clear),1)])],512),[[h]])],512)),[[b]])},_.__file="src/components/special-effects/scan-effect/scan-effect.vue",_.install=function(e){e.component(_.name,_)};export default _;
