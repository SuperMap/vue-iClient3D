import{reactive as e,toRefs as t,ref as i,watch as o,onBeforeUnmount as n,resolveComponent as l,resolveDirective as r,openBlock as a,createBlock as s,Fragment as c,withDirectives as u,createVNode as d,renderList as p,toDisplayString as h,vShow as w,vModelCheckbox as g,createTextVNode as b,createCommentVNode as m,vModelText as f}from"vue";function y(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function v(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,o)}return i}function S(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?v(Object(i),!0).forEach((function(t){y(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):v(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function D(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return M(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return M(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}var C=e({isViewer:!1,changeLayers:0,changeGeometrys:0}),L=function(e){for(var t=[].concat(e),i=[],o=0,n=t.length;o<n;o++){var l=SuperMap3D.Cartographic.fromCartesian(t[o]),r=SuperMap3D.Math.toDegrees(l.longitude),a=SuperMap3D.Math.toDegrees(l.latitude),s=l.height;-1==i.indexOf(r)&&-1==i.indexOf(a)&&(i.push(r),i.push(a),i.push(s))}return i};var P,x,k={errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},V=L,I={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},N=(x=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=x,x).toLowerCase();var E=((P=void 0!==N?N:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||P.startsWith("ja"),I);var O=function(e,t){var i=0;switch(t&&(i=t),e){case"Point":window.handlerPoint=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Point);break;case"Polyline":window.handlerPolyline=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Line,i);break;case"Polygon":window.handlerPolygon=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Polygon,i);break;case"Marker":window.handlerMarker=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Marker,i);break;case"Box":window.handlerBox=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box,i)}window.tooltip||(window.tooltip=function(e){var t=function(e){var t=document.createElement("DIV");t.className="twipsy right";var i=document.createElement("DIV");i.className="twipsy-arrow",t.appendChild(i);var o=document.createElement("DIV");o.className="twipsy-inner",t.appendChild(o),this._div=t,this._title=o,this.message="",e.appendChild(t);var n=this;t.onmousemove=function(e){n.showAt({x:e.clientX,y:e.clientY},n.message)}};return t.prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},t.prototype.showAt=function(e,t){e&&t&&(this.setVisible(!0),this._title.innerHTML=t,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px",this.message=t)},new t(e)}(viewer._element)),window.polylineCollection||(window.polylineCollection=new SuperMap3D.PolylineCollection({translucentRS:SuperMap3D.RenderState.fromCache({depthMask:!1,depthTest:{enabled:!1}})}),window.polylineTransparent=window.polylineCollection.add({width:2,material:SuperMap3D.Material.fromType(SuperMap3D.Material.ColorType,{color:SuperMap3D.Color.fromCssColorString("#51ff00").withAlpha(.3)})}),viewer.scene.primitives.add(window.polylineCollection))},j=function(e){var t;switch(e){case"Point":t=window.handlerPoint;break;case"Polyline":t=window.handlerPolyline;break;case"Polygon":t=window.handlerPolygon;break;case"Marker":t=window.handlerMarker;break;case"Box":t=window.handlerBox}return t};function A(e){var t=function(e){var t=document.createElement("DIV");t.className="tooltip",this._div=t,this.message="",e.appendChild(t)};return t.prototype.setVisible=function(e){this._div.style.right=e?"10px":"-300px"},t.prototype.showAt=function(e,t){t&&(this._div.style.top=t),e&&(this.setVisible(!0),this._div.innerHTML=e)},new t(e)}var B=[{id:0,iconfont:"icondianguangyuan",lightName:"点光源"},{id:1,iconfont:"iconjuguangdeng",lightName:"聚光灯"},{id:2,iconfont:"iconpinghangguang",lightName:"平行光"}];function _(l){var r,a,s,c=e({lightSelectId:0,lightColor:"#FFFFFF",cutoffDistance:200,lightDecay:5,lightIntensity:5,spotLightAngle:30,visibleModel:!0,dockFontShow:!0,modelPosition:[0,0,0],modelLongitude:"",modelLatitude:"",modelHeight:"",bubbleShow:!1,visiblePositions:!1});if(l)for(var u in l)c.hasOwnProperty(u)?c[u]=l[u]:k.errorMsg(E.AttributeError+u);var d,p=!1,h=new Map,w="public/data/s3m/light.s3m",g=i(null);function b(e,t){var i="light-model-"+(new Date).getTime();s.add(w,{id:i,position:e,scale:new SuperMap3D.Cartesian3(2,2,2)}),r=s.getInstance(w,i),h.set(i,t)}C.isViewer&&(window.tooltip||(window.tooltip=A(viewer._element)),s=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(s)),o((function(){return C.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=A(viewer._element)),s=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(s))}));var m,f=!1;function y(){window.handlerPolyline||O("Polyline"),function(e,t,i){var o=!0;!1===t&&(o=t);var n=j(e);return new Promise((function(t,i){var l=window.tooltip,r=n.activeEvt.addEventListener((function(t){1==t?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="","Point"==e||"Marker"==e?document.body.classList.add("measureCur"):document.body.classList.add("drawCur")):(viewer.enableCursorStyle=!0,l.setVisible(!1),"Point"==e||"Marker"==e?document.body.classList.remove("measureCur"):document.body.classList.remove("drawCur"))})),a=n.movingEvt.addEventListener((function(t){if(t.x<200&&t.y<150)l.setVisible(!1);else if(n.polyline&&n.isDrawing){var i=D(n.positions);"Polygon"==e&&i.push(i[0]),window.polylineTransparent.show=!0,window.polylineTransparent.positions=i}})),s=n.drawEvt.addEventListener((function(i){if(!i.object.positions&&"Point"!=e&&"Box"!=e)return l.showAt(i,"<p>请绘制正确的多边形</p>"),n.polygon.show=!1,n.polyline.show=!1,n.deactivate(),void n.activate();if("Box"!=e){if("Point"==e||"Marker"==e)n.clear(),t({result:i});else{if(window.polylineTransparent.show=o,o&&"Polygon"==e&&o){n.polygon._polygon._material._color._value.alpha=.1;var c=D(i.object.positions);c.push(c[0]),window.polylineTransparent.positions=c}var u=L(i.object.positions);t({result:i,positions:u})}r(),a(),s()}else t({result:i})}))}))}("Polyline").then((function(e){var t,i,o,n,l;1===c.lightSelectId?(t=e.result.object.positions,i=M(t[0]),o=t[1],n={color:SuperMap3D.Color.fromCssColorString(c.lightColor),distance:Number(c.cutoffDistance),decay:Number(c.lightDecay),intensity:Number(c.lightIntensity),angle:SuperMap3D.Math.toRadians(Number(c.spotLightAngle))},l=new SuperMap3D.SpotLight(i,o,n),a=l,viewer.scene.addLightSource(l),b(i,l)):function(e){var t=M(e[0]),i={targetPosition:e[1],color:SuperMap3D.Color.fromCssColorString(c.lightColor),intensity:Number(c.lightIntensity)},o=new SuperMap3D.DirectionalLight(t,i);a=o,viewer.scene.addLightSource(o),b(t,o)}(e.result.object.positions);var r=window.handlerPolyline;r.polyline.show=!1,window.polylineTransparent.show=!1,r.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()}function v(e){if(p){p=!1,viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),!function(e){var t=M(e),i={color:SuperMap3D.Color.fromCssColorString(c.lightColor),cutoffDistance:Number(c.cutoffDistance),decay:Number(c.lightDecay),intensity:Number(c.lightIntensity)},o=new SuperMap3D.PointLight(t,i);a=o,viewer.scene.addLightSource(o),b(t,o)}(scene.pickPosition(e.message.position)),tooltip.setVisible(!1)}else{var t=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(t&&t.id&&"string"==typeof t.id&&-1!=t.id.indexOf("light-model-")){var i;if(r&&r.id===t.id.id)return;r=t,a=h.get(t.id),d?d.setEditObject(t.primitive):(n=t.primitive,(d=new SuperMap3D.ModelEditor({model:n,scene:viewer.scene,axesShow:{translation:!0,rotation:!1,scale:!0}})).activate(),d.changedEvt.addEventListener((function(e){var t=new SuperMap3D.Cartesian3;if(SuperMap3D.Matrix4.getTranslation(e.modelMatrix,t),t){var i;a.position=t,f=!0,x((function(){return f=!1}));var o=V(t);c.modelPosition.length=0,(i=c.modelPosition).push.apply(i,[o[0].toFixed(6),o[1].toFixed(6),o[2].toFixed(2)])}}))),g.value.style.top=e.message.position.y-160+"px",g.value.style.left=e.message.position.x+"px",console.log(d);var o=V(d._position);return c.modelPosition.length=0,(i=c.modelPosition).push.apply(i,[o[0].toFixed(6),o[1].toFixed(6),o[2].toFixed(2)]),void(c.bubbleShow=!0)}r=void 0,a=void 0,d&&d.deactivate(),c.bubbleShow=!1}var n}function M(e){var t=SuperMap3D.Cartographic.fromCartesian(e);return t.height+=.5,SuperMap3D.Cartographic.toCartesian(t)}function P(){c.bubbleShow=!1}function x(e){m&&clearTimeout(m),m=setTimeout((function(){e()}),1e3)}return o((function(){return c.lightColor}),(function(e){if(a){var t=SuperMap3D.Color.fromCssColorString(e);a.color=t}})),o((function(){return c.cutoffDistance}),(function(e){a&&(1!==a.lightType?2!==a.lightType||(a.distance=Number(e)):a.cutoffDistance=Number(e))})),o((function(){return c.lightDecay}),(function(e){a&&0!==a.lightType&&(a.decay=Number(e))})),o((function(){return c.lightIntensity}),(function(e){a&&(a.intensity=Number(e))})),o((function(){return c.spotLightAngle}),(function(e){a&&2===a.lightType&&(a.angle=SuperMap3D.Math.toRadians(Number(e)))})),o((function(){return c.visibleModel}),(function(e){r&&(d&&d.deactivate(),s.visible=e)})),o((function(){return c.modelPosition}),(function(e){r&&!f&&x((function(){var t=Number(e[0]),i=Number(e[1]),o=Number(e[2]),n=SuperMap3D.Cartesian3.fromDegrees(t,i,o);a.position=n,r.primitive.updatePosition(n),d&&d.setEditObject(r.primitive)}))}),{deep:!0}),n((function(){})),S(S({},t(c)),{},{config:B,addLight:function(){var e=0===c.lightSelectId?"<p>点击确认点光源位置</p><p>选中光源模型可编辑与删除</p>":"<p>点击第一点确认光源位置</p><p>第二点确认光源方向</p><p>选中光源模型可编辑与删除</p>";if(window.tooltip.showAt(e,"400px"),viewer.eventManager.addEventListener("CLICK",v,!0),0===c.lightSelectId)return viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),void(p=!0);y()},clearLight:function(){var e,t;r&&(h.delete(r.id),s.removeInstance(w,r.id),r=null),a&&viewer.scene.removeLightSource(a),0===h.size&&viewer.eventManager.removeEventListener("CLICK",v),d&&d.deactivate(),p=!1,a=null,(t=e?j(e):window.handlerPolygon)&&(t.deactivate(),t.clear(),viewer.enableCursorStyle=!0,window.tooltip.setVisible(!1),window.polylineTransparent&&(window.polylineTransparent.show=!1)),viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),tooltip.setVisible(!1),P()},bubble:g,closeBubble:P,dockBubble:function(e){e?(g.value.classList.add("bubbleDock"),c.dockFontShow=!1):(g.value.classList.remove("bubbleDock"),c.dockFontShow=!0)}})}var T={name:"Sm3dLight",props:{lightColor:{type:String},cutoffDistance:{type:Number},lightDecay:{type:Number},lightIntensity:{type:Number},spotLightAngle:{type:Number}},setup:function(e){var t=_(e);return{lightSelectId:t.lightSelectId,lightColor:t.lightColor,cutoffDistance:t.cutoffDistance,lightDecay:t.lightDecay,lightIntensity:t.lightIntensity,spotLightAngle:t.spotLightAngle,config:t.config,addLight:t.addLight,clearLight:t.clearLight,visibleModel:t.visibleModel,bubble:t.bubble,closeBubble:t.closeBubble,dockBubble:t.dockBubble,dockFontShow:t.dockFontShow,modelPosition:t.modelPosition,bubbleShow:t.bubbleShow,visiblePositions:t.visiblePositions}}},F={id:"draw-panel",class:"sm-panel"},R={class:"sm-function-module-sub-section",style:{margin:"0"}},H={class:"sm-half-L symbolic"},U={style:{width:"100%"}},z={class:"sm-half-L"},W={style:{width:"35%"}},q={class:"sm-half-L"},K={style:{width:"35%"}},G={class:"sm-half-L"},X={style:{width:"35%"}},Y={class:"sm-half-L"},$={style:{width:"35%"}},J={class:"sm-half-L"},Q={style:{width:"35%"}},Z={class:"sm-half-L flex-between"},ee={style:{width:"auto"}},te={style:{width:"auto"}},ie={class:"boxchild",style:{padding:"0"}},oe={id:"bubble",class:"bubble",ref:"bubble"},ne={class:"boxchild flex-between"},le={style:{width:"auto"}},re={class:"flex flex-end",style:{width:"auto"}},ae={class:"sm-half-L"},se={class:"label-S"},ce={class:"sm-half-L"},ue={class:"label-S"},de={class:"sm-half-L"},pe={class:"label-S"};T.render=function(e,t,i,o,n,y){var v=l("el-color-picker"),S=l("el-slider"),D=r("stopdrag"),M=r("drag");return a(),s(c,null,[u(d("div",F,[u(d("div",R,[d("div",H,[(a(!0),s(c,null,p(o.config,(function(e){return a(),s("div",{key:e.id,class:["symbolic-box",{"theme-color":e.id===o.lightSelectId}],onClick:function(t){return o.lightSelectId=e.id}},[d("span",{class:["iconfont",e.iconfont]},null,2),d("label",U,h(e.lightName),1)],10,["onClick"])})),128))]),d("div",z,[d("label",W,h(e.Resource.lightColor),1),d(v,{modelValue:o.lightColor,"onUpdate:modelValue":t[1]||(t[1]=function(e){return o.lightColor=e}),size:"mini","show-alpha":"",style:{width:"63%"}},null,8,["modelValue"])]),u(d("div",q,[d("label",K,h(e.Resource.cutoffDistance),1),d(S,{modelValue:o.cutoffDistance,"onUpdate:modelValue":t[2]||(t[2]=function(e){return o.cutoffDistance=e}),min:0,max:500,step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])],512),[[w,2!==o.lightSelectId]]),u(d("div",G,[d("label",X,h(e.Resource.lightDecay),1),d(S,{modelValue:o.lightDecay,"onUpdate:modelValue":t[3]||(t[3]=function(e){return o.lightDecay=e}),min:0,max:10,step:.1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])],512),[[w,2!==o.lightSelectId]]),d("div",Y,[d("label",$,h(e.Resource.lightIntensity),1),d(S,{modelValue:o.lightIntensity,"onUpdate:modelValue":t[4]||(t[4]=function(e){return o.lightIntensity=e}),min:0,max:10,step:.1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue","step"])]),u(d("div",J,[d("label",Q,h(e.Resource.spotLightAngle),1),d(S,{modelValue:o.spotLightAngle,"onUpdate:modelValue":t[5]||(t[5]=function(e){return o.spotLightAngle=e}),min:0,max:90,step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"63%"}},null,8,["modelValue"])],512),[[w,1===o.lightSelectId]]),d("div",Z,[d("label",ee,[u(d("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=function(e){return o.visibleModel=e})},null,512),[[g,o.visibleModel]]),b(" "+h(e.Resource.lightModel),1)]),d("label",te,[u(d("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=function(e){return o.visiblePositions=e})},null,512),[[g,o.visiblePositions]]),b(" "+h(e.Resource.lightPositions),1)])]),d("div",ie,[m(' <div class="flex flex-start" style="width:56%; align-items: center;">\r\n          <input checked type="checkbox" style="margin-right:10%" v-model="showLight" />\r\n          <label style="width:auto">显示光源</label>\r\n        </div>'),d("button",{class:"tbtn",type:"button",style:{width:"auto"},onClick:t[8]||(t[8]=function(){return o.addLight&&o.addLight.apply(o,arguments)})},h(e.Resource.add),1),d("button",{class:"tbtn tbtn-margin-left",style:{width:"auto"},type:"button ",onClick:t[9]||(t[9]=function(){return o.clearLight&&o.clearLight.apply(o,arguments)})},h(e.Resource.clear),1)])],512),[[D]])],512),[[M]]),u(d("div",oe,[d("div",ne,[d("label",le,h(e.Resource.visiblePositions),1),d("div",re,[u(d("i",{class:"el-icon-position",title:"停靠",style:{"margin-right":"8px"},onClick:t[10]||(t[10]=function(e){return o.dockBubble(!0)})},null,512),[[w,o.dockFontShow]]),u(d("i",{class:"el-icon-chat-square",title:"悬浮",style:{"margin-right":"8px"},onClick:t[11]||(t[11]=function(e){return o.dockBubble(!1)})},null,512),[[w,!o.dockFontShow]]),d("i",{class:"el-icon-close",title:"关闭",onClick:t[12]||(t[12]=function(){return o.closeBubble&&o.closeBubble.apply(o,arguments)})})])]),d("div",ae,[d("label",se,h(e.Resource.longitude),1),u(d("input",{class:"sm-input-M",style:{width:"70%",height:"20px"},type:"text","onUpdate:modelValue":t[13]||(t[13]=function(e){return o.modelPosition[0]=e})},null,512),[[f,o.modelPosition[0]]])]),d("div",ce,[d("label",ue,h(e.Resource.latitude),1),u(d("input",{class:"sm-input-M",style:{width:"70%",height:"20px"},type:"text","onUpdate:modelValue":t[14]||(t[14]=function(e){return o.modelPosition[1]=e})},null,512),[[f,o.modelPosition[1]]])]),d("div",de,[d("label",pe,h(e.Resource.altitude),1),u(d("input",{class:"sm-input-M",style:{width:"70%",height:"20px"},type:"text","onUpdate:modelValue":t[15]||(t[15]=function(e){return o.modelPosition[2]=e})},null,512),[[f,o.modelPosition[2]]])])],512),[[w,o.bubbleShow&&o.visiblePositions]])],64)},T.__file="src/components/scene/light/light.vue",T.install=function(e){e.component(T.name,T)};export default T;
