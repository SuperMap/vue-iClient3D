import{reactive as e,toRefs as r,watch as t,onBeforeUnmount as o,resolveComponent as n,resolveDirective as a,withDirectives as i,openBlock as s,createBlock as l,createVNode as c,toDisplayString as u,createCommentVNode as p,Fragment as y,renderList as m,vModelSelect as d,vShow as g}from"vue";function f(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function v(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function h(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?v(Object(t),!0).forEach((function(r){f(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var w,b,C={errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},S=function(e){for(var r=[].concat(e),t=[],o=0,n=r.length;o<n;o++){var a=SuperMap3D.Cartographic.fromCartesian(r[o]),i=SuperMap3D.Math.toDegrees(a.longitude),s=SuperMap3D.Math.toDegrees(a.latitude),l=a.height;-1==t.indexOf(i)&&-1==t.indexOf(s)&&(t.push(i),t.push(s),t.push(l))}return t},M={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},D=(b=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=b,b).toLowerCase();var L=((w=void 0!==D?D:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||w.startsWith("ja"),M),P=e({isViewer:!1,changeLayers:0,changeGeometrys:0}),N={geometrys:{},layers:null};function T(e){var r=function(e){var r=document.createElement("DIV");r.className="tooltip",this._div=r,this.message="",e.appendChild(r)};return r.prototype.setVisible=function(e){this._div.style.right=e?"10px":"-300px"},r.prototype.showAt=function(e,r){r&&(this._div.style.top=r),e&&(this.setVisible(!0),this._div.innerHTML=e)},new r(e)}function O(n){var a=e({layerNames:[],selectedLayerName:null,scale:3,positionMode:"intersects",Xpitch:0,Yroll:0,Zheading:0,geometryType:"box",drawType:"Fill_And_WireFrame",FillColor:"rgba(192,211,25,0.5)",WireFrameColor:"rgba(89,129,228,0.8)",searchColor:"rgba(255, 186, 1, 1)",GeometryBodyNames:[],boxParameters:[100,100,100],sphereParameters:[100],coneParameters:[100,200],cylinderParameters:[100,100,200],ellicpseParameters:[100,50,50],rotateOrigin:null});if(n)for(var i in n)a.hasOwnProperty(i)?a[i]=n[i]:C.errorMsg(L.AttributeError+i);var s,l,c,u,p,y=!0,m=[];function d(){if(a.GeometryBodyNames=[],m=[],N.geometrys)for(var e in N.geometrys){m.push(e);var r=N.geometrys[e].name;a.GeometryBodyNames.includes(r)||a.GeometryBodyNames.push(r)}0===a.GeometryBodyNames.length&&(n&&n.geometryType?a.geometryType=n.geometryType:a.geometryType="box")}function g(){s=viewer.scene,l=viewer.scene.layers.layerQueue,(c=new SuperMap3D.SpatialQuery3D(s)).outlineColor=SuperMap3D.Color.fromCssColorString(a.WireFrameColor),c.fillColor=SuperMap3D.Color.fromCssColorString(a.FillColor),c.fillStyle=SuperMap3D.FillStyle[a.drawType],b(a.geometryType),M(a.positionMode),c.build(),setTimeout((function(){0===a.layerNames.length&&f()}),1e3),p=new SuperMap3D.S3MInstanceCollection(s._context),viewer.scene.primitives.add(p)}function f(){var e=w(a.selectedLayerName);c&&c.layers&&(c.layers=e?[e]:[]),a.layerNames.length=0,l&&l.length>0&&(l.forEach((function(e,r){a.layerNames.includes(e._name)||a.layerNames.push(e._name)})),a.selectedLayerName||(a.selectedLayerName=a.layerNames[0]))}function v(e){document.body.classList.remove("measureCur");var r=s.pickPosition(e.message.position);D(S(r)),tooltip.setVisible(!1),viewer.eventManager.removeEventListener("CLICK",v)}function w(e){return l.find((function(r,t){return r._name===e}))}function b(e){switch(e){case"box":var r=a.boxParameters;u=new SuperMap3D.GeoBox(r[0],r[1],r[2]);break;case"sphere":var t=a.sphereParameters;u=new SuperMap3D.GeoSphere(t[0]);break;case"cone":var o=a.coneParameters;u=new SuperMap3D.GeoCone(o[0],o[1]),a.rotateOrigin&&(u.rotateOrigin="APEX"==a.rotateOrigin?SuperMap3D.RotationOrigin.APEX:SuperMap3D.RotationOrigin.CENTER);break;case"cylinder":var n=a.cylinderParameters;u=new SuperMap3D.GeoCylinder(n[0],n[1],n[2]);break;case"ellicpse":var i=a.ellicpseParameters;u=new SuperMap3D.GeoEllipsoid(i[0],i[1],i[2]);break;default:(u=new SuperMap3D.GeoModel3D).geoModel=N.geometrys.SkyLineBody,c.clear()}c.geometry=u}function M(e){var r;switch(e){case"intersects":r=SuperMap3D.PositionMode.Intersects;break;case"disjoint":r=SuperMap3D.PositionMode.Disjoint;break;case"contains":r=SuperMap3D.PositionMode.Contains;break;default:r=SuperMap3D.PositionMode.Intersects}c.positionMode=r}function D(e){c&&c.geometry&&(c.geometry.geoPosition=new SuperMap3D.Point3D(e[0],e[1],e[2]))}function O(){var e=w(a.selectedLayerName);e&&(e.selectedColor=new SuperMap3D.Color(.7,.7,1,1),e.setSelection([]),e.selectColorType=SuperMap3D.SelectColorType.MIX),c.clear(),tooltip.setVisible(!1),document.body.classList.remove("measureCur"),c.geometry.geoPosition=new SuperMap3D.Point3D(0,0,0),viewer.eventManager.removeEventListener("CLICK",v)}return P.isViewer&&(window.tooltip||(window.tooltip=T(viewer._element)),g()),t((function(){return P.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=T(viewer._element)),g())})),t((function(){return P.changeLayers}),(function(e){f()})),P.changeGeometrys&&d(),t((function(){return P.changeGeometrys}),(function(e){d()})),t((function(){return a.Xpitch}),(function(e){""!=e&&(u.geoRotationX=parseFloat(e))})),t((function(){return a.Yroll}),(function(e){""!=e&&(u.geoRotationY=parseFloat(e))})),t((function(){return a.Zheading}),(function(e){""!=e&&(u.geoRotationZ=parseFloat(e))})),t((function(){return a.scale}),(function(e){""!=e&&(u.geoScaleX=parseFloat(e),u.geoScaleY=parseFloat(e),u.geoScaleZ=parseFloat(e))})),t((function(){return a.positionMode}),(function(e){""!=e&&M(e)})),t((function(){return a.geometryType}),(function(e){""!==e&&b(e)})),t((function(){return a.drawType}),(function(e){""!=e&&(c.fillStyle=SuperMap3D.FillStyle[e])})),t((function(){return a.FillColor}),(function(e){""!=e&&(c.fillColor=SuperMap3D.Color.fromCssColorString(e))})),t((function(){return a.WireFrameColor}),(function(e){""!=e&&(c.outlineColor=SuperMap3D.Color.fromCssColorString(e))})),t((function(){return a.searchColor}),(function(e){""!=e&&(w(a.selectedLayerName).selectedColor=SuperMap3D.Color.fromCssColorString(e))})),t((function(){return a.selectedLayerName}),(function(e,r){var t=w(r);t&&(t.selectedColor=new SuperMap3D.Color(.7,.7,1,1),t.setSelection([]),t.selectColorType=SuperMap3D.SelectColorType.MIX),O()})),o((function(){c.destroy(),c=void 0,l=void 0,u=void 0})),h(h({},r(a)),{},{setPosition:D,getQueryIDs:function(){return c.getQueryIDs()},analysis:function(){try{var e=w(a.selectedLayerName);if(!e)return void C.warnMsg("请选择需要查询的图层！");if(c.layers=[e],tooltip.setVisible(!1),e.selectedColor=SuperMap3D.Color.fromCssColorString(a.searchColor),e.selectColorType=SuperMap3D.SelectColorType.REPLACE,e.selectEnabled=!1,c.geometry){var r=c.getQueryIDs();console.log(r)}if("number"==typeof a.geometryType)return b(a.geometryType),void c.build();c.build(),viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),y&&(window.tooltip.showAt(" <p>点击鼠标左键确认查询位置</p>","300px"),y=!1),viewer.eventManager.addEventListener("CLICK",v,!0)}catch(e){console.error(e)}},clear:O})}var x={name:"Sm3dSpatialQuery3d",props:{selectedLayerName:{type:String},Xpitch:{type:Number},Yroll:{type:Number},Zheading:{type:Number},scale:{type:Number},positionMode:{type:String},geometryType:{type:String},drawType:{type:String},FillColor:{type:String},WireFrameColor:{type:String},searchColor:{type:String},boxParameters:{type:Array},sphereParameters:{type:Array},coneParameters:{type:Array},cylinderParameters:{type:Array},ellicpseParameters:{type:Array},rotateOrigin:{type:String}},setup:function(e){var r=O(e);return{scale:r.scale,selectedLayerName:r.selectedLayerName,layerNames:r.layerNames,positionMode:r.positionMode,GeometryBodyNames:r.GeometryBodyNames,geometryType:r.geometryType,analysis:r.analysis,clear:r.clear}}},k={id:"openness-panel",class:"sm-panel"},E={class:"sm-function-module-sub-section",style:{margin:"0"}},B={class:"sm-half-L"},R={style:{width:"40%"}},F={class:"sm-half-L"},G={style:{width:"40%"}},V={class:"sm-half-L"},j={style:{width:"40%"}},_={value:"intersects"},A={value:"disjoint"},I={value:"contains"},W={class:"sm-half-L"},X={style:{width:"40%"}},Q={value:"box"},Y={class:"boxchild"};x.render=function(e,r,t,o,f,v){var h=n("el-slider"),w=a("stopdrag"),b=a("drag");return i((s(),l("div",k,[i(c("div",E,[c("div",B,[c("label",R,u(e.Resource.scale),1),c(h,{modelValue:o.scale,"onUpdate:modelValue":r[1]||(r[1]=function(e){return o.scale=e}),min:.2,max:10,step:.2,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class",style:{width:"58%"}},null,8,["modelValue","min","step"]),p(' <input class="sm-input-S" min="1" step="1" type="number" v-model="clipWidth" /> ')]),c("div",F,[c("label",G,u(e.Resource.searchLayers),1),i(c("select",{class:"sm-select",style:{width:"58%"},"onUpdate:modelValue":r[2]||(r[2]=function(e){return o.selectedLayerName=e})},[(s(!0),l(y,null,m(o.layerNames,(function(e,r){return s(),l("option",{key:r,value:e},u(e),9,["value"])})),128))],512),[[d,o.selectedLayerName]])]),c("div",V,[c("label",j,u(e.Resource.positionMode),1),i(c("select",{class:"sm-select",style:{width:"58%"},"onUpdate:modelValue":r[3]||(r[3]=function(e){return o.positionMode=e})},[c("option",_,u(e.Resource.intersects),1),c("option",A,u(e.Resource.disjoint),1),c("option",I,u(e.Resource.contains),1)],512),[[d,o.positionMode]])]),i(c("div",W,[c("label",X,u(e.Resource.geometryType),1),i(c("select",{class:"sm-select",style:{width:"58%"},"onUpdate:modelValue":r[4]||(r[4]=function(e){return o.geometryType=e})},[c("option",Q,u(e.Resource.box),1),(s(!0),l(y,null,m(o.GeometryBodyNames,(function(e,r){return s(),l("option",{key:r,value:r},u(e),9,["value"])})),128))],512),[[d,o.geometryType]])],512),[[g,o.GeometryBodyNames.length>0]]),c("div",Y,[c("button",{class:"tbtn",type:"button",onClick:r[5]||(r[5]=function(){return o.analysis&&o.analysis.apply(o,arguments)})},u(e.Resource.search),1),c("button",{onClick:r[6]||(r[6]=function(){return o.clear&&o.clear.apply(o,arguments)}),class:"tbtn",style:{"margin-left":"4px"},type:"button"},u(e.Resource.clear),1)])],512),[[w]])],512)),[[b]])},x.__file="src/components/space-search/spatial-query3d/spatial-query3d.vue",x.install=function(e){e.component(x.name,x)};export default x;
