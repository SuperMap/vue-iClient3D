import{reactive as e,toRefs as r,resolveDirective as a,withDirectives as n,openBlock as t,createBlock as o,createVNode as i,vModelSelect as l,vModelText as s,createCommentVNode as c,vModelCheckbox as u,vShow as d,createStaticVNode as p}from"vue";function y(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}function v(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),a.push.apply(a,n)}return a}function f(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?v(Object(a),!0).forEach((function(r){y(e,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))}))}return e}var m=e({isViewer:!1,changeLayers:0,changeGeometrys:0}),w=function(e){m.changeLayers+=1},g={geometrys:{},layers:null};function h(e,r,a){SuperMap3D.when.all(e,(function(e){console.log("layers:",e),g.layers=viewer.scene.layers.layerQueue,w(),r(e[0],a),g.layers.forEach((function(e){(!e.visibleDistanceMax||e.visibleDistanceMax>12e3)&&(e.visibleDistanceMax=12e3)}))}),(function(e){var r=viewer.SuperMap3DWidget;if(r._showRenderLoopErrors){r.showErrorPanel("请检查url地址是否正确？",void 0,e)}}))}var S={addS3mLayers:function(e,r){var a=[];try{e&&e.forEach((function(e){a.push(viewer.scene.addS3MTilesLayerByScp(e.url,e.options))})),h(a,r,"S3M")}catch(e){var n=viewer.SuperMap3DWidget;if(n._showRenderLoopErrors){n.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}},addScene:function(e,r,a){r&&r.SceneToken&&(SuperMap3D.Credential.CREDENTIAL=new SuperMap3D.Credential(r.SceneToken));var n=!0;if(r&&r.autoSetView&&(n=r.autoSetView),function(e){if(null===e||""===e)return!1;if('"'==e.charAt(0)||"'"==e.charAt(0)){var r=/^['|"](.*)['|"]$/;e=e.replace(r,"$1")}return!0}(e))try{h([viewer.scene.open(e,void 0,{autoSetView:n})],a,"SCENE")}catch(e){var t=viewer.SuperMap3DWidget;if(t._showRenderLoopErrors){t.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}},addTerrainLayer:function(e,r){try{viewer.terrainProvider=new SuperMap3D.SuperMap3DTerrainProvider({url:e,isSct:r})}catch(e){var a=viewer.SuperMap3DWidget;if(a._showRenderLoopErrors){a.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}},addImageLayer:function(e){try{return viewer.imageryLayers.addImageryProvider(new SuperMap3D.SuperMapImageryProvider({url:e}))}catch(e){var r=viewer.SuperMap3DWidget;if(r._showRenderLoopErrors){r.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}},layersDelete:function(e,r,a){switch(e){case"S3M":viewer.scene.layers.remove(r),w(),a();break;case"IMG":var n;if("nunber"==typeof r)n=viewer.imageryLayers.get(r);else for(var t=viewer.imageryLayers._layers,o=0;o<t.length;o++)t[o].imageryProvider.tablename&&t[o].imageryProvider.tablename===r&&(n=t[o]);n&&(viewer.imageryLayers.remove(n),w(),a());break;case"TERRAIN":viewer.terrainProvider=new SuperMap3D.EllipsoidTerrainProvider,w(),a();break;case"MVT":viewer.scene.removeVectorTilesMap(r),w(),a()}},addMvtLayer:function(e,r,a){try{var n=viewer.scene.addVectorTilesMap({url:e,canvasWidth:512,name:r||"mvt",viewer:viewer});return SuperMap3D.when(n.readyPromise,(function(e){var r=n.rectangle;viewer.scene.camera.flyTo({destination:new SuperMap3D.Cartesian3.fromRadians(.5*(r.east+r.west),.5*(r.north+r.south),1e4),duration:0,orientation:{heading:0,roll:0}}),w(),a(n)})),n}catch(e){var t=viewer.SuperMap3DWidget;if(t._showRenderLoopErrors){t.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}}};var b={errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},M={name:"Sm3dCustomService",props:{addCallback:{type:Function},clearCallback:{type:Function},getLayerName:{type:Function}},setup:function(a){var n=e({layersType:"SCENE",layerURL:null,layerName:null,isAddToken:!1,token:null,isSct:!1}),t=function(){},o=function(){},i=function(){};function l(){return n.layerURL&&""!==n.layerURL?"SCENE"==n.layersType||n.layerName&&""!==n.layerName?!(n.isAddToken&&!n.token)||(b.warnMsg("勾选token后请填写token"),!1):(b.warnMsg("请补充图层名称"),!1):(b.warnMsg("请填写正确的URL"),!1)}function s(){n.layerURL=null,n.layerName=null,n.isAddToken=!1,n.token=null,n.isSct=!1}return a&&a.clearCallback&&(o=a.clearCallback),a&&a.addCallback&&(t=a.addCallback),a&&a.getLayerName&&(i=a.getLayerName),f(f({},r(n)),{},{addLayer:function(){if(e=n.layerURL.split("/"),"realspace"===(r=e[e.length-1])&&"SCENE"!=n.layersType||"config"===r&&"S3M"!=n.layersType||"image"===r&&"IMG"!=n.layersType)b.warnMsg("请检查添加类型是否正常？");else{var e,r;switch(i(n.layerName),n.layersType){case"SCENE":if(l()){var a={};n.isAddToken&&(a.SceneToken=token),S.addScene(n.layerURL,a,t)}break;case"S3M":if(l()){var o=[{url:n.layerURL,options:{name:n.layerName}}];S.addS3mLayers(o,t)}break;case"IMG":if(l()){var c=S.addImageLayer(n.layerURL);t(c,"IMG")}break;case"TERRAIN":l()&&(S.addTerrainLayer(n.layerURL,n.isSct),t(viewer.terrainProvider,"TERRAIN"));break;case"MVT":if(l()){var u=S.addMvtLayer(n.layerURL,n.layerName);t(u,"MVT")}}s()}},clear:function(){s(),o()}})}},L={id:"CustomService-panel",class:"sm-panel"},k={class:"sm-function-module-sub-section",style:{margin:"0"}},T={class:"sm-half-L"},E=i("label",{style:{width:"40%"}},"打开图层",-1),R=p('<option value="SCENE">场景</option><option value="S3M">S3M</option><option value="IMG">影像</option><option value="TERRAIN">地形</option><option value="MVT">矢量瓦片</option>',5),P={class:"sm-half-L flex-start"},D=i("label",{class:"label-S"},"添加token",-1),N={class:"sm-half-L flex-start"},C=i("label",{class:"label-S"},"isSct",-1),U={class:"boxchild"};M.render=function(e,r,p,y,v,f){var m=a("stopdrag"),w=a("drag");return n((t(),o("div",L,[n(i("div",k,[i("div",T,[E,n(i("select",{class:"sm-select",style:{width:"58%"},"onUpdate:modelValue":r[1]||(r[1]=function(r){return e.layersType=r})},[R],512),[[l,e.layersType]])]),i("div",P,[n(i("input",{type:"text",class:"sm-input sm-margin-M",style:{width:"100%"},placeholder:"URL","onUpdate:modelValue":r[2]||(r[2]=function(r){return e.layerURL=r})},null,512),[[s,e.layerURL]]),n(i("input",{type:"text",class:"sm-input sm-margin-M",style:{width:"100%"},placeholder:"自定义名称","onUpdate:modelValue":r[3]||(r[3]=function(r){return e.layerName=r})},null,512),[[s,e.layerName]]),c(" v-show=\"layersType === 'S3M'\" "),D,n(i("input",{checked:"",type:"checkbox","onUpdate:modelValue":r[4]||(r[4]=function(r){return e.isAddToken=r})},null,512),[[u,e.isAddToken]]),n(i("input",{type:"text",class:"sm-input sm-margin-M",style:{width:"100%"},placeholder:"token","onUpdate:modelValue":r[5]||(r[5]=function(r){return e.token=r})},null,512),[[s,e.token],[d,e.isAddToken]])]),n(i("div",N,[C,n(i("input",{checked:"",type:"checkbox","onUpdate:modelValue":r[6]||(r[6]=function(r){return e.isSct=r})},null,512),[[u,e.isSct]])],512),[[d,"TERRAIN"===e.layersType]]),i("div",U,[i("button",{class:"tbtn tbtn-margin-left",type:"button",onClick:r[7]||(r[7]=function(){return y.addLayer&&y.addLayer.apply(y,arguments)})},"添加"),i("button",{onClick:r[8]||(r[8]=function(){return y.clear&&y.clear.apply(y,arguments)}),class:"tbtn tbtn-margin-left",type:"button"},"取消")])],512),[[m]])],512)),[[w]])},M.__file="src/components/layer/custom-service/custom-service.vue",M.install=function(e){e.component(M.name,M)};export default M;
