import{toRefs as e,reactive as n,watch as o,onBeforeUnmount as i,resolveComponent as t,resolveDirective as r,withDirectives as l,openBlock as a,createBlock as s,createVNode as p,toDisplayString as u,vModelText as c,vModelSelect as d}from"vue";function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,n,o){return n in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function f(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),o.push.apply(o,i)}return o}function g(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?f(Object(o),!0).forEach((function(n){y(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):f(Object(o)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))}))}return e}function h(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return v(e,n);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return v(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,n){(null==n||n>e.length)&&(n=e.length);for(var o=0,i=new Array(n);o<n;o++)i[o]=e[o];return i}var m=function(e,n){if(!e||!n)return!0;var o=!0;if(Object.keys(e).length!=Object.keys(n).length)return!1;for(var i in e)if("object"==w(e[i])){if(!(o=isSame(e[i],n[i])))break}else if(e[i]!=n[i]){o=!1;break}return o},M=function(e){for(var n=[].concat(e),o=[],i=0,t=n.length;i<t;i++){var r=SuperMap3D.Cartographic.fromCartesian(n[i]),l=SuperMap3D.Math.toDegrees(r.longitude),a=SuperMap3D.Math.toDegrees(r.latitude),s=r.height;-1==o.indexOf(l)&&-1==o.indexOf(a)&&(o.push(l),o.push(a),o.push(s))}return o};var b,S,D={errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},C={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},P=(S=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=S,S).toLowerCase();var H=((b=void 0!==P?P:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||b.startsWith("ja"),C),E=function(e,n){var o,i,t=0;switch(n&&(t=n),e){case"Point":window.handlerPoint=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Point);break;case"Polyline":window.handlerPolyline=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Line,t);break;case"Polygon":window.handlerPolygon=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Polygon,t);break;case"Marker":window.handlerMarker=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Marker,t);break;case"Box":window.handlerBox=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box,t)}window.tooltip||(window.tooltip=(o=viewer._element,(i=function(e){var n=document.createElement("DIV");n.className="twipsy right";var o=document.createElement("DIV");o.className="twipsy-arrow",n.appendChild(o);var i=document.createElement("DIV");i.className="twipsy-inner",n.appendChild(i),this._div=n,this._title=i,this.message="",e.appendChild(n);var t=this;n.onmousemove=function(e){t.showAt({x:e.clientX,y:e.clientY},t.message)}}).prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},i.prototype.showAt=function(e,n){e&&n&&(this.setVisible(!0),this._title.innerHTML=n,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px",this.message=n)},new i(o))),window.polylineCollection||(window.polylineCollection=new SuperMap3D.PolylineCollection({translucentRS:SuperMap3D.RenderState.fromCache({depthMask:!1,depthTest:{enabled:!1}})}),window.polylineTransparent=window.polylineCollection.add({width:2,material:SuperMap3D.Material.fromType(SuperMap3D.Material.ColorType,{color:SuperMap3D.Color.fromCssColorString("#51ff00").withAlpha(.3)})}),viewer.scene.primitives.add(window.polylineCollection))},L=function(e){var n;switch(e){case"Point":n=window.handlerPoint;break;case"Polyline":n=window.handlerPolyline;break;case"Polygon":n=window.handlerPolygon;break;case"Marker":n=window.handlerMarker;break;case"Box":n=window.handlerBox}return n},O=function(e,n,o){window.selectHandler||(window.selectHandler=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas));var i=window.selectHandler;window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!0),i.setInputAction((function(){console.log("viewer.selectedEntity:",viewer.selectedEntity);var t=viewer.selectedEntity,r=window.editHandler;t&&(r&&r&&r.clear(),r?(r.deactivate(),r.setEditObject(t),r.activate()):(window.editHandler=new SuperMap3D.EditHandler(viewer,t),window.editHandler.isEditZ=n||!1,window.editHandler.activate()),i.setInputAction((function(){if(t=viewer.selectedEntity,r=window.editHandler,t&&r&&r._positions){var n=M(r._positions);if(m(e,n))return;if(e=n,o&&o(n,window.editHandler),window.handlerPolygon&&window.handlerPolygon.polygon&&window.handlerPolygon.polygon.show){var i=h(r._positions);i.push(i[0]),window.polylineTransparent.positions=i}}}),SuperMap3D.ScreenSpaceEventType.LEFT_UP))}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)},k=function(){window.editHandler&&(window.editHandler.deactivate(),window.editHandler.clear()),window.selectHandler&&(window.selectHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_UP),window.selectHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),window.selectHandler.destroy(),window.selectHandler=null)};function I(t){var r=n({fillMaxHeight:9e3,fillMinHeight:0,fillHeight:[0,9e3],equivalentIsoline:100,fillOptionsSelected:"Line",lineColor:"#FF8040",isEdit:!1,isolinePositions:[],lineVisible:!0});if(t)for(var l in t)r.hasOwnProperty(l)?r[l]=t[l]:D.errorMsg(H.AttributeError+l);var a=new SuperMap3D.HypsometricSetting,s=SuperMap3D.HypsometricSettingEnum.DisplayMode.LINE,p=new SuperMap3D.ColorTable;!function(e){e.insert(5597.06640625,new SuperMap3D.Color(0,0,1)),e.insert(5406.387386067709,new SuperMap3D.Color(0,.2,1)),e.insert(5215.708365885417,new SuperMap3D.Color(0,.4,1)),e.insert(5025.029345703126,new SuperMap3D.Color(0,.6,1)),e.insert(4834.350325520834,new SuperMap3D.Color(0,.8,1)),e.insert(4643.671305338543,new SuperMap3D.Color(0,1,1)),e.insert(4452.992285156252,new SuperMap3D.Color(.2,1,.8)),e.insert(4262.313264973961,new SuperMap3D.Color(.4,1,.6)),e.insert(4071.6342447916695,new SuperMap3D.Color(.6,1,.4)),e.insert(3880.955224609378,new SuperMap3D.Color(.8,1,.2)),e.insert(3690.2762044270867,new SuperMap3D.Color(1,1,0)),e.insert(3499.5971842447952,new SuperMap3D.Color(1,.8,0)),e.insert(3308.918164062504,new SuperMap3D.Color(1,.6,0)),e.insert(3118.239143880213,new SuperMap3D.Color(1,.4,0)),e.insert(2927.5601236979214,new SuperMap3D.Color(1,.2,0)),e.insert(2736.88110351563,new SuperMap3D.Color(1,0,0))}(p);var u=[];function c(e){e&&(u=e),0!=u.length&&(e&&(a.CoverageArea=e),viewer.scene.globe.HypsometricSetting={hypsometricSetting:a,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})}return t&&t.isolinePositions&&c(t.isolinePositions),o((function(){return r.fillMaxHeight}),(function(e){a.MaxVisibleValue=parseFloat(e),0!=u.length&&c()})),o((function(){return r.fillMinHeight}),(function(e){a.MinVisibleValue=parseFloat(e),0!=u.length&&c()})),o((function(){return r.fillHeight}),(function(e){r.fillMinHeight=e[0],r.fillMaxHeight=e[1]})),o((function(){return r.equivalentIsoline}),(function(e){a.LineInterval=parseFloat(e),0!=u.length&&c()})),o((function(){return r.lineColor}),(function(e){if(e){if(a._lineColor=SuperMap3D.Color.fromCssColorString(e),0==u.length)return;c()}else console.warn("err: color is  null")})),o((function(){return r.fillOptionsSelected}),(function(e){switch(e){case"None":s=void 0;break;case"Line":s=SuperMap3D.HypsometricSettingEnum.DisplayMode.LINE,a.Opacity=1;break;case"Region":s=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE,a.Opacity=.5;break;case"Line_Region":s=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE_AND_LINE,a.Opacity=.5}a.DisplayMode=s,0!=u.length&&c(u)})),o((function(){return r.isEdit}),(function(e){e&&window.handlerPolygon?O(u,!1,c):(k(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),i((function(){a.destroy(),p.destroy(),a=void 0,p=void 0})),g(g({},e(r)),{},{isoLineAnalysis:function(e){e.preventDefault(),a.DisplayMode=s,a._lineColor=SuperMap3D.Color.fromCssColorString(r.lineColor),a.LineInterval=parseFloat(r.equivalentIsoline),a.MaxVisibleValue=parseFloat(r.fillMaxHeight),a.MinVisibleValue=parseFloat(r.fillMinHeight),a.ColorTableMinKey=2736.88110351563,a.ColorTableMaxKey=5597.06640625,a.ColorTable=p,window.handlerPolygon||E("Polygon"),function(e,n,o){var i=!0;!1===n&&(i=n);var t=L(e);return new Promise((function(n,o){var r=window.tooltip,l=t.activeEvt.addEventListener((function(n){1==n?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="","Point"==e||"Marker"==e?document.body.classList.add("measureCur"):document.body.classList.add("drawCur")):(viewer.enableCursorStyle=!0,r.setVisible(!1),"Point"==e||"Marker"==e?document.body.classList.remove("measureCur"):document.body.classList.remove("drawCur"))})),a=t.movingEvt.addEventListener((function(n){if(n.x<200&&n.y<150)r.setVisible(!1);else if(t.polyline&&t.isDrawing){var o=h(t.positions);"Polygon"==e&&o.push(o[0]),window.polylineTransparent.show=!0,window.polylineTransparent.positions=o}})),s=t.drawEvt.addEventListener((function(o){if(!o.object.positions&&"Point"!=e&&"Box"!=e)return r.showAt(o,"<p>请绘制正确的多边形</p>"),t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),void t.activate();if("Box"!=e){if("Point"==e||"Marker"==e)t.clear(),n({result:o});else{if(window.polylineTransparent.show=i,i&&"Polygon"==e&&i){t.polygon._polygon._material._color._value.alpha=.1;var p=h(o.object.positions);p.push(p[0]),window.polylineTransparent.positions=p}var u=M(o.object.positions);n({result:o,positions:u})}l(),a(),s()}else n({result:o})}))}))}("Polygon",r.lineVisible).then((function(e){u=e.positions;var n=window.handlerPolygon;c(u),n.polygon.show=!1,n.polyline.show=!1,n.deactivate(),r.isEdit&&O(u,!1,c)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),scene.pickPositionSupported||D.errorMsg(H.NoPickPositionSupported)},clearIsoLine:function(e){var n,o;e.preventDefault(),u=[],window.handlerPolygon&&(viewer.scene.globe.HypsometricSetting=void 0,a&&(a.MaxVisibleValue=-1e3),a&&(a.MinVisibleValue=-1e3),(o=(n="Polygon")?L(n):window.handlerPolygon)&&(o.deactivate(),o.clear(),viewer.enableCursorStyle=!0,window.tooltip.setVisible(!1),window.polylineTransparent&&(window.polylineTransparent.show=!1)),k())},isolinePosition:u})}var x={name:"Sm3dTerrainIsoline",props:{fillMaxHeight:{type:Number},fillMinHeight:{type:Number},equivalentIsoline:{type:Number},lineColor:{type:String},fillOptionsSelected:{type:String},isEdit:{type:Boolean,default:!1},isolinePositions:{type:Array},lineVisible:{type:Boolean,default:!0}},methods:{formatTooltip:function(e){return e+Resource.meter},formatTooltip2:function(e){return e+Resource.meter_second}},setup:function(e){var n=I(e);return{fillMaxHeight:n.fillMaxHeight,fillMinHeight:n.fillMinHeight,fillHeight:n.fillHeight,equivalentIsoline:n.equivalentIsoline,lineColor:n.lineColor,fillOptionsSelected:n.fillOptionsSelected,isEdit:n.isEdit,isoLineAnalysis:n.isoLineAnalysis,clearIsoLine:n.clearIsoLine}}},T={id:"terrain-isoline-panel",class:"sm-panel"},V={class:"sm-function-module-sub-section",style:{margin:"0"}},A={class:"sm-half-L"},_={style:{width:"40%"}},j={class:"sm-half-L"},R={style:{width:"40%"}},B={class:"sm-half-L"},F={style:{width:"40%"}},N={value:"Line"},q={value:"Region"},U={value:"Line_Region"},W={value:"None"},K={class:"boxchild"};x.render=function(e,n,o,i,w,y){var f=t("el-slider"),g=r("stopdrag"),h=r("drag");return l((a(),s("div",T,[l(p("div",V,[p("div",A,[p("label",_,u(e.Resource.visibleHeight),1),p(f,{modelValue:i.fillHeight,"onUpdate:modelValue":n[1]||(n[1]=function(e){return i.fillHeight=e}),min:0,max:9e3,range:"",step:1,"input-size":"mini",debounce:500,"tooltip-class":"tooltip-class","format-tooltip":y.formatTooltip,style:{width:"58%"}},null,8,["modelValue","format-tooltip"])]),p("div",j,[p("label",R,u(e.Resource.isolineInterval),1),l(p("input",{class:"sm-input",style:{width:"58%"},min:"0",type:"number","onUpdate:modelValue":n[2]||(n[2]=function(e){return i.equivalentIsoline=e})},null,512),[[c,i.equivalentIsoline]])]),p("div",B,[p("label",F,u(e.Resource.displayMode),1),l(p("select",{class:"sm-select",style:{width:"58%"},id:"fillOptions","onUpdate:modelValue":n[3]||(n[3]=function(e){return i.fillOptionsSelected=e})},[p("option",N,u(e.Resource.contourFilling),1),p("option",q,u(e.Resource.panelFilling),1),p("option",U,u(e.Resource.contourPanelFilling),1),p("option",W,u(e.Resource.noColorTable),1)],512),[[d,i.fillOptionsSelected]])]),p("div",K,[p("button",{onClick:n[4]||(n[4]=function(){return i.isoLineAnalysis&&i.isoLineAnalysis.apply(i,arguments)}),class:"tbtn",type:"button"},u(e.Resource.analyze),1),p("button",{onClick:n[5]||(n[5]=function(){return i.clearIsoLine&&i.clearIsoLine.apply(i,arguments)}),class:"tbtn tbtn-margin-left",type:"button"},u(e.Resource.clear),1)])],512),[[g]])],512)),[[h]])},x.__file="src/components/terrain-analysis/terrain-isoline/terrain-isoline.vue",x.install=function(e){e.component(x.name,x)};export default x;
