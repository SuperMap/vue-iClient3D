import{reactive as e,onBeforeUnmount as t,onMounted as n,openBlock as r,createBlock as i,renderSlot as o}from"vue";var a=e({isViewer:!1,changeLayers:0,changeGeometrys:0}),s=function(e){a.isViewer=e},c=function(e){a.changeLayers+=1},u={geometrys:{},layers:null};function p(e,t){var n=[];try{e&&e.forEach((function(e){n.push(viewer.scene.addS3MTilesLayerByScp(e.url,e.options))})),d(n,t,"S3M")}catch(e){var r=viewer.SuperMap3DWidget;if(r._showRenderLoopErrors){r.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}}function l(e,t,n){t&&t.SceneToken&&(SuperMap3D.Credential.CREDENTIAL=new SuperMap3D.Credential(t.SceneToken));var r=!0;if(t&&t.autoSetView&&(r=t.autoSetView),function(e){if(null===e||""===e)return!1;if('"'==e.charAt(0)||"'"==e.charAt(0)){var t=/^['|"](.*)['|"]$/;e=e.replace(t,"$1")}return!0}(e))try{d([viewer.scene.open(e,void 0,{autoSetView:r})],n,"SCENE")}catch(e){var i=viewer.SuperMap3DWidget;if(i._showRenderLoopErrors){i.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}}function d(e,t,n){SuperMap3D.when.all(e,(function(e){console.log("layers:",e),u.layers=viewer.scene.layers.layerQueue,c(),t(e[0],n),u.layers.forEach((function(e){(!e.visibleDistanceMax||e.visibleDistanceMax>12e3)&&(e.visibleDistanceMax=12e3)}))}),(function(e){var t=viewer.SuperMap3DWidget;if(t._showRenderLoopErrors){t.showErrorPanel("请检查url地址是否正确？",void 0,e)}}))}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function w(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f(e);if(t){var i=f(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w(this,n)}}function m(){}Object.assign(m.prototype,{addEventListener:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];void 0===this._listeners&&(this._listeners={}),this._mutex=this._mutex||{};var r=this._mutex,i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&(n&&(r[e]=t),i[e].push(t))},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(this._mutex[e]===t&&(this._mutex[e]=null),void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){var t=this;if(void 0!==this._listeners){var n=this._listeners[e.type];if(void 0!==n){e.target=this;var r=n.slice(0);if(this._mutex[e.type])return void r.find((function(n){return n===t._mutex[e.type]})).call(this,e);for(var i=0,o=r.length;i<o;i++)r[i].call(this,e)}}},removeAllListener:function(){for(var e in this._mutex={},this._listeners)this._listeners[e]=[]}});var g="CLICK",S="LEFT_DOWN",E="LEFT_UP",_="MOUSE_MOVE",M="RIGHT_CLICK",L="LEFT_DOWN_MOUSE_MOVE",b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(o,m);var t,n,r,i=y(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).viewer=e,t.handler=new SuperMap3D.ScreenSpaceEventHandler(t.viewer.scene.canvas),t.handler.setInputAction((function(e){t.dispatchEvent({type:g,message:e})}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),t.handler.setInputAction((function(e){t.press=!0,t.dispatchEvent({type:S,message:e})}),SuperMap3D.ScreenSpaceEventType.LEFT_DOWN),t.handler.setInputAction((function(e){t.press=!1,t.dispatchEvent({type:E,message:e})}),SuperMap3D.ScreenSpaceEventType.LEFT_UP),t.handler.setInputAction((function(e){t.dispatchEvent({type:M,message:e})}),SuperMap3D.ScreenSpaceEventType.RIGHT_CLICK),t.handler.setInputAction((function(e){t.press&&t.dispatchEvent({type:L,message:e}),t.dispatchEvent({type:_,message:e})}),SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),t}return t=o,(n=[{key:"addCameraMoveListener",value:function(e){this.viewer.camera.changed.addEventListener(e)}},{key:"removeCameraMoveListener",value:function(e){this.viewer.camera.changed.removeEventListener(e)}}])&&v(t.prototype,n),r&&v(t,r),o}();var D,C,x={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},O=(C=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=C,C).toLowerCase();var T=((D=void 0!==O?O:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||D.startsWith("ja"),x);function P(e,n){var r;if(window.viewer&&(window.viewer=null),window.isPCBroswer=SuperMap3D.FeatureDetection.isPCBroswer()){r=new SuperMap3D.Viewer("SuperMap3DContainer",{timeline:!0,baseLayerPicker:!1,imageryProvider:!1,navigation:!1,animation:!1,infoBox:!1,contextOptions:{msaaLevel:8,requestWebgl2:!0},shadows:!1,pcss:!0,shadowQuality:0,creditContainer:document.createElement("div")}),document.getElementsByClassName("supermap3d-viewer-timelineContainer")[0].style.visibility="hidden"}else{var i=(r=new SuperMap3D.Viewer("SuperMap3DContainer",{selectionIndicator:!1,infoBox:!1,skyBox:!1,navigation:!1,contextOptions:{requestWebgl2:!0}})).scene;SuperMap3D.defined(i.sun)&&(i.globe.enableLighting=!1),SuperMap3D.defined(i.moon)&&(i.moon.show=!1),document.documentElement.style.height=window.innerHeight+"px",document.addEventListener("touchmove",(function(e){e.preventDefault()}),!1)}r.scene.debugShowFramesPerSecond=!0,r.scene.globe.baseColor=SuperMap3D.Color.BLACK,window.viewer=r,window.scene=r.scene,scene.moon.show=!1,r.eventManager=new b(r);var o,a,c=r.SuperMap3DWidget;s(!0),r.geocoder&&(r.geocoder.viewModel.geoKey="fvV2osxwuZWlY0wJb8FEb2i5"),window.tooltip||(window.tooltip=(o=r._element,(a=function(e){var t=document.createElement("DIV");t.className="tooltip",this._div=t,this.message="",e.appendChild(t)}).prototype.setVisible=function(e){this._div.style.right=e?"10px":"-300px"},a.prototype.showAt=function(e,t){t&&(this._div.style.top=t),e&&(this.setVisible(!0),this._div.innerHTML=e)},new a(o)));try{e&&e.openingAnimation&&r.camera.flyTo({destination:new SuperMap3D.Cartesian3(6788287.844465209,-41980756.10214644,29619220.04004376),duration:0,complete:function(){r.camera.flyTo({destination:new SuperMap3D.Cartesian3.fromDegrees(110.60396458865515,34.54408834959379,30644793.325518917),duration:5})}}),e&&e.afterInitviewer&&e.afterInitviewer(),e&&e.sceneUrl&&l(e.sceneUrl,{},(function(e){})),e&&e.s3mScps&&p(e.s3mScps)}catch(e){if(c._showRenderLoopErrors){var u=T.showRenderLoopErrors;c.showErrorPanel(u,void 0,e)}}t((function(){r.destroy(),window.viewer=void 0,window.scene=void 0}))}var I={name:"Sm3dViewer",props:{sceneUrl:{type:String},s3mScps:{type:Array},afterInitviewer:{type:Function},openingAnimation:{type:Boolean}},setup:function(e){n((function(){P(e)}))}},V={id:"SuperMap3DContainer",ref:"viewer"};I.render=function(e,t,n,a,s,c){return r(),i("div",V,[o(e.$slots,"default")],512)},I.__file="src/components/viewer/viewer.vue",I.install=function(e){e.component(I.name,I)};export default I;
