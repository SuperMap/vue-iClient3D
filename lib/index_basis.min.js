!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["vue-webgl-basis"]=t(e.Vue)}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=l(e);if(t){var i=l(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return c(this,n)}}function d(e){return function(e){if(Array.isArray(e))return w(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||f(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){if(e){if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function h(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=f(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw r}}}}var v=function(e,n){if(!e||!n)return!0;var o=!0;if(Object.keys(e).length!=Object.keys(n).length)return!1;for(var i in e)if("object"==t(e[i])){if(!(o=isSame(e[i],n[i])))break}else if(e[i]!=n[i]){o=!1;break}return o},m=function(e){for(var t=[].concat(e),n=[],o=0,i=t.length;o<i;o++){var r=SuperMap3D.Cartographic.fromCartesian(t[o]),a=SuperMap3D.Math.toDegrees(r.longitude),s=SuperMap3D.Math.toDegrees(r.latitude),l=r.height;-1==n.indexOf(a)&&-1==n.indexOf(s)&&(n.push(a),n.push(s),n.push(l))}return n};var y={Message:{errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},axiosJsonp:function(e){if(e)return new Promise((function(t,n){window.jsonCallBack=function(e){t(e)};var o=document.createElement("script");o.type="text/javascript",o.src="".concat(e,"&callback=jsonCallBack"),document.getElementsByTagName("head")[0].appendChild(o),setTimeout((function(){document.getElementsByTagName("head")[0].removeChild(o)}),500)}));console.error("Axios.JSONP 至少需要一个url参数!")},isEqualArr:v,CartesiantoDegrees:m,CartesiantoDegreesObjs:function(e){for(var t=[].concat(e),n=[],o=0,i=t.length;o<i;o++){var r=SuperMap3D.Cartographic.fromCartesian(t[o]),a={longitude:SuperMap3D.Math.toDegrees(r.longitude),latitude:SuperMap3D.Math.toDegrees(r.latitude),height:r.height};n.push(a)}return n},unique:function(e){for(var t=[],n={},o=0;o<e.length;o++)n[e[o]]||(t.push(e[o]),n[e[o]]=1);return t},gradientColors:function(e,t,n,o){var i,r,a,s,l=[],u=[];o=o||1;var c,p=function(e){return Math.pow(e/255,o)};for(e=d(e).map(p),t=d(t).map(p),i=0;i<n;i++){for(s=1-(a=i/(n-1)),r=0;r<3;r++)u[r]=1===(c=Math.round(255*Math.pow(e[r]*s+t[r]*a,1/o)).toString(16)).length?"0"+c:c;l.push("#"+u.join(""))}return l;function d(e){return 4===e.length?e.substr(1).split("").map((function(e){return 17*parseInt(e,16)})):[e.substr(1,2),e.substr(3,2),e.substr(5,2)].map((function(e){return parseInt(e,16)}))}},getAngleAndRadian:function(e,t){var n=SuperMap3D.Transforms.eastNorthUpToFixedFrame(e),o=SuperMap3D.Cartesian3.subtract(t,e,new SuperMap3D.Cartesian3),i=SuperMap3D.Matrix4.multiplyByPointAsVector(SuperMap3D.Matrix4.inverse(n,new SuperMap3D.Matrix4),o,new SuperMap3D.Cartesian3),r=SuperMap3D.Cartesian3.normalize(i,new SuperMap3D.Cartesian3),a=Math.atan2(r.y,r.x)-SuperMap3D.Math.PI_OVER_TWO,s=SuperMap3D.Math.TWO_PI-SuperMap3D.Math.zeroToTwoPi(a),l=s*(180/Math.PI);return l<0&&(l+=360),{angle:l,radian:s}},CartographictoDegrees:function(e){return[SuperMap3D.Math.toDegrees(e.longitude),SuperMap3D.Math.toDegrees(e.latitude),e.height]},getPitch:function(e,t){var n=SuperMap3D.Transforms.eastNorthUpToFixedFrame(e),o=SuperMap3D.Cartesian3.subtract(t,e,new SuperMap3D.Cartesian3),i=SuperMap3D.Matrix4.multiplyByPointAsVector(SuperMap3D.Matrix4.inverse(n,n),o,o);SuperMap3D.Cartesian3.normalize(i,i);var r=SuperMap3D.Math.PI_OVER_TWO-SuperMap3D.Math.acosClamped(i.z),a=r*(180/Math.PI);return a<0&&(a+=360),{angle:a,radian:r}}},g=/^\s+|\s+$/g,S=/^[-+]0x[0-9a-f]+$/i,M=/^0b[01]+$/i,b=/^0o[0-7]+$/i,C=parseInt,D="object"==("undefined"==typeof global?"undefined":t(global))&&global&&global.Object===Object&&global,P="object"==("undefined"==typeof self?"undefined":t(self))&&self&&self.Object===Object&&self,E=D||P||Function("return this")(),x=Object.prototype.toString,L=Math.max,R=Math.min,T=function(){return E.Date.now()};function k(e,t,n){var o,i,r,a,s,l,u=0,c=!1,p=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function f(t){var n=o,r=i;return o=i=void 0,u=t,a=e.apply(r,n)}function w(e){return u=e,s=setTimeout(v,t),c?f(e):a}function h(e){var n=e-l;return void 0===l||n>=t||n<0||p&&e-u>=r}function v(){var e=T();if(h(e))return m(e);s=setTimeout(v,function(e){var n=t-(e-l);return p?R(n,r-(e-u)):n}(e))}function m(e){return s=void 0,d&&o?f(e):(o=i=void 0,a)}function y(){var e=T(),n=h(e);if(o=arguments,i=this,l=e,n){if(void 0===s)return w(l);if(p)return s=setTimeout(v,t),f(l)}return void 0===s&&(s=setTimeout(v,t)),a}return t=B(t)||0,I(n)&&(c=!!n.leading,r=(p="maxWait"in n)?L(B(n.maxWait)||0,t):r,d="trailing"in n?!!n.trailing:d),y.cancel=function(){void 0!==s&&clearTimeout(s),u=0,o=l=i=s=void 0},y.flush=function(){return void 0===s?a:m(T())},y}function I(e){var n=t(e);return!!e&&("object"==n||"function"==n)}function N(e){return"symbol"==t(e)||function(e){return!!e&&"object"==t(e)}(e)&&"[object Symbol]"==x.call(e)}function B(e){if("number"==typeof e)return e;if(N(e))return NaN;if(I(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=I(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(g,"");var n=M.test(e);return n||b.test(e)?C(e.slice(2),n?2:8):S.test(e)?NaN:+e}var V=e.reactive({isViewer:!1,changeLayers:0,changeGeometrys:0}),A=function(e){V.isViewer=e},_=function(e){V.changeLayers+=1},O=function(e){V.changeGeometrys+=1,console.log(F.geometrys)},F={geometrys:{},layers:null};function H(e,t){var n=[];try{e&&e.forEach((function(e){n.push(viewer.scene.addS3MTilesLayerByScp(e.url,e.options))})),j(n,t,"S3M")}catch(e){var o=viewer.SuperMap3DWidget;if(o._showRenderLoopErrors){o.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}}function G(e,t,n){t&&t.SceneToken&&(SuperMap3D.Credential.CREDENTIAL=new SuperMap3D.Credential(t.SceneToken));var o=!0;if(t&&t.autoSetView&&(o=t.autoSetView),function(e){if(null===e||""===e)return!1;if('"'==e.charAt(0)||"'"==e.charAt(0)){var t=/^['|"](.*)['|"]$/;e=e.replace(t,"$1")}return!0}(e))try{j([viewer.scene.open(e,void 0,{autoSetView:o})],n,"SCENE")}catch(e){var i=viewer.SuperMap3DWidget;if(i._showRenderLoopErrors){i.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}}function j(e,t,n){SuperMap3D.when.all(e,(function(e){console.log("layers:",e),F.layers=viewer.scene.layers.layerQueue,_(),t(e[0],n),F.layers.forEach((function(e){(!e.visibleDistanceMax||e.visibleDistanceMax>12e3)&&(e.visibleDistanceMax=12e3)}))}),(function(e){var t=viewer.SuperMap3DWidget;if(t._showRenderLoopErrors){t.showErrorPanel("请检查url地址是否正确？",void 0,e)}}))}var U={addS3mLayers:H,addScene:G,addTerrainLayer:function(e,t){try{viewer.terrainProvider=new SuperMap3D.SuperMap3DTerrainProvider({url:e,isSct:t})}catch(e){var n=viewer.SuperMap3DWidget;if(n._showRenderLoopErrors){n.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}},addImageLayer:function(e){try{return viewer.imageryLayers.addImageryProvider(new SuperMap3D.SuperMapImageryProvider({url:e}))}catch(e){var t=viewer.SuperMap3DWidget;if(t._showRenderLoopErrors){t.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}},layersDelete:function(e,t,n){switch(e){case"S3M":viewer.scene.layers.remove(t),_(),n();break;case"IMG":var o;if("nunber"==typeof t)o=viewer.imageryLayers.get(t);else for(var i=viewer.imageryLayers._layers,r=0;r<i.length;r++)i[r].imageryProvider.tablename&&i[r].imageryProvider.tablename===t&&(o=i[r]);o&&(viewer.imageryLayers.remove(o),_(),n());break;case"TERRAIN":viewer.terrainProvider=new SuperMap3D.EllipsoidTerrainProvider,_(),n();break;case"MVT":viewer.scene.removeVectorTilesMap(t),_(),n()}},addMvtLayer:function(e,t,n){try{var o=viewer.scene.addVectorTilesMap({url:e,canvasWidth:512,name:t||"mvt",viewer:viewer});return SuperMap3D.when(o.readyPromise,(function(e){var t=o.rectangle;viewer.scene.camera.flyTo({destination:new SuperMap3D.Cartesian3.fromRadians(.5*(t.east+t.west),.5*(t.north+t.south),1e4),duration:0,orientation:{heading:0,roll:0}}),_(),n(o)})),o}catch(e){var i=viewer.SuperMap3DWidget;if(i._showRenderLoopErrors){i.showErrorPanel("渲染时发生错误，已停止渲染。",void 0,e)}}}},W={flyByCameraParam:function(e){e&&viewer.scene.camera.flyTo({destination:new SuperMap3D.Cartesian3(e.Cartesian3.x,e.Cartesian3.y,e.Cartesian3.z),orientation:{heading:e.heading,pitch:e.pitch,roll:e.roll},duration:0})},flyByLayerName:function(e,t){if(e&&t)switch(e){case"S3M":var n=viewer.scene.layers.find(t);viewer.flyTo(n,{duration:0});break;case"MVT":var o=viewer.scene.getVectorTilesMap(t).rectangle;viewer.scene.camera.flyTo({destination:new SuperMap3D.Cartesian3.fromRadians(.5*(o.east+o.west),.5*(o.north+o.south),1e4),duration:0,orientation:{heading:0,roll:0}});break;case"IMG":var i;if("nunber"==typeof t)i=viewer.imageryLayers.get(t);else for(var r=viewer.imageryLayers._layers,a=0;a<r.length;a++)r[a].imageryProvider.tablename&&r[a].imageryProvider.tablename===t&&(i=r[a]);i&&viewer.flyTo(i,{duration:0})}}};function K(){}Object.assign(K.prototype,{addEventListener:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];void 0===this._listeners&&(this._listeners={}),this._mutex=this._mutex||{};var o=this._mutex,i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&(n&&(o[e]=t),i[e].push(t))},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(this._mutex[e]===t&&(this._mutex[e]=null),void 0!==n){var o=n.indexOf(t);-1!==o&&n.splice(o,1)}}},dispatchEvent:function(e){var t=this;if(void 0!==this._listeners){var n=this._listeners[e.type];if(void 0!==n){e.target=this;var o=n.slice(0);if(this._mutex[e.type])return void o.find((function(n){return n===t._mutex[e.type]})).call(this,e);for(var i=0,r=o.length;i<r;i++)o[i].call(this,e)}}},removeAllListener:function(){for(var e in this._mutex={},this._listeners)this._listeners[e]=[]}});var z="CLICK",Q="LEFT_DOWN",X="LEFT_UP",Z="MOUSE_MOVE",Y="RIGHT_CLICK",q="LEFT_DOWN_MOUSE_MOVE",J=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(o,e);var t=p(o);function o(e){var i;return n(this,o),(i=t.call(this)).viewer=e,i.handler=new SuperMap3D.ScreenSpaceEventHandler(i.viewer.scene.canvas),i.handler.setInputAction((function(e){i.dispatchEvent({type:z,message:e})}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),i.handler.setInputAction((function(e){i.press=!0,i.dispatchEvent({type:Q,message:e})}),SuperMap3D.ScreenSpaceEventType.LEFT_DOWN),i.handler.setInputAction((function(e){i.press=!1,i.dispatchEvent({type:X,message:e})}),SuperMap3D.ScreenSpaceEventType.LEFT_UP),i.handler.setInputAction((function(e){i.dispatchEvent({type:Y,message:e})}),SuperMap3D.ScreenSpaceEventType.RIGHT_CLICK),i.handler.setInputAction((function(e){i.press&&i.dispatchEvent({type:q,message:e}),i.dispatchEvent({type:Z,message:e})}),SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),i}return i(o,[{key:"addCameraMoveListener",value:function(e){this.viewer.camera.changed.addEventListener(e)}},{key:"removeCameraMoveListener",value:function(e){this.viewer.camera.changed.removeEventListener(e)}}]),o}(K);function $(e){var t=function(e){var t=document.createElement("DIV");t.className="tooltip",this._div=t,this.message="",e.appendChild(t)};return t.prototype.setVisible=function(e){this._div.style.right=e?"10px":"-300px"},t.prototype.showAt=function(e,t){t&&(this._div.style.top=t),e&&(this.setVisible(!0),this._div.innerHTML=e)},new t(e)}var ee,te,ne={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},oe=(te=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=te,te).toLowerCase();var ie=((ee=void 0!==oe?oe:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||ee.startsWith("ja"),ne);var re=function(e,t){var n=0;switch(t&&(n=t),e){case"Point":window.handlerPoint=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Point);break;case"Polyline":window.handlerPolyline=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Line,n);break;case"Polygon":window.handlerPolygon=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Polygon,n);break;case"Marker":window.handlerMarker=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Marker,n);break;case"Box":window.handlerBox=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box,n)}window.tooltip||(window.tooltip=function(e){var t=function(e){var t=document.createElement("DIV");t.className="twipsy right";var n=document.createElement("DIV");n.className="twipsy-arrow",t.appendChild(n);var o=document.createElement("DIV");o.className="twipsy-inner",t.appendChild(o),this._div=t,this._title=o,this.message="",e.appendChild(t);var i=this;t.onmousemove=function(e){i.showAt({x:e.clientX,y:e.clientY},i.message)}};return t.prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},t.prototype.showAt=function(e,t){e&&t&&(this.setVisible(!0),this._title.innerHTML=t,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px",this.message=t)},new t(e)}(viewer._element)),window.polylineCollection||(window.polylineCollection=new SuperMap3D.PolylineCollection({translucentRS:SuperMap3D.RenderState.fromCache({depthMask:!1,depthTest:{enabled:!1}})}),window.polylineTransparent=window.polylineCollection.add({width:2,material:SuperMap3D.Material.fromType(SuperMap3D.Material.ColorType,{color:SuperMap3D.Color.fromCssColorString("#51ff00").withAlpha(.3)})}),viewer.scene.primitives.add(window.polylineCollection))},ae=function(e,t,n){var o=!0;!1===t&&(o=t);var i=le(e);return new Promise((function(t,n){var r=window.tooltip,a=i.activeEvt.addEventListener((function(t){1==t?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="","Point"==e||"Marker"==e?document.body.classList.add("measureCur"):document.body.classList.add("drawCur")):(viewer.enableCursorStyle=!0,r.setVisible(!1),"Point"==e||"Marker"==e?document.body.classList.remove("measureCur"):document.body.classList.remove("drawCur"))})),s=i.movingEvt.addEventListener((function(t){if(t.x<200&&t.y<150)r.setVisible(!1);else if(i.polyline&&i.isDrawing){var n=d(i.positions);"Polygon"==e&&n.push(n[0]),window.polylineTransparent.show=!0,window.polylineTransparent.positions=n}})),l=i.drawEvt.addEventListener((function(n){if(!n.object.positions&&"Point"!=e&&"Box"!=e)return r.showAt(n,"<p>请绘制正确的多边形</p>"),i.polygon.show=!1,i.polyline.show=!1,i.deactivate(),void i.activate();if("Box"!=e){if("Point"==e||"Marker"==e)i.clear(),t({result:n});else{if(window.polylineTransparent.show=o,o&&"Polygon"==e&&o){i.polygon._polygon._material._color._value.alpha=.1;var u=d(n.object.positions);u.push(u[0]),window.polylineTransparent.positions=u}var c=m(n.object.positions);t({result:n,positions:c})}a(),s(),l()}else t({result:n})}))}))},se=function(e){var t;(t=e?le(e):window.handlerPolygon)&&(t.deactivate(),t.clear(),viewer.enableCursorStyle=!0,window.tooltip.setVisible(!1),window.polylineTransparent&&(window.polylineTransparent.show=!1))},le=function(e){var t;switch(e){case"Point":t=window.handlerPoint;break;case"Polyline":t=window.handlerPolyline;break;case"Polygon":t=window.handlerPolygon;break;case"Marker":t=window.handlerMarker;break;case"Box":t=window.handlerBox}return t},ue=re,ce=ae,pe=se,de=function(e,t,n){window.selectHandler||(window.selectHandler=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas));var o=window.selectHandler;window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!0),o.setInputAction((function(){console.log("viewer.selectedEntity:",viewer.selectedEntity);var i=viewer.selectedEntity,r=window.editHandler;i&&(r&&r&&r.clear(),r?(r.deactivate(),r.setEditObject(i),r.activate()):(window.editHandler=new SuperMap3D.EditHandler(viewer,i),window.editHandler.isEditZ=t||!1,window.editHandler.activate()),o.setInputAction((function(){if(i=viewer.selectedEntity,r=window.editHandler,i&&r&&r._positions){var t=m(r._positions);if(v(e,t))return;if(e=t,n&&n(t,window.editHandler),window.handlerPolygon&&window.handlerPolygon.polygon&&window.handlerPolygon.polygon.show){var o=d(r._positions);o.push(o[0]),window.polylineTransparent.positions=o}}}),SuperMap3D.ScreenSpaceEventType.LEFT_UP))}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)},fe=function(){window.editHandler&&(window.editHandler.deactivate(),window.editHandler.clear()),window.selectHandler&&(window.selectHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_UP),window.selectHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),window.selectHandler.destroy(),window.selectHandler=null)};var we=function(){function e(t,o,i,r){n(this,e),this.viewer=t,this.id_type=o,this.pickedEntity=null,this.leftDownFlag=!1,this.moveEndCallBack=i||void 0,this.leftUpCallBack=r||void 0,this.movePickedEntity=null,this.layers=t.scene.layers.layerQueue}return i(e,[{key:"addEventListener",value:function(){for(var e=this,t=0;t<e.layers.length;t++)e.layers[t].selectEnabled=!1;e.viewer.screenSpaceEventHandler.setInputAction((function(t){var n=e.viewer.scene.pick(t.position);if(e.leftDownFlag=!0,n){var o=SuperMap3D.defaultValue(n.id,n.primitive.id);o.id&&o.id.includes(e.id_type)&&(e.pickedEntity=o,e.viewer.scene.screenSpaceCameraController.enableRotate=!1)}}),SuperMap3D.ScreenSpaceEventType.LEFT_DOWN),e.viewer.screenSpaceEventHandler.setInputAction((function(t){e.leftDownFlag=!1,e.viewer.scene.screenSpaceCameraController.enableRotate=!0,e.leftUpCallBack&&e.pickedEntity&&e.leftUpCallBack(e.pickedEntity);e.pickedEntity=null}),SuperMap3D.ScreenSpaceEventType.LEFT_UP),e.viewer.screenSpaceEventHandler.setInputAction((function(t){if(e.leftDownFlag){if(e.pickedEntity){var n=e.viewer.scene.pickPosition(t.endPosition);e.pickedEntity.position=n,e.moveEndCallBack&&e.moveEndCallBack(e.pickedEntity)}}else{var o=e.viewer.scene.pick(t.endPosition);if(o){var i=SuperMap3D.defaultValue(o.id,o.primitive.id);i.id&&i.id.includes(e.id_type)?(e.movePickedEntity=i,i.point.pixelSize=20):e.movePickedEntity&&(e.movePickedEntity.point.pixelSize=10)}else e.movePickedEntity&&(e.movePickedEntity.point.pixelSize=10)}}),SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE)}},{key:"removeEventListener",value:function(){this.viewer.screenSpaceEventHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_DOWN),this.viewer.screenSpaceEventHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),this.viewer.screenSpaceEventHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_UP)}}]),e}();var he=function(){function e(){n(this,e)}return i(e,[{key:"createXMLflyLine",value:function(e){var t=new DOMParser;window.parser=t;var n=t.parseFromString("<cusxmlRoute></cusxmlRoute>","text/xml");window.xmlDoc=n;var o=this.createSceneRouteNode(n),i=this.createRouteNode(n,e),r=this.createRouteStyleNode(n);i.appendChild(r);var a=e.routeStops;if(!(a.length<2)){for(var s=0;s<a.length;s++){var l=a[s],u={longitude:l.point[0],latitude:l.point[1],altitude:l.point[2],heading:l.heading*(180/Math.PI),tilt:l.tilt*(180/Math.PI)+90},c=this.createStopNode(n,u,l,s);i.appendChild(c)}return o.appendChild(i),n.children[0].appendChild(o),n.children[0].innerHTML}console.warn("节点数小于2")}},{key:"createSceneRouteNode",value:function(e){var t=e.createElement("SceneRoute");return t.setAttribute("xmlns","http://www.supermap.com.cn/ugc60"),t}},{key:"createRouteNode",value:function(e,t){var n=e.createElement("route"),o={name:t.routeName||"飞行路线",speed:t.speed||"200",lineType:"0",showroutestop:"False",showrouteline:"False",altitudefree:"False",headingfree:"False",tiltfree:"False",flycircle:"False",alongline:t.isAlongLine||"False"};for(var i in o)n.setAttribute(i,o[i]);return n}},{key:"createRouteStyleNode",value:function(e){var t=e.createElement("style"),n=e.createElement("geostyle3d"),o=e.createElement("linecolor");o.textContent="RGBA(147,112,219,255)";var i=e.createElement("linewidth");i.textContent=2;var r=e.createElement("altitudeMode");r.textContent="Absolute";var a=e.createElement("bottomAltitude");return a.textContent=0,n.appendChild(o),n.appendChild(i),n.appendChild(r),n.appendChild(a),t.appendChild(n),t}},{key:"createStopNode",value:function(e,t,n,o){var i=e.createElement("routestop"),r={name:n.stopName||"Stop"+(o+1),speed:n.speed,excluded:"False",viewType:"camera"};for(var a in r)i.setAttribute(a,r[a]);var s=this.createStopCameraNode(e,t);i.appendChild(s);var l=this.createStopStyleNode(e);i.appendChild(l);var u=this.createStopSettingNode(e,n);return i.appendChild(u),i}},{key:"createStopCameraNode",value:function(e,t){var n=e.createElement("camera");for(var o in t){var i=e.createElement(o);i.textContent=t[o],n.appendChild(i)}return n}},{key:"createStopStyleNode",value:function(e){var t={icon:"",markersize:4.8,markericonscale:1,markercolor:"RGBA(255, 255, 255, 255)"},n=e.createElement("style"),o=e.createElement("geostyle3d");for(var i in t){var r=e.createElement(i);r.textContent=t[i],o.appendChild(r)}return n.appendChild(o),n}},{key:"createStopSettingNode",value:function(e,t){var n=e.createElement("setting"),o={turnTime:t.surroundDuration||1.5,turnSlowly:"False",stopPlayMode:t.stopPlayMode||"StopPause",autoPlay:"False",pauseTime:t.waitTime||0,angularSpeed:1};for(var i in o){var r=e.createElement(i);r.textContent=o[i],n.appendChild(r)}return n}}]),e}();var ve={polyline:[{id:"1",iconfont:"iconshixian",lineName:"实线"},{id:"2",iconfont:"iconxuxian",lineName:"虚线"},{id:"3",iconfont:"iconlunkuoxian",lineName:"轮廓线"},{id:"4",iconfont:"iconjiantouxian",lineName:"箭头线"},{id:"5",iconfont:"iconguangyunxian",lineName:"光晕线"},{id:"6",iconfont:"iconweijixian",lineName:"尾迹线"},{},{}],polygon:[{id:"1",iconfont:"iconchunse",faceName:"纯色"},{id:"2",iconfont:"iconwangge",faceName:"网格"},{id:"3",iconfont:"icontiaowen",faceName:"条纹"}]};var me=[{id:0,name:"树木",type:"tree",data:[{id:0,name:"树1",thumbnail:"public/data/s3m/S3MData/tree.png",path:"public/data/s3m/S3MData/tree1.s3m"},{id:1,name:"树2",thumbnail:"public/data/s3m/S3MData/pine.png",path:"public/data/s3m/S3MData/tree2.s3m"},{id:2,name:"树3",thumbnail:"public/data/s3m/S3MData/tree3.png",path:"public/data/s3m/S3MData/tree3.s3m"},{id:3,name:"树4",thumbnail:"public/data/s3m/S3MData/tree2.png",path:"public/data/s3m/S3MData/tree4.s3m"},{id:4,name:"springTree",thumbnail:"public/data/s3m/S3MData/springTree.png",path:"public/data/s3m/S3MData/springTree.s3m"},{id:5,name:"autumnTree",thumbnail:"public/data/s3m/S3MData/autumnTree.png",path:"public/data/s3m/S3MData/autumnTree.s3m"},{id:6,name:"winterTree",thumbnail:"public/data/s3m/S3MData/winterTree.png",path:"public/data/s3m/S3MData/winterTree.s3m"},{},{},{}]},{id:1,name:"公共设施",type:"public-utilities",data:[{id:0,name:"椅子",thumbnail:"public/data/s3m/S3MData/bench.png",path:"public/data/s3m/S3MData/Chair.s3m"},{id:1,name:"垃圾箱",thumbnail:"public/data/s3m/S3MData/Dustbin.png",path:"public/data/s3m/S3MData/Dustbin.s3m"},{id:2,name:"垃圾箱2",thumbnail:"public/data/s3m/S3MData/paper-bucket.png",path:"public/data/s3m/S3MData/Dustbin2.s3m"},{id:3,name:"垃圾桶",thumbnail:"public/data/s3m/S3MData/dustbin1.png",path:"public/data/s3m/S3MData/GarbageCan.s3m"},{id:4,name:"报亭",thumbnail:"public/data/s3m/S3MData/newspaper.png",path:"public/data/s3m/S3MData/NewsStand.s3m"},{id:5,name:"邮政信箱",thumbnail:"public/data/s3m/S3MData/mailbox.png",path:"public/data/s3m/S3MData/PO-Box.s3m"},{id:6,name:"电信电话亭",thumbnail:"public/data/s3m/S3MData/phone-booth.png",path:"public/data/s3m/S3MData/T-TelBooth.s3m"},{},{},{}]},{id:2,name:"交通",type:"traffic",data:[{id:0,name:"限速牌",thumbnail:"public/data/s3m/S3MData/speed-limit.png",path:"public/data/s3m/S3MData/RestrictionBoard.s3m"},{id:1,name:"路灯",thumbnail:"public/data/s3m/S3MData/lamp-post.png",path:"public/data/s3m/S3MData/StreetLight.s3m"},{id:2,name:"红绿灯",thumbnail:"public/data/s3m/S3MData/traffic-light.png",path:"public/data/s3m/S3MData/TrafficLight.s3m"},{},{}]}],ye=function(){function e(){n(this,e),this._positions=null,this.boundingSphere=null,this._geometry=null,this._triangleArrayByWeight=null}return i(e,[{key:"initPolygonEmitter",value:function(e){if(this._positions=SuperMap3D.defaultValue(e,[new SuperMap3D.Cartesian3,new SuperMap3D.Cartesian3,new SuperMap3D.Cartesian3]),this.boundingSphere=SuperMap3D.BoundingSphere.fromPoints(e),SuperMap3D.defaultValue(e)){var t=SuperMap3D.PolygonGeometry.fromPositions({positions:e,perPositionHeight:!0});this._geometry=SuperMap3D.PolygonGeometry.createGeometry(t),this._triangleArrayByWeight=this.initWeight(this._geometry)}}},{key:"initWeight",value:function(e){var t,n,o=new SuperMap3D.Cartesian3,i=new SuperMap3D.Cartesian3,r=new SuperMap3D.Cartesian3,a=e.indices,s=a.length/3,l=e.attributes.position.values,u=[],c=0;for(t=0;t<s;t++){var p=a[3*t],d=a[3*t+1],f=a[3*t+2];o.x=l[3*p],o.y=l[3*p+1],o.z=l[3*p+2],i.x=l[3*d],i.y=l[3*d+1],i.z=l[3*d+2],r.x=l[3*f],r.y=l[3*f+1],r.z=l[3*f+2];var w=this.triangleArea(o,i,r);c+=w,u.push(w)}var h=Math.max(100,10*s),v=[];for(t=0;t<s;t++){var m=Math.floor(u[t]/c*h);for(m=Math.max(1,m),n=0;n<m;n++)v.push(t)}return v}},{key:"triangleArea",value:function(e,t,n){var o=new SuperMap3D.Cartesian3,i=new SuperMap3D.Cartesian3,r=new SuperMap3D.Cartesian3;return o=SuperMap3D.Cartesian3.subtract(t,e,o),i=SuperMap3D.Cartesian3.subtract(n,e,i),r=SuperMap3D.Cartesian3.cross(o,i,r),.5*SuperMap3D.Cartesian3.magnitude(r)}},{key:"randomVertex",value:function(e,t,n,o,i){return(1-Math.sqrt(e))*n+Math.sqrt(e)*(1-t)*o+Math.sqrt(e)*t*i}},{key:"getOneRandomPosition",value:function(){if(SuperMap3D.defaultValue(this._geometry)){var e=Math.floor(SuperMap3D.Math.randomBetween(0,this._triangleArrayByWeight.length)),t=this._triangleArrayByWeight[e],n=this._geometry.indices[3*t],o=this._geometry.indices[3*t+1],i=this._geometry.indices[3*t+2],r=this._geometry.attributes.position.values,a=r[3*n],s=r[3*n+1],l=r[3*n+2],u=r[3*o],c=r[3*o+1],p=r[3*o+2],d=r[3*i],f=r[3*i+1],w=r[3*i+2],h=SuperMap3D.Math.randomBetween(0,1),v=SuperMap3D.Math.randomBetween(0,1),m=this.randomVertex(h,v,a,u,d),y=this.randomVertex(h,v,s,c,f),g=this.randomVertex(h,v,l,p,w);return SuperMap3D.Cartesian3.fromElements(m,y,g)}}},{key:"positions",get:function(){return this._positions},set:function(e){if(SuperMap3D.defaultValue(e)){this._positions=e;var t=SuperMap3D.PolygonGeometry.fromPositions({positions:this._positions,perPositionHeight:!0});this._geometry=SuperMap3D.PolygonGeometry.createGeometry(t),this._triangleArrayByWeight=this.initWeight(this._geometry),this.boundingSphere=SuperMap3D.BoundingSphere.fromPoints(e)}}}]),e}();var ge=[{id:0,iconfont:"icondianguangyuan",lightName:"点光源"},{id:1,iconfont:"iconjuguangdeng",lightName:"聚光灯"},{id:2,iconfont:"iconpinghangguang",lightName:"平行光"}];var Se=[{name:"线状纹理1",type:"line",url:"public/img/particleSystem/line-1.jpg"},{name:"线状纹理2",type:"line",url:"public/img/particleSystem/line-2.jpg"},{name:"环状纹理1",type:"ring",url:"public/img/particleSystem/ring-1.jpg"},{name:"环状纹理2",type:"ring",url:"public/img/particleSystem/ring-2.jpg"},{name:"环状六边形纹理",type:"ring",url:"public/img/particleSystem/ring-3.jpg"}];function Me(e){this.tableName=e.tableName,this.opacityMinValue=e.opacityMinValue,this.opacityMaxValue=e.opacityMaxValue,this.gradientMinOpacity=e.gradientMinOpacity,this.gradientMaxOpacity=e.gradientMaxOpacity,this.visibleMinValue=e.visibleMinValue,this.visibleMaxValue=e.visibleMaxValue}Me.prototype.setColorTable=function(e,t){if(SuperMap3D.defined(e)){var n=e.minValue,o=e.maxValue,i=this.visibleMinValue,r=this.visibleMaxValue;if(i>r){var a=i;i=r,r=a}this.setOpacityFunction(e,n,o,i,r),this.setColorFunction(e,n,o,i,r,t)}},Me.prototype.setOpacityFunction=function(e,t,n,o,i){var r=this.opacityMinValue,a=this.opacityMaxValue,s=new SuperMap3D.PiecewiseFunction;s.addPoint(t,0),s.addPoint(t+(n-t)*o,r),s.addPoint(t+(n-t)*i,a),s.addPoint(t+(n-t)*(i+.01),r),s.addPoint(n,0),e.opacityTransferFunction=s},Me.prototype.setColorFunction=function(e,t,n,o,i,r){var a=new SuperMap3D.ColorTransferFunction,s=(i-o)/15;switch(r){case 1:a.addRGBPoint(t,9/255,9/255,212/255),a.addRGBPoint(t+(n-t)*o,9/255,10/255,1),a.addRGBPoint(t+(n-t)*(o+s),9/255,.2,1),a.addRGBPoint(t+(n-t)*(o+2*s),9/255,.4,1),a.addRGBPoint(t+(n-t)*(o+3*s),9/255,.6,1),a.addRGBPoint(t+(n-t)*(o+4*s),9/255,.8,1),a.addRGBPoint(t+(n-t)*(o+5*s),9/255,1,1),a.addRGBPoint(t+(n-t)*(o+6*s),.2,1,.8),a.addRGBPoint(t+(n-t)*(o+7*s),.4,1,.6),a.addRGBPoint(t+(n-t)*(o+8*s),.6,1,.4),a.addRGBPoint(t+(n-t)*(o+9*s),.8,1,.2),a.addRGBPoint(t+(n-t)*(o+10*s),1,1,0),a.addRGBPoint(t+(n-t)*(o+11*s),1,.8,0),a.addRGBPoint(t+(n-t)*(o+12*s),1,.6,0),a.addRGBPoint(t+(n-t)*(o+13*s),1,.4,0),a.addRGBPoint(t+(n-t)*(o+14*s),1,.2,0),a.addRGBPoint(t+(n-t)*(o+15*s),1,0,0);break;case 2:a.addRGBPoint(t,1,103/255,103/255),a.addRGBPoint(t+(n-t)*o,1,0,1),a.addRGBPoint(t+(n-t)*(o+s),1,.2,1),a.addRGBPoint(t+(n-t)*(o+2*s),1,.4,1),a.addRGBPoint(t+(n-t)*(o+3*s),1,.6,1),a.addRGBPoint(t+(n-t)*(o+4*s),1,.8,1),a.addRGBPoint(t+(n-t)*(o+5*s),1,1,1),a.addRGBPoint(t+(n-t)*(o+6*s),.2,1,.8),a.addRGBPoint(t+(n-t)*(o+7*s),.4,1,.6),a.addRGBPoint(t+(n-t)*(o+8*s),.6,1,.4),a.addRGBPoint(t+(n-t)*(o+9*s),.8,1,.2),a.addRGBPoint(t+(n-t)*(o+10*s),1,1,0),a.addRGBPoint(t+(n-t)*(o+11*s),1,.8,0),a.addRGBPoint(t+(n-t)*(o+12*s),1,.6,0),a.addRGBPoint(t+(n-t)*(o+13*s),1,.4,0),a.addRGBPoint(t+(n-t)*(o+14*s),1,.2,0),a.addRGBPoint(t+(n-t)*(o+15*s),1,0,0);break;case 3:a.addRGBPoint(t,157/255,0,1),a.addRGBPoint(t+(n-t)*o,157/255,0,1),a.addRGBPoint(t+(n-t)*(o+s),157/255,.2,1),a.addRGBPoint(t+(n-t)*(o+2*s),157/255,.4,1),a.addRGBPoint(t+(n-t)*(o+3*s),157/255,.6,1),a.addRGBPoint(t+(n-t)*(o+4*s),157/255,.8,1),a.addRGBPoint(t+(n-t)*(o+5*s),157/255,1,1),a.addRGBPoint(t+(n-t)*(o+6*s),.2,1,.8),a.addRGBPoint(t+(n-t)*(o+7*s),.4,1,.6),a.addRGBPoint(t+(n-t)*(o+8*s),.6,1,.4),a.addRGBPoint(t+(n-t)*(o+9*s),.8,1,.2),a.addRGBPoint(t+(n-t)*(o+10*s),1,1,0),a.addRGBPoint(t+(n-t)*(o+11*s),1,.8,0),a.addRGBPoint(t+(n-t)*(o+12*s),1,.6,0),a.addRGBPoint(t+(n-t)*(o+13*s),1,.4,0),a.addRGBPoint(t+(n-t)*(o+14*s),1,.2,0),a.addRGBPoint(t+(n-t)*(o+15*s),1,0,0);break;case 4:a.addRGBPoint(t,149/255,232/255,249/255),a.addRGBPoint(t+(n-t)*o,149/255,0,1),a.addRGBPoint(t+(n-t)*(o+s),149/255,.2,1),a.addRGBPoint(t+(n-t)*(o+2*s),149/255,.4,1),a.addRGBPoint(t+(n-t)*(o+3*s),149/255,.6,1),a.addRGBPoint(t+(n-t)*(o+4*s),149/255,.8,1),a.addRGBPoint(t+(n-t)*(o+5*s),149/255,1,1),a.addRGBPoint(t+(n-t)*(o+6*s),.2,1,.8),a.addRGBPoint(t+(n-t)*(o+7*s),.4,1,.6),a.addRGBPoint(t+(n-t)*(o+8*s),.6,1,.4),a.addRGBPoint(t+(n-t)*(o+9*s),.8,1,.2),a.addRGBPoint(t+(n-t)*(o+10*s),1,1,0),a.addRGBPoint(t+(n-t)*(o+11*s),1,.8,0),a.addRGBPoint(t+(n-t)*(o+12*s),1,.6,0),a.addRGBPoint(t+(n-t)*(o+13*s),1,.4,0),a.addRGBPoint(t+(n-t)*(o+14*s),1,.2,0),a.addRGBPoint(t+(n-t)*(o+15*s),1,0,0);break;case 5:a.addRGBPoint(t,26/255,1,156/255),a.addRGBPoint(t+(n-t)*o,26/255,0,1),a.addRGBPoint(t+(n-t)*(o+s),26/255,.2,1),a.addRGBPoint(t+(n-t)*(o+2*s),26/255,.4,1),a.addRGBPoint(t+(n-t)*(o+3*s),26/255,.6,1),a.addRGBPoint(t+(n-t)*(o+4*s),26/255,.8,1),a.addRGBPoint(t+(n-t)*(o+5*s),26/255,1,1),a.addRGBPoint(t+(n-t)*(o+6*s),.2,1,.8),a.addRGBPoint(t+(n-t)*(o+7*s),.4,1,.6),a.addRGBPoint(t+(n-t)*(o+8*s),.6,1,.4),a.addRGBPoint(t+(n-t)*(o+9*s),.8,1,.2),a.addRGBPoint(t+(n-t)*(o+10*s),1,1,0),a.addRGBPoint(t+(n-t)*(o+11*s),1,.8,0),a.addRGBPoint(t+(n-t)*(o+12*s),1,.6,0),a.addRGBPoint(t+(n-t)*(o+13*s),1,.4,0),a.addRGBPoint(t+(n-t)*(o+14*s),1,.2,0),a.addRGBPoint(t+(n-t)*(o+15*s),1,0,0);break;default:a.addRGBPoint(t,0,0,1),a.addRGBPoint(t+(n-t)*o,0,0,1),a.addRGBPoint(t+(n-t)*(o+s),0,.2,1),a.addRGBPoint(t+(n-t)*(o+2*s),0,.4,1),a.addRGBPoint(t+(n-t)*(o+3*s),0,.6,1),a.addRGBPoint(t+(n-t)*(o+4*s),0,.8,1),a.addRGBPoint(t+(n-t)*(o+5*s),0,1,1),a.addRGBPoint(t+(n-t)*(o+6*s),.2,1,.8),a.addRGBPoint(t+(n-t)*(o+7*s),.4,1,.6),a.addRGBPoint(t+(n-t)*(o+8*s),.6,1,.4),a.addRGBPoint(t+(n-t)*(o+9*s),.8,1,.2),a.addRGBPoint(t+(n-t)*(o+10*s),1,1,0),a.addRGBPoint(t+(n-t)*(o+11*s),1,.8,0),a.addRGBPoint(t+(n-t)*(o+12*s),1,.6,0),a.addRGBPoint(t+(n-t)*(o+13*s),1,.4,0),a.addRGBPoint(t+(n-t)*(o+14*s),1,.2,0),a.addRGBPoint(t+(n-t)*(o+15*s),1,0,0)}o+15*s<1&&a.addRGBPoint(n,1,0,0),e.colorTransferFunction=a},Me.prototype.setGradientOpacityValue=function(e){var t=e.minValue,n=e.maxValue,o=this.gradientMinOpacity,i=this.gradientMaxOpacity;if(o>i){var r=o;o=i,i=r}e.gradientOpacityMinValue=.1*Math.abs(n-t)*o,e.gradientOpacityMaxValue=.1*Math.abs(n-t)*i};var be={initDrag:function(e,t){e.directive("drag",{beforeMount:function(e,t){var n,o,i,r,a,s,l=!1,u=e;u.addEventListener("touchstart",(function(e){if(l=!0,e.changedTouches[0]){var t=e.changedTouches[0],n=t.clientX,o=t.clientY;i=n-e.changedTouches[0].target.x,r=o-e.changedTouches[0].target.y,a=document.body.clientWidth,s=document.body.clientHeight}}),{passive:!1}),u.addEventListener("touchmove",k((function(t){t.preventDefault(),n=t.changedTouches[0].clientX-i,o=t.changedTouches[0].clientY-r,n<0&&o<0?(e.style.left="0px",e.style.top="0px"):n<0&&o+e.clientHeight<s?(e.style.left="0px",e.style.top=o+"px"):n<0&&o+e.clientHeight>=s?(e.style.left="0px",e.style.top=s-e.clientHeight+"px"):n+e.clientWidth>a&&o<0?(e.style.left=a-e.clientWidth+"px",e.style.top="0px"):n+e.clientWidth<a&&o+e.clientHeight>=s?(e.style.left=n+"px",e.style.top=s-e.clientHeight+"px"):n+e.clientWidth<a&&o<0?(e.style.left=n+"px",e.style.top="0px"):n+e.clientWidth>a&&o+e.clientHeight<s?(e.style.left=a-e.clientWidth+"px",e.style.top=o+"px"):n+e.clientWidth>a&&o+e.clientHeight>=s?(e.style.left=a-e.clientWidth+"px",e.style.top=s-e.clientHeight+"px"):(e.style.left=n+"px",e.style.top=o+"px")}),5),{passive:!1}),u.addEventListener("touchend",(function(e){l=!1,document.ontouchmove=null,document.ontouchmove=null,e.changedTouches[0].clientX,e.changedTouches[0].clientY}),{passive:!1}),u.onmousedown=function(t){if(a=document.body.clientWidth,s=document.body.clientHeight,!l){l=!0;var i=t.clientX,r=t.clientY,u=i-e.offsetLeft,c=r-e.offsetTop;document.onmousemove=k((function(t){n=t.clientX-u,o=t.clientY-c,n<0&&o<0?(e.style.left="0px",e.style.top="0px"):n<0&&o+e.clientHeight<s?(e.style.left="0px",e.style.top=o+"px"):n<0&&o+e.clientHeight>=s?(e.style.left="0px",e.style.top=s-e.clientHeight+"px"):n+e.clientWidth>a&&o<0?(e.style.left=a-e.clientWidth+"px",e.style.top="0px"):n+e.clientWidth<a&&o+e.clientHeight>=s?(e.style.left=n+"px",e.style.top=s-e.clientHeight+"px"):n+e.clientWidth<a&&o<0?(e.style.left=n+"px",e.style.top="0px"):n+e.clientWidth>a&&o+e.clientHeight<s?(e.style.left=a-e.clientWidth+"px",e.style.top=o+"px"):n+e.clientWidth>a&&o+e.clientHeight>=s?(e.style.left=a-e.clientWidth+"px",e.style.top=s-e.clientHeight+"px"):(e.style.left=n+"px",e.style.top=o+"px")}),5),document.onmouseup=function(e){document.onmousedown=null,document.onmousemove=null,l=!1}}}}}),e.directive("stopdrag",{beforeMount:function(e,t){e.onmousedown=function(e){"el-input__inner"!=e.target.className&&e.stopPropagation()}}})},tool:y,layerManagement:U,camera:W,initViewer:function(t,n){var o;if(window.viewer&&(window.viewer=null),window.isPCBroswer=SuperMap3D.FeatureDetection.isPCBroswer()){o=new SuperMap3D.Viewer("SuperMap3DContainer",{timeline:!0,baseLayerPicker:!1,imageryProvider:!1,navigation:!1,animation:!1,infoBox:!1,contextOptions:{msaaLevel:8,requestWebgl2:!0},shadows:!1,pcss:!0,shadowQuality:0,creditContainer:document.createElement("div")}),document.getElementsByClassName("supermap3d-viewer-timelineContainer")[0].style.visibility="hidden"}else{var i=(o=new SuperMap3D.Viewer("SuperMap3DContainer",{selectionIndicator:!1,infoBox:!1,skyBox:!1,navigation:!1,contextOptions:{requestWebgl2:!0}})).scene;SuperMap3D.defined(i.sun)&&(i.globe.enableLighting=!1),SuperMap3D.defined(i.moon)&&(i.moon.show=!1),document.documentElement.style.height=window.innerHeight+"px",document.addEventListener("touchmove",(function(e){e.preventDefault()}),!1)}o.scene.debugShowFramesPerSecond=!0,o.scene.globe.baseColor=SuperMap3D.Color.BLACK,window.viewer=o,window.scene=o.scene,scene.moon.show=!1,o.eventManager=new J(o);var r=o.SuperMap3DWidget;A(!0),o.geocoder&&(o.geocoder.viewModel.geoKey="fvV2osxwuZWlY0wJb8FEb2i5"),window.tooltip||(window.tooltip=$(o._element));try{t&&t.openingAnimation&&o.camera.flyTo({destination:new SuperMap3D.Cartesian3(6788287.844465209,-41980756.10214644,29619220.04004376),duration:0,complete:function(){o.camera.flyTo({destination:new SuperMap3D.Cartesian3.fromDegrees(110.60396458865515,34.54408834959379,30644793.325518917),duration:5})}}),t&&t.afterInitviewer&&t.afterInitviewer(),t&&t.sceneUrl&&G(t.sceneUrl,{},(function(e){})),t&&t.s3mScps&&H(t.s3mScps)}catch(e){if(r._showRenderLoopErrors){var a=ie.showRenderLoopErrors;r.showErrorPanel(a,void 0,e)}}e.onBeforeUnmount((function(){o.destroy(),window.viewer=void 0,window.scene=void 0}))},terrainOperation:function(t){var n=e.reactive({digDepth:500,isEdit:!1,isEditZ:!1,lineVisible:!0,digPositions:[],modifyPositions:[],operationType:"dig",terrainVisible:"terrainVisible"});if(t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:y.Message.errorMsg(ie.AttributeError+o);var i=[],r=[],a="dig";function l(e){e&&(i=e),viewer.scene.globe.removeAllExcavationRegion(),viewer.scene.globe.addExcavationRegion({name:"dig_terrain",position:i,height:n.digDepth,transparent:!1})}function u(e){e&&(r=e),viewer.scene.globe.removeAllModifyRegion(),viewer.scene.globe.addModifyRegion({name:"ggg",position:r})}return t&&t.digPositions&&l(t.digPositions),e.watch((function(){return n.digDepth}),(function(e){0!=i.length&&l()})),e.watch((function(){return n.isEdit}),(function(e){e&&window.handlerPolygon?"dig"===a?de(i,n.isEditZ,l):de(r,n.isEditZ,u):(fe(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),e.watch((function(){return n.isEditZ}),(function(e){window.editHandler&&(window.editHandler.isEditZ=e)})),e.watch((function(){return n.terrainVisible}),(function(e){switch(e){case"terrainVisible":viewer.terrainProvider._visible=!0;break;case"terrainUnvisible":viewer.terrainProvider._visible=!1}})),s(s({},e.toRefs(n)),{},{digTerrain:function(e){n.isEdit=!1,e.preventDefault(),a="dig",window.handlerPolygon||re("Polygon"),ae("Polygon",n.lineVisible).then((function(e){i=e.positions;var t=window.handlerPolygon;l(e.positions),t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),n.isEdit&&de(i,n.isEditZ,l)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||y.Message.errorMsg(ie.NoPickPositionSupported)},clearDig:function(e){e.preventDefault(),i=[],n.isEdit=!1,window.handlerPolygon&&(viewer.scene.globe.removeAllExcavationRegion(),se("Polygon"),fe())},modifyTerrain:function(e){e.preventDefault(),a="modify",window.handlerPolygon||re("Polygon"),ae("Polygon",n.lineVisible).then((function(e){r=e.positions;var t=window.handlerPolygon;u(e.positions),t.polygon.show=!1,t.polyline.show=!1,n.isEdit&&de(r,n.isEditZ,u)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||alert("不支持深度纹理,无法绘制多边形，地形修改功能无法使用！")},clearModify:function(e){e.preventDefault(),window.handlerPolygon&&(viewer.scene.globe.removeAllModifyRegion(),se("Polygon"),fe())},digPosition:i,modifyPosition:r})},terrainSlope:function(t){var n=e.reactive({analysisArea:"ARM_REGION",displayMode:"FACE_AND_ARROW",wideMaxR:90,wideMinR:0,slopeInterval:[0,90],trans:.8,isEdit:!1,slopePositions:[],lineVisible:!0});if(t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:y.Message.errorMsg(ie.AttributeError+o);var i=!0,r=new SuperMap3D.SlopeSetting,a=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode[n.analysisArea],l=SuperMap3D.SlopeSettingEnum.DisplayMode[n.displayMode],u=new SuperMap3D.ColorTable,c=[];function p(e){e&&(c=e),r.CoverageArea=e,viewer.scene.globe.SlopeSetting={slopeSetting:r,analysisMode:a}}return u.insert(80,new SuperMap3D.Color(1,0,0)),u.insert(50,new SuperMap3D.Color(221/255,224/255,7/255)),u.insert(30,new SuperMap3D.Color(20/255,187/255,18/255)),u.insert(20,new SuperMap3D.Color(0,161/255,1)),u.insert(0,new SuperMap3D.Color(9/255,9/255,1)),t&&t.slopePositions&&p(t.slopePositions),V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element))),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)))})),e.watch((function(){return n.analysisArea}),(function(e){switch(e){case"ARM_REGION":a=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION;break;case"ARM_ALL":a=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_ALL;break;case"ARM_NONE":a=SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_NONE}0!=c.length&&p(c)})),e.watch((function(){return n.wideMaxR}),(function(e){r.MaxVisibleValue=parseFloat(e),0!=c.length&&(viewer.scene.globe.SlopeSetting={slopeSetting:r,analysisMode:a})})),e.watch((function(){return n.wideMinR}),(function(e){r.MinVisibleValue=parseFloat(e),0!=c.length&&(viewer.scene.globe.SlopeSetting={slopeSetting:r,analysisMode:a})})),e.watch((function(){return n.slopeInterval}),(function(e){n.wideMinR=e[0],n.wideMaxR=e[1]})),e.watch((function(){return n.displayMode}),(function(e){switch(e){case"FACE":l=SuperMap3D.SlopeSettingEnum.DisplayMode.FACE;break;case"ARROW":l=SuperMap3D.SlopeSettingEnum.DisplayMode.ARROW;break;case"FACE_AND_ARROW":l=SuperMap3D.SlopeSettingEnum.DisplayMode.FACE_AND_ARROW}r.DisplayMode=l,0!=c.length&&p(c)})),e.watch((function(){return n.trans}),(function(e){r.Opacity=parseFloat(e),0!=c.length&&(viewer.scene.globe.SlopeSetting={slopeSetting:r,analysisMode:a})})),e.watch((function(){return n.isEdit}),(function(e){e&&window.handlerPolygon?de(c,!1,p):(fe(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),e.onBeforeUnmount((function(){r.destroy(),u.destroy(),r=void 0,u=void 0})),s(s({},e.toRefs(n)),{},{startSlope:function(e){e.preventDefault(),tooltip.setVisible(!1),i&&(window.tooltip.showAt(" <p>点击鼠标左键绘制分析区域</p><p>点击鼠标右键结束绘制</p><p>坡度坡向分析需要带法线地形</p>","250px"),i=!1),r.DisplayMode=l,r.MaxVisibleValue=n.wideMaxR,r.MinVisibleValue=n.wideMinR,r.ColorTable=u,r.Opacity=n.trans,window.handlerPolygon||re("Polygon"),ae("Polygon",n.lineVisible).then((function(e){p(c=e.positions);var t=window.handlerPolygon;t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),n.isEdit&&de(c,!1,p)}),(function(e){console.log(e)})),handlerPolygon.activate(),scene.pickPositionSupported||y.Message.errorMsg(ie.NoPickPositionSupported)},clearSlope:function(e){e.preventDefault(),c=[],window.handlerPolygon&&(viewer.scene.globe.SlopeSetting={analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_NONE},tooltip.setVisible(!1),se("Polygon"),fe())},slopePosition:c})},terrainIsoline:function(t){var n=e.reactive({fillMaxHeight:9e3,fillMinHeight:0,fillHeight:[0,9e3],equivalentIsoline:100,fillOptionsSelected:"Line",lineColor:"#FF8040",isEdit:!1,isolinePositions:[],lineVisible:!0});if(t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:y.Message.errorMsg(ie.AttributeError+o);var i=new SuperMap3D.HypsometricSetting,r=SuperMap3D.HypsometricSettingEnum.DisplayMode.LINE,a=new SuperMap3D.ColorTable;!function(e){e.insert(5597.06640625,new SuperMap3D.Color(0,0,1)),e.insert(5406.387386067709,new SuperMap3D.Color(0,.2,1)),e.insert(5215.708365885417,new SuperMap3D.Color(0,.4,1)),e.insert(5025.029345703126,new SuperMap3D.Color(0,.6,1)),e.insert(4834.350325520834,new SuperMap3D.Color(0,.8,1)),e.insert(4643.671305338543,new SuperMap3D.Color(0,1,1)),e.insert(4452.992285156252,new SuperMap3D.Color(.2,1,.8)),e.insert(4262.313264973961,new SuperMap3D.Color(.4,1,.6)),e.insert(4071.6342447916695,new SuperMap3D.Color(.6,1,.4)),e.insert(3880.955224609378,new SuperMap3D.Color(.8,1,.2)),e.insert(3690.2762044270867,new SuperMap3D.Color(1,1,0)),e.insert(3499.5971842447952,new SuperMap3D.Color(1,.8,0)),e.insert(3308.918164062504,new SuperMap3D.Color(1,.6,0)),e.insert(3118.239143880213,new SuperMap3D.Color(1,.4,0)),e.insert(2927.5601236979214,new SuperMap3D.Color(1,.2,0)),e.insert(2736.88110351563,new SuperMap3D.Color(1,0,0))}(a);var l=[];function u(e){e&&(l=e),0!=l.length&&(e&&(i.CoverageArea=e),viewer.scene.globe.HypsometricSetting={hypsometricSetting:i,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})}return t&&t.isolinePositions&&u(t.isolinePositions),e.watch((function(){return n.fillMaxHeight}),(function(e){i.MaxVisibleValue=parseFloat(e),0!=l.length&&u()})),e.watch((function(){return n.fillMinHeight}),(function(e){i.MinVisibleValue=parseFloat(e),0!=l.length&&u()})),e.watch((function(){return n.fillHeight}),(function(e){n.fillMinHeight=e[0],n.fillMaxHeight=e[1]})),e.watch((function(){return n.equivalentIsoline}),(function(e){i.LineInterval=parseFloat(e),0!=l.length&&u()})),e.watch((function(){return n.lineColor}),(function(e){if(e){if(i._lineColor=SuperMap3D.Color.fromCssColorString(e),0==l.length)return;u()}else console.warn("err: color is  null")})),e.watch((function(){return n.fillOptionsSelected}),(function(e){switch(e){case"None":r=void 0;break;case"Line":r=SuperMap3D.HypsometricSettingEnum.DisplayMode.LINE,i.Opacity=1;break;case"Region":r=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE,i.Opacity=.5;break;case"Line_Region":r=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE_AND_LINE,i.Opacity=.5}i.DisplayMode=r,0!=l.length&&u(l)})),e.watch((function(){return n.isEdit}),(function(e){e&&window.handlerPolygon?de(l,!1,u):(fe(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),e.onBeforeUnmount((function(){i.destroy(),a.destroy(),i=void 0,a=void 0})),s(s({},e.toRefs(n)),{},{isoLineAnalysis:function(e){e.preventDefault(),i.DisplayMode=r,i._lineColor=SuperMap3D.Color.fromCssColorString(n.lineColor),i.LineInterval=parseFloat(n.equivalentIsoline),i.MaxVisibleValue=parseFloat(n.fillMaxHeight),i.MinVisibleValue=parseFloat(n.fillMinHeight),i.ColorTableMinKey=2736.88110351563,i.ColorTableMaxKey=5597.06640625,i.ColorTable=a,window.handlerPolygon||re("Polygon"),ae("Polygon",n.lineVisible).then((function(e){l=e.positions;var t=window.handlerPolygon;u(l),t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),n.isEdit&&de(l,!1,u)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),scene.pickPositionSupported||y.Message.errorMsg(ie.NoPickPositionSupported)},clearIsoLine:function(e){e.preventDefault(),l=[],window.handlerPolygon&&(viewer.scene.globe.HypsometricSetting=void 0,i&&(i.MaxVisibleValue=-1e3),i&&(i.MinVisibleValue=-1e3),se("Polygon"),fe())},isolinePosition:l})},terrainFlood:function(t){var n=e.reactive({maxHeight:9e3,minHeight:1e3,floodHeight:[1e3,9e3],currentHeight:1e3,floodTrans:.8,cheackedBand:"band1",colorBandShow:!1,floodSpeed:800,floodPositions:[],lineVisible:!0});if(t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:y.Message.errorMsg(ie.AttributeError+o);var i,r=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE,a=new SuperMap3D.HypsometricSetting,l=new SuperMap3D.ColorTable;l.insert(9e3,new SuperMap3D.Color(0,39/255,148/255)),l.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));var u=[];function c(e){e&&(u=e);var t=parseFloat(n.minHeight);a.CoverageArea=e,i=setInterval("flood()",100),window.flood=function(){if(t<=n.maxHeight&&(n.currentHeight=parseInt(t)),t>n.maxHeight)return n.currentHeight=n.maxHeight,void clearInterval(i);a.MaxVisibleValue=t;try{viewer.scene.globe.HypsometricSetting={hypsometricSetting:a,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION}}catch(e){console.log(e),clearInterval(i)}t+=parseFloat(n.floodSpeed)/10}}return e.watch((function(){return n.floodTrans}),(function(e){a.Opacity=parseFloat(e),0!=u.length&&(viewer.scene.globe.HypsometricSetting={hypsometricSetting:a,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})})),e.watch((function(){return n.floodHeight}),(function(e){n.minHeight=e[0],n.maxHeight=e[1]})),e.watch((function(){return n.minHeight}),(function(e){a.MinVisibleValue=parseInt(e),0!=u.length?viewer.scene.globe.HypsometricSetting={hypsometricSetting:a,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION}:n.currentHeight=parseInt(e)})),e.watch((function(){return n.maxHeight}),(function(e){a.MaxVisibleValue=parseInt(e),0!=u.length&&(viewer.scene.globe.HypsometricSetting={hypsometricSetting:a,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})})),e.watch((function(){return n.cheackedBand}),(function(e){l=function(e){var t=new SuperMap3D.ColorTable;switch(e){case"band1":t.insert(9e3,new SuperMap3D.Color(0,39/255,148/255)),t.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));break;case"band2":t.insert(9e3,new SuperMap3D.Color(162/255,251/255,194/255)),t.insert(0,new SuperMap3D.Color(1,103/255,103/255));break;case"band3":t.insert(9e3,new SuperMap3D.Color(230/255,198/255,1)),t.insert(0,new SuperMap3D.Color(157/255,0,1));break;case"band4":t.insert(9e3,new SuperMap3D.Color(210/255,15/255,15/255)),t.insert(6e3,new SuperMap3D.Color(221/255,224/255,7/255)),t.insert(5e3,new SuperMap3D.Color(20/255,187/255,18/255)),t.insert(4e3,new SuperMap3D.Color(0,161/255,1)),t.insert(0,new SuperMap3D.Color(9/255,9/255,212/255));break;case"band5":t.insert(9e3,new SuperMap3D.Color(186/255,1,229/255)),t.insert(0,new SuperMap3D.Color(26/255,185/255,156/255));break;default:t.insert(9e3,new SuperMap3D.Color(0,39/255,148/255)),t.insert(0,new SuperMap3D.Color(149/255,232/255,249/255))}return t}(e),a.ColorTable=l,0!=u.length&&i&&(viewer.scene.globe.HypsometricSetting={hypsometricSetting:a,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})})),e.onBeforeUnmount((function(){a.destroy(),l.destroy(),a=void 0,l=void 0})),s(s({},e.toRefs(n)),{},{floodBegin:function(e){e.preventDefault(),a.DisplayMode=r,a._lineColor=new SuperMap3D.Color(1,0,0,1),a.MinVisibleValue=n.minHeight,a.MaxVisibleValue=0,a.ColorTableMinKey=1,a.ColorTableMaxKey=9e3,a.ColorTable=l,a.Opacity=n.floodTrans,a.LineInterval=200,window.handlerPolygon||ue("Polygon"),t&&t.floodPositions?c(t.floodPositions):(ce("Polygon",n.lineVisible).then((function(e){var t=window.handlerPolygon;c(e.positions),t.polygon.show=!1,t.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||y.Message.errorMsg(ie.NoPickPositionSupported))},floodClear:function(e){e.preventDefault(),u=[],window.handlerPolygon&&(viewer.scene.globe.HypsometricSetting=void 0,clearInterval(i),pe("Polygon"))},changeColor:function(e){n.colorBandShow=!1,n.cheackedBand=e},floodPosition:u})},clipBoxEditor:function(t){var n=e.reactive({clipModel:"ClipInside"});if(t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:y.Message.errorMsg(ie.AttributeError+o);var i,r,a,l,u="clip_behind_all_plane";function c(){if(void 0!==a){var e=a.box.dimensions.getValue(),t=a.position.getValue(0),n=0;if(void 0!==a.orientation){var o=SuperMap3D.Matrix3.fromQuaternion(a.orientation._value,new SuperMap3D.Matrix3),i=SuperMap3D.Matrix4.fromRotationTranslation(o,SuperMap3D.Cartesian3.ZERO,new SuperMap3D.Matrix4),r=SuperMap3D.Matrix4.inverse(SuperMap3D.Transforms.eastNorthUpToFixedFrame(t),new SuperMap3D.Matrix4),s=SuperMap3D.Matrix4.multiply(r,i,new SuperMap3D.Matrix4),l=SuperMap3D.Matrix4.getMatrix3(s,new SuperMap3D.Matrix3);n=SuperMap3D.HeadingPitchRoll.fromQuaternion(SuperMap3D.Quaternion.fromRotationMatrix(l)).heading}p({dimensions:e,position:t,clipMode:u,heading:n})}}function p(e){for(var t=0,n=i.length;t<n;t++)i[t].setCustomClipBox(e)}function d(){if(r&&(r.deactivate(),tooltip.setVisible(!1)),a){var e,t=h(i);try{for(t.s();!(e=t.n()).done;){e.value.clearCustomClipBox()}}catch(e){t.e(e)}finally{t.f()}a=void 0,l.deactivate(),viewer.entities.removeAll(),r.clear()}}return V.isViewer&&(i=viewer.scene.layers.layerQueue,r=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box),window.tooltip||(window.tooltip=$(viewer._element))),e.watch((function(){return V.isViewer}),(function(e){e&&(i=viewer.scene.layers.layerQueue,r=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box),window.tooltip||(window.tooltip=$(viewer._element)))})),e.watch((function(){return n.clipModel}),(function(e){switch(e){case"ClipInside":u="clip_behind_all_plane";break;case"ClipOutside":u="clip_behind_any_plane"}a&&c()})),e.onBeforeUnmount((function(){l&&l.destroy(),l=void 0,i=void 0,r=void 0,a=void 0})),s(s({},e.toRefs(n)),{},{BoxClipByEitor:function(){d(),l||(function(){for(var e=0,t=i.length;e<t;e++)i[e].selectEnabled=!1,i[e].clipLineColor=new SuperMap3D.Color(1,1,1,0)}(),r.movingEvt.addEventListener((function(e){r.isDrawing?tooltip.showAt(" <p>点击鼠标左键结束绘制box底面</p><p>移动鼠标绘制box高度</p><p>点击鼠标右键结束绘制</p>","230px"):tooltip.showAt(" <p>点击鼠标左键开始绘制box底面</p>","230px")})),r.drawEvt.addEventListener((function(e){var t={dimensions:(a=e.object).box.dimensions.getValue(),position:a.position.getValue(0),clipMode:u,heading:0};(l=new SuperMap3D.BoxEditor(viewer,a)).editEvt.addEventListener((function(e){a.box.dimensions=e.dimensions,a.position=e.position,a.orientation=e.orientation,c()})),l.activate(),p(t),tooltip.setVisible(!1),r.clear(),r.deactivate()}))),r.activate()},clearBoxClipByEitor:d})},clipPolygon:function(t){var n=e.reactive({clipModelPolygon:"ClipInside",isEdit:!1,isEditZ:!1,lineVisible:!0});if(t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:y.Message&&y.Message.errorMsg(ie.AttributeError+o);var i,r=SuperMap3D.ModifyRegionMode.CLIP_INSIDE,a=!0,l=[];function u(e){l=e;var t,n=h(i);try{for(n.s();!(t=n.n()).done;){t.value.setModifyRegions([e],r)}}catch(e){n.e(e)}finally{n.f()}}return t&&t.polygonPositions&&u(t.slopePositions),V.isViewer&&(i=viewer.scene.layers.layerQueue,window.tooltip||(window.tooltip=$(viewer._element))),e.watch((function(){return V.isViewer}),(function(e){e&&(i=viewer.scene.layers.layerQueue,window.tooltip||(window.tooltip=$(viewer._element)))})),e.watch((function(){return n.clipModelPolygon}),(function(e){switch(e){case"ClipInside":r=SuperMap3D.ModifyRegionMode.CLIP_INSIDE;break;case"ClipOutside":r=SuperMap3D.ModifyRegionMode.CLIP_OUTSIDE}l.length>0&&u(l)})),e.watch((function(){return n.isEdit}),(function(e){e&&window.handlerPolygon?de(l,n.isEditZ,u):(fe(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),e.watch((function(){return n.isEditZ}),(function(e){window.editHandler&&(window.editHandler.isEditZ=e)})),e.onBeforeUnmount((function(){i=void 0})),s(s({},e.toRefs(n)),{},{clipPolygon:function(e){e.preventDefault(),tooltip.setVisible(!1),a&&(tooltip.showAt(" <p>点击鼠标左键开始绘制多边形</p><p>点击鼠标右键结束绘制</p>","230px"),a=!1),i||(i=viewer.scene.layers.layerQueue);var t,o=h(i);try{for(o.s();!(t=o.n()).done;){var r=t.value;r.selectEnabled=!1,r.clipLineColor=new SuperMap3D.Color(1,1,1,0)}}catch(e){o.e(e)}finally{o.f()}window.handlerPolygon||re("Polygon"),ae("Polygon",n.lineVisible).then((function(e){u(e.positions);var t=window.handlerPolygon;t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),n.isEdit&&de(l,n.isEditZ,u)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),scene.pickPositionSupported||y.Message&&y.Message.errorMsg(ie.NoPickPositionSupported)},clearClipPolygon:function(e){if(e.preventDefault(),l=[],tooltip.setVisible(!1),window.handlerPolygon){se("Polygon");var t,n=h(i);try{for(n.s();!(t=n.n()).done;){t.value.clearModifyRegions()}}catch(e){n.e(e)}finally{n.f()}}},polygonPosition:l})},clipPlane:function(t){var n,o=e.reactive({isEdit:!0,isEditZ:!1,lineVisible:!0,PlanePositions:[]});if(t)for(var i in t)o.hasOwnProperty(i)?o[i]=t[i]:y.Message.errorMsg(ie.AttributeError+i);var r=[];function a(e){r=e;var t,o=h(n);try{for(o.s();!(t=o.n()).done;){t.value.setCustomClipPlane(e[0],e[1],e[2])}}catch(e){o.e(e)}finally{o.f()}}return t&&t.PlanePositions&&clipPolygonUpdate(t.PlanePositions),V.isViewer&&(n=viewer.scene.layers.layerQueue,window.tooltip||(window.tooltip=$(viewer._element))),e.watch((function(){return V.isViewer}),(function(e){e&&(n=viewer.scene.layers.layerQueue,window.tooltip||(window.tooltip=$(viewer._element)))})),e.watch((function(){return o.isEdit}),(function(e){e||window.handlerPolygon?de(r,o.isEditZ,a):(fe(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),e.watch((function(){return o.isEditZ}),(function(e){window.editHandler&&(window.editHandler.isEditZ=e)})),e.onBeforeUnmount((function(){n=void 0})),s(s({},e.toRefs(o)),{},{clipPlaneStart:function(e){console.log(1),e.preventDefault(),tooltip.setVisible(!1),tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>绘制三点确定一个平面</p><p>点击鼠标右键结束绘制</p>","230px"),n||(n=viewer.scene.layers.layerQueue);var t,i=h(n);try{for(i.s();!(t=i.n()).done;){var s=t.value;s.selectEnabled=!1,s.clipLineColor=new SuperMap3D.Color(1,1,1,0)}}catch(e){i.e(e)}finally{i.f()}window.handlerPolygon||re("Polygon"),ae("Polygon",o.lineVisible).then((function(e){a(e.result.object.positions),window.handlerPolygon.deactivate(),tooltip.setVisible(!1),de(r,o.isEditZ,a)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),scene.pickPositionSupported||alert("不支持深度纹理,无法绘制多边形，裁剪功能无法使用！")},clearClipPlane:function(e){if(e.preventDefault(),tooltip.setVisible(!1),r=[],window.handlerPolygon){se("Polygon");var t,o=h(n);try{for(o.s();!(t=o.n()).done;){t.value.clearCustomClipBox()}}catch(e){o.e(e)}finally{o.f()}}},planePosition:r})},clipCross:function(t){var n,o,i,r,a,l,u,c=e.reactive({clipWidth:5,clipHeight:5,heading:0,pitch:0,roll:0,extrude:1});if(t)for(var p in t)c.hasOwnProperty(p)?c[p]=t[p]:y.Message.errorMsg(ie.AttributeError+p);function d(){var e,t=h(n);try{for(t.s();!(e=t.n()).done;){e.value.setCustomClipCross({position:u,dimensions:l,heading:c.heading,pitch:c.pitch,roll:c.roll,extrudeDistance:Number(c.extrude)})}}catch(e){t.e(e)}finally{t.f()}}function f(){r&&viewer.entities.removeById("cross-clip-identify-box");var e,t=h(n);try{for(t.s();!(e=t.n()).done;){e.value.clearCustomClipBox()}}catch(e){t.e(e)}finally{t.f()}i=!1,r=void 0,o.removeInputAction(SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),o.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)}return V.isViewer&&(o=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas),n=viewer.scene.layers.layerQueue),e.watch((function(){return V.isViewer}),(function(e){e&&(o=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas),n=viewer.scene.layers.layerQueue)})),e.watch((function(){return c.clipWidth}),(function(e){var t=Number(e);t<=0||!r||(r.box.dimensions=new SuperMap3D.Cartesian3(c.clipWidth,c.clipHeight,.1),l=new SuperMap3D.Cartesian3(t,c.clipHeight,c.extrude),d())})),e.watch((function(){return c.clipHeight}),(function(e){var t=Number(e);t<=0||!r||(r.box.dimensions=new SuperMap3D.Cartesian3(c.clipWidth,c.clipHeight,.1),l=new SuperMap3D.Cartesian3(c.clipWidth,t,c.extrude),d())})),e.watch((function(){return c.pitch}),(function(e){if(""!==e&&r){var t=Number(e),n=new SuperMap3D.HeadingPitchRoll(SuperMap3D.Math.toRadians(c.heading),SuperMap3D.Math.toRadians(t),SuperMap3D.Math.toRadians(c.roll)),o=SuperMap3D.Transforms.headingPitchRollQuaternion(a,n);r.orientation=o,d()}})),e.watch((function(){return c.roll}),(function(e){if(""!==e&&r){var t=Number(e),n=new SuperMap3D.HeadingPitchRoll(SuperMap3D.Math.toRadians(c.heading),SuperMap3D.Math.toRadians(c.pitch),SuperMap3D.Math.toRadians(t)),o=SuperMap3D.Transforms.headingPitchRollQuaternion(a,n);r.orientation=o,d()}})),e.watch((function(){return c.heading}),(function(e){if(""!==e&&r){var t=Number(e),n=new SuperMap3D.HeadingPitchRoll(SuperMap3D.Math.toRadians(t),SuperMap3D.Math.toRadians(c.pitch),SuperMap3D.Math.toRadians(c.roll)),o=SuperMap3D.Transforms.headingPitchRollQuaternion(a,n);r.orientation=o,d()}})),e.watch((function(){return c.extrude}),(function(e){Number(e)<=0||!r||d()})),e.onBeforeUnmount((function(){o.destroy(),n=void 0,r=void 0,o=void 0,l=void 0})),s(s({},e.toRefs(c)),{},{startCross:function(e){e.preventDefault(),viewer&&(r&&f(),function(){var e,t,s=h(n);try{for(s.s();!(e=s.n()).done;){e.value.selectEnabled=!1}}catch(e){s.e(e)}finally{s.f()}a=SuperMap3D.Cartesian3.fromDegrees(0,0,0),l=new SuperMap3D.Cartesian3(c.clipWidth,c.clipHeight,.1),r=viewer.entities.add({id:"cross-clip-identify-box",position:a,show:!1,box:{dimensions:l,fill:!1,outline:!0,outlineColor:SuperMap3D.Color.AQUA,outlineWidth:5}}),o.setInputAction((function(e){if(i){if(!(a=scene.pickPosition(e.endPosition)))return;r.position=a,t||(t=new SuperMap3D.HeadingPitchRoll(SuperMap3D.Math.toRadians(c.heading),SuperMap3D.Math.toRadians(c.pitch),SuperMap3D.Math.toRadians(c.roll)));var n=SuperMap3D.Transforms.headingPitchRollQuaternion(a,t);r.orientation=n}}),SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),o.setInputAction((function(e){if(i){if(!(u=scene.pickPosition(e.position)))return;d(),i=!1,r.show=!1}o.removeInputAction(SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),o.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),t=null}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)}(),i=!0,r.show=!0)},clearCross:f})},clipBox:clipBox,measure:function(t){var n,o,i,r,a,l,u,c=e.reactive({measureMode:"Space",clampMode:SuperMap3D.ClampMode.Space,Ellipsoid:null,contourColor:"#ff7d00",isShowDVH:!1,isShowLine:!0,pickPointEnabled:!0});(a=new SuperMap3D.HypsometricSetting).DisplayMode=SuperMap3D.HypsometricSettingEnum.DisplayMode.LINE;var p=new SuperMap3D.ColorTable;a._lineColor=SuperMap3D.Color.fromCssColorString(c.contourColor),a.ColorTable=p,a.Opacity=.6,a.MaxVisibleValue=-100,a.MinVisibleValue=-100;var d=function(){setInterval((function(){console.log("now-state.pickPointEnabled:",c.pickPointEnabled)}),2e3),n=viewer.scene.layers.layerQueue,viewer.scene.globe.HypsometricSetting={hypsometricSetting:a,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_ALL},V.changeLayers&&f(),o=new SuperMap3D.MeasureHandler(viewer,SuperMap3D.MeasureMode.Distance,c.clampMode),i=new SuperMap3D.MeasureHandler(viewer,SuperMap3D.MeasureMode.Area,c.clampMode),r=new SuperMap3D.MeasureHandler(viewer,SuperMap3D.MeasureMode.DVH),o.activeEvt.addEventListener((function(e){1==e?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.scene.pickPointEnabled=c.pickPointEnabled):(viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),viewer.scene.pickPointEnabled=!1)})),o.measureEvt.addEventListener((function(e){var t=Number(e.distance),n=c.measureMode;"CGCS2000"!=n&&"XIAN80"!=n&&"WGS84"!=n||(t=Number(function(e){for(var t=[],n=0;n<e.length;n++){var o=SuperMap3D.Cartographic.fromCartesian(e[n]),i=SuperMap3D.Math.toDegrees(o.longitude),r=SuperMap3D.Math.toDegrees(o.latitude);t.push(i,r)}var a=new SuperMap3D.PolylineGeometry({positions:SuperMap3D.Cartesian3.fromDegreesArray(t)});return scene.globe.computeSurfaceDistance(a,c.Ellipsoid)}(e.positions)));var i=t>1e3?(t/1e3).toFixed(2)+"km":t.toFixed(2)+"m";o.disLabel.text="距离:"+i})),i.activeEvt.addEventListener((function(e){1==e?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.scene.pickPointEnabled=c.pickPointEnabled):(viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),viewer.scene.pickPointEnabled=!1)})),i.measureEvt.addEventListener((function(e){var t=Number(e.area),n=c.measureMode;"CGCS2000"==n||"XIAN80"==n||"WGS84"==n?t=Number(function(e){for(var t=[],n=0;n<e.length;n++){var o=SuperMap3D.Cartographic.fromCartesian(e[n]),i=SuperMap3D.Math.toDegrees(o.longitude),r=SuperMap3D.Math.toDegrees(o.latitude);t.push(i,r)}var a=new SuperMap3D.PolygonGeometry.fromPositions({positions:SuperMap3D.Cartesian3.fromDegreesArray(t)});return scene.globe.computeSurfaceArea(a,c.Ellipsoid)}(e.positions)):"6"==n&&(t=Number(function(e){for(var t=0,n=0;n<e.length;n++){var o=SuperMap3D.Cartographic.fromCartesian(e[n]);t+=SuperMap3D.Math.toDegrees(o.longitude)}for(var i=Math.round((t/e.length+6)/6),r=6*i-3,a=new SuperMap3D.CustomProjection({name:"tmerc",centralMeridian:r,primeMeridian:0,standardParallel_1:0,standardParallel_2:0,eastFalse:5e5,northFalse:0,semimajorAxis:6378137,inverseFlattening:298.257222101}),s=[],l=0;l<e.length;l++){var u=SuperMap3D.Cartographic.fromCartesian(e[l]),c=a.project(u);s.push(c)}return s.push(s[0]),SuperMap3D.getPreciseArea(s,"China2000",r,i,1)}(e.positions)));var o=t>1e6?(t/1e6).toFixed(2)+"km²":t.toFixed(2)+"㎡";i.areaLabel.text="面积:"+o})),r.measureEvt.addEventListener((function(e){var t=e.distance>1e3?(e.distance/1e3).toFixed(2)+"km":e.distance+"m",n=e.verticalHeight>1e3?(e.verticalHeight/1e3).toFixed(2)+"km":e.verticalHeight+"m",o=e.horizontalDistance>1e3?(e.horizontalDistance/1e3).toFixed(2)+"km":e.horizontalDistance+"m";r.disLabel.text="空间距离:"+t,r.vLabel.text="垂直高度:"+n,r.hLabel.text="水平距离:"+o,l=Number(e.endHeight),c.isShowLine&&w(l)})),r.activeEvt.addEventListener((function(e){1==e?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.scene.pickPointEnabled=c.pickPointEnabled):(viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),viewer.scene.pickPointEnabled=!1)}))};function f(){for(var e=0;e<n.length;e++)n[e].hypsometricSetting={hypsometricSetting:a,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_ALL};u=!0}function w(e){if(viewer.scene.globe.HypsometricSetting.hypsometricSetting.MaxVisibleValue=e,viewer.scene.globe.HypsometricSetting.hypsometricSetting.MinVisibleValue=e,u)for(var t=0;t<n.length;t++)n[t].hypsometricSetting.hypsometricSetting?(n[t].hypsometricSetting.hypsometricSetting.MaxVisibleValue=e,n[t].hypsometricSetting.hypsometricSetting.MinVisibleValue=e):f()}function h(e){var t=scene.pickPosition(e.message.position);y.CartesiantoDegrees(t)[2]}function v(){w(-1e4),viewer.eventManager.removeEventListener("CLICK",h)}function m(){o&&o.deactivate(),i&&i.deactivate(),r&&r.deactivate(),c.isShowDVH=!1,c.Ellipsoid=null,l=-1e4}return V.isViewer&&d(),e.watch((function(){return V.isViewer}),(function(e){e&&d()})),e.watch((function(){return V.changeLayers}),(function(e){f()})),e.watch((function(){return c.isShowLine}),(function(e){w(e?l:-1e4)})),e.watch((function(){return c.pickPointEnabled}),(function(e){viewer.scene.pickPointEnabled=e})),e.watch((function(){return c.measureMode}),(function(e){"Space"==e?(c.clampMode=SuperMap3D.ClampMode.Space,i.clampMode=SuperMap3D.ClampMode.Space,o.clampMode=SuperMap3D.ClampMode.Space):(c.clampMode=SuperMap3D.ClampMode.Ground,i.clampMode=SuperMap3D.ClampMode.Ground,o.clampMode=SuperMap3D.ClampMode.Ground,c.Ellipsoid="XIAN80"==e?SuperMap3D.Ellipsoid.XIAN80:"CGCS2000"==e?SuperMap3D.Ellipsoid.CGCS2000:"WGS84"==e?SuperMap3D.Ellipsoid.WGS84:null)})),e.onBeforeUnmount((function(){a.destroy(),n=void 0})),s(s({},e.toRefs(c)),{},{distanceClk:function(){m(),o&&o.activate()},areaClk:function(){m(),i&&i.activate()},heightClk:function(){u||f(),v(),viewer.eventManager.addEventListener("CLICK",h,!0),m(),c.isShowDVH=!0,r&&r.activate()},clear:function(){m(),o&&o.clear(),i&&i.clear(),r&&r.clear(),v(),viewer.scene.pickPointEnabled=!1}})},skyLine:function(t){var n=e.reactive({skylineRadius:1e4,lineWidth:3,skylineColor:"rgb(200, 0, 0)",skyBodyColor:"rgba(44,149,197,0.6)",barrierColor:"rgba(255, 186, 1, 1)",skylineMode:0,highlightBarrier:!1,getSkyline2d:!0,skylineSpatialAnalysisUrl:null,observerInformation:null,ignoreGlobe:!0,isClear:!0});if(t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:y.Message.errorMsg(ie.AttributeError+o);var i,r,a,l,u=!0,c=e.ref(null);function p(){window.echarts?(i||(i=window.echarts.init(c.value),window.onresize=function(){i.resize()}),i.setOption({title:{text:"二维天际线",textStyle:{fontSize:14}},grid:{left:30,right:0,top:30,bottom:8},tooltip:{},xAxis:{show:!1},yAxis:{show:!1},series:[{type:"bar",data:[]}]})):y.Message.warnMsg(ie.EchartsErr)}function d(){a.build(),g();var e=viewer.scene.camera.positionCartographic;w({longitude:SuperMap3D.Math.toDegrees(e.longitude),latitude:SuperMap3D.Math.toDegrees(e.latitude),height:e.height,pitch:SuperMap3D.Math.toDegrees(l.camera.pitch),direction:SuperMap3D.Math.toDegrees(l.camera.heading)}),n.isClear=!1}function f(){var e=viewer.camera.position,t=viewer.scene.globe.ellipsoid.cartesianToCartographic(e).height/200;viewer.camera.moveBackward(t)}function w(e){a.viewPosition=[e.longitude,e.latitude,e.height],a.pitch=e.pitch,a.direction=e.direction,a.radius=Number(n.skylineRadius),a.lineWidth=Number(n.lineWidth),a.color=SuperMap3D.Color.fromCssColorString(n.skylineColor),a.displayStyle=Number(n.skylineMode>1?0:n.skylineMode),setTimeout((function(){n.highlightBarrier&&h(SuperMap3D.Color.fromCssColorString(n.barrierColor));2==n.skylineMode&&(n.skylineSpatialAnalysisUrl?v():m(e)),function(e){if(n.observerInformation&&i){var t={tooltip:{trigger:"axis",formatter:function(e){var t=Number(e[0].axisValue),n=e[0].data;return["X: "+t.toFixed(6)+"<br/>","Y: "+n.toFixed(6)].join("")}},grid:{left:40,right:0,top:35,bottom:8,borderColor:"#333333"},color:"red",xAxis:[{type:"category",boundaryGap:!1,data:null==e?void 0:e.x,show:!1}],yAxis:{min:function(e){return(e.min-.05).toFixed(2)},show:!0,axisLine:{show:!0}},dataZoom:[{type:"inside",xAxisIndex:0,filterMode:"filter",start:0,end:100}],series:[{symbolSize:8,symbol:"circle",smooth:!0,type:"line",data:null==e?void 0:e.y,lineStyle:{width:2,shadowColor:"rgba(145, 146, 148,0.7)",shadowBlur:10,shadowOffsetY:8}}]};i.setOption(t)}}(a.getSkyline2D())}),300),n.observerInformation=e,1===a.displayStyle&&f()}function h(e){var t=a.getObjectIds();console.log(t);var n=viewer.scene.layers._layerQueue,o=function(o){n.forEach((function(n){n._id===Number(o)&&n.setObjsColor(t[o],e)}))};for(var i in t)o(i)}function v(){var e=a.getSkylineSectorParameter(),t={viewerPoint:e.viewPos,line3D:e.geoLine3D,height:0,lonlat:!0},o=n.skylineSpatialAnalysisUrl,i=JSON.stringify(t);axios.post(o,i).then((function(e){axios.get(e.data.newResourceLocation+".json").then((function(e){var t=e.data;if(null!==t.geometry){var o=new Uint8Array(t.geometry.model).buffer;r.add("SkyLineBody",{id:1,position:SuperMap3D.Cartesian3.fromDegrees(t.geometry.position.x,t.geometry.position.y,t.geometry.position.z),hpr:new SuperMap3D.HeadingPitchRoll(0,0,0),color:SuperMap3D.Color.fromCssColorString(n.skyBodyColor)},o,!1),t.geometry.model=[4,0,0,0].concat(t.geometry.model),t.geometry.name=ie.SkyLineBody,F.geometrys.SkyLineBody=t.geometry,O()}})).catch((function(e){console.log(e),y.Message.errorMsg("获取天际线体数据失败",e)}))})).catch((function(e){console.log(e),y.Message.errorMsg("获取天际线体数据失败",e)}))}function m(e){var t=a.getSkyline3D(),o=new Array,i=SuperMap3D.Cartesian3.fromDegrees(e.longitude,e.latitude,e.height);o.push(i);for(var r=0;r<t.x.length;r++){var s=SuperMap3D.Cartesian3.fromDegrees(t.x[r],t.y[r],t.z[r]);o.push(s)}viewer.entities.add({id:"SkyLineBody",polygon:{extrudedHeight:10,hierarchy:o,perPositionHeight:!0,material:SuperMap3D.Color.fromCssColorString(n.skyBodyColor)}})}function g(){if(se(),tooltip.setVisible(!1),n.observerInformation){viewer.entities.removeById("SkyLineBody"),a&&a.clear();for(var e=0;e<l.layers._layerQueue.length;e++){l.layers.findByIndex(e).removeAllObjsColor()}n.observerInformation=null,i.clear(),p(),r.removeCollection("SkyLineBody"),F.geometrys.SkyLineBody&&(delete F.geometrys.SkyLineBody,O()),n.isClear=!0}}return e.onMounted((function(){p()})),l=viewer.scene,r=new SuperMap3D.S3MInstanceCollection(viewer.scene._context),viewer.scene.primitives.add(r),(a=new SuperMap3D.Skyline(viewer.scene)).ignoreGlobe=n.ignoreGlobe,n.observerInformation&&w(n.observerInformation),window.tooltip||(window.tooltip=createTooltip(viewer._element)),e.watch((function(){return n.skylineRadius}),(function(e){n.observerInformation&&(a.radius=parseFloat(e),a.pitch=parseFloat(n.observerInformation.pitch))})),e.watch((function(){return n.lineWidth}),(function(e){n.isClear||(d(),a.lineWidth=Number(e))})),e.watch((function(){return n.skylineColor}),(function(e){if(n.observerInformation&&""!=e){var t=SuperMap3D.Color.fromCssColorString(e);a.color=t,a.pitch=parseFloat(n.observerInformation.pitch)}})),e.watch((function(){return n.barrierColor}),(function(e){!n.observerInformation&&n.highlightBarrier||h(SuperMap3D.Color.fromCssColorString(e))})),e.watch((function(){return n.ignoreGlobe}),(function(e){a&&(a.ignoreGlobe=e),d()})),e.watch((function(){return n.highlightBarrier}),(function(e){if(e&&n.observerInformation)h(SuperMap3D.Color.fromCssColorString(n.barrierColor));else for(var t=0;t<l.layers._layerQueue.length;t++){l.layers.findByIndex(t).removeAllObjsColor()}})),e.watch((function(){return n.skyBodyColor}),(function(e){if(n.observerInformation&&""!=e){var t=SuperMap3D.Color.fromCssColorString(e);n.skylineSpatialAnalysisUrl?r.getInstance("SkyLineBody",1).updateColor(t):viewer.entities.getById("SkyLineBody").polygon.material=t}})),e.watch((function(){return n.getSkyline2d}),(function(e){e&&i?setTimeout((function(){i.resize()}),200):n.getSkyline2d=!1})),e.watch((function(){return n.skylineMode}),(function(e){0==e?(a.displayStyle=0,viewer.entities.removeById("SkyLineBody"),r.removeCollection("SkyLineBody"),F.geometrys.SkyLineBody&&(delete F.geometrys.SkyLineBody,O())):1==e?(a.displayStyle=1,viewer.entities.removeById("SkyLineBody"),r.removeCollection("SkyLineBody"),F.geometrys.SkyLineBody&&(delete F.geometrys.SkyLineBody,O()),f()):2==e&&(a.displayStyle=0,n.observerInformation&&(n.skylineSpatialAnalysisUrl?v(n.observerInformation):m(n.observerInformation)))})),e.onBeforeUnmount((function(){g(),a=void 0,i=void 0,r=void 0})),s(s({},e.toRefs(n)),{},{skyLineAnalysis:d,setLimitBody:function(){window.handlerPolygon||re("Polygon"),tooltip.setVisible(!1),u&&(window.tooltip.showAt(" <p>点击鼠标左键绘制区域</p><p>点击鼠标右键结束绘制</p>","450px"),u=!1),ae("Polygon").then((function(e){a.removeLimitbody("limitBody");for(var t=window.handlerPolygon,n=e.result.object.positions,o=[],i=0,r=n.length;i<r;i++){var s=SuperMap3D.Cartographic.fromCartesian(n[i]),l=SuperMap3D.Math.toDegrees(s.longitude),u=SuperMap3D.Math.toDegrees(s.latitude);o.push([l,u])}for(var c=[],p=0,d=y.unique(o).length;p<d;p++)c.push(o[p][0]),c.push(o[p][1]);a.addLimitbody({position:c,name:"limitBody"}),t.polygon.show=!1,t.polyline.show=!1,t.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate()},echarts_box:c,clear:g})},shadowquery:function(t){var n=e.reactive({timeValue:[24,64],currentDate:new Date,shadowShow:!0,marks:{0:"0:00",8:"",16:"",24:"6:00",32:"",40:"",48:"12:00",56:"",64:"",72:"18:00",80:"",88:"",96:"24:00"},timeInterval:60,spacing:10,bottomHeight:1,extrudeHeight:30,shadowQueryRegion:[],layerShadowType:SuperMap3D.ShadowType.ALL,terrainShadows:SuperMap3D.ShadowMode.RECEIVE_ONLY,showStartImgForTime:!0,showStartImgForDate:!0,shadowRadio:{shadowRadio:"",longitude:"",latitude:"",height:"",isShow:!1},dockFontShow:!0,legendShow:!1,shadowBodyShow:!1,shadowBodyFilter:[0,100]});if(t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:y.Message.errorMsg(ie.AttributeError+o);t&&t.shadowQueryRegion&&E(t.shadowQueryRegion);var i,r,a,l,u,c,p,f=!0,w=d(n.timeValue),h=e.ref(null),v="public/data/s3m/box.s3m",m=[],g=y.gradientColors,S=["#0000ff"];function M(){var e=viewer.scene;viewer.shadows=n.shadowShow,viewer.terrainShadows=n.terrainShadows,r=viewer.scene.layers.layerQueue,e.globe.enableLighting=!0,e.skyBox.show=!0,viewer.clock.multiplier=1,viewer.clock.shouldAnimate=!0,i=new SuperMap3D.ShadowQueryPoints(e),(u=new SuperMap3D.S3MInstanceCollection(e._context)).setCullEnabled(v,!0),e.primitives.add(u),i.queryPointsEvent.addEventListener((function(e){m=e,n.shadowBodyShow&&T()})),V.changeLayers&&b()}function b(){for(var e=0;e<r.length;e++)r[e].shadowType=n.layerShadowType,c=!0}function C(e){var t;t=w[0]===e[0]?D(e[1]):D(e[0]),viewer.clock.currentTime=SuperMap3D.JulianDate.fromDate(t),w=e}function D(e){var t=parseInt(e/4),o=parseInt(e%4*15),i=n.currentDate;return i.setHours(t),i.setMinutes(o),i}function P(e){n.shadowShow&&(i.startTime=SuperMap3D.JulianDate.fromDate(D(e[0])),i.endTime=SuperMap3D.JulianDate.fromDate(D(e[1]))),n.showStartImgForTime&&n.shadowQueryRegion.length>0&&i.build()}function E(e){P(n.timeValue);var t=[];i.spacing=Number(n.spacing),i.timeInterval=Number(n.timeInterval);for(var o=Number(n.bottomHeight),r=Number(n.extrudeHeight),a=0,s=SuperMap3D.arrayRemoveDuplicates(e,SuperMap3D.Cartesian3.equalsEpsilon).length;a<s;a++){var l=SuperMap3D.Cartographic.fromCartesian(e[a]),u=SuperMap3D.Math.toDegrees(l.longitude),c=SuperMap3D.Math.toDegrees(l.latitude);t.push(u),t.push(c)}n.shadowQueryRegion=t,i.qureyRegion({position:t,bottom:o,extend:r}),i.build()}function x(e){if(n.shadowBodyShow){var t=scene.pick(e.message.position);if(t&&t.id){var o=m[t.id];if(!o)return;var r=100*o.shadowRatio;(r<n.shadowBodyFilter[0]||r>n.shadowBodyFilter[1])&&(n.shadowRadio.isShow=!1);var a=y.CartesiantoDegrees(o.position);n.shadowRadio={shadowRadio:(100*o.shadowRatio).toFixed(0)+"%",longitude:a[0].toFixed(8),latitude:a[1].toFixed(8),height:a[2].toFixed(8),isShow:!0},h.value.style.top=e.message.position.y-160+"px",h.value.style.left=e.message.position.x+"px"}else n.shadowRadio.isShow=!1}else{var s=scene.pickPosition(e.message.position),l=SuperMap3D.Cartographic.fromCartesian(s),u=i.getShadowRadio(l);if(-1!=u){var c=SuperMap3D.Math.toDegrees(l.longitude),p=SuperMap3D.Math.toDegrees(l.latitude),d=l.height;n.shadowRadio={shadowRadio:(100*u).toFixed(0)+"%",longitude:c.toFixed(8),latitude:p.toFixed(8),height:d.toFixed(8),isShow:!0},h.value.style.top=e.message.position.y-160+"px",h.value.style.left=e.message.position.x+"px"}else n.shadowRadio.isShow=!1}}function L(){n.shadowRadio.isShow=!1}function R(){n.legendShow=!1,se(),n.shadowQueryRegion.length=0,tooltip.setVisible(!1),L(),viewer.eventManager.removeEventListener("CLICK",x),i.clear(),m.length=0,u.removeCollection(v);for(var e=0;e<r.length;e++)r[e].shadowType=SuperMap3D.ShadowType.NONE}function T(){var e=[];if(!(i._bottom<0||0==m.length)){for(var t,o,r,a=Number(n.spacing-.5),s=0,l=m.length;s<l;s++)e.push({position:m[s].position,color:(t=m[s].shadowRatio,o=void 0,r=void 0,o=parseInt(100*t),r=S[o],SuperMap3D.Color.fromCssColorString(r)),scale:new SuperMap3D.Cartesian3(a,a,a)});e.length>0&&u.add(v,e),k(n.shadowBodyFilter)}}function k(e){if(!(i._bottom<=0||0==m.length))for(var t=0,n=m.length;t<n;t++){var o=100*m[t].shadowRatio;o<e[0]||o>e[1]?u.getInstance(v,t).visible=!1:u.getInstance(v,t).visible=!0}}function I(e){p&&clearTimeout(p),p=setTimeout((function(){e()}),500)}return S=S.concat(g("#0000ff","#00ffff",20)).concat(g("#00ffff","#00ff00",20)).concat(g("#00ff00","#ffff00",20)).concat(g("#ffff00","#ff7f00",20)).concat(g("#ff7f00","#ff0000",20)),V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element)),M()),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)),M())})),e.watch((function(){return V.changeLayers}),(function(e){b()})),e.watch((function(){return n.timeValue}),(function(e){C(e)})),e.watch((function(){return n.currentDate}),(function(e){C(w)})),e.watch((function(){return n.timeInterval}),(function(e){I((function(){i.timeInterval=Number(e)}))})),e.watch((function(){return n.spacing}),(function(e){I((function(){i.spacing=Number(e)}))})),e.watch((function(){return n.bottomHeight}),(function(e){0!==n.shadowQueryRegion.length&&I((function(){var t=Number(e),o=Number(n.extrudeHeight);i.qureyRegion({position:n.shadowQueryRegion,bottom:t,extend:o}),i.build()}))})),e.watch((function(){return n.extrudeHeight}),(function(e){0!==n.shadowQueryRegion.length&&I((function(){var t=Number(n.bottomHeight),o=Number(e);i.qureyRegion({position:n.shadowQueryRegion,bottom:t,extend:o}),i.build()}))})),e.watch((function(){return n.shadowShow}),(function(e){viewer.shadows=e;for(var t=0,o=r.length;t<o&&r[t].shadowType!=n.layerShadowType;t++)r[t].shadowType=n.layerShadowType})),e.watch((function(){return n.shadowBodyShow}),(function(e){e?(i.isPointsVisible=!1,T()):(i.isPointsVisible=!0,u.removeCollection(v))})),e.onBeforeUnmount((function(){R(),i.destroy(),i=void 0,viewer.shadows=!1,r=void 0})),s(s({},e.toRefs(n)),{},{timeChanged:P,filterChanged:function(e){k(e)},formatTooltip:function(e){return e===n.timeValue[0]?"开始时间:"+t(D(e).toLocaleTimeString()):"结束时间:"+t(D(e).toLocaleTimeString());function t(e){var t=e.split(":");return t[0]+":"+t[1]}},sunLightForTime:function(e){if(l&&(n.showStartImgForDate=!0,clearInterval(l)),!e)return n.showStartImgForTime=!0,void clearInterval(a);n.showStartImgForTime=!1;var t=d(w),o=t[0],i=t[1],r=o;a=setInterval((function(){r<i?(r+=.5,n.timeValue=[o,r]):(n.showStartImgForTime=!0,clearInterval(a))}),50)},sunLightForDate:function(e){if(a&&(clearInterval(a),n.showStartImgForTime=!0),!e)return n.showStartImgForDate=!0,void clearInterval(l);n.showStartImgForDate=!1;var t=D(w[1]),o=t.getMonth();l=setInterval((function(){o<11?o+=1:o=0,t.setMonth(o),n.currentDate=new Date(t)}),1e3)},analysis:function(){n.shadowShow?(tooltip.setVisible(!1),f&&(window.tooltip.showAt(" <p>点击鼠标左键绘制分析区域</p><p>点击鼠标右键结束绘制</p>","350px"),f=!1),c&&r[0].shadowType==n.layerShadowType||b(),window.handlerPolygon||re("Polygon"),ae("Polygon").then((function(e){var t=window.handlerPolygon;E(e.result.object.positions),t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),viewer.eventManager.addEventListener("CLICK",x,!0)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),n.legendShow=!0):n.shadowShow=!0},clear:R,bubble:h,closeBubble:L,dockBubble:function(e){e?(h.value.classList.add("bubbleDock"),n.dockFontShow=!1):(h.value.classList.remove("bubbleDock"),n.dockFontShow=!0)}})},viewshed:function(t){var n,o,i,r,a,l=e.reactive({viewshedSpatialUrl:"http://www.supermapol.com/realspace/services/spatialAnalysis-data_all/restjsr/spatialanalyst/geometry/3d/viewshedbody.json",observerInformation:null,direction:1,pitch:1,addheight:1.8,distance:200,verticalFov:60,horizontalFov:90,hintLineColor:"rgb(212,202,45)",visibleAreaColor:"rgba(9,199,112,0.5)",hiddenAreaColor:"rgba(238,114,22,0.5)",visibleBodyColor:"rgba(9,199,112,0.7)",invisibleBodyColor:"rgba(238,114,22,0.7)",visibleBody:!1,invisibleBody:!1,viewshedAnimation:!1,DynamicLine:[],DynamicSpeed:10});if(t)for(var u in t)l.hasOwnProperty(u)?l[u]=t[u]:y.Message.errorMsg(ie.AttributeError+u);var c,p,d=!0,f=["public/data/s3m/car1.s3m"];function w(){console.log("可视域分析"),r=viewer.scene,n=new SuperMap3D.ViewShed3D(r),o=new SuperMap3D.ScreenSpaceEventHandler(r.canvas),n.hintLineColor=SuperMap3D.Color.fromCssColorString(l.hintLineColor),n.visibleAreaColor=SuperMap3D.Color.fromCssColorString(l.visibleAreaColor),n.hiddenAreaColor=SuperMap3D.Color.fromCssColorString(l.hiddenAreaColor),i=new SuperMap3D.S3MInstanceCollection(r._context),viewer.scene.primitives.add(i),(p=new SuperMap3D.DynamicLayer3D(r.context,f)).updateInterval=100,p.setCullEnabled(f[0],SuperMap3D.CullFace.BACK),p.maxVisibleAltitude=2e3,p.minVisibleAltitude=0,r.primitives.add(p)}V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element)),w()),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)),w())}));var h=null;function v(e){switch(e){case"LEFT_CLICK":o.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK);break;case"MOUSE_MOVE":o.removeInputAction(SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE);break;case"RIGHT_CLICK":o.removeInputAction(SuperMap3D.ScreenSpaceEventType.RIGHT_CLICK);break;case"ALL":default:o.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),o.removeInputAction(SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),o.removeInputAction(SuperMap3D.ScreenSpaceEventType.RIGHT_CLICK)}}function m(){var e=n.getViewshedParameter(),t={viewerPoint:e.viewPosition,point3DsList:e.point3DList,radius:e.distance,lonlat:!0,viewShedType:"VISIBLEBODY"},o=JSON.stringify(t),r=SuperMap3D.Color.fromCssColorString(l.visibleBodyColor);window.axios.post(l.viewshedSpatialUrl,o).then((function(e){window.axios.get(e.data.newResourceLocation+".json").then((function(e){var t=e.data;if(null!=t.geometry){var o=new Uint8Array(t.geometry.model).buffer;i.add("VeiwshedBody",{id:1,position:SuperMap3D.Cartesian3.fromDegrees(t.geometry.position.x,t.geometry.position.y,t.geometry.position.z),hpr:new SuperMap3D.HeadingPitchRoll(0,0,0),color:r},o,!1),t.geometry.model=[4,0,0,0].concat(t.geometry.model),n.visibleAreaColor=SuperMap3D.Color.fromCssColorString("rgba(0,0,0,0)"),n.hiddenAreaColor=SuperMap3D.Color.fromCssColorString("rgba(0,0,0,0)"),t.geometry.name=ie.VeiwshedBody,F.geometrys.VeiwshedBody=t.geometry,O()}else y.Message.errorMsg("获取geometry失败")})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}function g(){var e=n.getViewshedParameter(),t={viewerPoint:e.viewPosition,point3DsList:e.point3DList,radius:e.distance,lonlat:!0,viewShedType:"HIDDENBODY"},o=JSON.stringify(t),r=SuperMap3D.Color.fromCssColorString(l.invisibleBodyColor);window.axios.post(l.viewshedSpatialUrl,o).then((function(e){window.axios.get(e.data.newResourceLocation+".json").then((function(e){var t=e.data;if(null!=t.geometry){var o=new Uint8Array(t.geometry.model).buffer;i.add("VeiwshedBodyHidden",{id:1,position:SuperMap3D.Cartesian3.fromDegrees(t.geometry.position.x,t.geometry.position.y,t.geometry.position.z),hpr:new SuperMap3D.HeadingPitchRoll(0,0,0),color:r},o,!1),t.geometry.model=[4,0,0,0].concat(t.geometry.model),n.visibleAreaColor=SuperMap3D.Color.fromCssColorString("rgba(0,0,0,0)"),n.hiddenAreaColor=SuperMap3D.Color.fromCssColorString("rgba(0,0,0,0)"),t.geometry.name=ie.VeiwshedBodyHidden,F.geometrys.VeiwshedBodyHidden=t.geometry,O()}else y.Message.errorMsg("获取geometry失败")})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}function S(){M(),p.clearState(f[0],[1]),clearInterval(c),c=null,l.viewshedAnimation=!1,se("Polyline")}function M(){tooltip.setVisible(!1),viewer.entities.removeById("viewshedPoint"),document.body.classList.remove("measureCur"),n.distance=1e-5,n.viewPosition=[0,0,0],l.visibleBody=!1,l.invisibleBody=!1,l.observerInformation=null}function b(){n.distance=l.distance,n.build();for(var e=l.DynamicLine,t=[],o=1,i=e.length;o<i;o++)for(var r=e[o-1],a=e[o],s=SuperMap3D.Cartesian3.distance(r,a),u=parseInt(s/(.05*l.DynamicSpeed))+1,d=1,w=u;d<=w;d++)t.push(SuperMap3D.Cartesian3.lerp(r,a,d/u,new SuperMap3D.Cartesian3));var h=y.CartesiantoDegreesObjs(t),v=new SuperMap3D.DynamicObjectState({id:1,longitude:h[0].longitude,latitude:h[0].latitude,altitude:h[0].height,scale:new SuperMap3D.Cartesian3(1,1,1)});p.updateObjectWithModel(f[0],[v]);var m=1;c=setInterval((function(){if(m>=h.length)clearInterval(c);else{v.longitude=h[m].longitude,v.latitude=h[m].latitude,v.altitude=h[m].height,p.updateObjectWithModel(f[0],[v]);var e=y.getAngleAndRadian(t[m-1],t[m]);n.direction=e.angle,n.viewPosition=[v.longitude,v.latitude,v.altitude+Number(l.addheight)],m+=1}}),50)}function C(e){if(""!=e)return SuperMap3D.Color.fromCssColorString(e)}return e.watch((function(){return l.visibleBody}),(function(e){e&&l.observerInformation?m():(i.removeCollection("VeiwshedBody"),l.invisibleBody||(n.visibleAreaColor=SuperMap3D.Color.fromCssColorString(l.visibleAreaColor),n.hiddenAreaColor=SuperMap3D.Color.fromCssColorString(l.hiddenAreaColor)),F.geometrys.VeiwshedBody&&(delete F.geometrys.VeiwshedBody,O()))})),e.watch((function(){return l.invisibleBody}),(function(e){e&&l.observerInformation?g():(i.removeCollection("VeiwshedBodyHidden"),l.visibleBody||(n.visibleAreaColor=SuperMap3D.Color.fromCssColorString(l.visibleAreaColor),n.hiddenAreaColor=SuperMap3D.Color.fromCssColorString(l.hiddenAreaColor)),F.geometrys.VeiwshedBodyHidden&&(delete F.geometrys.VeiwshedBodyHidden,O()))})),e.watch((function(){return l.addheight}),(function(e){(""===e||e<0)&&(e=0),l.observerInformation&&(l.observerInformation[2]=h+parseFloat(e),n.viewPosition=l.observerInformation)})),e.watch((function(){return l.pitch}),(function(e){(""===e||e<0)&&(e=0),n.pitch=parseFloat(e)})),e.watch((function(){return l.direction}),(function(e){(""===e||e<0)&&(e=0),n.direction=parseFloat(e)})),e.watch((function(){return l.distance}),(function(e){(""===e||e<0)&&(e=0),n.distance=parseFloat(e)})),e.watch((function(){return l.verticalFov}),(function(e){(""===e||e<0)&&(e=0),n.verticalFov=parseFloat(e)})),e.watch((function(){return l.horizontalFov}),(function(e){(""===e||e<0)&&(e=0),n.horizontalFov=parseFloat(e)})),e.watch((function(){return l.hintLineColor}),(function(e){n.hintLineColor=C(e)})),e.watch((function(){return l.visibleAreaColor}),(function(e){n.visibleAreaColor=C(e)})),e.watch((function(){return l.visibleBodyColor}),(function(e){i.getInstance("VeiwshedBody",1).updateColor(C(e))})),e.watch((function(){return l.hiddenAreaColor}),(function(e){n.hiddenAreaColor=C(e)})),e.watch((function(){return l.invisibleBodyColor}),(function(e){i.getInstance("VeiwshedBodyHidden",1).updateColor(C(e))})),e.watch((function(){return l.viewshedAnimation}),(function(e){e?(M(),tooltip.showAt("<p>点击分析按钮激活事件</p><p>点击鼠标左键确认模型移动路线</p><p>单击右键结束分析</p>","450px"),setTimeout((function(){tooltip.setVisible(!1)}),3e3)):S()})),e.onBeforeUnmount((function(){S(),i.destroy(),n.destroy(),o.destroy(),DynamicLayer3D.destroy(),n=void 0,o=void 0,i=void 0})),s(s({},e.toRefs(l)),{},{analysis:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),l.viewshedAnimation?(c&&(S(),l.viewshedAnimation=!0,document.body.classList.add("measureCur")),function(){window.handlerPolyline||re("Polyline");if(t.DynamicLine)return void b();ae("Polyline",SuperMap3D.ClampMode.Ground).then((function(e){var t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!0,t.deactivate(),l.DynamicLine=e.result.object.positions,tooltip.setVisible(!1),l.DynamicLine.length<2?y.Message.warnMsg("至少需要两个点！"):b()}),(function(e){console.log(e)})),window.handlerPolyline.activate()}()):(d&&(window.tooltip.showAt(" <p>点击鼠标左键确认观察者位置</p> <p>右键单击结束分析</p>","450px"),d=!1),i.removeCollection("VeiwshedBody"),i.removeCollection("VeiwshedBodyHidden"),n.distance=1e-5,n.visibleAreaColor=SuperMap3D.Color.fromCssColorString(l.visibleAreaColor),n.hiddenAreaColor=SuperMap3D.Color.fromCssColorString(l.hiddenAreaColor),o.setInputAction((function(e){h=null;var t=r.pickPosition(e.position);a=t;var i=y.CartesiantoDegrees(t);h=i[2],i[2]+=Number(l.addheight),n.viewPosition=i,n.build(),l.observerInformation=i,document.body.classList.remove("measureCur"),v("LEFT_CLICK"),o.setInputAction((function(e){var t=e.endPosition,o=r.pickPosition(t);if(SuperMap3D.Cartesian3.distance(a,o)>0){var i=y.CartesiantoDegrees(o);n.setDistDirByPoint(i)}}),SuperMap3D.ScreenSpaceEventType.MOUSE_MOVE),o.setInputAction((function(e){l.direction=n.direction.toFixed(2),l.pitch=n.pitch.toFixed(2),l.distance=n.distance.toFixed(2),l.horizontalFov=n.horizontalFov,l.verticalFov=n.verticalFov,l.visibleBody&&m(),l.invisibleBody&&g(),tooltip.setVisible(!1),v("MOUSE_MOVE"),v("RIGHT_CLICK")}),SuperMap3D.ScreenSpaceEventType.RIGHT_CLICK),function(e){viewer.entities.removeById("viewshedPoint"),viewer.entities.add(new SuperMap3D.Entity({id:"viewshedPoint",point:new SuperMap3D.PointGraphics({color:C(l.hiddenAreaColor),pixelSize:8}),position:e}))}(SuperMap3D.Cartesian3.fromDegrees(i[0],i[1],i[2]))}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK))},clear:S})},profile:function(t){var n,o,i,r=e.reactive({profile2d:!0,polylineColor:"rgb(250, 213, 6)",polylineWidth:5,initEchartsOption:null,updateEchartsOption:null});if(t)for(var a in t)r.hasOwnProperty(a)?r[a]=t[a]:y.Message.errorMsg(ie.AttributeError+a);var l=!0,u=[],c=[],p=null,d=e.ref(null);function f(){window.echarts?(n||(n=window.echarts.init(d.value),window.onresize=function(){n.resize()}),r.initEchartsOption?n.setOption(r.initEchartsOption):n.setOption({title:{text:"剖面分析",textStyle:{fontSize:14}},grid:{left:30,right:0,top:30,bottom:8},tooltip:{},xAxis:{data:[]},yAxis:{data:[]},series:[{type:"bar",data:[]}]})):y.Message.warnMsg(ie.EchartsErr)}function w(e,t){r.profile2d=!0,n.clear(),n.showLoading(),u.length=0,c.length=0;for(var a=[],s=1,l=t.length;s<l;s++){var p=t[s-1],d=t[s],f=SuperMap3D.Cartesian3.distance(p,d);h(parseInt(f));for(var w=1,v=o;w<=v;w++)a.push(SuperMap3D.Cartesian3.lerp(p,d,w/o,new SuperMap3D.Cartesian3))}viewer.scene.clampToHeightMostDetailed(a).then((function(e){c=e,u=y.CartesiantoDegreesObjs(c),function(){if(n.hideLoading(),n.clear(),r.updateEchartsOption)return void n.setOption(r.updateEchartsOption);var e={title:{text:"剖面信息",textStyle:{fontSize:14}},grid:{left:50,right:8,top:40,bottom:20},tooltip:{trigger:"axis",backgroundColor:"#ffffff",textStyle:{color:"#000"},formatter:function(e){var t=e[0].dataIndex;return i=c[t],['当前位置: <hr size=1 style="margin: 3px 0">',"经度: "+u[t].longitude.toFixed(6)+"<br/>","纬度: "+u[t].latitude.toFixed(6)+"<br/>","海拔: "+u[t].height.toFixed(2)+"米<br/>"].join("")}},xAxis:{data:u.map((function(e,t){return t})),show:!1},yAxis:{min:function(e){return e.min<20?0:Math.floor(e.min)},axisLabel:{interval:"auto",formatter:function(e,t){return e>999?(e/1e3).toFixed(2)+"km":e+"m"}},splitLine:{show:!0}},toolbox:{left:"right",feature:{saveAsImage:{}}},dataZoom:[{type:"inside",xAxisIndex:0,filterMode:"filter",start:0,end:100}],series:{name:"height",type:"line",data:u.map((function(e){return e.height})),areaStyle:{}}};n.setOption(e)}()}))}function h(e){o=e/1e4>1?parseInt(e/100):e/1e3>5?parseInt(e/10):e/1e3>2?parseInt(e/5):e/1e3>1?parseInt(e/2):e/100>5?parseInt(e/1.5):e/100>2?e:2*e}function v(){r.profile2d=!1,viewer.entities.removeById("location4"),viewer.entities.removeById("polyline-profile"),n.clear(),u.length=0,c.length=0,se("Polyline"),fe(),f(),tooltip.setVisible(!1)}return e.onMounted((function(){f()})),V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element))),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)))})),e.watch((function(){return r.profile2d}),(function(e){e&&n?setTimeout((function(){n.resize()}),200):r.getSkyline2d=!1})),e.onBeforeUnmount((function(){v(),n.clear(),u.length=0,c.length=0})),s(s({},e.toRefs(r)),{},{echarts_box:d,myChart:n,Entypositions:i,LatAndLons:u,Cartesians:c,analysis:function(){l&&(tooltip.showAt(" <p>点击鼠标左键开始绘制</p> <p>单击右键结束分析</p><p>选中可进行编辑</p>","250px"),l=!1),window.handlerPolyline||re("Polyline"),ae("Polyline").then((function(e){n.showLoading(),p=e.positions,function(e){viewer.entities.removeById("polyline-profile"),viewer.entities.removeById("location4");var t=SuperMap3D.Color.fromCssColorString(r.polylineColor);viewer.entities.add({id:"polyline-profile",polyline:{positions:SuperMap3D.Cartesian3.fromDegreesArrayHeights(e),width:r.polylineWidth,material:t,clampToGround:!0}}),function(){if(viewer.entities.getById("location4"))return;viewer.entities.add({id:"location4",position:new SuperMap3D.CallbackProperty((function(){return i}),!1),billboard:{image:"src/style/images/location4.png",width:30,height:40,scaleByDistance:new SuperMap3D.NearFarScalar(10,1,2e3,.6),eyeOffset:new SuperMap3D.Cartesian3(0,1,-5)}})}()}(e.positions);var t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),w("",e.result.positions),de(p,!1,w),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()},clear:v})},sightLine:function(t){var n,o,i,r=e.reactive({viewPosition:null,visibleColor:"rgb(0, 200, 0)",hiddenColor:"rgb(200, 0, 0)",barrierColor:"rgba(255, 186, 1, 1)",highlightBarrier:!1,lineWidth:3,showBarrierPoints:!0});if(t)for(var a in t)r.hasOwnProperty(a)?null!=t[a]&&(r[a]=t[a]):y.Message.errorMsg(ie.AttributeError+a);var l,u,c=!0,p=!1,d=[],f=0,w=[],v=[],m=[];function g(){n=viewer.scene,(o=new SuperMap3D.Sightline(n)).visibleColor=SuperMap3D.Color.fromCssColorString(r.visibleColor),o.hiddenColor=SuperMap3D.Color.fromCssColorString(r.hiddenColor),o.lineWidth=Number(r.lineWidth),i=new we(viewer,"sightPoint_",D,P)}function S(e){p=!0,clearTimeout(l),l=setTimeout((function(){p=!1}),20);var t=n.pickPosition(e.message.position),i=y.CartesiantoDegrees(t);i[2]<0&&(i[2]=0,t=SuperMap3D.Cartesian3.fromDegrees(i[0],i[1],i[2])),r.viewPosition?(o.addTargetPoint({position:i,name:"sightPoint_Target"+f}),w.push(t),requestAnimationFrame((function(){requestAnimationFrame((function(){o.getBarrierPoint("sightPoint_Target"+f,(function(e){var t;if(t=f,viewer.entities.add(new SuperMap3D.Entity({id:"sightPoint_Target"+t,point:new SuperMap3D.PointGraphics({color:new SuperMap3D.CallbackProperty((function(){return SuperMap3D.Color.fromCssColorString(m[t])}),!1),pixelSize:10}),position:new SuperMap3D.CallbackProperty((function(){return w[t]}),!1)})),e&&e.position){e.position.height+=2;var n=SuperMap3D.Cartographic.toCartesian(e.position);v.push(n);var i=o.getObjectIds();d.push(i),m.push(r.hiddenColor)}else v.push({x:6378137,y:0,z:0}),m.push(r.visibleColor);!function(e){var t=viewer.entities.add({name:"Point_Barrier"+e,position:new SuperMap3D.CallbackProperty((function(){return v[e]}),!1),cylinder:{length:3,topRadius:2,bottomRadius:0,material:SuperMap3D.Color.fromCssColorString("#d60000")}});M.push(t)}(f),f+=1}))}))}))):(o.viewPosition=i,r.viewPosition=i,o.build(),viewer.entities.add(new SuperMap3D.Entity({id:"sightPoint_view",point:new SuperMap3D.PointGraphics({color:SuperMap3D.Color.fromCssColorString(r.barrierColor),pixelSize:10}),position:new SuperMap3D.CallbackProperty((function(){return u}),!1)})),u=t)}V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element)),g()),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)),g())}));var M=[];function b(e){if(r.viewPosition&&!p){var t=n.pickPosition(e.message.endPosition),i=y.CartesiantoDegrees(t);o.addTargetPoint({position:i,name:"point"})}}function C(){window.tooltip.setVisible(!1),document.body.classList.remove("measureCur"),r.highlightBarrier&&E(),o.removeTargetPoint("point"),o.build(),i.addEventListener(),viewer.eventManager.removeEventListener("CLICK",S),viewer.eventManager.removeEventListener("MOUSE_MOVE",b),viewer.eventManager.removeEventListener("RIGHT_CLICK",C)}function D(e){if(e.id)if(e.id.includes("sightPoint_Target")){var t=y.CartesiantoDegrees(e.position._value);o.addTargetPoint({position:t,name:e.id})}else if(e.id.includes("sightPoint_view")){var n=y.CartesiantoDegrees(e.position._value);o.viewPosition=n}}function P(e){requestAnimationFrame((function(){requestAnimationFrame((function(){if(e.id)if(e.id.includes("sightPoint_view"))for(var t=0,i=v.length;t<i;t++)a("sightPoint_Target"+t,!0);else e.id.includes("sightPoint_Target")&&a(e.id);function a(t,i){o.getBarrierPoint(t,(function(a){var s=t.charAt(t.length-1);if(a&&a.position){a.position.height+=2;var l,u=SuperMap3D.Cartographic.toCartesian(a.position);if(i){var c=o._targetPoints.values[s],p=SuperMap3D.Cartesian3.fromDegrees(c[0],c[1],c[2]);l=SuperMap3D.Cartesian3.distance(p,u)}else l=SuperMap3D.Cartesian3.distance(e.position._value,u);l>=2.5?(v[s]=u,m[s]=r.hiddenColor):(v[s]={x:6378137,y:0,z:0},m[s]=r.visibleColor);var f=o.getObjectIds();if(d.splice(s,1,f),r.highlightBarrier){var w,y=h(n.layers.layerQueue);try{for(y.s();!(w=y.n()).done;){w.value.removeAllObjsColor()}}catch(e){y.e(e)}finally{y.f()}E()}}else v[s]={x:6378137,y:0,z:0},m[s]=r.visibleColor}))}}))}))}function E(e){var t=SuperMap3D.defaultValue(e,SuperMap3D.Color.fromCssColorString(r.barrierColor)),n=viewer.scene.layers.layerQueue,o=d[d.length-1],i=o[String(Object.keys(o))];console.log("barrierIds:",i),n.forEach((function(e){"Building@CBD"===e._name&&e.setObjsColor(i,t)}))}function x(){o.removeAllTargetPoint();var e,t=h(n.layers.layerQueue);try{for(t.s();!(e=t.n()).done;){e.value.removeAllObjsColor()}}catch(e){t.e(e)}finally{t.f()}f=0,d.length=0,w.length=0,v.length=0,m.length=0,i.removeEventListener(),viewer.entities.removeAll(),document.body.classList.remove("measureCur"),window.tooltip.setVisible(!1),r.viewPosition=null,M.length=0,viewer.eventManager.removeEventListener("CLICK",S),viewer.eventManager.removeEventListener("MOUSE_MOVE",b),viewer.eventManager.removeEventListener("RIGHT_CLICK",C)}return e.watch((function(){return r.lineWidth}),(function(e){o&&(o.lineWidth=Number(e))})),e.watch((function(){return r.visibleColor}),(function(e){o&&(o.visibleColor=SuperMap3D.Color.fromCssColorString(e))})),e.watch((function(){return r.hiddenColor}),(function(e){o&&(o.hiddenColor=SuperMap3D.Color.fromCssColorString(e))})),e.watch((function(){return r.barrierColor}),(function(e){0!==d.length&&E(SuperMap3D.Color.fromCssColorString(e))})),e.watch((function(){return r.highlightBarrier}),(function(e){if(e)E();else{var t,o=h(n.layers.layerQueue);try{for(o.s();!(t=o.n()).done;){t.value.removeAllObjsColor()}}catch(e){o.e(e)}finally{o.f()}}})),e.watch((function(){return r.showBarrierPoints}),(function(e){0!==M.length&&M.forEach((function(t){t.show=e}))})),e.onBeforeUnmount((function(){x(),o=void 0})),s(s({},e.toRefs(r)),{},{analysis:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),c&&(window.tooltip.showAt(" <p>点击鼠标左键确认观察者位置</p><p>再点击左键确认目标位置</p> <p>右键单击结束分析</p>","400px"),c=!1),i.removeEventListener(),viewer.eventManager.addEventListener("CLICK",S,!0),viewer.eventManager.addEventListener("MOUSE_MOVE",b),viewer.eventManager.addEventListener("RIGHT_CLICK",C,!0)},clear:x})},openness:function(t){var n=e.reactive({addHeight:1,viewPosition:null,viewDomeRadius:100,domeType:"ALLDOME",isClosed:!1,visibleAreaColor:"rgba(9,199,112,0.5)",hiddenAreaColor:"rgba(238,114,22,0.5)",startAngle:0,endAngle:360});if(t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:y.Message.errorMsg(ie.AttributeError+o);var i,r,a,l=!0;function u(){i=viewer.scene,(r=new SuperMap3D.ViewDome(i)).viewPosition=[0,0,0],r.distance=Number(n.viewDomeRadius),r.domeType=SuperMap3D.ViewDomeType[n.domeType],r.visibleAreaColor=SuperMap3D.Color.fromCssColorString(n.visibleAreaColor),r.hiddenAreaColor=SuperMap3D.Color.fromCssColorString(n.hiddenAreaColor),r.startAngle=Number(n.startAngle),r.endAngle=Number(n.endAngle),r.isClosed=n.isClosed,r.build()}function c(e){viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");var t=i.pickPosition(e.message.position),o=y.CartesiantoDegrees(t);o[2]+=Number(n.addHeight),n.viewPosition={longitude:o[0].toFixed(6),latitude:o[1].toFixed(6),height:o[2].toFixed(2)},r.viewPosition=o,r.build(),window.tooltip.setVisible(!1),viewer.eventManager.removeEventListener("CLICK",c),viewer.eventManager.removeEventListener("MOUSE_MOVE",p),r.startAngle=Number(n.startAngle)}function p(e){a=i.pickPosition(e.message.endPosition)}function d(){viewer.entities.removeById("opennessPoint"),document.body.classList.remove("measureCur"),window.tooltip.setVisible(!1),n.viewPosition=null,r.viewPosition=[0,0,0],r.startAngle=Number(n.startAngle)}return V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element)),u()),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)),u())})),e.watch((function(){return n.viewDomeRadius}),(function(e){""!=e&&(r.distance=Number(e))})),e.watch((function(){return n.domeType}),(function(e){""!=e&&(r.domeType=SuperMap3D.ViewDomeType[e])})),e.watch((function(){return n.isClosed}),(function(e){""!=e&&(r.isClosed=e)})),e.watch((function(){return n.startAngle}),(function(e){""!=e&&(r.startAngle=Number(e))})),e.watch((function(){return n.endAngle}),(function(e){""!=e&&(r.endAngle=Number(e))})),e.watch((function(){return n.visibleAreaColor}),(function(e){if(""!=e){var t=SuperMap3D.Color.fromCssColorString(e);r.visibleAreaColor=t}})),e.watch((function(){return n.hiddenAreaColor}),(function(e){if(""!=e){var t=SuperMap3D.Color.fromCssColorString(e);r.hiddenAreaColor=t}})),e.watch((function(){return n.addHeight}),(function(e,t){var o=e-t;o=SuperMap3D.defaultValue(o,0),r.viewPosition[2]+=Number(o),a=SuperMap3D.Cartesian3.fromDegrees(r.viewPosition[0],r.viewPosition[1],r.viewPosition[2]),r.startAngle=Number(n.startAngle)})),e.onBeforeUnmount((function(){d(),r.destroy(),r=void 0})),s(s({},e.toRefs(n)),{},{analysis:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),l&&(window.tooltip.showAt(" <p>点击鼠标左键确认分析位置</p>","250px"),l=!1),viewer.entities.removeById("opennessPoint"),viewer.entities.add(new SuperMap3D.Entity({id:"opennessPoint",point:new SuperMap3D.PointGraphics({color:SuperMap3D.Color.fromCssColorString("rgba(238,114,22,1)"),pixelSize:8}),position:new SuperMap3D.CallbackProperty((function(){return a}),!1)})),viewer.eventManager.addEventListener("CLICK",c,!0),viewer.eventManager.addEventListener("MOUSE_MOVE",p,!0)},clear:d})},spatialQuery3d:function(t){var n=e.reactive({layerNames:[],selectedLayerName:null,scale:3,positionMode:"intersects",Xpitch:0,Yroll:0,Zheading:0,geometryType:"box",drawType:"Fill_And_WireFrame",FillColor:"rgba(192,211,25,0.5)",WireFrameColor:"rgba(89,129,228,0.8)",searchColor:"rgba(255, 186, 1, 1)",GeometryBodyNames:[],boxParameters:[100,100,100],sphereParameters:[100],coneParameters:[100,200],cylinderParameters:[100,100,200],ellicpseParameters:[100,50,50],rotateOrigin:null});if(t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:y.Message.errorMsg(ie.AttributeError+o);var i,r,a,l,u,c=!0,p=[];function d(){if(n.GeometryBodyNames=[],p=[],F.geometrys)for(var e in F.geometrys){p.push(e);var o=F.geometrys[e].name;n.GeometryBodyNames.includes(o)||n.GeometryBodyNames.push(o)}0===n.GeometryBodyNames.length&&(t&&t.geometryType?n.geometryType=t.geometryType:n.geometryType="box")}function f(){i=viewer.scene,r=viewer.scene.layers.layerQueue,(a=new SuperMap3D.SpatialQuery3D(i)).outlineColor=SuperMap3D.Color.fromCssColorString(n.WireFrameColor),a.fillColor=SuperMap3D.Color.fromCssColorString(n.FillColor),a.fillStyle=SuperMap3D.FillStyle[n.drawType],m(n.geometryType),g(n.positionMode),a.build(),setTimeout((function(){0===n.layerNames.length&&w()}),1e3),u=new SuperMap3D.S3MInstanceCollection(i._context),viewer.scene.primitives.add(u)}function w(){var e=v(n.selectedLayerName);a&&a.layers&&(a.layers=e?[e]:[]),n.layerNames.length=0,r&&r.length>0&&(r.forEach((function(e,t){n.layerNames.includes(e._name)||n.layerNames.push(e._name)})),n.selectedLayerName||(n.selectedLayerName=n.layerNames[0]))}function h(e){document.body.classList.remove("measureCur");var t=i.pickPosition(e.message.position);S(y.CartesiantoDegrees(t)),tooltip.setVisible(!1),viewer.eventManager.removeEventListener("CLICK",h)}function v(e){return r.find((function(t,n){return t._name===e}))}function m(e){switch(e){case"box":var t=n.boxParameters;l=new SuperMap3D.GeoBox(t[0],t[1],t[2]);break;case"sphere":var o=n.sphereParameters;l=new SuperMap3D.GeoSphere(o[0]);break;case"cone":var i=n.coneParameters;l=new SuperMap3D.GeoCone(i[0],i[1]),n.rotateOrigin&&(l.rotateOrigin="APEX"==n.rotateOrigin?SuperMap3D.RotationOrigin.APEX:SuperMap3D.RotationOrigin.CENTER);break;case"cylinder":var r=n.cylinderParameters;l=new SuperMap3D.GeoCylinder(r[0],r[1],r[2]);break;case"ellicpse":var s=n.ellicpseParameters;l=new SuperMap3D.GeoEllipsoid(s[0],s[1],s[2]);break;default:(l=new SuperMap3D.GeoModel3D).geoModel=F.geometrys.SkyLineBody,a.clear()}a.geometry=l}function g(e){var t;switch(e){case"intersects":t=SuperMap3D.PositionMode.Intersects;break;case"disjoint":t=SuperMap3D.PositionMode.Disjoint;break;case"contains":t=SuperMap3D.PositionMode.Contains;break;default:t=SuperMap3D.PositionMode.Intersects}a.positionMode=t}function S(e){a&&a.geometry&&(a.geometry.geoPosition=new SuperMap3D.Point3D(e[0],e[1],e[2]))}function M(){var e=v(n.selectedLayerName);e&&(e.selectedColor=new SuperMap3D.Color(.7,.7,1,1),e.setSelection([]),e.selectColorType=SuperMap3D.SelectColorType.MIX),a.clear(),tooltip.setVisible(!1),document.body.classList.remove("measureCur"),a.geometry.geoPosition=new SuperMap3D.Point3D(0,0,0),viewer.eventManager.removeEventListener("CLICK",h)}return V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element)),f()),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)),f())})),e.watch((function(){return V.changeLayers}),(function(e){w()})),V.changeGeometrys&&d(),e.watch((function(){return V.changeGeometrys}),(function(e){d()})),e.watch((function(){return n.Xpitch}),(function(e){""!=e&&(l.geoRotationX=parseFloat(e))})),e.watch((function(){return n.Yroll}),(function(e){""!=e&&(l.geoRotationY=parseFloat(e))})),e.watch((function(){return n.Zheading}),(function(e){""!=e&&(l.geoRotationZ=parseFloat(e))})),e.watch((function(){return n.scale}),(function(e){""!=e&&(l.geoScaleX=parseFloat(e),l.geoScaleY=parseFloat(e),l.geoScaleZ=parseFloat(e))})),e.watch((function(){return n.positionMode}),(function(e){""!=e&&g(e)})),e.watch((function(){return n.geometryType}),(function(e){""!==e&&m(e)})),e.watch((function(){return n.drawType}),(function(e){""!=e&&(a.fillStyle=SuperMap3D.FillStyle[e])})),e.watch((function(){return n.FillColor}),(function(e){""!=e&&(a.fillColor=SuperMap3D.Color.fromCssColorString(e))})),e.watch((function(){return n.WireFrameColor}),(function(e){""!=e&&(a.outlineColor=SuperMap3D.Color.fromCssColorString(e))})),e.watch((function(){return n.searchColor}),(function(e){""!=e&&(v(n.selectedLayerName).selectedColor=SuperMap3D.Color.fromCssColorString(e))})),e.watch((function(){return n.selectedLayerName}),(function(e,t){var n=v(t);n&&(n.selectedColor=new SuperMap3D.Color(.7,.7,1,1),n.setSelection([]),n.selectColorType=SuperMap3D.SelectColorType.MIX),M()})),e.onBeforeUnmount((function(){a.destroy(),a=void 0,r=void 0,l=void 0})),s(s({},e.toRefs(n)),{},{setPosition:S,getQueryIDs:function(){return a.getQueryIDs()},analysis:function(){try{var e=v(n.selectedLayerName);if(!e)return void y.Message.warnMsg("请选择需要查询的图层！");if(a.layers=[e],tooltip.setVisible(!1),e.selectedColor=SuperMap3D.Color.fromCssColorString(n.searchColor),e.selectColorType=SuperMap3D.SelectColorType.REPLACE,e.selectEnabled=!1,a.geometry){var t=a.getQueryIDs();console.log(t)}if("number"==typeof n.geometryType)return m(n.geometryType),void a.build();a.build(),viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),c&&(window.tooltip.showAt(" <p>点击鼠标左键确认查询位置</p>","300px"),c=!1),viewer.eventManager.addEventListener("CLICK",h,!0)}catch(e){console.error(e)}},clear:M})},splitScreen:function(t){var n,o,i,r=e.reactive({multiViewport:"NONE",selectedViewport:"0",TreeDatas:[]});if(t)for(var a in t)r.hasOwnProperty(a)?r[a]=t[a]:y.Message.errorMsg(ie.AttributeError+a);var l=e.ref(null),u={KeysViewport1:[],KeysViewport2:[],KeysViewport3:[],KeysViewport4:[]};function c(){n=viewer.scene.layers.layerQueue,o=viewer.imageryLayers._layers,i=viewer.scene._vectorTileMaps._layerQueue,viewer.terrainProvider,r.TreeDatas.length=0,function(){if(0==n.length)return;var e={id:"s3m",label:"S3M图层",children:[]};n.forEach((function(t,n){var o={id:"s3m-"+n,label:t._name};e.children.push(o)})),r.TreeDatas[0]=e}(),function(){if(1==o.length)return;var e={id:"img",label:"IMG图层",children:[]};o.forEach((function(t,n){var o=t._imageryProvider instanceof SuperMap3D.MvtProviderGL;if(0===n||o)return!0;var i={id:"img-"+n,label:ie.BaseMapImg};t._imageryProvider.tablename&&(i.label=t._imageryProvider.tablename),e.children.unshift(i)})),e.children.length>0&&(r.TreeDatas[1]=e)}(),function(){if(console.log(i),0==i.length)return;var e={id:"mvt",label:"MVT图层",children:[]};i.forEach((function(t,n){var o={id:"mvt-"+n,label:t.name};e.children.unshift(o)})),r.TreeDatas[2]=e}(),setTimeout((function(){l.value.setCheckedNodes(r.TreeDatas);var e=l.value.getCheckedKeys(!0);u.KeysViewport1=d(e),u.KeysViewport2=d(e),u.KeysViewport3=d(e),u.KeysViewport4=d(e)}),500)}return e.onMounted((function(){setTimeout((function(){c()}),500)})),e.watch((function(){return V.changeLayers}),(function(e){c()})),e.watch((function(){return r.multiViewport}),(function(e){viewer.scene.multiViewportMode=SuperMap3D.MultiViewportMode[e]})),e.watch((function(){return r.selectedViewport}),(function(e,t){var n=l.value.getCheckedKeys(!0);u["KeysViewport"+t]=n,l.value.setCheckedKeys(u["KeysViewport"+e],!0)})),e.onBeforeUnmount((function(){n=null,o=null,i=null,u=null})),s(s({},e.toRefs(r)),{},{tree:l,checkNode:function(e){var t=l.value.getNode(e);!function(e,t){var a=e[0],s=e[1];switch(a){case"s3m":if(!s){for(var l=0;l<n.length;l++)n[l].setVisibleInViewport(Number(r.selectedViewport),t);return}n[s].setVisibleInViewport(Number(r.selectedViewport),t);break;case"img":if(!s){for(var u=0;u<o.length;u++)o[u].setVisibleInViewport(Number(r.selectedViewport),t);return}o[s].setVisibleInViewport(Number(r.selectedViewport),t);break;case"mvt":if(!s){for(var c=0;c<i.length;c++)i[c].setVisibleInViewport(Number(r.selectedViewport),t);return}i[s].setVisibleInViewport(Number(r.selectedViewport),t)}}(e.id.split("-"),t.checked)}})},roller:function(t){var n,o,i,r=e.reactive({useRoller:!1,rollerMode:"lrRoller",lrRoller:"1",tbRoller:"4",TreeDatas:[]});if(t)for(var a in t)r.hasOwnProperty(a)?r[a]=t[a]:y.Message.errorMsg(ie.AttributeError+a);var l=document.getElementById("SuperMap3DContainer"),u=document.body.clientWidth-l.clientWidth,c=document.body.clientHeight-l.clientHeight,p=l.clientWidth,d=l.clientHeight,f=e.ref(null),w=e.ref(null),h=e.ref(null),v=e.ref(null),m=e.ref(null),g=new SuperMap3D.BoundingRectangle,S={startX:.33,startY:.33,endX:.66,endY:.66,index:1,mode:1};function M(){var e,t;n=viewer.scene.layers.layerQueue,o=viewer.imageryLayers._layers,i=viewer.scene._vectorTileMaps._layerQueue,viewer.terrainProvider,r.TreeDatas.length=0,function(){if(0==n.length)return;var e={id:"s3m",label:"S3M图层",children:[]};n.forEach((function(t,n){var o={id:"s3m-"+n,label:t._name};e.children.push(o)})),r.TreeDatas[0]=e}(),function(){if(1==o.length)return;var e={id:"img",label:"IMG图层",children:[]};o.forEach((function(t,n){if(0===n)return!0;if(t._imageryProvider instanceof SuperMap3D.MvtProviderGL)return!0;var o={id:"img-"+n,label:ie.BaseMapImg};t._imageryProvider.tablename&&(o.label=t._imageryProvider.tablename),e.children.unshift(o)})),e.children.length>0&&(r.TreeDatas[1]=e)}(),function(){if(0==i.length)return;var e={id:"mvt",label:"MVT图层",children:[]};i.forEach((function(t,n){var o={id:"mvt-"+n,label:t.name};e.children.unshift(o)})),r.TreeDatas[2]=e}(),t={id:"globe-0",label:"地表"},(e={id:"globe",label:"地球",children:[]}).children.push(t),r.TreeDatas[4]=e,setTimeout((function(){f.value.setCheckedNodes(r.TreeDatas)}),500)}function b(){var e=S.startX,t=S.startY,n=S.endX,o=S.endY;switch(S.mode){case 1:SuperMap3D.BoundingRectangle.unpack([e,0,1,1],0,g);break;case 2:SuperMap3D.BoundingRectangle.unpack([0,0,e,1],0,g);break;case 4:SuperMap3D.BoundingRectangle.unpack([0,t,1,1],0,g);break;case 8:SuperMap3D.BoundingRectangle.unpack([0,0,1,t],0,g);break;case 15:SuperMap3D.BoundingRectangle.unpack([e,t,n-e,o-t],0,g);break;default:SuperMap3D.BoundingRectangle.unpack([0,0,1,1],0,g)}f.value.getCheckedKeys(!0).forEach((function(e){C(e.split("-"),!0)}))}function C(e,t){var r=e[0],a=e[1];switch(r){case"s3m":if(!a){for(var s=0;s<n.length;s++)n[s].swipeEnabled=t,n[s].swipeRegion=g;return}n[a].swipeEnabled=t,n[a].swipeRegion=g;break;case"img":if(!a){for(var l=1;l<o.length;l++)o[l].swipeEnabled=t,o[l].swipeRegion=g;return}o[a].swipeEnabled=t,o[a].swipeRegion=g;break;case"mvt":if(!a){for(var u=0;u<i.length;u++)i[u].swipeEnabled=t,i[u].swipeRegion=g;return}i[a].swipeEnabled=t,i[a].swipeRegion=g;break;case"globe":viewer.scene.globe.swipeEnabled=t,viewer.scene.globe.swipeRegion=g}}function D(e){w.value.style.display="none",h.value.style.display="none",v.value.style.display="none",m.value.style.display="none",1&e&&(w.value.style.display="block"),2&e&&(h.value.style.display="block"),4&e&&(v.value.style.display="block"),8&e&&(m.value.style.display="block")}return e.watch((function(){return V.changeLayers}),(function(e){M()})),e.onMounted((function(){!function(){function e(e){document.removeEventListener("mousemove",n,!1)}function t(e,t){S.index=t,document.addEventListener("mousemove",n,!1)}function n(e){switch(e.preventDefault?e.preventDefault():e.returnValue=!1,S.index){case 1:w.value.style.left=e.clientX-u+"px",S.startX=(e.clientX-u)/p;break;case 2:v.value.style.top=e.clientY-c+"px",S.startY=(e.clientY-c)/d;break;case 3:h.value.style.left=e.clientX-u+"px",S.endX=(e.clientX-u)/p;break;case 4:m.value.style.top=e.clientY-c+"px",S.endY=(e.clientY-c)/d}b()}w.value.addEventListener("mousedown",(function(e){t(e,1)}),!1),h.value.onmousedown=function(e){t(e,3)},v.value.onmousedown=function(e){t(e,2)},m.value.onmousedown=function(e){t(e,4)},window.addEventListener("resize",(function(){p=document.body.clientWidth-u,d=document.body.clientHeight-c})),document.addEventListener("mouseup",e,!1)}(),setTimeout((function(){M()}),500)})),e.watch((function(){return r.multiViewport}),(function(e){viewer.scene.multiViewportMode=SuperMap3D.MultiViewportMode[e]})),e.watch((function(){return r.selectedViewport}),(function(e,t){var n=f.value.getCheckedKeys(!0);r["KeysViewport"+t]=n,f.value.setCheckedKeys(r["KeysViewport"+e],!0)})),e.watch((function(){return r.useRoller}),(function(e){e?(1!=S.mode&&2!=S.mode||D(1),4!=S.mode&&8!=S.mode||D(4),15==S.mode&&D(15),b()):(D(0),C(["s3m"],!1),C(["img"],!1),C(["mvt"],!1),C(["globe"],!1))})),e.watch((function(){return r.rollerMode}),(function(e){switch(e){case"lrRoller":r.useRoller&&D(1),S.mode=Number(r.lrRoller);break;case"tbRoller":r.useRoller&&D(4),S.mode=Number(r.tbRoller);break;case"customRoller":r.useRoller&&D(15),S.mode=15}r.useRoller&&b()})),e.watch((function(){return r.lrRoller}),(function(e){r.useRoller&&(S.mode=Number(e),b())})),e.watch((function(){return r.tbRoller}),(function(e){r.useRoller&&(S.mode=Number(e),b())})),e.onBeforeUnmount((function(){n=void 0,o=void 0,i=void 0})),s(s({},e.toRefs(r)),{},{tree:f,checkNode:function(e){var t=f.value.getNode(e);C(e.id.split("-"),t.checked)},verticalSliderLeft:w,verticalSliderRight:h,horizontalSliderTop:v,horizontalSliderBottom:m})},layerManage:function(t){var n,o,i,r,a,l,u=e.reactive({TreeDatas:[],expandedKeys:[]}),c=e.ref(null),p=e.ref(null),d=function(){},f=document.getElementById("SuperMap3DContainer"),w=document.body.clientWidth-f.clientWidth,h=document.body.clientHeight-f.clientHeight;function v(){n=viewer.scene.layers.layerQueue,o=viewer.imageryLayers._layers,r=viewer.scene._vectorTileMaps._layerQueue,i=viewer.terrainProvider,u.TreeDatas.length=0,m(),y(),g(),function(){if(!i.tablename)return;var e={id:"terrain",label:"地形图层",children:[]},t={id:"terrain-0",label:i.tablename};e.children.push(t),u.TreeDatas[3]=e}(),setTimeout((function(){c.value.setCheckedNodes(u.TreeDatas)}),500),console.log(r)}function m(){if(0!=n.length){var e={id:"s3m",label:"S3M图层",children:[]};n.forEach((function(t,n){var o={id:"s3m-"+n,label:t._name};e.children.push(o)})),u.TreeDatas[0]=e}else u.TreeDatas[0]&&c.value.remove(u.TreeDatas[0])}function y(){if(1!=o.length){var e={id:"img",label:"IMG图层",children:[]};o.forEach((function(t,n){var o=t._imageryProvider instanceof SuperMap3D.MvtProviderGL;if(0===n||o)return!0;var i={id:"img-"+n,label:ie.BaseMapImg};t._imageryProvider.tablename&&(i.label=t._imageryProvider.tablename),e.children.unshift(i)})),e.children.length>0&&(u.TreeDatas[1]=e)}else u.TreeDatas[1]&&c.value.remove(u.TreeDatas[1])}function g(){if(0!=r.length){var e={id:"mvt",label:"MVT图层",children:[]};r.forEach((function(t,n){var o={id:"mvt-"+n,label:t.name};e.children.unshift(o)})),u.TreeDatas[2]=e}else u.TreeDatas[2]&&c.value.remove(u.TreeDatas[2])}return t&&t.deleteCallback&&(d=t.deleteCallback),e.watch((function(){return V.changeLayers}),(function(e){v()})),e.onMounted((function(){setTimeout((function(){v()}),500)})),document.onclick=function(e){e.stopPropagation(),p.value.style.display="none"},e.onBeforeUnmount((function(){document.onclick=function(){}})),s(s({},e.toRefs(u)),{},{tree:c,domContextmenu:p,checkNode:function(e){var t=c.value.getNode(e);!function(e,t){var i=e[0],s=e[1];switch(i){case"s3m":if(!s){for(var l=0;l<n.length;l++)n[l].visible=t;return}n[s].visible=t;break;case"img":if(!s){for(var u=1;u<o.length;u++)o[u].show=t;return}o[s].show=t;break;case"mvt":if(!s){for(var c=0;c<r.length;c++)r[c].show=t;return}r[s].show=t;break;case"terrain":t?viewer.terrainProvider=a:(a=viewer.terrainProvider,viewer.terrainProvider=new SuperMap3D.EllipsoidTerrainProvider)}}(e.id.split("-"),t.checked)},nodeContextmenu:function(e,t){t.id.split("-")[1]&&(l=t,p.value.style.left=e.clientX+30-w+"px",e.clientX>=1810&&(p.value.style.left=e.clientX-80-w+"px"),p.value.style.top=e.clientY-h+"px",p.value.style.display="block")},nodeClick:function(e){!function(e){var t,i=e[0],a=e[1];switch(i){case"s3m":a&&(t=n[a]);break;case"img":a&&(t=o[a]);break;case"mvt":a&&(t=r[a])}t&&viewer.flyTo(t)}(e.id.split("-"))},deleteLayer:function(){p.value.style.display="none";var e=l.id.split("-"),t=e[0],i=e[1];switch(t){case"s3m":i&&(viewer.scene.layers.remove(n[i]._name),m(),setTimeout((function(){u.expandedKeys=["s3m"],c.value.setCheckedNodes(u.TreeDatas)}),50));break;case"img":i&&(viewer.imageryLayers.remove(o[i]),y(),setTimeout((function(){c.value.setCheckedNodes(u.TreeDatas)}),50));break;case"mvt":i&&(viewer.scene.removeVectorTilesMap(r[i].name),g(),setTimeout((function(){c.value.setCheckedNodes(u.TreeDatas)}),100));break;case"terrain":viewer.terrainProvider=new SuperMap3D.EllipsoidTerrainProvider,a=null;var s=c.value.getNode(t);c.value.remove(s)}_(),d(l)}})},mvtlayerStyle:function(t){var n,o,i,r,a=e.reactive({layerNames:[],selectedLayerIndex:"none",childLayerNames:[],selectedChildLayerIndex:"none",mvtAlpha:1,showLayer:!0,textAvoidance:!0,openFilter:!1,propertyKeys:[],symbols:[],clickGetFeature:{layer:{id:null},id:null},isClickShowProperty:!0,dockFontShow:!0,bubbleShow:!1,selectedPropertyKeys:[""],selectedSymbols:[""],inputPropertys:[""],inputSymbols:[""],inputValues:[""]}),l=[],u=!1,c=e.ref(null);function p(){(n=viewer.scene._vectorTileMaps._layerQueue)&&n.length>0?(n.forEach((function(e,t){a.layerNames.includes(e.name)||a.layerNames.push(e.name)})),console.log("init"),(a.selectedLayerIndex="none")&&(a.selectedLayerIndex=0)):a.selectedLayerIndex="none",viewer.eventManager.addEventListener("CLICK",w,!0)}function d(e){return e.slice(0,e.length-1)}function f(){if(""==a.inputPropertys[0])return!1;var e=["any"];return a.inputPropertys.forEach((function(t,n){var o=[];o[0]=a.inputSymbols[n],o[1]=t,o[2]=a.inputValues[n],"number"==typeof Number(o[2])&&(o[2]=Number(o[2])),e.push(o)})),!(e.length<2)&&e}function w(e){var t=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(SuperMap3D.defined(t)&&SuperMap3D.defined(t.pickResult)){var n=document.body.clientWidth-e.message.position.x;c.value.style.left=n>=300?e.message.position.x+"px":e.message.position.x-250+"px",c.value.style.top=e.message.position.y-220+"px",a.bubbleShow=!0;var o=null;for(var i in t.pickResult){o=t.pickResult[i];break}var r=o[0].feature;r&&(a.clickGetFeature=r),console.log(r)}else a.bubbleShow=!1}function h(){r&&(o.removeLayer(r.id),r=null)}return a.symbols=["!","!=",">",">=","<","<=","==","in","like","!like","left","right"],V.isViewer&&setTimeout((function(){return p()}),500),e.watch((function(){return V.isViewer}),(function(e){p()})),e.watch((function(){return V.changeLayers}),(function(e){p()})),e.watch((function(){return a.selectedLayerIndex}),(function(e){"none"!==e&&(l.length=0,o=n[e],a.showLayer=o.show,o.readyPromise.then((function(e){e&&(o.mapboxStyle.layers.forEach((function(e,t){a.childLayerNames.includes(e.id)||a.childLayerNames.push(e.id);var n=o.getLayoutProperty(e.id,"visibility");l.push(n)})),a.selectedChildLayerIndex=0)})))})),e.watch((function(){return a.selectedChildLayerIndex}),(function(e){i=o.mapboxStyle.layers[e];var t=o.querySourceFeatures({sourceLayer:i.id,filter:["<","$id",10]});0==t.length?a.propertyKeys=[]:a.propertyKeys=t[0]._keys.length>0?t[0]._keys:[]})),e.watch((function(){return a.mvtAlpha}),(function(e){o&&(o.alpha=Number(e))})),e.watch((function(){return a.showLayer}),(function(e){o&&(o.show=e)})),e.watch((function(){return a.textAvoidance}),(function(e){if(o)for(var t=o.mapboxStyle.layers,n=0;n<t.length;n++)t[n].isOverlapDisplayed=e})),e.watch((function(){return a.isClickShowProperty}),(function(e){if(e)return viewer.eventManager.addEventListener("CLICK",w,!0),void(a.bubbleShow=!0);viewer.eventManager.removeEventListener("CLICK",w),a.bubbleShow=!1})),e.watch((function(){return a.selectedPropertyKeys}),(function(e,t){e.length===t.length&&e.forEach((function(e,t){a.inputPropertys[t]=e}))}),{deep:!0}),e.watch((function(){return a.selectedSymbols}),(function(e,t){e.length===t.length&&e.forEach((function(e,t){if("left"===e||"right"===e)return""===a.inputPropertys[t]||a.inputPropertys[t].includes("left(")||a.inputPropertys[t].includes("right(")?void(a.inputPropertys[t]=e+"()"):void(a.inputPropertys[t]=e+"("+a.inputPropertys[t]+",2)");a.inputSymbols[t]=e}))}),{deep:!0}),e.onBeforeUnmount((function(){n=null,o=null,i=null})),s(s({},e.toRefs(a)),{},{addCondition:function(e){if(!e)return a.selectedPropertyKeys=d(a.selectedPropertyKeys),a.selectedSymbols=d(a.selectedSymbols),a.inputSymbols=d(a.inputSymbols),a.inputPropertys=d(a.inputPropertys),void(a.inputValues=d(a.inputValues));a.selectedPropertyKeys=a.selectedPropertyKeys.concat([""]),a.selectedSymbols=a.selectedSymbols.concat([""]),a.inputSymbols=a.inputSymbols.concat([""]),a.inputPropertys=a.inputPropertys.concat([""]),a.inputValues=a.inputValues.concat([""])},propertySearch:function(){var e=f();e&&function(e){r&&h();if(!i)return;var t=i.id+"_highlight";r||((r=SuperMap3D.clone(i,!0)).id=t,"line"==i.type?r.paint["line-color"]="rgba(0,255,255,1.00)":"fill"==i.type?r.paint["fill-color"]="rgba(0,255,255,1.00)":r.paint["text-color"]="rgba(255,0,0,1.00)",r.layout.visibility="visible",r.minzoom=3,o.addLayer(r),o.setFilter(r.id,e))}(e)},propertyFilter:function(){var e=f();u=!0,o&&(o.mapboxStyle.layers.forEach((function(e){o.setLayoutProperty(e.id,"visibility","none")})),o.setLayoutProperty(i.id,"visibility","visible"),e&&o.setFilter(i.id,e))},clear:function(){h(),u&&(o.mapboxStyle.layers.forEach((function(e,t){o.setLayoutProperty(e.id,"visibility",l[t])})),o.setFilter(i.id,null),o.refresh(),u=!1)},bubble:c,closeBubble:function(){a.bubbleShow=!1},dockBubble:function(e){e?(c.value.classList.add("bubbleDock"),a.dockFontShow=!1):(c.value.classList.remove("bubbleDock"),a.dockFontShow=!0)}})},s3mlayerAttribute:function(t){var n,o,i=e.reactive({layerNames:[],selectedLayerName:"none",brightness:1,contrast:1,hue:0,saturation:1,gamma:1,shadowMode:"noShadow",shadowDarkness:.3,selectEnabled:!0,multiChoose:!1,cullEnabled:!1,visibility:"showAll"});if(t)for(var r in t)i.hasOwnProperty(r)?i[r]=t[r]:y.Message.errorMsg(ie.AttributeError+r);function a(){viewer.scene,(n=viewer.scene.layers.layerQueue)&&n.length>0?(n.forEach((function(e,t){i.layerNames.includes(e._name)||i.layerNames.push(e._name)})),(i.selectedLayerName="none")&&(i.selectedLayerName=i.layerNames[0],o=n[0])):i.layerNames=[]}return V.isViewer&&a(),e.watch((function(){return V.isViewer}),(function(e){e&&a()})),e.watch((function(){return V.changeLayers}),(function(e){a()})),e.onBeforeUnmount((function(){n=null})),e.watch((function(){return i.selectedLayerName}),(function(e){var t=i.layerNames.indexOf(e);-1!=t&&(o=n[t])})),e.watch((function(){return i.brightness}),(function(e){o&&(o.brightness=Number(e))})),e.watch((function(){return i.contrast}),(function(e){o&&(o.contrast=Number(e))})),e.watch((function(){return i.hue}),(function(e){o&&(o.hue=Number(e))})),e.watch((function(){return i.saturation}),(function(e){o&&(o.saturation=Number(e))})),e.watch((function(){return i.gamma}),(function(e){o&&(o.gamma=Number(e))})),e.watch((function(){return i.shadowMode}),(function(e){if(o)switch(e){case"noShadow":viewer.shadows=!1,o.shadowType=SuperMap3D.ShadowType.NONE;break;case"chooseShadow":viewer.shadows=!0,o.shadowType=SuperMap3D.ShadowType.SELECTION,o.refresh();break;case"allShadow":viewer.shadows=!0,o.shadowType=SuperMap3D.ShadowType.ALL,o.refresh()}})),e.watch((function(){return i.shadowDarkness}),(function(e){viewer.scene.shadowMap.darkness=Number(e)})),e.watch((function(){return i.multiChoose}),(function(e){o&&(o.multiChoose=e)})),e.watch((function(){return i.selectEnabled}),(function(e){o&&(o.selectEnabled=e)})),e.watch((function(){return i.cullEnabled}),(function(e){o&&(o.cullEnabled=e)})),e.watch((function(){return i.visibility}),(function(e){if(o)switch(e){case"showAll":o.setObjsVisible([],!1);break;case"onlyHideSlection":var t=o.getSelection();o.setObjsVisible(t,!1);break;case"onlyShowSlection":var n=o.getSelection();o.setObjsVisible(n,!0)}})),s({},e.toRefs(i))},s3mlayerStyle:function(t){var n,o,i=this,r=e.reactive({layerNames:[],selectedLayerName:"none",foreColor:"#ffffff",lineColor:"rgba(27, 27, 27, 1)",selectedColor:"#A40FF4",selectColorMode:"mix",bottomAltitude:0,LODScale:5,layerTrans:1,fillStyle:"fill-and-wireframe",visibleDistanceMin:0,visibleDistanceMax:1e4});if(t)for(var a in t)r.hasOwnProperty(a)?r[a]=t[a]:y.Message.errorMsg(ie.AttributeError+a);function l(){viewer.scene,(n=viewer.scene.layers.layerQueue)&&n.length>0?(n.forEach((function(e,t){r.layerNames.includes(e._name)||r.layerNames.push(e._name)})),(r.selectedLayerName="none")&&(r.selectedLayerName=r.layerNames[0],o=n[0])):r.layerNames=[]}return V.isViewer&&l(),e.watch((function(){return V.isViewer}),(function(e){e&&l()})),e.watch((function(){return V.changeLayers}),(function(e){l()})),e.onBeforeUnmount((function(){n=null})),e.watch((function(){return r.selectedLayerName}),(function(e){var t=r.layerNames.indexOf(e);-1!=t&&(o=n[t])})),e.watch((function(){return r.foreColor}),(function(e){o&&(o.style3D.fillForeColor=SuperMap3D.Color.fromCssColorString(e))})),e.watch((function(){return r.lineColor}),(function(e){o&&(o.style3D.lineColor=SuperMap3D.Color.fromCssColorString(e))})),e.watch((function(){return r.selectedColor}),(function(e){o&&(o.selectedColor=SuperMap3D.Color.fromCssColorString(e))})),e.watch((function(){return r.selectColorMode}),(function(e){o&&(o.selectColorType="mix"===e?0:1)})),e.watch((function(){return r.bottomAltitude}),(function(e){o&&(o.style3D.bottomAltitude=Number(e)),o.refresh()})),e.watch((function(){return r.fillStyle}),(function(e){if(o)switch(e){case"fill":o.style3D.fillStyle=SuperMap3D.FillStyle.Fill;break;case"wireframe":o.style3D.fillStyle=SuperMap3D.FillStyle.WireFrame,o.style3D.lineColor=SuperMap3D.Color.fromCssColorString(r.lineColor);break;case"fill-and-wireframe":o.style3D.fillStyle=SuperMap3D.FillStyle.Fill_And_WireFrame,o.style3D.lineColor=SuperMap3D.Color.fromCssColorString(r.lineColor)}o.refresh()})),e.watch((function(){return r.LODScale}),(function(e){o&&(o.lodRangeScale=Number(e))})),e.watch((function(){return r.layerTrans}),(function(e){o&&(o.style3D.fillForeColor.alpha=Number(e))})),e.watch((function(){return r.visibleDistanceMin}),(function(e){""==e&&(e=0),o&&(o.visibleDistanceMin=Number(e))})),e.watch((function(){return r.visibleDistanceMax}),(function(e){""==e&&(e=i.maxNumber),o&&(o.cullEnabled=e),o.visibleDistanceMax=Number(e)})),s({},e.toRefs(r))},s3mlayerOperation:function(t){var n,o,i=e.reactive({layerNames:[],selectedLayerName:"none",selectedoffset:!1,offsetX:0,offsetY:0,offsetZ:0,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnit:0});if(t)for(var r in t)i.hasOwnProperty(r)?i[r]=t[r]:y.Message.errorMsg(ie.AttributeError+r);function a(){viewer.scene,(n=viewer.scene.layers.layerQueue)&&n.length>0?(n.forEach((function(e,t){i.layerNames.includes(e._name)||i.layerNames.push(e._name)})),(i.selectedLayerName="none")&&(i.selectedLayerName=i.layerNames[0],o=n[0])):i.layerNames=[]}function l(){var e=o.getSelection();o.removeAllObjsOffset(),e.length>0&&o.setObjsOffset(e)}return V.isViewer&&a(),e.watch((function(){return V.isViewer}),(function(e){e&&a()})),e.watch((function(){return V.changeLayers}),(function(e){a()})),e.onBeforeUnmount((function(){n=null})),e.watch((function(){return i.selectedLayerName}),(function(e){var t=i.layerNames.indexOf(e);-1!=t&&(o=n[t])})),e.watch((function(){return i.selectedoffset}),(function(e){if(o)if(e){var t=Number(i.offsetX),n=Number(i.offsetY),r=Number(i.offsetZ);o.selectedTranslate=new SuperMap3D.Cartesian3(t,n,r),viewer.eventManager.addEventListener("CLICK",l,!0),l()}else viewer.eventManager.removeEventListener("CLICK",l),o.selectedTranslate=new SuperMap3D.Cartesian3(0,0,0),o.removeAllObjsOffset(),o.releaseSelection()})),e.watch((function(){return i.offsetX}),(function(e){if(i.selectedoffset){var t=Number(e),n=Number(i.offsetY),r=Number(i.offsetZ);o.selectedTranslate=new SuperMap3D.Cartesian3(t,n,r)}})),e.watch((function(){return i.offsetY}),(function(e){if(i.selectedoffset){var t=Number(i.offsetX),n=Number(i.offsetY),r=Number(i.offsetZ);o.selectedTranslate=new SuperMap3D.Cartesian3(t,n,r)}})),e.watch((function(){return i.offsetZ}),(function(e){if(i.selectedoffset){var t=Number(i.offsetX),n=Number(i.offsetY),r=Number(i.offsetZ);o.selectedTranslate=new SuperMap3D.Cartesian3(t,n,r)}})),e.watch((function(){return i.polygonOffset}),(function(e){o&&(e?o.setPolygonoffset(Number(i.polygonOffsetFactor),Number(e)):o.setPolygonoffset(0,0))})),e.watch((function(){return i.polygonOffsetFactor}),(function(e){o&&i.polygonOffset&&o.setPolygonoffset(Number(e),Number(i.polygonOffsetUnit))})),e.watch((function(){return i.polygonOffsetUnit}),(function(e){o&&i.polygonOffset&&o.setPolygonoffset(Number(i.polygonOffsetFactor),Number(e))})),s({},e.toRefs(i))},modelFlood:function(t){var n,o,i=e.reactive({layerNames:[],selectedLayerName:"none",maxHeight:200,minHeight:0,floodHeight:[0,200],currentHeight:0,floodSpeed:1,floodTrans:.8,cheackedBand:"band1",colorBandShow:!1,floodPositions:[],lineVisible:!0});if(t)for(var r in t)i.hasOwnProperty(r)?i[r]=t[r]:y.Message.errorMsg(ie.AttributeError+r);var a,l=SuperMap3D.HypsometricSettingEnum.DisplayMode.FACE,u=new SuperMap3D.HypsometricSetting,c=new SuperMap3D.ColorTable;c.insert(500,new SuperMap3D.Color(0,39/255,148/255)),c.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));var p=[];function d(){viewer.scene,(n=viewer.scene.layers.layerQueue)&&n.length>0&&(n.forEach((function(e,t){i.layerNames.includes(e._name)||i.layerNames.push(e._name)})),(i.selectedLayerName="none")&&(i.selectedLayerName=i.layerNames[0],o=n[0]))}function f(e){e&&(p=e),u.CoverageArea=e;var t=Number(i.minHeight);a=setInterval("ModelFlood()",100),window.ModelFlood=function(){if(t>i.maxHeight)return i.currentHeight=i.maxHeight,void clearInterval(a);i.currentHeight=Number(t.toFixed(2)),u.MaxVisibleValue=t;try{w()}catch(e){console.log(e),clearInterval(a)}t+=parseFloat(i.floodSpeed)/10}}function w(){0!=p.length&&(o.hypsometricSetting={hypsometricSetting:u,analysisMode:SuperMap3D.HypsometricSettingEnum.AnalysisRegionMode.ARM_REGION})}return V.isViewer&&d(),e.watch((function(){return V.isViewer}),(function(e){e&&d()})),e.watch((function(){return V.changeLayers}),(function(e){d()})),e.onBeforeUnmount((function(){n=null,u.destroy(),c.destroy(),u=void 0,c=void 0})),e.watch((function(){return i.selectedLayerName}),(function(e){var t=i.layerNames.indexOf(e);-1!=t&&(o=n[t])})),e.watch((function(){return i.maxHeight}),(function(e){u.MaxVisibleValue=parseInt(e),w()})),e.watch((function(){return i.minHeight}),(function(e){u.MinVisibleValue=parseInt(e),i.currentHeight=parseInt(e),w()})),e.watch((function(){return i.floodHeight}),(function(e){i.minHeight=e[0],i.maxHeight=e[1]})),e.watch((function(){return i.floodTrans}),(function(e){u.Opacity=parseFloat(e),w()})),e.watch((function(){return i.cheackedBand}),(function(e){c=function(e){var t=new SuperMap3D.ColorTable;switch(e){case"band1":t.insert(500,new SuperMap3D.Color(0,39/255,148/255)),t.insert(0,new SuperMap3D.Color(149/255,232/255,249/255));break;case"band2":t.insert(500,new SuperMap3D.Color(162/255,251/255,194/255)),t.insert(0,new SuperMap3D.Color(1,103/255,103/255));break;case"band3":t.insert(500,new SuperMap3D.Color(230/255,198/255,1)),t.insert(0,new SuperMap3D.Color(157/255,0,1));break;case"band4":t.insert(500,new SuperMap3D.Color(210/255,15/255,15/255)),t.insert(100,new SuperMap3D.Color(221/255,224/255,7/255)),t.insert(50,new SuperMap3D.Color(20/255,187/255,18/255)),t.insert(4e3,new SuperMap3D.Color(0,161/255,1)),t.insert(0,new SuperMap3D.Color(9/255,9/255,212/255));break;case"band5":t.insert(500,new SuperMap3D.Color(186/255,1,229/255)),t.insert(0,new SuperMap3D.Color(26/255,185/255,156/255));break;default:t.insert(500,new SuperMap3D.Color(0,39/255,148/255)),t.insert(0,new SuperMap3D.Color(149/255,232/255,249/255))}return t}(e),u.ColorTable=c,w()})),s(s({},e.toRefs(i)),{},{floodClear:function(e){e.preventDefault(),o.hypsometricSetting.hypsometricSetting.MaxVisibleValue=-1e3,clearInterval(a),p=[],i.currentHeight=Number(i.floodHeight[0]),window.handlerPolygon&&pe("Polygon")},floodBegin:function(e){e.preventDefault(),u.DisplayMode=l,u._lineColor=new SuperMap3D.Color(1,0,0,1),u.MinVisibleValue=Number(i.floodHeight[0]),u.MaxVisibleValue=0,u.ColorTableMinKey=0,u.ColorTableMaxKey=200,u.ColorTable=c,u.Opacity=Number(i.floodTrans),u.LineInterval=10,window.handlerPolygon||ue("Polygon"),t&&t.floodPositions?f(t.floodPositions):(ce("Polygon",i.lineVisible).then((function(e){var t=window.handlerPolygon;f(e.positions),t.polygon.show=!1,t.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||y.Message.errorMsg(ie.NoPickPositionSupported))},changeColor:function(e){i.colorBandShow=!1,i.cheackedBand=e},floodPosition:p})},photography:function(t){var n=e.reactive({layerNames:[],selectedLayerName:"none",operationType:"Excavation",lineVisible:!0});if(t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:y.Message.errorMsg(ie.AttributeError+o);var i,r,a=[],l=[];function u(){viewer.scene,(i=viewer.scene.layers.layerQueue)&&i.length>0&&(i.forEach((function(e,t){n.layerNames.includes(e._name)||n.layerNames.push(e._name)})),(n.selectedLayerName="none")&&(n.selectedLayerName=n.layerNames[0],r=i[0]))}function c(e){e&&(a=e),r.addExcavationRegion({position:e,name:"excavation_"+Math.random()})}function p(e){e&&(l=e),r.addFlattenRegion({position:e,name:"flatten"+Math.random()})}return V.isViewer&&u(),e.watch((function(){return V.isViewer}),(function(e){e&&u()})),e.watch((function(){return V.changeLayers}),(function(e){u()})),e.watch((function(){return n.selectedLayerName}),(function(e){var t=n.layerNames.indexOf(e);-1!=t&&(r=i[t])})),e.onBeforeUnmount((function(){i=null})),s(s({},e.toRefs(n)),{},{startExcavation:function(e){e.preventDefault(),window.handlerPolygon||re("Polygon"),t&&t.excavationPositions?c(t.excavationPositions):(ae("Polygon",n.lineVisible).then((function(e){var t=window.handlerPolygon;c(e.positions),t.polygon.show=!1,t.polyline.show=!1,t.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||y.Message&&y.Message.errorMsg(ie.NoPickPositionSupported))},clearExcavation:function(e){e.preventDefault(),a=[],window.handlerPolygon&&(r.removeAllExcavationRegion(),se("Polygon"))},startFlatten:function(e){e.preventDefault(),window.handlerPolygon||re("Polygon"),t&&t.flattenPositions?p(t.flattenPositions):(ae("Polygon",n.lineVisible).then((function(e){var t=window.handlerPolygon;p(e.positions),t.polygon.show=!1,t.polyline.show=!1}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||y.Message&&y.Message.errorMsg(ie.NoPickPositionSupported))},clearFlatten:function(e){e.preventDefault(),window.handlerPolygon&&(r.removeAllFlattenRegion(),se("Polygon"))},excavationPositions:a,flattenPositions:l})},imglayerAttribute:function(t){var n,o,i=e.reactive({layerNames:[],selectedLayerName:"none",brightness:1,contrast:1,hue:0,saturation:1,gamma:1,alpha:1,transparentBackColor:"#eecccc",transparentBackColorTolerance:0});if(t)for(var r in t)i.hasOwnProperty(r)?i[r]=t[r]:y.Message.errorMsg(ie.AttributeError+r);function a(){viewer.scene,(n=viewer.imageryLayers._layers)&&n.length>1&&(n.forEach((function(e,t){var n=e._imageryProvider instanceof SuperMap3D.MvtProviderGL;if(0===t||n)return!0;i.layerNames.includes(e._imageryProvider.tablename)||i.layerNames.push(e._imageryProvider.tablename)})),(i.selectedLayerName="none")&&(i.selectedLayerName=i.layerNames[0],o=n[1]))}return V.isViewer&&a(),e.watch((function(){return V.isViewer}),(function(e){e&&a()})),e.watch((function(){return V.changeLayers}),(function(e){a()})),e.onBeforeUnmount((function(){n=null})),e.watch((function(){return i.selectedLayerName}),(function(e){var t=i.layerNames.indexOf(e);-1!=t&&(o=n[t+1])})),e.watch((function(){return i.brightness}),(function(e){o&&(o.brightness=Number(e))})),e.watch((function(){return i.contrast}),(function(e){o&&(o.contrast=Number(e))})),e.watch((function(){return i.hue}),(function(e){o&&(o.hue=Number(e))})),e.watch((function(){return i.saturation}),(function(e){o&&(o.saturation=Number(e))})),e.watch((function(){return i.gamma}),(function(e){o&&(o.gamma=Number(e))})),e.watch((function(){return i.alpha}),(function(e){o&&(o.alpha=Number(e))})),e.watch((function(){return i.transparentBackColor}),(function(e){var t=SuperMap3D.Color.fromCssColorString(e);o&&(o.transparentBackColor=t)})),e.watch((function(){return i.transparentBackColorTolerance}),(function(e){o&&(o.transparentBackColorTolerance=Number(e))})),s({},e.toRefs(i))},sceneAttribute:function(t){var n=e.reactive({earthShow:!0,shadows:!1,cloud:!1,skyBox:!1,sunShow:!1,timeline:!1,depthAgainst:!0,atomsphereRender:!0,fogEffect:!0,underground:!0,frameRate:!1,rain:!1,snow:!1,surfaceTransparency:1,cloudsUrl:"public/img/skyboxs/clouds/clouds1.png",skyboxSources:null,skyboxType:"bluesky",uspeed:0,vspeed:0,wspeed:.5,viewMode:"3D",rainAngle:45,rainSpeed:8,snowDesity:10,snowSpeed:4,snowAngle:10,snowType:"0",compass:!1,isCompass:""});if(n.skyboxSources={bluesky:{positiveX:"public/img/skyboxs/bluesky/Right.jpg",negativeX:"public/img/skyboxs/bluesky/Left.jpg",positiveY:"public/img/skyboxs/bluesky/Front.jpg",negativeY:"public/img/skyboxs/bluesky/Back.jpg",positiveZ:"public/img/skyboxs/bluesky/Up.jpg",negativeZ:"public/img/skyboxs/bluesky/Down.jpg"},sunsetglow:{positiveX:"public/img/skyboxs/sunsetglow/Right.jpg",negativeX:"public/img/skyboxs/sunsetglow/Left.jpg",positiveY:"public/img/skyboxs/sunsetglow/Front.jpg",negativeY:"public/img/skyboxs/sunsetglow/Back.jpg",positiveZ:"public/img/skyboxs/sunsetglow/Up.jpg",negativeZ:"public/img/skyboxs/sunsetglow/Down.jpg"}},t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:y.Message.errorMsg(ie.AttributeError+o);var i,r=new SuperMap3D.CloudBox({url:n.cloudsUrl}),a={};for(var l in n.skyboxSources){var u=new SuperMap3D.SkyBox({sources:n.skyboxSources[l]});u.USpeed=n.uspeed,u.VSpeed=n.vspeed,u.WSpeed=n.wspeed,a[l]=u}function c(){if(viewer.scene.frameState.passes.render){for(var e in a)a[e].update(viewer.scene.frameState,!0),a[e].show=!1;viewer.scene.postRender.removeEventListener(c)}}function p(){n.skyBox&&(viewer.scene.camera.positionCartographic.height>22e4?(viewer.scene.skyBox.show=!1,n.atomsphereRender=!0):(viewer.scene.skyBox.show=!0,n.atomsphereRender=!1))}V.isViewer&&(i=viewer.scene.skyBox,viewer.scene.postRender.addEventListener(c),viewer.scene.postProcessStages.snow.uniforms.density=parseFloat(n.snowDesity),viewer.scene.postProcessStages.snow.uniforms.speed=parseFloat(n.snowSpeed),viewer.scene.postProcessStages.rain.uniforms.speed=parseFloat(n.rainSpeed),p());for(var d=viewer.scene.layers.layerQueue,f=0;f<d.length;f++)d[f].shadowType=2;return e.watch((function(){return V.isViewer}),(function(e){e&&(i=viewer.scene.skyBox,viewer.scene.postRender.addEventListener(c),viewer.scene.postProcessStages.snow.uniforms.density=parseFloat(n.snowDesity),viewer.scene.postProcessStages.snow.uniforms.speed=parseFloat(n.snowSpeed),viewer.scene.postProcessStages.rain.uniforms.speed=parseFloat(n.rainSpeed),p())})),e.onBeforeUnmount((function(){for(var e in r.destroy(),a)a[e].destroy();viewer.scene.skyBox=i})),e.watch((function(){return n.earthShow}),(function(e){viewer.scene.globe.show=e})),e.watch((function(){return n.shadows}),(function(e){e?(viewer.shadows=!0,viewer.pcss=!0,viewer.shadowQuality=0,viewer.scene.shadowMap.maximumDistance=2e3,viewer.shadowMap.darkness=.4,viewer.shadowMap.penumbraRatio=.1):viewer.shadows=!1})),e.watch((function(){return n.sunShow}),(function(e){viewer.scene.globe.enableLighting=e})),e.watch((function(){return n.timeline}),(function(e){var t=document.getElementsByClassName("supermap3d-viewer-timelineContainer")[0];e?(t.style.visibility="visible",t.style["z-index"]=99999999999):t.style.visibility="hidden"})),e.watch((function(){return n.depthAgainst}),(function(e){viewer.scene.globe.depthTestAgainstTerrain=e})),e.watch((function(){return n.atomsphereRender}),(function(e){viewer.scene.skyAtmosphere.show=e})),e.watch((function(){return n.fogEffect}),(function(e){viewer.scene.fog.enabled=e})),e.watch((function(){return n.surfaceTransparency}),(function(e){viewer.scene.globe.globeAlpha=parseFloat(e)})),e.watch((function(){return n.underground}),(function(e){viewer.scene.undergroundMode=e,e?(viewer.scene.screenSpaceCameraController.minimumZoomDistance=-1e3,viewer.scene.terrainProvider.isCreateSkirt=!1):(viewer.scene.screenSpaceCameraController.minimumZoomDistance=1,viewer.scene.terrainProvider.isCreateSkirt=!0)})),e.watch((function(){return n.frameRate}),(function(e){viewer.scene.debugShowFramesPerSecond=e})),e.watch((function(){return n.cloud}),(function(e){viewer.scene.cloudBox=e?r:null})),e.watch((function(){return n.cloudsUrl}),(function(e){viewer.scene.cloudBox.url=e})),e.watch((function(){return n.skyBox}),(function(e){if(e){var t=viewer.scene.camera.positionCartographic.height;viewer.scene.postRender.addEventListener(p),viewer.scene.skyBox=a[n.skyboxType],t<22e4?(viewer.scene.skyBox.show=!0,n.atomsphereRender=!1):n.atomsphereRender=!0}else n.atomsphereRender=!0,viewer.scene.skyBox.show=!1,viewer.scene.skyBox=i,viewer.scene.postRender.removeEventListener(p)})),e.watch((function(){return n.skyboxType}),(function(e){n.skyBox&&(a[e].show=!0,viewer.scene.skyBox=a[e])})),e.watch((function(){return n.uspeed}),(function(e){a[n.skyboxType].USpeed=Number(e),n.skyBox&&(viewer.scene.skyBox.USpeed=Number(e))})),e.watch((function(){return n.vspeed}),(function(e){a[n.skyboxType].VSpeed=Number(e),n.skyBox&&(viewer.scene.skyBox.VSpeed=Number(e))})),e.watch((function(){return n.wspeed}),(function(e){a[n.skyboxType].WSpeed=Number(e),n.skyBox&&(viewer.scene.skyBox.WSpeed=Number(e))})),e.watch((function(){return n.viewMode}),(function(e){viewer.scene.mode="2D"===e?SuperMap3D.SceneMode.SCENE2D:"3D"===e?SuperMap3D.SceneMode.SCENE3D:SuperMap3D.SceneMode.COLUMBUS_VIEW})),e.watch((function(){return n.rain}),(function(e){viewer.scene.postProcessStages.rain.enabled=e})),e.watch((function(){return n.snow}),(function(e){viewer.scene.postProcessStages.snow.enabled=e,console.log(viewer.scene.postProcessStages.snow.uniforms)})),e.watch((function(){return n.rainAngle}),(function(e){viewer.scene.postProcessStages.rain.uniforms.angle=parseFloat(e)})),e.watch((function(){return n.rainSpeed}),(function(e){viewer.scene.postProcessStages.rain.uniforms.speed=parseFloat(e)})),e.watch((function(){return n.snowDesity}),(function(e){viewer.scene.postProcessStages.snow.uniforms.density=parseFloat(e)})),e.watch((function(){return n.snowSpeed}),(function(e){viewer.scene.postProcessStages.snow.uniforms.speed=parseFloat(e)})),e.watch((function(){return n.snowAngle}),(function(e){viewer.scene.postProcessStages.snow.uniforms.angle=parseFloat(e)})),e.watch((function(){return n.snowType}),(function(e){switch(e){case"0":n.snowDesity=5,n.snowSpeed=2;break;case"1":n.snowDesity=10,n.snowSpeed=4;break;case"2":n.snowDesity=15,n.snowSpeed=6;break;case"3":n.snowDesity=20,n.snowSpeed=10;break;default:n.snowDesity=5,n.snowSpeed=2}})),e.watch((function(){return n.isCompass}),(function(e){n.compass=e?"Sm3dCompass":""})),s({},e.toRefs(n))},facade:function(t){var n,o,i,r=e.reactive({maxDistance:200,maxHeight:100,setLodrange:!1,layerNames:[],selectedLayerName:"none",lodrange:.01});if(t)for(var a in t)r.hasOwnProperty(a)?r[a]=t[a]:y.Message.errorMsg(ie.AttributeError+a);function l(){viewer.scene,(o=viewer.scene.layers.layerQueue)&&o.length>0&&(o.forEach((function(e,t){r.layerNames.includes(e._name)||r.layerNames.push(e._name)})),(r.selectedLayerName="none")&&(r.selectedLayerName=r.layerNames[0],i=o[0]))}function u(){n.clear(),se("Polyline"),tooltip.setVisible(!1)}return V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element)),(n=new SuperMap3D.Facade(viewer.scene)).build(),l()),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)),(n=new SuperMap3D.Facade(viewer.scene)).build(),l())})),e.watch((function(){return V.changeLayers}),(function(e){l()})),e.onBeforeUnmount((function(){u(),n.destroy()})),e.watch((function(){return r.maxDistance}),(function(e){n.farDistance=Number(e)})),e.watch((function(){return r.maxHeight}),(function(e){n.maxHeight=Number(e)})),e.watch((function(){return r.selectedLayerName}),(function(e){var t=r.layerNames.indexOf(e);-1!=t&&(i=o[t])})),e.watch((function(){return r.lodrange}),(function(e){i&&i.setLodRangeScale(Number(e))})),e.watch((function(){return r.setLodrange}),(function(e){i&&(e?i.setLodRangeScale(Number(r.lodrange)):i.setLodRangeScale(1))})),s(s({},e.toRefs(r)),{},{setRegion:function(){tooltip.showAt(" <p>点击鼠标左键开始绘制起点</p><p>绘制两点确定区域宽度</p> <p>单击右键结束分析</p><p>设置模型精细度调整图片清晰度</p>","350px"),window.handlerPolyline||re("Polyline"),ae("Polyline").then((function(e){var t=e.result.object.positions[0],o=e.result.object.positions[1];n.startPoint=t,n.endPoint=o;var i=window.handlerPolyline;i.polyline.show=!1,window.polylineTransparent.show=!1,i.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()},execute:function(){n.readyPromise.then((function(e){!function(e){var t=new Image;t.src=e,t.onload=function(){var e=function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t}(t).toDataURL("image/jpeg"),n=document.createElement("a"),o=new MouseEvent("click");n.download=(new Date).getTime()+".jpg",n.href=e,n.dispatchEvent(o)}}(e)}))},clear:u})},compass:function(t){var n,o,i=e.reactive({resetPosition:"",isfull:!1});if(i.resetPosition=new SuperMap3D.Cartesian3.fromDegrees(110.60396458865515,34.54408834959379,30644793.325518917),t)for(var r in t)i.hasOwnProperty(r)?i[r]=t[r]:y.Message.errorMsg(ie.AttributeError+r);i.isfull&&w();var a,l,u=e.ref(null),c=!1;function p(){(o=new SuperMap3D.Cartesian2).x=n.canvas.clientWidth/2,o.y=n.canvas.clientHeight/2,n.postRender.addEventListener(d),window.addEventListener("resize",(function(){o.x=n.canvas.clientWidth/2,o.y=n.canvas.clientHeight/2}))}function d(){var e=n.camera.heading,t="rotate("+-SuperMap3D.Math.toDegrees(e)+"deg)";u.value.style.transform=t,c&&(e<=.05||e>=6.23)&&(n.camera.stopFlyCircle(),e=0,c=!1)}function f(){var e=n.pickPosition(o),t=viewer.camera.position,i=SuperMap3D.Cartesian3.distance(e,t);return i>=1e3?i/30:i>=20?i/20:i>0?.5:0}function w(){var e;document.fullscreenElement?(i.isfull=!1,document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()):(i.isfull=!0,(e=document.documentElement).requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen())}return V.isViewer&&(n=viewer.scene,p()),e.watch((function(){return V.isViewer}),(function(e){e&&(n=viewer.scene,p())})),e.onBeforeUnmount((function(){n.postRender.removeEventListener(d)})),s(s({},e.toRefs(i)),{},{compass_dom:u,reduceCompass:function(){var e=n.camera.heading,t=8;if(!(e<=.05||e>=6.23)){(e<=.5||e>=5.8)&&(t=2),c=!0;var i=n.pickPosition(o);if(n.camera.heading-SuperMap3D.Math.PI>=0)return n.camera.speedRatio=t,void n.camera.flyCircle(i);n.camera.speedRatio=-t,n.camera.flyCircle(i)}},reset:function(){viewer.camera.flyTo({destination:i.resetPosition})},fullscreenchange:w,zoomIn:function(){var e=10;clearInterval(a),a=setInterval((function(){e=f(),viewer.camera.zoomIn(e)}),30)},mouseup_zoomIn:function(){clearInterval(a)},zoomOut:function(){var e=10;clearInterval(l),l=setInterval((function(){e=f(),viewer.camera.zoomOut(e)}),30)},mouseup_zoomOut:function(){clearInterval(l)}})},flyRoute:function(t){var n,o,i=e.reactive({routeType:"designatedRoute",fileSrc:"",fpfUrl:null,selectedStopIndex:0,showRoute:!1,showStop:!1,currentStopNames:[],customRouteNames:[],customRouteSelectedIndex:null,routeStops:[],selectedAddedStopIndex:null,setStopName:"Stop-1",setStopSpeed:0,stopPlayMode:"StopPause",waitTime:0,surroundDuration:1,isAlongline:!1,routeSpeed:200});if(t)for(var r in t)i.hasOwnProperty(r)?i[r]=t[r]:y.Message.errorMsg(ie.AttributeError+r);var a,l,u=e.ref(null),c=new FileReader,p=[];function d(){o=new SuperMap3D.RouteCollection(viewer.entities),n=new SuperMap3D.FlyManager({scene:viewer.scene,routes:o}),l=new he,i.fpfUrl&&f()}function f(){n.stop(),o.fromFile(i.fpfUrl),n.readyPromise.then((function(){var e=n.currentRoute;e.isLineVisible=i.showRoute,e.isStopVisible=i.showStop,h()}))}function w(){o.readyPromise.then((function(){n.routes=o;var e=n.currentRoute;e.isLineVisible=i.showRoute,e.isStopVisible=i.showStop,h()}))}function h(){i.currentStopNames.length=0;for(var e=0,t=(a=n.getAllRouteStops()).length;e<t;e++){var o=a[e].stopName||"Stop"+(e+1);i.currentStopNames.push(o)}}function v(){if(n.stop(),!(p.length<1))if(p.splice(i.customRouteSelectedIndex,1),i.customRouteNames.splice(i.customRouteSelectedIndex,1),p.length>0)i.customRouteSelectedIndex=0;else{i.customRouteSelectedIndex=null,i.currentStopNames.length=0;var e=n.currentRoute;e&&e.clear()}}return V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element)),d()),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)),d())})),e.onMounted((function(){u.value.addEventListener("change",(function(e){n.stop();var t=n.currentRoute;t&&t.clear(),o=new SuperMap3D.RouteCollection(viewer.entities);var r=e.target.files[0];r&&(i.fileSrc=u.value.value,c.onload=function(e){var t=e.target.result;o.fromXML(t)},c.readAsBinaryString(r),w())}))})),e.watch((function(){return i.selectedStopIndex}),(function(e){n&&n.stop();var t=Number(e),o=a[t];n.viewToStop(o)})),e.watch((function(){return i.showRoute}),(function(e){var t=n.currentRoute;t&&(t.isLineVisible=e)})),e.watch((function(){return i.showStop}),(function(e){var t=n.currentRoute;t&&(t.isStopVisible=e)})),e.watch((function(){return i.fpfUrl}),(function(e){f()})),e.watch((function(){return i.customRouteSelectedIndex}),(function(e){if(null!==e){n&&n.stop();var t=n.currentRoute;t&&t.clear(),(o=new SuperMap3D.RouteCollection(viewer.entities)).fromXML(p[e]),w()}})),e.watch((function(){return i.selectedAddedStopIndex}),(function(e){var t=i.routeStops[e];t&&viewer.camera.setView({destination:SuperMap3D.Cartesian3.fromDegrees(t.point[0],t.point[1],t.point[2]),orientation:{heading:t.heading,pitch:t.tilt,roll:0}})})),e.watch((function(){return i.routeType}),(function(e){"customRoute"===e?(window.tooltip.showAt(" <p>调整当前相机位置和视角</p><p>以当前相机位置和视角设置站点</p><p>点击添加保存此站点</p>","80%"),setTimeout((function(){window.tooltip.setVisible(!1)}),5e3)):window.tooltip.setVisible(!1);var t=n.currentRoute;t&&(t.isLineVisible=!1,t.isStopVisible=!1)})),e.onBeforeUnmount((function(){i=null,n=o=null,a=null,l=p=null})),s(s({},e.toRefs(i)),{},{flyFile_dom:u,chooseFile:function(){u.value.click()},flyStart:function(){n.readyPromise.then((function(){n.play()}))},flyPause:function(){n&&n.pause()},flyStop:function(){n&&n.stop()},addStop:function(){n.stop();var e=viewer.camera.position,t=y.CartesiantoDegrees(e),o={stopName:i.setStopName,point:t,heading:viewer.camera.heading,tilt:viewer.camera.pitch,speed:i.setStopSpeed,stopPlayMode:i.stopPlayMode,surroundDuration:i.surroundDuration,waitTime:i.waitTime};if(i.routeStops.push(o),i.routeStops.length>0){var r=i.routeStops.length,a=i.routeStops[r-1].stopName.split("-")[1]||1,s="Stop-"+(Number(a)+1);i.setStopName=s}i.selectedAddedStopIndex=i.routeStops.length-1},saveStop:function(){if(i.routeStops.length<2)y.Message.warnMsg("节点小于2");else{p.length>0&&v();var e={routeName:"飞行路线_"+(p.length+1),speed:i.routeSpeed,isAlongLine:"False",routeStops:i.routeStops},t=l.createXMLflyLine(e);p.push(t),i.customRouteNames.push(e.routeName),null===i.customRouteSelectedIndex&&(i.customRouteSelectedIndex=0)}},restStops:function(){i.routeStops.length=0,i.setStopName="Stop-1",i.setStopSpeed=0,i.stopPlayMode="StopPause",i.waitTime=0,i.surroundDuration=1},downLoad:function(){var e=p[i.customRouteSelectedIndex];if(e){var t=new Blob([e]),n=document.createElement("a");n.download="fly-route.fpf",n.href=URL.createObjectURL(t),n.click()}},clearRoute:v,clearStop:function(){i.routeStops.splice(i.selectedAddedStopIndex,1),i.routeStops.length>0?i.selectedAddedStopIndex=i.routeStops.length-1:(i.selectedAddedStopIndex=null,i.setStopName="Stop-1")}})},drawLineSrface:function(t){var n=e.reactive({drawModle:"space",currentId:"1",config:ve,lineColor:"rgba(250, 196, 65, 1)",lineWidth:5,dottedColor:"rgba(250, 196, 65, 0)",dottedLength:30,outLineColor:"rgba(29, 206, 200, 1)",outLineWidth:2,glowStrength:.5,trailPercentage:.3,trailPeroid:2,isEdit:!0,isEditZ:!1,drawType:"polyline",solidColor:"rgba(250, 196, 65, 1)",gridColor:"rgba(250, 196, 65, 1)",gridWidth:1,gridCount:8,gridCellAlpha:.1,stripeEvenColor:"#FFFFFF",stripeOddColor:"#000000",stripeRepeat:12,stripeOffset:0,stripeOrientation:"horizontal"});if(t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:y.Message.errorMsg(ie.AttributeError+o);var i=void 0,r=void 0,a=!0,l=(SuperMap3D.ClassificationType.TERRAIN,void 0),u=void 0,c=void 0;function p(){window.handlerPolyline||re("Polyline"),window.tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>右键单击结束分析</p><p>选中对象进行编辑或清除</p>","50%"),ae("Polyline").then((function(e){!function(e){var t,o=SuperMap3D.Color.fromCssColorString(n.lineColor),a=Number(n.lineWidth);switch(n.currentId){case"1":t=o;break;case"2":var s=SuperMap3D.Color.fromCssColorString(n.dottedColor),u=Number(n.dottedLength);t=new SuperMap3D.PolylineDashMaterialProperty({color:o,gapColor:s,dashLength:u});break;case"3":var p=SuperMap3D.Color.fromCssColorString(n.outLineColor),d=Number(n.outLineWidth);t=new SuperMap3D.PolylineOutlineMaterialProperty({color:o,outlineWidth:d,outlineColor:p});break;case"4":t=new SuperMap3D.PolylineArrowMaterialProperty(o);break;case"5":var f=Number(n.glowStrength);t=new SuperMap3D.PolylineGlowMaterialProperty({glowPower:f,color:o});break;case"6":var w=Number(n.trailPercentage);t=new SuperMap3D.PolylineTrailMaterialProperty({color:o,trailLength:w,period:n.trailPeroid});break;default:t=o}l=viewer.entities.add({id:"polyline-symbol-line-"+(new Date).getTime(),polyline:{positions:e,width:a,material:t,clampToGround:i,classificationType:r,height:c}})}(e.result.object.positions);var t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()}function d(e){var t=viewer.scene.pick(e.message.position);t&&t.id&&t.id.id&&"string"==typeof t.id.id&&(-1!=t.id.id.indexOf("polyline-symbol-line")&&(l=t.id),-1!=t.id.id.indexOf("polygon-symbol-gon")&&(u=t.id))}function f(e,t,n){i=e,r=t,c=n,l&&(l.polyline.clampToGround=i,l.polyline.classificationType=r,l.polyline.height=n)}function w(e,t,n){a=e,r=t,c=n,u&&(u.polygon.perPositionHeight=a,u.classificationType=r,u.polygon.height=n)}return V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element)),viewer.eventManager.addEventListener("CLICK",d,!1),de()),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)),viewer.eventManager.addEventListener("CLICK",d,!1),de())})),e.onBeforeUnmount((function(){viewer&&viewer.eventManager.removeEventListener("CLICK",d)})),e.watch((function(){return n.drawModle}),(function(e){var t="polyline"===n.drawType;switch(e){case"space":t?f(void 0,void 0,void 0):w(!0,void 0,void 0);break;case"stick":t?f(!0,SuperMap3D.ClassificationType.TERRAIN,0):w(!1,SuperMap3D.ClassificationType.TERRAIN,0);break;case"postObject":t?f(!0,SuperMap3D.ClassificationType.S3M_TILE,void 0):w(!1,SuperMap3D.ClassificationType.S3M_TILE,void 0);break;default:f(void 0,void 0,void 0),w(!0,!1,void 0)}})),e.watch((function(){return n.lineColor}),(function(e){var t=SuperMap3D.Color.fromCssColorString(e);l&&(l.polyline.material.color=t)})),e.watch((function(){return n.lineWidth}),(function(e){l&&(l.polyline.width=Number(e))})),e.watch((function(){return n.dottedColor}),(function(e){var t=SuperMap3D.Color.fromCssColorString(e);l&&(l.polyline.material.gapColor=t)})),e.watch((function(){return n.dottedLength}),(function(e){l&&(l.polyline.material.dashLength=Number(e))})),e.watch((function(){return n.outLineColor}),(function(e){var t=SuperMap3D.Color.fromCssColorString(e);l&&(l.polyline.material.outlineColor=t)})),e.watch((function(){return n.outLineWidth}),(function(e){l&&(l.polyline.material.outlineWidth=Number(e))})),e.watch((function(){return n.glowStrength}),(function(e){l&&(l.polyline.material.glowPower=Number(e))})),e.watch((function(){return n.trailPercentage}),(function(e){l&&(l.polyline.material.trailLength=Number(e))})),e.watch((function(){return n.isEdit}),(function(e){l&&(e?de():fe())})),e.watch((function(){return n.isEditZ}),(function(e){l&&window.editHandler&&(window.editHandler.isEditZ=e)})),e.watch((function(){return n.drawType}),(function(e){n.currentId="1"})),e.watch((function(){return n.solidColor}),(function(e){var t=SuperMap3D.Color.fromCssColorString(e);u&&(u.polygon.material=t)})),e.watch((function(){return n.gridColor}),(function(e){var t=SuperMap3D.Color.fromCssColorString(e);u&&(u.polygon.material.color=t)})),e.watch((function(){return n.gridWidth}),(function(e){u&&(u.polygon.material.lineThickness=new SuperMap3D.Cartesian2(Number(e),Number(e)))})),e.watch((function(){return n.gridCount}),(function(e){u&&(u.polygon.material.lineCount=new SuperMap3D.Cartesian2(Number(e),Number(e)))})),e.watch((function(){return n.gridCellAlpha}),(function(e){u&&(u.polygon.material.cellAlpha=Number(e))})),e.watch((function(){return n.stripeEvenColor}),(function(e){var t=SuperMap3D.Color.fromCssColorString(e);u&&(u.polygon.material.evenColor=t)})),e.watch((function(){return n.stripeOddColor}),(function(e){var t=SuperMap3D.Color.fromCssColorString(e);u&&(u.polygon.material.oddColor=t)})),e.watch((function(){return n.stripeRepeat}),(function(e){u&&(u.polygon.material.repeat=Number(e))})),e.watch((function(){return n.stripeOffset}),(function(e){u&&(u.polygon.material.offset=Number(e))})),e.watch((function(){return n.stripeOrientation}),(function(e){if(u){var t="horizontal"===e?0:1;u.polygon.material.orientation=t}})),s(s({},e.toRefs(n)),{},{draw:function(){"polyline"===n.drawType?p():function(){window.handlerPolygon||re("Polygon");ae("Polygon",!1).then((function(e){var t=window.handlerPolygon;!function(e){var t;switch(console.log(e),n.currentId){case"1":t=SuperMap3D.Color.fromCssColorString(n.solidColor);break;case"2":var o=SuperMap3D.Color.fromCssColorString(n.gridColor),i=Number(n.gridWidth),s=Number(n.gridCount),l=Number(n.gridCellAlpha);t=new SuperMap3D.GridMaterialProperty({color:o,cellAlpha:l,lineCount:new SuperMap3D.Cartesian2(s,s),lineThickness:new SuperMap3D.Cartesian2(i,i)});break;case"3":var p=SuperMap3D.Color.fromCssColorString(n.stripeEvenColor),d=SuperMap3D.Color.fromCssColorString(n.stripeOddColor),f=Number(n.stripeRepeat),w=Number(n.stripeOffset);t=new SuperMap3D.StripeMaterialProperty({evenColor:p,oddColor:d,repeat:f,offset:w,orientation:"horizontal"===n.stripeOrientation?0:1})}u=viewer.entities.add({id:"polygon-symbol-gon-"+(new Date).getTime(),polygon:{hierarchy:{positions:e},material:t,perPositionHeight:a,groundBottomAltitude:0,groundExtrudedHeight:100},classificationType:r,height:c})}(e.result.object.positions),t.polygon.show=!1,t.polyline.show=!1,t.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate()}()},changeSelect:function(e){n.currentId=e},clear:function(){l&&"polyline"===n.drawType&&viewer.entities.removeById(l.id),u&&"polygon"===n.drawType&&viewer.entities.removeById(u.id),window.tooltip.setVisible(!1),se("Polyline"),se("Polygon"),window.editHandler&&window.editHandler.clear(),n.isEdit=!1,n.isEditZ=!1}})},symbol:function(t){var n=e.reactive({selectedTypeId:0,selectedSymbolId:0,symbolColor:"#ffffff",space:10,density:100,addType:"single"});if(t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:y.Message.errorMsg(ie.AttributeError+o);var i,r,a,l=me[n.selectedTypeId].data,u=null,c=!1,p=[],d=!1,f=!0;function w(e){if(!c){if(d){tooltip.setVisible(!1),viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");var t=scene.pickPosition(e.message.position),o=SuperMap3D.Color.fromCssColorString(n.symbolColor),a="symbol-"+me[n.selectedTypeId].id+"-"+l[n.selectedSymbolId].id+"-"+(new Date).getTime(),s=l[n.selectedSymbolId].path;return i.add(s,{id:a,position:t,color:o}),p.includes(s)||p.push(s),void(d=!1)}var f=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(f&&f.id&&"string"==typeof f.id&&-1!=f.id.indexOf("symbol-")){if(u&&u.id===f.id)return;return r&&r.destroy(),u=f,void(r=new SuperMap3D.ModelEditor({model:u.primitive,scene:viewer.scene})).activate()}r&&r.destroy(),r=null,u=null}}function h(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),d=!0}function v(){c=!0,window.handlerPolyline||re("Polyline"),ae("Polyline").then((function(e){!function(e,t){for(var o=[],r=1,a=t.positions.length;r<a;r++)for(var s=t.positions[r-1],u=t.positions[r],d=SuperMap3D.Cartesian3.distance(s,u),f=m(parseInt(d)),w=1,h=f;w<=h;w++)o.push(SuperMap3D.Cartesian3.lerp(s,u,w/f,new SuperMap3D.Cartesian3));viewer.scene.clampToHeightMostDetailed(o).then((function(e){c=!1;var t=SuperMap3D.Color.fromCssColorString(n.symbolColor),o="symbol-"+me[n.selectedTypeId].id+"-"+l[n.selectedSymbolId].id+"-",r=l[n.selectedSymbolId].path;p.includes(r)||p.push(r);for(var a=0,s=e.length;a<=s;a++)i.add(r,{id:o+(new Date).getTime()+a,position:e[a],color:t})}))}(0,e.result.object);var t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()}function m(e){var t=Number(n.space);return parseInt(e/t)+1}return V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element)),i=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(i),a=new ye),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)),i=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(i),a=new ye)})),e.onBeforeUnmount((function(){l.length=0,i=null,u=null,r&&r.destroy(),p.length=0})),e.watch((function(){return n.selectedTypeId}),(function(e){l=me[n.selectedTypeId].data})),e.watch((function(){return n.symbolColor}),(function(e){var t=SuperMap3D.Color.fromCssColorString(e);if(u){var n=u.primitive,o=u.id;n.updateColor(t,o)}})),s(s({},e.toRefs(n)),{},{s3mModels:me,changeSelect:function(e){n.selectedSymbolId=e},clear:function(){if(u){var e=u.id,t=e.split("-"),n=me[t[1]].data[t[2]].path;n&&(i.removeInstance(n,e),u=null)}else p.forEach((function(e){i.removeCollection(e)})),p.length=0;0===p.length&&viewer.eventManager.removeEventListener("CLICK",w),r&&r.destroy(),r=null,window.tooltip.setVisible(!1),se("Polyline"),se("Polygon"),d=!1,viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur")},statrtAdd:function(){switch(f&&(window.tooltip.showAt("<p>选中模型可以编辑和清除选中模型</p><p>未选中模型时清除所有</p>","420px"),f=!1),viewer.eventManager.addEventListener("CLICK",w,!0),n.addType){case"single":h();break;case"line":v();break;case"face":c=!0,window.handlerPolygon||re("Polygon"),ae("Polygon",!1).then((function(e){tooltip.setVisible(!1);var t=window.handlerPolygon;t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),a.initPolygonEmitter(e.result.object.positions);var o=SuperMap3D.Color.fromCssColorString(n.symbolColor),r="symbol-"+me[n.selectedTypeId].id+"-"+l[n.selectedSymbolId].id+"-",s=l[n.selectedSymbolId].path;p.includes(s)||p.push(s);for(var u=Number(n.density),d=0;d<u;d++){var f=a.getOneRandomPosition();i.add(s,{id:r+(new Date).getTime()+d,position:f,color:o})}c=!1}),(function(e){console.log(e)})),window.handlerPolygon.activate();break;default:h()}}})},light:function(t){var n,o,i,r=e.reactive({lightSelectId:0,lightColor:"#FFFFFF",cutoffDistance:200,lightDecay:5,lightIntensity:5,spotLightAngle:30,visibleModel:!0,dockFontShow:!0,modelPosition:[0,0,0],modelLongitude:"",modelLatitude:"",modelHeight:"",bubbleShow:!1,visiblePositions:!1});if(t)for(var a in t)r.hasOwnProperty(a)?r[a]=t[a]:y.Message.errorMsg(ie.AttributeError+a);var l,u=!1,c=new Map,p="public/data/s3m/light.s3m",d=e.ref(null);function f(e,t){var o="light-model-"+(new Date).getTime();i.add(p,{id:o,position:e,scale:new SuperMap3D.Cartesian3(2,2,2)}),n=i.getInstance(p,o),c.set(o,t)}V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element)),i=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(i)),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)),i=new SuperMap3D.S3MInstanceCollection(scene._context),viewer.scene.primitives.add(i))}));var w,h=!1;function v(){window.handlerPolyline||re("Polyline"),ae("Polyline").then((function(e){var t,n,i,a,s;1===r.lightSelectId?(t=e.result.object.positions,n=g(t[0]),i=t[1],a={color:SuperMap3D.Color.fromCssColorString(r.lightColor),distance:Number(r.cutoffDistance),decay:Number(r.lightDecay),intensity:Number(r.lightIntensity),angle:SuperMap3D.Math.toRadians(Number(r.spotLightAngle))},s=new SuperMap3D.SpotLight(n,i,a),o=s,viewer.scene.addLightSource(s),f(n,s)):function(e){var t=g(e[0]),n={targetPosition:e[1],color:SuperMap3D.Color.fromCssColorString(r.lightColor),intensity:Number(r.lightIntensity)},i=new SuperMap3D.DirectionalLight(t,n);o=i,viewer.scene.addLightSource(i),f(t,i)}(e.result.object.positions);var l=window.handlerPolyline;l.polyline.show=!1,window.polylineTransparent.show=!1,l.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()}function m(e){if(u){u=!1,viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),!function(e){var t=g(e),n={color:SuperMap3D.Color.fromCssColorString(r.lightColor),cutoffDistance:Number(r.cutoffDistance),decay:Number(r.lightDecay),intensity:Number(r.lightIntensity)},i=new SuperMap3D.PointLight(t,n);o=i,viewer.scene.addLightSource(i),f(t,i)}(scene.pickPosition(e.message.position)),tooltip.setVisible(!1)}else{var t=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(t&&t.id&&"string"==typeof t.id&&-1!=t.id.indexOf("light-model-")){var i;if(n&&n.id===t.id.id)return;n=t,o=c.get(t.id),l?l.setEditObject(t.primitive):(s=t.primitive,(l=new SuperMap3D.ModelEditor({model:s,scene:viewer.scene,axesShow:{translation:!0,rotation:!1,scale:!0}})).activate(),l.changedEvt.addEventListener((function(e){var t=new SuperMap3D.Cartesian3;if(SuperMap3D.Matrix4.getTranslation(e.modelMatrix,t),t){var n;o.position=t,h=!0,M((function(){return h=!1}));var i=y.CartesiantoDegrees(t);r.modelPosition.length=0,(n=r.modelPosition).push.apply(n,[i[0].toFixed(6),i[1].toFixed(6),i[2].toFixed(2)])}}))),d.value.style.top=e.message.position.y-160+"px",d.value.style.left=e.message.position.x+"px",console.log(l);var a=y.CartesiantoDegrees(l._position);return r.modelPosition.length=0,(i=r.modelPosition).push.apply(i,[a[0].toFixed(6),a[1].toFixed(6),a[2].toFixed(2)]),void(r.bubbleShow=!0)}n=void 0,o=void 0,l&&l.deactivate(),r.bubbleShow=!1}var s}function g(e){var t=SuperMap3D.Cartographic.fromCartesian(e);return t.height+=.5,SuperMap3D.Cartographic.toCartesian(t)}function S(){r.bubbleShow=!1}function M(e){w&&clearTimeout(w),w=setTimeout((function(){e()}),1e3)}return e.watch((function(){return r.lightColor}),(function(e){if(o){var t=SuperMap3D.Color.fromCssColorString(e);o.color=t}})),e.watch((function(){return r.cutoffDistance}),(function(e){o&&(1!==o.lightType?2!==o.lightType||(o.distance=Number(e)):o.cutoffDistance=Number(e))})),e.watch((function(){return r.lightDecay}),(function(e){o&&0!==o.lightType&&(o.decay=Number(e))})),e.watch((function(){return r.lightIntensity}),(function(e){o&&(o.intensity=Number(e))})),e.watch((function(){return r.spotLightAngle}),(function(e){o&&2===o.lightType&&(o.angle=SuperMap3D.Math.toRadians(Number(e)))})),e.watch((function(){return r.visibleModel}),(function(e){n&&(l&&l.deactivate(),i.visible=e)})),e.watch((function(){return r.modelPosition}),(function(e){n&&!h&&M((function(){var t=Number(e[0]),i=Number(e[1]),r=Number(e[2]),a=SuperMap3D.Cartesian3.fromDegrees(t,i,r);o.position=a,n.primitive.updatePosition(a),l&&l.setEditObject(n.primitive)}))}),{deep:!0}),e.onBeforeUnmount((function(){})),s(s({},e.toRefs(r)),{},{config:ge,addLight:function(){var e=0===r.lightSelectId?"<p>点击确认点光源位置</p><p>选中光源模型可编辑与删除</p>":"<p>点击第一点确认光源位置</p><p>第二点确认光源方向</p><p>选中光源模型可编辑与删除</p>";if(window.tooltip.showAt(e,"400px"),viewer.eventManager.addEventListener("CLICK",m,!0),0===r.lightSelectId)return viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),void(u=!0);v()},clearLight:function(){n&&(c.delete(n.id),i.removeInstance(p,n.id),n=null),o&&viewer.scene.removeLightSource(o),0===c.size&&viewer.eventManager.removeEventListener("CLICK",m),l&&l.deactivate(),u=!1,o=null,se(),viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur"),tooltip.setVisible(!1),S()},bubble:d,closeBubble:S,dockBubble:function(e){e?(d.value.classList.add("bubbleDock"),r.dockFontShow=!1):(d.value.classList.remove("bubbleDock"),r.dockFontShow=!0)}})},projection:function(t){var n,o,i,r=e.reactive({viewlongitude:"",viewlatitude:"",viewheight:"",direction:"",pitch:"",horizontal:20,vertical:10,distance:200,hintLineColor:"rgba(251,250,248,1)",clipMode:"clip-inside",visibleLine:!0,fileText:"",fromInfo:null});if(t)for(var a in t)r.hasOwnProperty(a)?r[a]=t[a]:y.Message.errorMsg(ie.AttributeError+a);var l,u,c,p=e.ref(null),d=new Map,f="public/data/s3m/projector.s3m",w=!1,h=null,v=new FileReader,m=!1;function g(e,t){return new Promise((function(n,o){var i=document.getElementById("videoContain"),r=document.createElement("video"),a=document.createElement("source");a.src=e,r.appendChild(a),r.id="trailer-"+t,r.classList.add("videoBox"),r.setAttribute("autoplay","autoplay"),r.setAttribute("loop","loop"),r.setAttribute("crossorigin","crossorigin"),r.setAttribute("controls","controls"),r.setAttribute("muted","muted"),i.appendChild(r),setTimeout((function(){n(r)}),500)}))}function S(e){if(!m){if(w){viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");var t=SuperMap3D.Cartesian3.fromDegrees(i.viewPosition[0],i.viewPosition[1],i.viewPosition[2]),n=JSON.parse(JSON.stringify(t));return viewer.eventManager.removeEventListener("MOUSE_MOVE",M),o=n,a="projector-"+(new Date).getTime(),s=i.direction,c=i.pitch,p=SuperMap3D.Math.toRadians(s),v=p>=SuperMap3D.Math.PI?p-SuperMap3D.Math.PI:p+SuperMap3D.Math.PI,y=-SuperMap3D.Math.toRadians(c),l.add(f,{id:a,position:o,hpr:{heading:v,pitch:0,roll:y}}),h=l.getInstance(f,a),d.set(a,i),void(w=!1)}var o,a,s,c,p,v,y,g=viewer.scene.pick(e.message.position)||viewer.selectedEntity;if(g&&g.id&&"string"==typeof g.id&&-1!=g.id.indexOf("projector-"))return u&&u.destroy(),h=g,void((i=d.get(g.id))&&(r.horizontal=i.horizontalFov,r.vertical=i.verticalFov,r.distance=i.distance));h=null,i=null}}function M(e){var t=0,n=viewer.scene.camera.position,r=o.pickPosition(e.message.endPosition);r&&(t=SuperMap3D.Cartesian3.distance(n,r)),t>0&&t<1e3&&i.setDistDirByPoint(y.CartesiantoDegrees(r))}return V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element)),o=viewer.scene,n=viewer.scene.layers.layerQueue,l=new SuperMap3D.S3MInstanceCollection(o._context),viewer.scene.primitives.add(l),viewer.eventManager.addEventListener("CLICK",S,!0)),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)),o=viewer.scene,n=viewer.scene.layers.layerQueue,l=new SuperMap3D.S3MInstanceCollection(o._context),viewer.scene.primitives.add(l))})),e.watch((function(){return V.changeLayers}),(function(e){for(var t=0;t<n.length;t++)n[t].selectEnabled=!1})),e.onMounted((function(){p.value.addEventListener("change",(function(e){var t=e.target.files[0];if(t){r.fileText=p.value.value;var n=new Blob([t],{type:"video/mp4"});v.readAsDataURL(n),v.onload=function(e){var t=e.target.result,n=document.querySelectorAll("#videoContain>video").length;g(t,n).then((function(e){c=document.getElementById("trailer-"+n)}))}}})),c=document.getElementById("trailer-0")})),e.watch((function(){return r.fileText}),(function(e){if(-1!==e.indexOf("http")){var t=document.querySelectorAll("#videoContain>video").length;g(e,t).then((function(e){c=document.getElementById("trailer-"+t)}))}})),e.watch((function(){return r.horizontal}),(function(e){""!=e&&i&&(i.horizontalFov=Number(e))})),e.watch((function(){return r.vertical}),(function(e){""!=e&&i&&(i.verticalFov=Number(e))})),e.watch((function(){return r.distance}),(function(e){""!=e&&i&&(i.distance=Number(e))})),e.watch((function(){return r.visibleLine}),(function(e){i&&(l.visible=e,d.forEach((function(t){t.hintLineVisible=e})))})),e.watch((function(){return r.hintLineColor}),(function(e){i&&(i.hintLineColor=SuperMap3D.Color.fromCssColorString(e))})),e.watch((function(){return r.clipMode}),(function(e){if(i){var t="clip-outside"===e?SuperMap3D.ModifyRegionMode.CLIP_INSIDE:SuperMap3D.ModifyRegionMode.CLIP_OUTSIDE;i.setClipMode(t)}})),e.watch((function(){return r.viewlongitude}),(function(e){i&&""!=e&&(i.viewPosition[0]=e)})),e.watch((function(){return r.viewlatitude}),(function(e){i&&""!=e&&(i.viewPosition[1]=e)})),e.watch((function(){return r.viewheight}),(function(e){i&&""!=e&&(i.viewPosition[2]=e)})),e.watch((function(){return r.direction}),(function(e){i&&""!=e&&(i.direction=Number(e))})),e.watch((function(){return r.pitch}),(function(e){i&&""!=e&&(i.pitch=Number(e))})),e.watch((function(){return r.fromInfo}),(function(e){e&&""!=e&&SuperMap3D.ProjectionImage.fromInfo(o,r.fromInfo.infoUrl,r.fromInfo.baseUrl)})),e.onBeforeUnmount((function(){for(var e=0;e<n.length;e++)n[e].selectEnabled=!0})),s(s({},e.toRefs(r)),{},{chooseFile:function(){p.value.click()},vedioFile_dom:p,startProjection:function(){viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur");var e=viewer.scene.camera.position;c.play(),(i=new SuperMap3D.ProjectionImage(o)).setImage({video:c}),i.distance=Number(r.distance),i.horizontalFov=Number(r.horizontal),i.verticalFov=Number(r.vertical),i.viewPosition=y.CartesiantoDegrees(e),i.build(),w=!0,window.tooltip.showAt(" <p>选中投放模型进行编辑和清除</p>","400px"),viewer.eventManager.addEventListener("MOUSE_MOVE",M),viewer.eventManager.addEventListener("CLICK",S,!0)},clear:function(){viewer.eventManager.removeEventListener("MOUSE_MOVE",M),h&&(d.delete(h.id),l.removeInstance(f,h.id),h=null),i&&(i.removeAllClipRegion(),i.destroy()),0===d.size&&viewer.eventManager.removeEventListener("CLICK",S),u&&u.destroy(),u=null,i=null,window.tooltip.setVisible(!1),se(),viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur")},clipProjectImg:function(){m=!0,tooltip.setVisible(!1),window.tooltip.showAt(" <p>点击鼠标左键绘制裁剪区域</p><p>点击鼠标右键结束绘制</p><p>注：只能裁剪当前选中投放对象</p>","400px"),window.handlerPolygon||re("Polygon"),ae("Polygon").then((function(e){m=!1;var t=window.handlerPolygon;!function(e){if(!i)return;i.addClipRegion({name:"clip-Projector"+(new Date).getTime(),position:e})}(e.positions),t.polygon.show=!1,t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate()}})},scanEffect:function(n){var o=e.reactive({scanMode:"lineMode",scanColor:"#0F7AF4",scanTextures:[],selectedTextureIndex:0,bloomShow:!1,openHDR:!1,threshold:.01,intensity:.5,lineWidth:100,period:3,speed:100,addTextures:null,scanShow:!1});if(n)for(var i in n)o.hasOwnProperty(i)?o[i]=n[i]:y.Message.errorMsg(ie.AttributeError+i);var r=[{name:"无纹理",type:"line",url:""}],a=[{name:"无纹理",type:"ring",url:""}];function l(e){for(var t=0;t<e.length;t++)"line"===e[t].type?r.push(e[t]):a.push(e[t]);o.scanTextures="lineMode"===o.scanMode?r:a}function u(){viewer.scene.scanEffect.color=SuperMap3D.Color.fromCssColorString(o.scanColor),viewer.scene.scanEffect.textureUrl="",viewer.scene.scanEffect.lineWidth=Number(o.lineWidth),viewer.scene.scanEffect.period=Number(o.period),viewer.scene.scanEffect.speed=Number(o.speed),viewer.scene.scanEffect.centerPostion=new SuperMap3D.Cartesian3.fromDegrees(0,0,0)}function c(){window.handlerPolyline||re("Polyline"),window.tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>绘制两点确定扫描线方向</p><p>鼠标右键结束绘制</p>","350px"),ae("Polyline").then((function(e){!function(e){var t=new SuperMap3D.Cartesian3;if(SuperMap3D.Cartesian3.subtract(e[1],e[0],t),o.scanShow)return viewer.scene.scanEffect.add(e[0]),void(viewer.scene.scanEffect.lineMoveDirection=t);viewer.scene.scanEffect.centerPostion=e[0],viewer.scene.scanEffect.lineMoveDirection=t,o.scanShow=!0}(e.result.object.positions);var t=window.handlerPolyline;t.polyline.show=!1,window.polylineTransparent.show=!1,t.deactivate(),tooltip.setVisible(!1)}),(function(e){console.log(e)})),window.handlerPolyline.activate()}function p(e){viewer.enableCursorStyle=!0,document.body.classList.remove("measureCur");var t=viewer.scene.pickPosition(e.message.position);o.scanShow?viewer.scene.scanEffect.add(t):(viewer.scene.scanEffect.centerPostion=t,o.scanShow=!0,viewer.eventManager.removeEventListener("CLICK",p))}return l(Se),V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element)),u()),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)),u())})),e.watch((function(){return o.scanShow}),(function(e){viewer.scene.scanEffect.show=e})),e.watch((function(){return o.scanMode}),(function(e){if("lineMode"===e)return viewer.scene.scanEffect.mode=SuperMap3D.ScanEffectMode.LINE,void(o.scanTextures=r);viewer.scene.scanEffect.mode=SuperMap3D.ScanEffectMode.CIRCLE,o.scanTextures=a})),e.watch((function(){return o.scanColor}),(function(e){viewer.scene.scanEffect.color=SuperMap3D.Color.fromCssColorString(e)})),e.watch((function(){return o.selectedTextureIndex}),(function(e){viewer.scene.scanEffect.textureUrl=o.scanTextures[e].url})),e.watch((function(){return o.scanTextures}),(function(e){o.selectedTextureIndex=0})),e.watch((function(){return o.bloomShow}),(function(e){viewer.scene.bloomEffect.show=e,viewer.scene.bloomEffect.threshold=Number(o.threshold),viewer.scene.bloomEffect.bloomIntensity=Number(o.intensity)})),e.watch((function(){return o.openHDR}),(function(e){viewer.scene.hdrEnabled=e})),e.watch((function(){return o.threshold}),(function(e){viewer.scene.bloomEffect.threshold=Number(e)})),e.watch((function(){return o.intensity}),(function(e){viewer.scene.bloomEffect.bloomIntensity=Number(e)})),e.watch((function(){return o.lineWidth}),(function(e){viewer.scene.scanEffect.lineWidth=Number(e)})),e.watch((function(){return o.period}),(function(e){viewer.scene.scanEffect.period=Number(e)})),e.watch((function(){return o.speed}),(function(e){viewer.scene.scanEffect.speed=Number(e)})),e.watch((function(){return o.scanShow}),(function(e){viewer.scene.scanEffect.scanShow=e})),e.watch((function(){return o.addTextures}),(function(e){"object"===t(e)?l(e):console.log("addTextures类型不是数组！")})),e.onBeforeUnmount((function(){})),s(s({},e.toRefs(o)),{},{addScans:function(){"lineMode"!==o.scanMode?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),viewer.eventManager.addEventListener("CLICK",p,!0)):c()},clear:function(){o.scanShow=!1;for(var e=viewer.scene.scanEffect.count,t=0;t<e;t++)viewer.scene.scanEffect.remove(t);viewer.eventManager.removeEventListener("CLICK",p),se("Polyline")}})},geologicalBody:function(t){var n=e.reactive({operationType:"stretch_cut",stretchHeight:1,modelUrls:null,digHeight:500,drillRadius:400,drillHeight:2e3,clipType:"drawClip",drawClipMode:"KeepInside"});if(n.modelUrls=[{id:1,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer1/features/1.stream",color:new SuperMap3D.Color(179/255,179/255,179/255,1)},{id:2,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer2/features/1.stream",color:new SuperMap3D.Color(94/255,179/255,59/255,1)},{id:3,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer3/features/1.stream",color:new SuperMap3D.Color(52/255,94/255,35/255,1)},{id:4,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer4/features/1.stream",color:new SuperMap3D.Color(115/255,115/255,115/255,1)},{id:5,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer5/features/1.stream",color:new SuperMap3D.Color(171/255,85/255,66/255,1)},{id:6,model:"http://www.supermapol.com/realspace/services/data-dizhiti/rest/data/datasources/%E5%9C%B0%E8%B4%A8%E4%BD%93/datasets/Layer6/features/1.stream",color:new SuperMap3D.Color(68/255,68/255,68/255,1)}],t)for(var o in t)n.hasOwnProperty(o)?n[o]=t[o]:y.Message.errorMsg(ie.AttributeError+o);var i,r,a,l,u=[],c=0,p=[];function d(){(i=viewer.scene).logarithmicDepthBuffer=!0,i.camera.frustum.near=.1,i.globe.show=!1,viewer.scene.skyAtmosphere.show=!1,(r=new SuperMap3D.SolidModelsProfile(i)).addModels(n.modelUrls),console.log(r),r.addedEvent.addEventListener((function(e){console.log(r._s3mInstanceCollection.getInstance(n.modelUrls[2].model,3))})),viewer.scene.camera.setView({destination:new SuperMap3D.Cartesian3(-2167835.4408299956,4423497.534529096,4095839.2845661934),orientation:{heading:4.029329438295484,pitch:-.23796647219353817,roll:8.994289757424667e-10}})}function f(){tooltip.setVisible(!1),r.clearProfile(),se("Polyline"),u.forEach((function(e){viewer.entities.removeById(e)})),u.length=0}function w(){window.handlerPolygon||re("Polygon"),ae("Polygon",!1).then((function(e){var t=window.handlerPolygon;!function(e){var t=new SuperMap3D.Point3Ds;y.CartesiantoDegreesObjs(e).forEach((function(e){var n=new SuperMap3D.Point3D(e.longitude,e.latitude,e.height+1e3);t.add(n)}));var o=new SuperMap3D.GeoRegion3D([t]);if("dig"===n.operationType){r.clippingType=SuperMap3D.ClippingType.KeepOutside,o.extrudedHeight=-Number(n.digHeight);var i=new SuperMap3D.GeoRegion3D([t]);i.isLatLon=!1,i.bottomAltitude=o.extrudedHeight,r.addProfileGeometry(i)}else o.extrudedHeight=-7e3;o.isLatLon=!1,r.setClipGeometry(o);for(var a=0;a<e.length;a++){var s=[];s.push(e[a]),a==e.length-1?s.push(e[0]):s.push(e[a+1]),r.addProfileGeometry(s),r.build()}}(e.result.object.positions),t.polygon.show=!1,t.polyline.show=!1,t.deactivate()}),(function(e){console.log(e)})),window.handlerPolygon.activate()}function v(){tooltip.setVisible(!1),r.clearProfile(),se()}function m(e){var t=viewer.scene.pickPosition(e.message.position);!function(e){c++,viewer.entities.add({id:"Drill_Point-"+c,position:e,cylinder:{length:100,topRadius:Number(n.drillRadius),bottomRadius:Number(n.drillRadius),material:SuperMap3D.Color.fromCssColorString("#d60000")}})}(t),p.push(t)}function g(e){window.tooltip.setVisible(!1),document.body.classList.remove("measureCur"),y.CartesiantoDegreesObjs(p).forEach((function(e){var t=new SuperMap3D.GeoCylinder(Number(n.drillRadius),Number(n.drillRadius),Number(n.drillHeight)),o=Number(n.drillHeight)/2;t.geoPosition=new SuperMap3D.Point3D(e.longitude,e.latitude,e.height-o),r.addProfileGeometry(t)}));for(var t=1;t<=c;t++)viewer.entities.removeById("Drill_Point-"+t);r.build(),viewer.eventManager.removeEventListener("CLICK",m),viewer.eventManager.removeEventListener("RIGHT_CLICK",g)}function S(){tooltip.setVisible(!1),r.clearProfile(),document.body.classList.remove("measureCur");for(var e=1;e<=c;e++)viewer.entities.removeById("Drill_Point-"+e);viewer.eventManager.removeEventListener("CLICK",m),viewer.eventManager.removeEventListener("RIGHT_CLICK",g),c=0,p.length=0}function M(){v(),se("Box"),a&&(a.deactivate(),a.destroy(),a=null)}function b(){f(),M(),S()}return V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element)),d()),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)),d())})),e.watch((function(){return n.modelUrls}),(function(e){r.addModels(e)})),e.watch((function(){return n.stretchHeight}),(function(e){if(n.modelUrls&&0!=n.modelUrls.length){var t,o=h(n.modelUrls);try{for(o.s();!(t=o.n()).done;){var i=t.value.model;r._s3mInstanceCollection._group[i].instances._array[0].updateScale(new SuperMap3D.Cartesian3(1,1,Number(e)))}}catch(e){o.e(e)}finally{o.f()}}})),e.watch((function(){return n.operationType}),(function(e){b()})),e.watch((function(){return n.drawClipMode}),(function(e){r.clippingType=SuperMap3D.ClippingType[e]})),e.watch((function(){return n.clipType}),(function(e){M()})),e.onBeforeUnmount((function(){r.clear(),viewer.scene.globe.show=!0,viewer.scene.skyAtmosphere.show=!0,b(),i=null,r=null,l=null})),s(s({},e.toRefs(n)),{},{drawLine:function(){window.handlerPolyline||re("Polyline"),window.tooltip.showAt(" <p>点击鼠标左键开始绘制</p><p>鼠标右键结束绘制</p><p>可以绘制多条线段</p>","350px"),ae("Polyline").then((function(e){!function(e){var t=[];if(e.length<2)return;for(var n=0;n<e.length-1;n++)t.length=0,t.push(e[n]),t.push(e[n+1]),r.addProfileGeometry(t)}(e.result.object.positions);var t=window.handlerPolyline;t.polyline.show=!1,t.deactivate(),tooltip.setVisible(!1);var n="geologicalbody_cutline-"+(new Date).getTime();u.push(n),viewer.entities.add({id:n,polyline:{positions:e.result.object.positions,width:2,material:SuperMap3D.Color.fromCssColorString("#51ff00")}})}),(function(e){console.log(e)})),window.handlerPolyline.activate()},startCut:function(){tooltip.setVisible(!1),se("Polyline"),0!==u.length?r.build():window.tooltip.showAt(" <p>请先绘制剖切的线段</p>","350px")},clearCut:f,startDig:function(){v(),w()},clearDig:v,startDrilling:function(){S(),viewer.enableCursorStyle=!1,viewer._element.style.cursor="",document.body.classList.add("measureCur"),window.tooltip.showAt(" <p>点击鼠标左键确认钻孔位置</p><p>鼠标右键结束绘制并执行钻孔</p>","350px"),console.log(1),viewer.eventManager.addEventListener("CLICK",m,!0),viewer.eventManager.addEventListener("RIGHT_CLICK",g,!0)},clearDrilling:S,startClip:function(){M(),r.clippingType=SuperMap3D.ClippingType[n.drawClipMode],"drawClip"!==n.clipType?function(){a&&a.deactivate();tooltip.showAt(" <p>点击鼠标左键开始绘制box底面</p><p>然后移动鼠标绘制box高度</p><p>点击鼠标右键结束绘制</p>","350px"),window.handlerBox||re("Box");ae("Box",!1).then((function(e){var t=window.handlerBox;!function(e){e.show=!1;var t=e.box.dimensions.getValue(),n=SuperMap3D.Cartographic.fromCartesian(e.position.getValue(0));if((l=new SuperMap3D.GeoBox(t.x,t.y,t.z)).geoPosition=new SuperMap3D.Point3D(SuperMap3D.Math.toDegrees(n.longitude),SuperMap3D.Math.toDegrees(n.latitude),n.height),r.addProfileGeometry(l),r.build(),a)a.setEditObject(e);else{(a=new SuperMap3D.BoxEditor(viewer,e)).color=SuperMap3D.Color.WHITE.withAlpha(0),a.hoverColor=SuperMap3D.Color.BLUE;var o=function(e){var t=e.dimensions;l.geoWidth=t.y,l.geoHeight=t.z,l.geoLength=t.x;var n=y.CartesiantoDegrees(e.position);l.geoPosition=new SuperMap3D.Point3D(n[0],n[1],n[2]),l.geoRotationZ=a.hpr.heading*(180/SuperMap3D.Math.PI)};a.editEvt.addEventListener(o)}a.activate()}(e.result.object),t.deactivate()}),(function(e){console.log(e)})),window.handlerBox.activate()}():w()},clearClip:M})},volume:function(t){var n,o=e.reactive({dataUrl:"",operationType:"addDate",dimensions:[],variables:[],selectedDateName:null,xDim:100,yDim:200,zDim:9,timeDim:40,drawMode:"volume",opacityInterval:[0,1],useGradientOpacity:!1,gradientOpacityValue:[0,1],gradientOpacity:[0,1],showClipPlane:!1,clipX:.5,clipY:.5,clipRotate:0,xOffset:.5,yOffset:.5,zOffset:.5,contourValue:1,contourRange:[0,1],zScale:0,colorInterval:[0,1],timeOrder:0,timeRange:[0,24],openLight:!1});if(t)for(var i in t)o.hasOwnProperty(i)?o[i]=t[i]:y.Message.errorMsg(ie.AttributeError+i);var r,a=new SuperMap3D.Cartesian3(1,1,1),l=new SuperMap3D.Cartesian3(.5,.5,.5),u=SuperMap3D.Plane.fromPointNormal(new SuperMap3D.Cartesian3(0,0,0),new SuperMap3D.Cartesian3(1,0,0));function c(){if(!o.dataUrl)return y.Message.warnMsg("请先定义数据路径！");var e=viewer.scene.addVoxelGridLayer(o.dataUrl,"test");SuperMap3D.when(e,(function(e){n=e,o.dimensions=n._NetCDFInfo.dimensions,o.variables=n._NetCDFInfo.variables,o.selectedDateName=o.variables[0].name,o.xDim=o.dimensions[0].name,o.yDim=o.dimensions[1].name,o.zDim=o.dimensions[2].name,o.timeDim=o.dimensions[3].name,n.layerBounds=new SuperMap3D.Rectangle(99.95422,32.25671,107.1912,37.1386),n.zBounds=new SuperMap3D.Cartesian2(500,5e4)}))}function p(){var e=n.layerBounds.west+(n.layerBounds.east-n.layerBounds.west)*Number(o.clipX),t=n.layerBounds.south+(n.layerBounds.north-n.layerBounds.south)*Number(o.clipY);viewer.entities.removeById("volume-clip-plane"),viewer.entities.add({id:"volume-clip-plane",position:SuperMap3D.Cartesian3.fromDegrees(e,t,5e4),point:{color:SuperMap3D.Color.YELLOW,pixelSize:10}})}return V.isViewer&&(window.tooltip||(window.tooltip=$(viewer._element)),c()),e.watch((function(){return V.isViewer}),(function(e){e&&(window.tooltip||(window.tooltip=$(viewer._element)),c())})),e.onBeforeUnmount((function(){viewer.scene.layers.remove(n.name),n=null})),e.watch((function(){return o.drawMode}),(function(e){n&&(n.volumeRenderMode="slice"===e?1:"gradient"===e?2:0)})),e.watch((function(){return o.useGradientOpacity}),(function(e){n&&(n.useGradientOpacity=e)})),e.watch((function(){return o.gradientOpacityValue}),(function(e){n&&(r.gradientMinOpacity=e[0],r.gradientMaxOpacity=e[1],r.setGradientOpacityValue(n))})),e.watch((function(){return o.opacityInterval}),(function(e){n&&(r.opacityMinValue=e[0],r.opacityMaxValue=e[1],r.setColorTable(n))})),e.watch((function(){return o.gradientOpacity}),(function(e){n&&(n.gradientOpacityMinOpacity=e[0],n.gradientOpacityMaxOpacity=e[1])})),e.watch((function(){return o.zScale}),(function(e){n&&(a.z=parseFloat(e),n.scale=a)})),e.watch((function(){return o.colorInterval}),(function(e){n&&(r.visibleMinValue=e[0],r.visibleMaxValue=e[1],r.setColorTable(n))})),e.watch((function(){return o.timeOrder}),(function(e){n&&(n.frameIndex=Number(e))})),e.watch((function(){return o.openLight}),(function(e){n&&(n.enableLighting=e)})),e.watch((function(){return o.clipX}),(function(e){if(n){p();var t=parseFloat(e),i=parseFloat(o.clipY),r=SuperMap3D.Math.toRadians(o.clipRotate),a=SuperMap3D.Quaternion.fromAxisAngle(SuperMap3D.Cartesian3.UNIT_Z,r),s=new SuperMap3D.Cartesian3(t,i,0),l=new SuperMap3D.TranslationRotationScale(s,a),c=SuperMap3D.Matrix4.fromTranslationRotationScale(l);SuperMap3D.Plane.fromPointNormal(new SuperMap3D.Cartesian3(0,0,0),new SuperMap3D.Cartesian3(1,0,0),u),SuperMap3D.Plane.transform(u,c,u)}})),e.watch((function(){return o.clipY}),(function(e){if(n){p();var t=parseFloat(o.clipX),i=parseFloat(e),r=new SuperMap3D.Cartesian3(t,i,0);SuperMap3D.Plane.fromPointNormal(r,new SuperMap3D.Cartesian3(0,1,0),u)}})),e.watch((function(){return o.clipRotate}),(function(e){if(n){var t=parseFloat(o.clipX),i=parseFloat(o.clipY),r=SuperMap3D.Math.toRadians(e),a=SuperMap3D.Quaternion.fromAxisAngle(SuperMap3D.Cartesian3.UNIT_Z,r),s=new SuperMap3D.Cartesian3(t,i,0),l=SuperMap3D.Matrix3.fromQuaternion(a),c=SuperMap3D.Matrix4.fromRotationTranslation(l),p=new SuperMap3D.Cartesian3(1,0,0);p=SuperMap3D.Matrix4.multiplyByPoint(c,p,new SuperMap3D.Cartesian3),SuperMap3D.Plane.fromPointNormal(s,p,u)}})),e.watch((function(){return o.xOffset}),(function(e){n&&(l.x=parseFloat(e),n.sliceCoordinate=l)})),e.watch((function(){return o.yOffset}),(function(e){n&&(l.y=parseFloat(e),n.sliceCoordinate=l)})),e.watch((function(){return o.zOffset}),(function(e){n&&(l.z=parseFloat(e),n.sliceCoordinate=l)})),e.watch((function(){return o.contourValue}),(function(e){n&&(n.contourValue=parseFloat(e))})),s(s({},e.toRefs(o)),{},{startRender:function(){n?o.xDim!=o.yDim&&o.xDim!=o.zDim&&o.yDim!=o.zDim?((r=new Me({opacityMinValue:0,opacityMaxValue:.8,gradientMinOpacity:1,gradientMaxOpacity:1,visibleMinValue:0,visibleMaxValue:.37})).setColorTable(n,0),n.startRender({variableName:o.selectedDateName,xDimName:o.xDim,yDimName:o.yDim,zDimName:o.zDim,timeDimName:o.timeDim}),function(){o.contourRange=[Math.ceil(n.minValue),Math.ceil(n.maxValue)],o.contourValue=Math.ceil(n.minValue);var e=n._NetCDFInfo.recordDimension;e&&e.length>0&&(o.timeRange=[0,e.length])}(),viewer.scene.camera.flyTo({destination:{x:-1688158.0372444934,y:6654029.431965283,z:2998692.1265170774},orientation:{heading:.028840576504810755,pitch:-.8994386458052253,roll:6.283185307179586}})):y.Message.warnMsg("各维度名不能一样"):c()},addClipPlane:function(){!SuperMap3D.defined(n)||n.getNumberOfClipPlanes()>0||(o.showClipPlane=!0,n.addClipPlane(u),p())},removeClipPlane:function(){SuperMap3D.defined(n)&&0!==n.getNumberOfClipPlanes()&&(o.showClipPlane=!1,n.removeAllClipPlanes(),viewer.entities.removeById("volume-clip-plane"))},clear:function(){n&&(viewer.scene.layers.remove(n.name),n=null,c())}})},particle:function(t){var n=e.reactive({particles:[{id:0,iconfont:"iconhuoyan",particleName:"火焰"},{id:1,iconfont:"iconshui",particleName:"水"},{id:2,iconfont:"iconyanhua",particleName:"烟花"}],particleSelectedId:0});if(t)for(var o in t)n.hasOwnProperty(o)?null!=t[o]&&(n[o]=t[o]):y.Message.errorMsg(ie.AttributeError+o);return e.onBeforeUnmount((function(){})),s({},e.toRefs(n))}};return"undefined"!=typeof window&&window.Vue&&(window.webgl3d_mc=be),be}));
