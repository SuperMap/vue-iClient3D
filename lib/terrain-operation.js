import{toRefs as e,reactive as n,watch as i,resolveDirective as o,withDirectives as t,openBlock as r,createBlock as a,createVNode as l,vModelRadio as s,createTextVNode as d,toDisplayString as c,vModelText as p,vShow as u,vModelCheckbox as w}from"vue";function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,n,i){return n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}function g(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,o)}return i}function v(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?g(Object(i),!0).forEach((function(n){f(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):g(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}function h(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,n){if(!e)return;if("string"==typeof e)return b(e,n);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return b(e,n)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,n){(null==n||n>e.length)&&(n=e.length);for(var i=0,o=new Array(n);i<n;i++)o[i]=e[i];return o}var m=function(e,n){if(!e||!n)return!0;var i=!0;if(Object.keys(e).length!=Object.keys(n).length)return!1;for(var o in e)if("object"==y(e[o])){if(!(i=isSame(e[o],n[o])))break}else if(e[o]!=n[o]){i=!1;break}return i},P=function(e){for(var n=[].concat(e),i=[],o=0,t=n.length;o<t;o++){var r=SuperMap3D.Cartographic.fromCartesian(n[o]),a=SuperMap3D.Math.toDegrees(r.longitude),l=SuperMap3D.Math.toDegrees(r.latitude),s=r.height;-1==i.indexOf(a)&&-1==i.indexOf(l)&&(i.push(a),i.push(l),i.push(s))}return i};var E,D,M={errorMsg:function(e){console.log("error",e),alert("error："+e)},warnMsg:function(e){console.log("warn",e)},successMsg:function(e){console.log("success",e)}},S={showRenderLoopErrors:"渲染时发生错误，已停止渲染。",AttributeError:"该组件props没有这个属性：",NoPickPositionSupported:"不支持深度纹理,无法绘制多边形，地形操作功能无法使用！",NoTerrain:"请在地形里使用地形组件！",initViewerWarn:"请先初始化viewer!",MoveMouseHeightBox:"点击鼠标左键结束矩形绘制，移动鼠标绘制box高度",RightClickEndDrawing:"右键单击结束绘制",LeftClickBottomBox:"点击鼠标左键，开始绘制矩形作为box底面",ClickModelAddBox:"点击模型，添加裁剪盒子",SkyLineWarn:"获取天际线体前，请先绘制天际线！",SkyLineBody:"天际线体",ShadowqueryWarn:"此操作需要先开启阴影！",VeiwshedBody:"可视体",VeiwshedBodyHidden:"不可视体",EchartsErr:"二维显示需要echarts支持，未找到相关依赖！",BaseMapImg:"底图",tip1:"<p>点击左键确定操作区域中间点</p><p>右键单击结束绘制</p>"},T=(D=(navigator.language||navigator.browserLanguage).toLowerCase(),window.lang=D,D).toLowerCase();var k=((E=void 0!==T?T:(navigator.language||navigator.browserLanguage).toLowerCase()).startsWith("zh")||E.startsWith("ja"),S),C=function(e,n){var i,o,t=0;switch(n&&(t=n),e){case"Point":window.handlerPoint=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Point);break;case"Polyline":window.handlerPolyline=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Line,t);break;case"Polygon":window.handlerPolygon=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Polygon,t);break;case"Marker":window.handlerMarker=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Marker,t);break;case"Box":window.handlerBox=new SuperMap3D.DrawHandler(viewer,SuperMap3D.DrawMode.Box,t)}window.tooltip||(window.tooltip=(i=viewer._element,(o=function(e){var n=document.createElement("DIV");n.className="twipsy right";var i=document.createElement("DIV");i.className="twipsy-arrow",n.appendChild(i);var o=document.createElement("DIV");o.className="twipsy-inner",n.appendChild(o),this._div=n,this._title=o,this.message="",e.appendChild(n);var t=this;n.onmousemove=function(e){t.showAt({x:e.clientX,y:e.clientY},t.message)}}).prototype.setVisible=function(e){this._div.style.display=e?"block":"none"},o.prototype.showAt=function(e,n){e&&n&&(this.setVisible(!0),this._title.innerHTML=n,this._div.style.left=e.x+10+"px",this._div.style.top=e.y-this._div.clientHeight/2+"px",this.message=n)},new o(i))),window.polylineCollection||(window.polylineCollection=new SuperMap3D.PolylineCollection({translucentRS:SuperMap3D.RenderState.fromCache({depthMask:!1,depthTest:{enabled:!1}})}),window.polylineTransparent=window.polylineCollection.add({width:2,material:SuperMap3D.Material.fromType(SuperMap3D.Material.ColorType,{color:SuperMap3D.Color.fromCssColorString("#51ff00").withAlpha(.3)})}),viewer.scene.primitives.add(window.polylineCollection))},x=function(e,n,i){var o=!0;!1===n&&(o=n);var t=O(e);return new Promise((function(n,i){var r=window.tooltip,a=t.activeEvt.addEventListener((function(n){1==n?(viewer.enableCursorStyle=!1,viewer._element.style.cursor="","Point"==e||"Marker"==e?document.body.classList.add("measureCur"):document.body.classList.add("drawCur")):(viewer.enableCursorStyle=!0,r.setVisible(!1),"Point"==e||"Marker"==e?document.body.classList.remove("measureCur"):document.body.classList.remove("drawCur"))})),l=t.movingEvt.addEventListener((function(n){if(n.x<200&&n.y<150)r.setVisible(!1);else if(t.polyline&&t.isDrawing){var i=h(t.positions);"Polygon"==e&&i.push(i[0]),window.polylineTransparent.show=!0,window.polylineTransparent.positions=i}})),s=t.drawEvt.addEventListener((function(i){if(!i.object.positions&&"Point"!=e&&"Box"!=e)return r.showAt(i,"<p>请绘制正确的多边形</p>"),t.polygon.show=!1,t.polyline.show=!1,t.deactivate(),void t.activate();if("Box"!=e){if("Point"==e||"Marker"==e)t.clear(),n({result:i});else{if(window.polylineTransparent.show=o,o&&"Polygon"==e&&o){t.polygon._polygon._material._color._value.alpha=.1;var d=h(i.object.positions);d.push(d[0]),window.polylineTransparent.positions=d}var c=P(i.object.positions);n({result:i,positions:c})}a(),l(),s()}else n({result:i})}))}))},H=function(e){var n;(n=e?O(e):window.handlerPolygon)&&(n.deactivate(),n.clear(),viewer.enableCursorStyle=!0,window.tooltip.setVisible(!1),window.polylineTransparent&&(window.polylineTransparent.show=!1))},O=function(e){var n;switch(e){case"Point":n=window.handlerPoint;break;case"Polyline":n=window.handlerPolyline;break;case"Polygon":n=window.handlerPolygon;break;case"Marker":n=window.handlerMarker;break;case"Box":n=window.handlerBox}return n},L=function(e,n,i){window.selectHandler||(window.selectHandler=new SuperMap3D.ScreenSpaceEventHandler(viewer.scene.canvas));var o=window.selectHandler;window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!0),o.setInputAction((function(){console.log("viewer.selectedEntity:",viewer.selectedEntity);var t=viewer.selectedEntity,r=window.editHandler;t&&(r&&r&&r.clear(),r?(r.deactivate(),r.setEditObject(t),r.activate()):(window.editHandler=new SuperMap3D.EditHandler(viewer,t),window.editHandler.isEditZ=n||!1,window.editHandler.activate()),o.setInputAction((function(){if(t=viewer.selectedEntity,r=window.editHandler,t&&r&&r._positions){var n=P(r._positions);if(m(e,n))return;if(e=n,i&&i(n,window.editHandler),window.handlerPolygon&&window.handlerPolygon.polygon&&window.handlerPolygon.polygon.show){var o=h(r._positions);o.push(o[0]),window.polylineTransparent.positions=o}}}),SuperMap3D.ScreenSpaceEventType.LEFT_UP))}),SuperMap3D.ScreenSpaceEventType.LEFT_CLICK)},V=function(){window.editHandler&&(window.editHandler.deactivate(),window.editHandler.clear()),window.selectHandler&&(window.selectHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_UP),window.selectHandler.removeInputAction(SuperMap3D.ScreenSpaceEventType.LEFT_CLICK),window.selectHandler.destroy(),window.selectHandler=null)};var _={name:"Sm3dTerrainOperation",props:{digDepth:{type:Number,default:500},digPositions:{type:Array},modifyPositions:{type:Array},isEdit:{type:Boolean,default:!1},isEditZ:{type:Boolean,default:!1},lineVisible:{type:Boolean,default:!0}},setup:function(o){var t=function(o){var t=n({digDepth:500,isEdit:!1,isEditZ:!1,lineVisible:!0,digPositions:[],modifyPositions:[],operationType:"dig",terrainVisible:"terrainVisible"});if(o)for(var r in o)t.hasOwnProperty(r)?t[r]=o[r]:M.errorMsg(k.AttributeError+r);var a=[],l=[],s="dig";function d(e){e&&(a=e),viewer.scene.globe.removeAllExcavationRegion(),viewer.scene.globe.addExcavationRegion({name:"dig_terrain",position:a,height:t.digDepth,transparent:!1})}function c(e){e&&(l=e),viewer.scene.globe.removeAllModifyRegion(),viewer.scene.globe.addModifyRegion({name:"ggg",position:l})}return o&&o.digPositions&&d(o.digPositions),i((function(){return t.digDepth}),(function(e){0!=a.length&&d()})),i((function(){return t.isEdit}),(function(e){e&&window.handlerPolygon?"dig"===s?L(a,t.isEditZ,d):L(l,t.isEditZ,c):(V(),window.handlerPolygon&&window.handlerPolygon.polygon&&(window.handlerPolygon.polygon.show=!1))})),i((function(){return t.isEditZ}),(function(e){window.editHandler&&(window.editHandler.isEditZ=e)})),i((function(){return t.terrainVisible}),(function(e){switch(e){case"terrainVisible":viewer.terrainProvider._visible=!0;break;case"terrainUnvisible":viewer.terrainProvider._visible=!1}})),v(v({},e(t)),{},{digTerrain:function(e){t.isEdit=!1,e.preventDefault(),s="dig",window.handlerPolygon||C("Polygon"),x("Polygon",t.lineVisible).then((function(e){a=e.positions;var n=window.handlerPolygon;d(e.positions),n.polygon.show=!1,n.polyline.show=!1,n.deactivate(),t.isEdit&&L(a,t.isEditZ,d)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||M.errorMsg(k.NoPickPositionSupported)},clearDig:function(e){e.preventDefault(),a=[],t.isEdit=!1,window.handlerPolygon&&(viewer.scene.globe.removeAllExcavationRegion(),H("Polygon"),V())},modifyTerrain:function(e){e.preventDefault(),s="modify",window.handlerPolygon||C("Polygon"),x("Polygon",t.lineVisible).then((function(e){l=e.positions;var n=window.handlerPolygon;c(e.positions),n.polygon.show=!1,n.polyline.show=!1,t.isEdit&&L(l,t.isEditZ,c)}),(function(e){console.log(e)})),window.handlerPolygon.activate(),viewer.scene.pickPositionSupported||alert("不支持深度纹理,无法绘制多边形，地形修改功能无法使用！")},clearModify:function(e){e.preventDefault(),window.handlerPolygon&&(viewer.scene.globe.removeAllModifyRegion(),H("Polygon"),V())},digPosition:a,modifyPosition:l})}(o);return{digDepth:t.digDepth,isEdit:t.isEdit,isEditZ:t.isEditZ,terrainVisible:t.terrainVisible,digTerrain:t.digTerrain,clearDig:t.clearDig,modifyTerrain:t.modifyTerrain,clearModify:t.clearModify,operationType:t.operationType}}},j={id:"terrain-operation-panel",class:"sm-panel"},A={class:"sm-function-module-sub-section",style:{margin:"0"}},R={class:"sm-half-L"},B={style:{width:"auto"}},Z={style:{width:"auto"}},I={class:"sm-half-L"},U={style:{width:"35%"}},N={class:"sm-half-L"},W={style:{width:"auto"}},F={style:{width:"auto"}},K={class:"boxchild"},q={class:"boxchild"};_.render=function(e,n,i,y,f,g){var v=o("stopdrag"),h=o("drag");return t((r(),a("div",j,[t(l("div",A,[l("div",R,[l("label",B,[t(l("input",{type:"radio",value:"dig","onUpdate:modelValue":n[1]||(n[1]=function(e){return y.operationType=e})},null,512),[[s,y.operationType]]),d(" "+c(e.Resource.terrainExcavation),1)]),l("label",Z,[t(l("input",{type:"radio",value:"modify","onUpdate:modelValue":n[2]||(n[2]=function(e){return y.operationType=e})},null,512),[[s,y.operationType]]),d(" "+c(e.Resource.terrainModify),1)])]),t(l("div",I,[l("label",U,c(e.Resource.terrainExcavationDepth),1),t(l("input",{class:"sm-input",style:{width:"43%"},type:"number",min:"0","onUpdate:modelValue":n[3]||(n[3]=function(e){return y.digDepth=e})},null,512),[[p,y.digDepth]])],512),[[u,"dig"===y.operationType]]),l("div",N,[l("label",W,[t(l("input",{checked:"",type:"checkbox","onUpdate:modelValue":n[4]||(n[4]=function(e){return y.isEdit=e})},null,512),[[w,y.isEdit]]),d(" "+c(e.Resource.isEdit),1)]),t(l("label",F,[t(l("input",{checked:"",type:"checkbox","onUpdate:modelValue":n[5]||(n[5]=function(e){return y.isEditZ=e})},null,512),[[w,y.isEditZ]]),d(" "+c(e.Resource.isEditZ),1)],512),[[u,"modify"===y.operationType]])]),t(l("div",K,[l("button",{onClick:n[6]||(n[6]=function(){return y.modifyTerrain&&y.modifyTerrain.apply(y,arguments)}),class:"tbtn",type:"button"},c(e.Resource.modify),1),l("button",{onClick:n[7]||(n[7]=function(){return y.clearModify&&y.clearModify.apply(y,arguments)}),class:"tbtn tbtn-margin-left",type:"button"},c(e.Resource.clear),1)],512),[[u,"modify"===y.operationType]]),t(l("div",q,[l("button",{onClick:n[8]||(n[8]=function(){return y.digTerrain&&y.digTerrain.apply(y,arguments)}),onTouchstart:n[9]||(n[9]=function(){return y.digTerrain&&y.digTerrain.apply(y,arguments)}),class:"tbtn",type:"button"},c(e.Resource.excavation),33),l("button",{onClick:n[10]||(n[10]=function(){return y.clearDig&&y.clearDig.apply(y,arguments)}),class:"tbtn tbtn-margin-left",type:"button"},c(e.Resource.clear),1)],512),[[u,"dig"===y.operationType]])],512),[[v]])],512)),[[h]])},_.__file="src/components/terrain-analysis/terrain-operation/terrain-operation.vue",_.install=function(e){e.component(_.name,_)};export default _;
