define(["./arrayRemoveDuplicates-30a3675e","./BoundingRectangle-0828d65a","./buildModuleUrl-9403d69d","./Cartesian2-54f49cd5","./Cartographic-9ee1f1bd","./Check-737bd4ec","./ComponentDatatype-94b9147c","./CoplanarPolygonGeometryLibrary-dc7fe7e1","./when-7d8885d2","./GeometryAttribute-bf27d0ff","./GeometryAttributes-2f749385","./GeometryInstance-66495308","./GeometryPipeline-78c783ae","./IndexDatatype-cb5f74b7","./Math-4ffce144","./FeatureDetection-07e177c7","./PolygonGeometryLibrary-83bb5a0c","./PolygonPipeline-68e6c052","./VertexFormat-86386b6b","./Event-1c0f5ff4","./RuntimeError-f53bcb51","./WebGLConstants-6b41cc89","./OrientedBoundingBox-89debfbe","./Cartesian4-6d2e270a","./EllipsoidTangentPlane-adf29704","./IntersectionTests-6a0482c9","./Plane-74ce87e7","./AttributeCompression-cd5a3a25","./EncodedCartesian3-8b0babb6","./ArcType-29cf2197","./EllipsoidRhumbLine-fd512dba"],(function(e,t,a,n,r,o,i,l,s,p,c,y,u,m,d,g,b,f,v,h,C,x,P,w,A,F,G,L,E,T,D){"use strict";var _=new r.Cartesian3,k=new t.BoundingRectangle,V=new n.Cartesian2,R=new n.Cartesian2,M=new r.Cartesian3,I=new r.Cartesian3,H=new r.Cartesian3,B=new r.Cartesian3,O=new r.Cartesian3,z=new r.Cartesian3,S=new p.Quaternion,N=new g.Matrix3,Q=new g.Matrix3,U=new r.Cartesian3;function j(e,t,a,o,l,s,y,u){var b=e.positions,v=f.PolygonPipeline.triangulate(e.positions2D,e.holes);v.length<3&&(v=[0,1,2]);var h=m.IndexDatatype.createTypedArray(b.length,v.length);h.set(v);var C=N;if(0!==o){var x=p.Quaternion.fromAxisAngle(s,o,S);if(C=g.Matrix3.fromQuaternion(x,C),t.tangent||t.bitangent){x=p.Quaternion.fromAxisAngle(s,-o,S);var P=g.Matrix3.fromQuaternion(x,Q);y=r.Cartesian3.normalize(g.Matrix3.multiplyByVector(P,y,y),y),t.bitangent&&(u=r.Cartesian3.normalize(r.Cartesian3.cross(s,y,u),u))}}else C=g.Matrix3.clone(g.Matrix3.IDENTITY,C);var w=R;t.st&&(w.x=a.x,w.y=a.y);for(var A=b.length,F=3*A,G=new Float64Array(F),L=t.normal?new Float32Array(F):void 0,E=t.tangent?new Float32Array(F):void 0,T=t.bitangent?new Float32Array(F):void 0,D=t.st?new Float32Array(2*A):void 0,k=0,M=0,I=0,H=0,B=0,O=0;O<A;O++){var z=b[O];if(G[k++]=z.x,G[k++]=z.y,G[k++]=z.z,t.st){var U=l(g.Matrix3.multiplyByVector(C,z,_),V);n.Cartesian2.subtract(U,w,U);var j=d.CesiumMath.clamp(U.x/a.width,0,1),Y=d.CesiumMath.clamp(U.y/a.height,0,1);D[B++]=j,D[B++]=Y}t.normal&&(L[M++]=s.x,L[M++]=s.y,L[M++]=s.z),t.tangent&&(E[H++]=y.x,E[H++]=y.y,E[H++]=y.z),t.bitangent&&(T[I++]=u.x,T[I++]=u.y,T[I++]=u.z)}var q=new c.GeometryAttributes;return t.position&&(q.position=new p.GeometryAttribute({componentDatatype:i.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:G})),t.normal&&(q.normal=new p.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:L})),t.tangent&&(q.tangent=new p.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:E})),t.bitangent&&(q.bitangent=new p.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:T})),t.st&&(q.st=new p.GeometryAttribute({componentDatatype:i.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:D})),new p.Geometry({attributes:q,indices:h,primitiveType:g.PrimitiveType.TRIANGLES})}function Y(e){var t=(e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT)).polygonHierarchy,a=s.defaultValue(e.vertexFormat,v.VertexFormat.DEFAULT);this._vertexFormat=v.VertexFormat.clone(a),this._polygonHierarchy=t,this._stRotation=s.defaultValue(e.stRotation,0),this._ellipsoid=n.Ellipsoid.clone(s.defaultValue(e.ellipsoid,n.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=b.PolygonGeometryLibrary.computeHierarchyPackedLength(t)+v.VertexFormat.packedLength+n.Ellipsoid.packedLength+2}Y.fromPositions=function(e){return new Y({polygonHierarchy:{positions:(e=s.defaultValue(e,s.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:e.vertexFormat,stRotation:e.stRotation,ellipsoid:e.ellipsoid})},Y.pack=function(e,t,a){return a=s.defaultValue(a,0),a=b.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,a),n.Ellipsoid.pack(e._ellipsoid,t,a),a+=n.Ellipsoid.packedLength,v.VertexFormat.pack(e._vertexFormat,t,a),a+=v.VertexFormat.packedLength,t[a++]=e._stRotation,t[a]=e.packedLength,t};var q=n.Ellipsoid.clone(n.Ellipsoid.UNIT_SPHERE),J=new v.VertexFormat,W={polygonHierarchy:{}};return Y.unpack=function(e,t,a){t=s.defaultValue(t,0);var r=b.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=r.startingIndex,delete r.startingIndex;var o=n.Ellipsoid.unpack(e,t,q);t+=n.Ellipsoid.packedLength;var i=v.VertexFormat.unpack(e,t,J);t+=v.VertexFormat.packedLength;var l=e[t++],p=e[t];return s.defined(a)||(a=new Y(W)),a._polygonHierarchy=r,a._ellipsoid=n.Ellipsoid.clone(o,a._ellipsoid),a._vertexFormat=v.VertexFormat.clone(i,a._vertexFormat),a._stRotation=l,a.packedLength=p,a},Y.createGeometry=function(t){var n=t._vertexFormat,o=t._polygonHierarchy,i=t._stRotation,s=o.positions;if(!((s=e.arrayRemoveDuplicates(s,r.Cartesian3.equalsEpsilon,!0)).length<3)){var c=M,g=I,f=H,v=O,h=z;if(l.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(s,B,v,h)){if(c=r.Cartesian3.cross(v,h,c),c=r.Cartesian3.normalize(c,c),!r.Cartesian3.equalsEpsilon(B,r.Cartesian3.ZERO,d.CesiumMath.EPSILON6)){var C=t._ellipsoid.geodeticSurfaceNormal(B,U);r.Cartesian3.dot(c,C)<0&&(c=r.Cartesian3.negate(c,c),v=r.Cartesian3.negate(v,v))}var x=l.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(B,v,h),P=l.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(B,v,h);n.tangent&&(g=r.Cartesian3.clone(v,g)),n.bitangent&&(f=r.Cartesian3.clone(h,f));var w=b.PolygonGeometryLibrary.polygonsFromHierarchy(o,x,!1),A=w.hierarchy,F=w.polygons;if(0!==A.length){s=A[0].outerRing;for(var G=a.BoundingSphere.fromPoints(s),L=b.PolygonGeometryLibrary.computeBoundingRectangle(c,P,s,i,k),E=[],T=0;T<F.length;T++){var D=new y.GeometryInstance({geometry:j(F[T],n,L,i,P,c,g,f)});E.push(D)}var _=u.GeometryPipeline.combineInstances(E)[0];_.attributes.position.values=new Float64Array(_.attributes.position.values),_.indices=m.IndexDatatype.createTypedArray(_.attributes.position.values.length/3,_.indices);var V=_.attributes;return n.position||delete V.position,new p.Geometry({attributes:V,indices:_.indices,primitiveType:_.primitiveType,boundingSphere:G})}}}},function(e,t){return s.defined(t)&&(e=Y.unpack(e,t)),Y.createGeometry(e)}}));
