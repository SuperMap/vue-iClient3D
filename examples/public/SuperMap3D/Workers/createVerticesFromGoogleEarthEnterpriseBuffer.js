define(["./EllipsoidTangentPlane-adf29704","./buildModuleUrl-9403d69d","./Cartesian2-54f49cd5","./Cartographic-9ee1f1bd","./when-7d8885d2","./TerrainEncoding-85372ebc","./Math-4ffce144","./FeatureDetection-07e177c7","./OrientedBoundingBox-89debfbe","./RuntimeError-f53bcb51","./GeometryAttribute-bf27d0ff","./WebMercatorProjection-cb51ca7c","./createTaskProcessorWorker","./Check-737bd4ec","./Cartesian4-6d2e270a","./IntersectionTests-6a0482c9","./Plane-74ce87e7","./Event-1c0f5ff4","./AttributeCompression-cd5a3a25","./ComponentDatatype-94b9147c","./WebGLConstants-6b41cc89","./PolygonPipeline-68e6c052","./EllipsoidRhumbLine-fd512dba"],(function(e,t,i,n,r,a,o,s,u,c,h,d,l,g,m,p,f,v,E,I,C,T,M){"use strict";var b=Uint16Array.BYTES_PER_ELEMENT,N=Int32Array.BYTES_PER_ELEMENT,x=Uint32Array.BYTES_PER_ELEMENT,S=Float32Array.BYTES_PER_ELEMENT,P=Float64Array.BYTES_PER_ELEMENT;function w(e,t,i){i=r.defaultValue(i,o.CesiumMath);for(var n=e.length,a=0;a<n;++a)if(i.equalsEpsilon(e[a],t,o.CesiumMath.EPSILON12))return a;return-1}var B=new n.Cartographic,y=new n.Cartesian3,A=new n.Cartesian3,R=new n.Cartesian3,_=new s.Matrix4;function F(e,t,a,u,c,h,d,l,g,m){for(var p=d.length,f=0;f<p;++f){var v=d[f],E=v.cartographic,I=v.index,C=e.length,T=E.longitude,M=E.latitude;M=o.CesiumMath.clamp(M,-o.CesiumMath.PI_OVER_TWO,o.CesiumMath.PI_OVER_TWO);var b=E.height-h.skirtHeight;h.hMin=Math.min(h.hMin,b),n.Cartographic.fromRadians(T,M,b,B),g&&(B.longitude+=l),g?f===p-1?B.latitude+=m:0===f&&(B.latitude-=m):B.latitude+=l;var N=h.ellipsoid.cartographicToCartesian(B);e.push(N),t.push(b),a.push(i.Cartesian2.clone(a[I])),u.length>0&&u.push(u[I]),s.Matrix4.multiplyByPoint(h.toENU,N,y);var x=h.minimum,S=h.maximum;n.Cartesian3.minimumByComponent(y,x,x),n.Cartesian3.maximumByComponent(y,S,S);var P=h.lastBorderPoint;if(r.defined(P)){var w=P.index;c.push(w,C-1,C,C,I,w)}h.lastBorderPoint=v}}return l((function(l,g){l.ellipsoid=i.Ellipsoid.clone(l.ellipsoid),l.rectangle=i.Rectangle.clone(l.rectangle);var m=function(l,g,m,p,f,v,E,I,C,T){var M,W,O,U,Y,k;r.defined(p)?(M=p.west,W=p.south,O=p.east,U=p.north,Y=p.width,k=p.height):(M=o.CesiumMath.toRadians(f.west),W=o.CesiumMath.toRadians(f.south),O=o.CesiumMath.toRadians(f.east),U=o.CesiumMath.toRadians(f.north),Y=o.CesiumMath.toRadians(p.width),k=o.CesiumMath.toRadians(p.height));var V,L,H=[W,U],D=[M,O],G=h.Transforms.eastNorthUpToFixedFrame(g,m),j=s.Matrix4.inverseTransformation(G,_);I&&(V=d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(W),L=1/(d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(U)-V));var z=new DataView(l),q=Number.POSITIVE_INFINITY,J=Number.NEGATIVE_INFINITY,K=A;K.x=Number.POSITIVE_INFINITY,K.y=Number.POSITIVE_INFINITY,K.z=Number.POSITIVE_INFINITY;var Q=R;Q.x=Number.NEGATIVE_INFINITY,Q.y=Number.NEGATIVE_INFINITY,Q.z=Number.NEGATIVE_INFINITY;var X,Z,$=0,ee=0,te=0;for(Z=0;Z<4;++Z){var ie=$;X=z.getUint32(ie,!0),ie+=x;var ne=o.CesiumMath.toRadians(180*z.getFloat64(ie,!0));ie+=P,-1===w(D,ne)&&D.push(ne);var re=o.CesiumMath.toRadians(180*z.getFloat64(ie,!0));ie+=P,-1===w(H,re)&&H.push(re),ie+=2*P;var ae=z.getInt32(ie,!0);ie+=N,ee+=ae,te+=3*(ae=z.getInt32(ie,!0)),$+=X+x}var oe=[],se=[],ue=new Array(ee),ce=new Array(ee),he=new Array(ee),de=I?new Array(ee):[],le=new Array(te),ge=[],me=[],pe=[],fe=[],ve=0,Ee=0;for($=0,Z=0;Z<4;++Z){X=z.getUint32($,!0);var Ie=$+=x,Ce=o.CesiumMath.toRadians(180*z.getFloat64($,!0));$+=P;var Te=o.CesiumMath.toRadians(180*z.getFloat64($,!0));$+=P;var Me=o.CesiumMath.toRadians(180*z.getFloat64($,!0)),be=.5*Me;$+=P;var Ne=o.CesiumMath.toRadians(180*z.getFloat64($,!0)),xe=.5*Ne;$+=P;var Se=z.getInt32($,!0);$+=N;var Pe=z.getInt32($,!0);$+=N,$+=N;for(var we=new Array(Se),Be=0;Be<Se;++Be){var ye=Ce+z.getUint8($++)*Me;B.longitude=ye;var Ae=Te+z.getUint8($++)*Ne;B.latitude=Ae;var Re=z.getFloat32($,!0);if($+=S,0!==Re&&Re<T&&(Re*=-Math.pow(2,C)),Re*=6371010*v,B.height=Re,-1!==w(D,ye)||-1!==w(H,Ae)){var _e=w(oe,B,n.Cartographic);if(-1!==_e){we[Be]=se[_e];continue}oe.push(n.Cartographic.clone(B)),se.push(ve)}we[Be]=ve,Math.abs(ye-M)<be?ge.push({index:ve,cartographic:n.Cartographic.clone(B)}):Math.abs(ye-O)<be?pe.push({index:ve,cartographic:n.Cartographic.clone(B)}):Math.abs(Ae-W)<xe?me.push({index:ve,cartographic:n.Cartographic.clone(B)}):Math.abs(Ae-U)<xe&&fe.push({index:ve,cartographic:n.Cartographic.clone(B)}),q=Math.min(Re,q),J=Math.max(Re,J),he[ve]=Re;var Fe=m.cartographicToCartesian(B);ue[ve]=Fe,I&&(de[ve]=(d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(Ae)-V)*L),s.Matrix4.multiplyByPoint(j,Fe,y),n.Cartesian3.minimumByComponent(y,K,K),n.Cartesian3.maximumByComponent(y,Q,Q);var We=(ye-M)/(O-M);We=o.CesiumMath.clamp(We,0,1);var Oe=(Ae-W)/(U-W);Oe=o.CesiumMath.clamp(Oe,0,1),ce[ve]=new i.Cartesian2(We,Oe),++ve}for(var Ue=3*Pe,Ye=0;Ye<Ue;++Ye,++Ee)le[Ee]=we[z.getUint16($,!0)],$+=b;if(X!==$-Ie)throw new c.RuntimeError("Invalid terrain tile.")}ue.length=ve,ce.length=ve,he.length=ve,I&&(de.length=ve);var ke=ve,Ve=Ee,Le={hMin:q,lastBorderPoint:void 0,skirtHeight:E,toENU:j,ellipsoid:m,minimum:K,maximum:Q};ge.sort((function(e,t){return t.cartographic.latitude-e.cartographic.latitude})),me.sort((function(e,t){return e.cartographic.longitude-t.cartographic.longitude})),pe.sort((function(e,t){return e.cartographic.latitude-t.cartographic.latitude})),fe.sort((function(e,t){return t.cartographic.longitude-e.cartographic.longitude}));var He=1e-5;if(F(ue,he,ce,de,le,Le,ge,-He*Y,!0,-He*k),F(ue,he,ce,de,le,Le,me,-He*k,!1),F(ue,he,ce,de,le,Le,pe,He*Y,!0,He*k),F(ue,he,ce,de,le,Le,fe,He*k,!1),ge.length>0&&fe.length>0){var De=ge[0].index,Ge=ke,je=fe[fe.length-1].index,ze=ue.length-1;le.push(je,ze,Ge,Ge,De,je)}ee=ue.length;var qe,Je=t.BoundingSphere.fromPoints(ue);r.defined(p)&&(qe=u.OrientedBoundingBox.fromRectangle(p,q,J,m));for(var Ke=new a.EllipsoidalOccluder(m).computeHorizonCullingPointPossiblyUnderEllipsoid(g,ue,q),Qe=new e.AxisAlignedBoundingBox(K,Q,g),Xe=new a.TerrainEncoding(Qe,Le.hMin,J,G,!1,I),Ze=new Float32Array(ee*Xe.getStride()),$e=0,et=0;et<ee;++et)$e=Xe.encode(Ze,$e,ue[et],ce[et],he[et],void 0,de[et]);var tt=ge.map((function(e){return e.index})).reverse(),it=me.map((function(e){return e.index})).reverse(),nt=pe.map((function(e){return e.index})).reverse(),rt=fe.map((function(e){return e.index})).reverse();return it.unshift(nt[nt.length-1]),it.push(tt[0]),rt.unshift(tt[tt.length-1]),rt.push(nt[0]),{vertices:Ze,indices:new Uint16Array(le),maximumHeight:J,minimumHeight:q,encoding:Xe,boundingSphere3D:Je,orientedBoundingBox:qe,occludeePointInScaledSpace:Ke,vertexCountWithoutSkirts:ke,indexCountWithoutSkirts:Ve,westIndicesSouthToNorth:tt,southIndicesEastToWest:it,eastIndicesNorthToSouth:nt,northIndicesWestToEast:rt}}(l.buffer,l.relativeToCenter,l.ellipsoid,l.rectangle,l.nativeRectangle,l.exaggeration,l.skirtHeight,l.includeWebMercatorT,l.negativeAltitudeExponentBias,l.negativeElevationThreshold),p=m.vertices;g.push(p.buffer);var f=m.indices;return g.push(f.buffer),{vertices:p.buffer,indices:f.buffer,numberOfAttributes:m.encoding.getStride(),minimumHeight:m.minimumHeight,maximumHeight:m.maximumHeight,boundingSphere3D:m.boundingSphere3D,orientedBoundingBox:m.orientedBoundingBox,occludeePointInScaledSpace:m.occludeePointInScaledSpace,encoding:m.encoding,vertexCountWithoutSkirts:m.vertexCountWithoutSkirts,indexCountWithoutSkirts:m.indexCountWithoutSkirts,westIndicesSouthToNorth:m.westIndicesSouthToNorth,southIndicesEastToWest:m.southIndicesEastToWest,eastIndicesNorthToSouth:m.eastIndicesNorthToSouth,northIndicesWestToEast:m.northIndicesWestToEast}}))}));
