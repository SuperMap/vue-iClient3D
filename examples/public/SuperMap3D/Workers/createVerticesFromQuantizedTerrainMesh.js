define(["./AttributeCompression-cd5a3a25","./EllipsoidTangentPlane-adf29704","./buildModuleUrl-9403d69d","./Cartesian2-54f49cd5","./Cartographic-9ee1f1bd","./when-7d8885d2","./TerrainEncoding-85372ebc","./IndexDatatype-cb5f74b7","./Math-4ffce144","./FeatureDetection-07e177c7","./OrientedBoundingBox-89debfbe","./Check-737bd4ec","./GeometryAttribute-bf27d0ff","./WebMercatorProjection-cb51ca7c","./createTaskProcessorWorker","./Cartesian4-6d2e270a","./IntersectionTests-6a0482c9","./Plane-74ce87e7","./Event-1c0f5ff4","./RuntimeError-f53bcb51","./ComponentDatatype-94b9147c","./WebGLConstants-6b41cc89","./PolygonPipeline-68e6c052","./EllipsoidRhumbLine-fd512dba"],(function(e,t,r,i,n,o,a,s,d,c,u,h,l,I,m,g,f,v,T,p,E,y,w,N){"use strict";function b(){h.DeveloperError.throwInstantiationError()}Object.defineProperties(b.prototype,{errorEvent:{get:h.DeveloperError.throwInstantiationError},credit:{get:h.DeveloperError.throwInstantiationError},tilingScheme:{get:h.DeveloperError.throwInstantiationError},ready:{get:h.DeveloperError.throwInstantiationError},readyPromise:{get:h.DeveloperError.throwInstantiationError},hasWaterMask:{get:h.DeveloperError.throwInstantiationError},hasVertexNormals:{get:h.DeveloperError.throwInstantiationError},availability:{get:h.DeveloperError.throwInstantiationError}});var x=[];b.getRegularGridIndices=function(e,t){var r=x[e];o.defined(r)||(x[e]=r=[]);var i=r[t];return o.defined(i)||S(e,t,i=e*t<d.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6+3*(e+t-2)):r[t]=new Uint32Array((e-1)*(t-1)*6+3*(e+t-2)),0),i},b.getRegularGridIndicesForReproject=function(e,t){var r=x[e];o.defined(r)||(x[e]=r=[]);var i=r[t];return o.defined(i)||S(e,t,i=e*t<d.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),0),i};var M=[];b.getRegularGridIndicesAndEdgeIndices=function(e,t){var r=M[e];o.defined(r)||(M[e]=r=[]);var i=r[t];if(!o.defined(i)){var n=b.getRegularGridIndices(e,t),a=A(e,t),s=a.westIndicesSouthToNorth,d=a.southIndicesEastToWest,c=a.eastIndicesNorthToSouth,u=a.northIndicesWestToEast;i=r[t]={indices:n,westIndicesSouthToNorth:s,southIndicesEastToWest:d,eastIndicesNorthToSouth:c,northIndicesWestToEast:u}}return i};var C=[];function A(e,t){var r,i=new Array(t),n=new Array(e),o=new Array(t),a=new Array(e);for(r=0;r<e;++r)a[r]=r,n[r]=e*t-1-r;for(r=0;r<t;++r)o[r]=(r+1)*e-1,i[r]=(t-r-1)*e;return{westIndicesSouthToNorth:i,southIndicesEastToWest:n,eastIndicesNorthToSouth:o,northIndicesWestToEast:a}}function S(e,t,r,i){for(var n=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=n,d=s+e,c=d+1,u=s+1;r[i++]=s,r[i++]=d,r[i++]=u,r[i++]=u,r[i++]=d,r[i++]=c,++n}++n}var h=(t-1)/2,l=(e-1)/2;n=0;for(a=0;a<l;a++)r[i++]=n,r[i++]=n+1,r[i++]=n+2,n+=2;n=e*(t-1);for(a=0;a<l;a++)r[i++]=n+1,r[i++]=n,r[i++]=n+2,n+=2;n=0;for(a=0;a<h;a++)r[i++]=n+e,r[i++]=n,r[i++]=n+2*e,n+=2*e;n=e-1;for(a=0;a<h;a++)r[i++]=n,r[i++]=n+e,r[i++]=n+2*e,n+=2*e}function P(e,t,r,i,n){for(var a=o.defined(n),s=e[0],d=e.length,c=1;c<d;++c){var u=e[c];!a||n[s+"_"+u]?(r[i++]=s,r[i++]=u,r[i++]=t,r[i++]=t,r[i++]=u,r[i++]=t+1,s=u,++t):(s=u,++t)}return i}b.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){var r=C[e];o.defined(r)||(C[e]=r=[]);var i=r[t];if(!o.defined(i)){var n=e*t,a=(e-1)*(t-1)*6,d=2*e+2*t,c=n+d,u=3*(e+t-2),h=a+6*Math.max(0,d-4)+u,l=A(e,t),I=l.westIndicesSouthToNorth,m=l.southIndicesEastToWest,g=l.eastIndicesNorthToSouth,f=l.northIndicesWestToEast,v=s.IndexDatatype.createTypedArray(c,h);S(e,t,v,0),b.addSkirtIndices(I,m,g,f,n,v,a+u),i=r[t]={indices:v,westIndicesSouthToNorth:I,southIndicesEastToWest:m,eastIndicesNorthToSouth:g,northIndicesWestToEast:f,indexCountWithoutSkirts:a}}return i},b.addSkirtIndices=function(e,t,r,i,n,o,a,s){var d=n;a=P(e,d,o,a,s),a=P(t,d+=e.length,o,a,s),a=P(r,d+=t.length,o,a,s),P(i,d+=r.length,o,a,s)},b.heightmapTerrainQuality=.25,b.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*b.heightmapTerrainQuality/(t*r)},b.prototype.requestTileGeometry=h.DeveloperError.throwInstantiationError,b.prototype.getLevelMaximumGeometricError=h.DeveloperError.throwInstantiationError,b.prototype.getTileDataAvailable=h.DeveloperError.throwInstantiationError,b.prototype.loadTileDataAvailability=h.DeveloperError.throwInstantiationError;var W=32767,B=new n.Cartesian3,_=new n.Cartesian3,F=new n.Cartesian3,D=new n.Cartographic,k=new i.Cartesian2,H=new n.Cartesian3,O=new c.Matrix4,V=new c.Matrix4;function G(e,t,r,i,o,a,s,u,h){var l=Number.POSITIVE_INFINITY,I=o.north,m=o.south,g=o.east,f=o.west;g<f&&(g+=d.CesiumMath.TWO_PI);for(var v=e.length,T=0;T<v;++T){var p=e[T],E=r[p],y=i[p];D.longitude=d.CesiumMath.lerp(f,g,y.x),D.latitude=d.CesiumMath.lerp(m,I,y.y),D.height=E-t;var w=a.cartographicToCartesian(D,B);c.Matrix4.multiplyByPoint(s,w,w),n.Cartesian3.minimumByComponent(w,u,u),n.Cartesian3.maximumByComponent(w,h,h),l=Math.min(l,D.height)}return l}function Y(t,r,i,a,s,u,h,m,g,f,v,T,p,E,y){var w=o.defined(h),N=g.north,b=g.south,x=g.east,M=g.west;x<M&&(x+=d.CesiumMath.TWO_PI);for(var C=i.length,A=0;A<C;++A){var S=i[A],P=s[S],W=u[S];D.longitude=d.CesiumMath.lerp(M,x,W.x)+E,D.latitude=d.CesiumMath.lerp(b,N,W.y)+y,D.height=P-f;var _,F=m.cartographicToCartesian(D,B);if(w){var G=2*S;if(k.x=h[G],k.y=h[G+1],1!==v){var Y=e.AttributeCompression.octDecode(k.x,k.y,H),R=l.Transforms.eastNorthUpToFixedFrame(B,m,V),U=c.Matrix4.inverseTransformation(R,O);c.Matrix4.multiplyByPointAsVector(U,Y,Y),Y.z*=v,n.Cartesian3.normalize(Y,Y),c.Matrix4.multiplyByPointAsVector(R,Y,Y),n.Cartesian3.normalize(Y,Y),e.AttributeCompression.octEncode(Y,k)}}a.hasWebMercatorT&&(_=(I.WebMercatorProjection.geodeticLatitudeToMercatorAngle(D.latitude)-T)*p),r=a.encode(t,r,F,W,D.height,k,_)}}function R(e,t){var r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),o.defined(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}return m((function(h,m){var g,f,v=h.quantizedVertices,T=v.length/3,p=h.octEncodedNormals,E=h.westIndices.length+h.eastIndices.length+h.southIndices.length+h.northIndices.length,y=h.includeWebMercatorT,w=i.Rectangle.clone(h.rectangle),N=w.west,x=w.south,M=w.east,C=w.north,A=i.Ellipsoid.clone(h.ellipsoid),S=h.exaggeration,P=h.minimumHeight*S,U=h.maximumHeight*S,z=o.defined(h.validMinimumHeight)?h.validMinimumHeight*S:P*S,L=o.defined(h.validMaximumHeight)?h.validMaximumHeight*S:U*S,j=h.relativeToCenter,q=l.Transforms.eastNorthUpToFixedFrame(j,A),K=c.Matrix4.inverseTransformation(q,new c.Matrix4);y&&(g=I.WebMercatorProjection.geodeticLatitudeToMercatorAngle(x),f=1/(I.WebMercatorProjection.geodeticLatitudeToMercatorAngle(C)-g));var Q=v.subarray(0,T),X=v.subarray(T,2*T),Z=v.subarray(2*T,3*T),J=o.defined(p),$=new Array(T),ee=new Array(T),te=new Array(T),re=y?new Array(T):[],ie=_;ie.x=Number.POSITIVE_INFINITY,ie.y=Number.POSITIVE_INFINITY,ie.z=Number.POSITIVE_INFINITY;var ne=F;ne.x=Number.NEGATIVE_INFINITY,ne.y=Number.NEGATIVE_INFINITY,ne.z=Number.NEGATIVE_INFINITY;for(var oe=Number.POSITIVE_INFINITY,ae=Number.NEGATIVE_INFINITY,se=Number.POSITIVE_INFINITY,de=Number.NEGATIVE_INFINITY,ce=0;ce<T;++ce){var ue=Q[ce],he=X[ce],le=ue/W,Ie=he/W,me=d.CesiumMath.lerp(P,U,Z[ce]/W);D.longitude=d.CesiumMath.lerp(N,M,le),D.latitude=d.CesiumMath.lerp(x,C,Ie),D.height=me,oe=Math.min(D.longitude,oe),ae=Math.max(D.longitude,ae),se=Math.min(D.latitude,se),de=Math.max(D.latitude,de);var ge=A.cartographicToCartesian(D);$[ce]=new i.Cartesian2(le,Ie),ee[ce]=me,te[ce]=ge,y&&(re[ce]=(I.WebMercatorProjection.geodeticLatitudeToMercatorAngle(D.latitude)-g)*f),c.Matrix4.multiplyByPoint(K,ge,B),n.Cartesian3.minimumByComponent(B,ie,ie),n.Cartesian3.maximumByComponent(B,ne,ne)}var fe,ve,Te=R(h.westIndices,(function(e,t){return $[e].y-$[t].y})),pe=R(h.eastIndices,(function(e,t){return $[t].y-$[e].y})),Ee=R(h.southIndices,(function(e,t){return $[t].x-$[e].x})),ye=R(h.northIndices,(function(e,t){return $[e].x-$[t].x}));ve=r.BoundingSphere.fromPoints(te),fe=u.OrientedBoundingBox.fromRectangle(w,P,U,A);var we,Ne=u.OrientedBoundingBox.fromRectangle(w,z,L,A);(1!==S||P<0)&&(we=new a.EllipsoidalOccluder(A).computeHorizonCullingPointPossiblyUnderEllipsoid(j,te,P));var be=P;be=Math.min(be,G(h.westIndices,h.westSkirtHeight,ee,$,w,A,K,ie,ne)),be=Math.min(be,G(h.southIndices,h.southSkirtHeight,ee,$,w,A,K,ie,ne)),be=Math.min(be,G(h.eastIndices,h.eastSkirtHeight,ee,$,w,A,K,ie,ne)),be=Math.min(be,G(h.northIndices,h.northSkirtHeight,ee,$,w,A,K,ie,ne));for(var xe=new t.AxisAlignedBoundingBox(ie,ne,j),Me=new a.TerrainEncoding(xe,be,U,q,J,y),Ce=Me.getStride(),Ae=new Float32Array(T*Ce+E*Ce),Se=0,Pe=0;Pe<T;++Pe){if(J){var We=2*Pe;if(k.x=p[We],k.y=p[We+1],1!==S){var Be=e.AttributeCompression.octDecode(k.x,k.y,H),_e=l.Transforms.eastNorthUpToFixedFrame(te[Pe],A,V),Fe=c.Matrix4.inverseTransformation(_e,O);c.Matrix4.multiplyByPointAsVector(Fe,Be,Be),Be.z*=S,n.Cartesian3.normalize(Be,Be),c.Matrix4.multiplyByPointAsVector(_e,Be,Be),n.Cartesian3.normalize(Be,Be),e.AttributeCompression.octEncode(Be,k)}}Se=Me.encode(Ae,Se,te[Pe],$[Pe],ee[Pe],k,re[Pe])}var De=Math.max(0,2*(E-4)),ke=h.indices.length+3*De,He=s.IndexDatatype.createTypedArray(T+E,ke);He.set(h.indices,0);var Oe=1e-4,Ve=(ae-oe)*Oe,Ge=(de-se)*Oe,Ye=-Ve,Re=Ve,Ue=Ge,ze=-Ge,Le=T*Ce;Y(Ae,Le,Te,Me,ee,$,p,A,w,h.westSkirtHeight,S,g,f,Ye,0),Y(Ae,Le+=h.westIndices.length*Ce,Ee,Me,ee,$,p,A,w,h.southSkirtHeight,S,g,f,0,ze),Y(Ae,Le+=h.southIndices.length*Ce,pe,Me,ee,$,p,A,w,h.eastSkirtHeight,S,g,f,Re,0),Y(Ae,Le+=h.eastIndices.length*Ce,ye,Me,ee,$,p,A,w,h.northSkirtHeight,S,g,f,0,Ue);var je=function(e,t,r,i){if(i<12)return;for(var n={},o=e.length,a=0;a<o;a+=3){var s=e[a],d=e[a+1],c=e[a+2];(t[s]===W&&t[d]===W||0===t[s]&&0===t[d]||r[s]===W&&r[d]===W||0===r[s]&&0===r[d])&&(n[s+"_"+d]=1,n[d+"_"+s]=1),(t[d]===W&&t[c]===W||0===t[d]&&0===t[c]||r[d]===W&&r[c]===W||0===r[d]&&0===r[c])&&(n[d+"_"+c]=1,n[c+"_"+d]=1),(t[c]===W&&t[s]===W||0===t[c]&&0===t[s]||r[c]===W&&r[s]===W||0===r[c]&&0===r[s])&&(n[c+"_"+s]=1,n[s+"_"+c]=1)}return n}(h.indices,Q,X,h.level);return b.addSkirtIndices(Te,Ee,pe,ye,T,He,h.indices.length,je),m.push(Ae.buffer,He.buffer),{vertices:Ae.buffer,indices:He.buffer,westIndicesSouthToNorth:Te,southIndicesEastToWest:Ee,eastIndicesNorthToSouth:pe,northIndicesWestToEast:ye,vertexStride:Ce,center:j,minimumHeight:P,maximumHeight:U,boundingSphere:ve,orientedBoundingBox:fe,validOrientedBoundingBox:Ne,occludeePointInScaledSpace:we,encoding:Me,indexCountWithoutSkirts:h.indices.length}}))}));
