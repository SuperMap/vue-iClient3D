define(["./AttributeCompression-cd5a3a25","./buildModuleUrl-9403d69d","./Cartesian2-54f49cd5","./Cartographic-9ee1f1bd","./when-7d8885d2","./TerrainEncoding-85372ebc","./IndexDatatype-cb5f74b7","./Check-737bd4ec","./Math-4ffce144","./OrientedBoundingBox-89debfbe","./createTaskProcessorWorker","./FeatureDetection-07e177c7","./Cartesian4-6d2e270a","./RuntimeError-f53bcb51","./WebGLConstants-6b41cc89","./Event-1c0f5ff4","./ComponentDatatype-94b9147c","./EllipsoidTangentPlane-adf29704","./IntersectionTests-6a0482c9","./Plane-74ce87e7","./GeometryAttribute-bf27d0ff","./PolygonPipeline-68e6c052","./EllipsoidRhumbLine-fd512dba"],(function(e,i,t,n,s,r,h,u,o,a,d,p,l,f,g,c,m,x,v,C,w,B,y){"use strict";var b={clipTriangleAtAxisAlignedThreshold:function(e,i,t,n,r,h){var u,o,a;s.defined(h)?h.length=0:h=[],i?(u=t<e,o=n<e,a=r<e):(u=t>e,o=n>e,a=r>e);var d,p,l,f,g,c,m=u+o+a;return 1===m?u?(d=(e-t)/(n-t),p=(e-t)/(r-t),h.push(1),h.push(2),1!==p&&(h.push(-1),h.push(0),h.push(2),h.push(p)),1!==d&&(h.push(-1),h.push(0),h.push(1),h.push(d))):o?(l=(e-n)/(r-n),f=(e-n)/(t-n),h.push(2),h.push(0),1!==f&&(h.push(-1),h.push(1),h.push(0),h.push(f)),1!==l&&(h.push(-1),h.push(1),h.push(2),h.push(l))):a&&(g=(e-r)/(t-r),c=(e-r)/(n-r),h.push(0),h.push(1),1!==c&&(h.push(-1),h.push(2),h.push(1),h.push(c)),1!==g&&(h.push(-1),h.push(2),h.push(0),h.push(g))):2===m?u||t===e?o||n===e?a||r===e||(p=(e-t)/(r-t),l=(e-n)/(r-n),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(p),h.push(-1),h.push(1),h.push(2),h.push(l)):(c=(e-r)/(n-r),d=(e-t)/(n-t),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(c),h.push(-1),h.push(0),h.push(1),h.push(d)):(f=(e-n)/(t-n),g=(e-r)/(t-r),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(f),h.push(-1),h.push(2),h.push(0),h.push(g)):3!==m&&(h.push(0),h.push(1),h.push(2)),h},computeBarycentricCoordinates:function(e,i,t,r,h,u,o,a,d){var p=t-o,l=o-h,f=u-a,g=r-a,c=1/(f*p+l*g),m=i-a,x=e-o,v=(f*x+l*m)*c,C=(-g*x+p*m)*c,w=1-v-C;return s.defined(d)?(d.x=v,d.y=C,d.z=w,d):new n.Cartesian3(v,C,w)},computeLineSegmentLineSegmentIntersection:function(e,i,n,r,h,u,o,a,d){var p=(a-u)*(n-e)-(o-h)*(r-i);if(0!==p){var l=((o-h)*(i-u)-(a-u)*(e-h))/p,f=((n-e)*(i-u)-(r-i)*(e-h))/p;return l>=0&&l<=1&&f>=0&&f<=1?(s.defined(d)||(d=new t.Cartesian2),d.x=e+l*(n-e),d.y=i+l*(r-i),d):void 0}}},A=32767,I=16383,M=[],H=[],T=[],z=new n.Cartographic,E=new n.Cartesian3,N=[],V=[],R=[],O=[],U=[],P=new n.Cartesian3,F=new i.BoundingSphere,S=new a.OrientedBoundingBox,D=new t.Cartesian2,L=new n.Cartesian3;function X(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}X.prototype.clone=function(e){return s.defined(e)||(e=new X),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},X.prototype.initializeIndexed=function(e,i,t,n,s){this.uBuffer=e,this.vBuffer=i,this.heightBuffer=t,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},X.prototype.initializeFromClipResult=function(e,i,t){var n=i+1;return-1!==e[i]?t[e[i]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=t[e[n]],++n,this.second=t[e[n]],++n,this.ratio=e[n],++n),n},X.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},X.prototype.isIndexed=function(){return s.defined(this.index)},X.prototype.getH=function(e,i){if(s.defined(this.index))return this.heightBuffer[this.index];var t=this.first.getH(e,i),n=this.second.getH(e,i);return 0===i+t/A*e||0===i+n/A*e?0:o.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},X.prototype.getU=function(){return s.defined(this.index)?this.uBuffer[this.index]:o.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},X.prototype.getV=function(){return s.defined(this.index)?this.vBuffer[this.index]:o.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var k=new t.Cartesian2,W=-1,K=[new n.Cartesian3,new n.Cartesian3],Y=[new n.Cartesian3,new n.Cartesian3];function _(i,t){++W;var s=K[W],r=Y[W];return s=e.AttributeCompression.octDecode(i.first.getNormalX(),i.first.getNormalY(),s),r=e.AttributeCompression.octDecode(i.second.getNormalX(),i.second.getNormalY(),r),E=n.Cartesian3.lerp(s,r,i.ratio,E),n.Cartesian3.normalize(E,E),e.AttributeCompression.octEncode(E,t),--W,t}X.prototype.getNormalX=function(){return s.defined(this.index)?this.normalBuffer[2*this.index]:(k=_(this,k)).x},X.prototype.getNormalY=function(){return s.defined(this.index)?this.normalBuffer[2*this.index+1]:(k=_(this,k)).y};var G=[];function J(e,i,t,n,r,h,u,o,a,d,p){if(0!==u.length){for(var l=0,f=0;f<u.length;)f=G[l++].initializeFromClipResult(u,f,o);for(var g=0;g<l;++g){var c=G[g];if(c.isIndexed())c.newIndex=h[c.index],c.uBuffer=e,c.vBuffer=i,c.heightBuffer=t,a&&(c.normalBuffer=n);else{var m=c.getKey();if(s.defined(h[m]))c.newIndex=h[m];else{var x=e.length;e.push(c.getU()),i.push(c.getV()),t.push(c.getH(d,p)),a&&(n.push(c.getNormalX()),n.push(c.getNormalY())),c.newIndex=x,h[m]=x}}}3===l?(r.push(G[0].newIndex),r.push(G[1].newIndex),r.push(G[2].newIndex)):4===l&&(r.push(G[0].newIndex),r.push(G[1].newIndex),r.push(G[2].newIndex),r.push(G[0].newIndex),r.push(G[2].newIndex),r.push(G[3].newIndex))}}return G.push(new X),G.push(new X),G.push(new X),G.push(new X),d((function(e,u){var d=e.isEastChild,p=e.isNorthChild,l=d?I:0,f=d?A:I,g=p?I:0,c=p?A:I,m=N,x=V,v=R,C=U;m.length=0,x.length=0,v.length=0,C.length=0;var w=O;w.length=0;var B={},y=e.vertices,k=e.indices;k=k.subarray(0,e.indexCountWithoutSkirts);var W,K,Y,_,G,Z=r.TerrainEncoding.clone(e.encoding),j=Z.hasVertexNormals,q=e.exaggeration,Q=0,$=e.vertexCountWithoutSkirts,ee=e.minimumHeight,ie=e.maximumHeight,te=s.defined(e.validMinimumHeight)?e.validMinimumHeight:e.minimumHeight,ne=s.defined(e.validMaximumHeight)?e.validMaximumHeight:e.maximumHeight,se=new Array($),re=new Array($),he=new Array($),ue=j?new Array(2*$):void 0;for(K=0,Y=0;K<$;++K,Y+=2){var oe=Z.decodeTextureCoordinates(y,K,D);if(W=Z.decodeHeight(y,K)/q,_=o.CesiumMath.clamp(oe.x*A|0,0,A),G=o.CesiumMath.clamp(oe.y*A|0,0,A),he[K]=o.CesiumMath.clamp((W-ee)/(ie-ee)*A|0,0,A),_<20&&(_=0),G<20&&(G=0),A-_<20&&(_=A),A-G<20&&(G=A),se[K]=_,re[K]=G,j){var ae=Z.getOctEncodedNormal(y,K,L);ue[Y]=ae.x,ue[Y+1]=ae.y}(d&&_>=I||!d&&_<=I)&&(p&&G>=I||!p&&G<=I)&&(B[K]=Q,m.push(_),x.push(G),v.push(he[K]),j&&(C.push(ue[Y]),C.push(ue[Y+1])),++Q)}var de=[];de.push(new X),de.push(new X),de.push(new X);var pe,le=[];for(le.push(new X),le.push(new X),le.push(new X),K=0;K<k.length;K+=3){var fe=k[K],ge=k[K+1],ce=k[K+2],me=se[fe],xe=se[ge],ve=se[ce];de[0].initializeIndexed(se,re,he,ue,fe),de[1].initializeIndexed(se,re,he,ue,ge),de[2].initializeIndexed(se,re,he,ue,ce);var Ce=b.clipTriangleAtAxisAlignedThreshold(I,d,me,xe,ve,M);(pe=0)>=Ce.length||((pe=le[0].initializeFromClipResult(Ce,pe,de))>=Ce.length||(pe=le[1].initializeFromClipResult(Ce,pe,de))>=Ce.length||(pe=le[2].initializeFromClipResult(Ce,pe,de),J(m,x,v,C,w,B,b.clipTriangleAtAxisAlignedThreshold(I,p,le[0].getV(),le[1].getV(),le[2].getV(),H),le,j,ie,ee),pe<Ce.length&&(le[2].clone(le[1]),le[2].initializeFromClipResult(Ce,pe,de),J(m,x,v,C,w,B,b.clipTriangleAtAxisAlignedThreshold(I,p,le[0].getV(),le[1].getV(),le[2].getV(),H),le,j,ie,ee))))}var we=d?-32767:0,Be=p?-32767:0,ye=[],be=[],Ae=[],Ie=[],Me=Number.MAX_VALUE,He=-Me,Te=Number.MAX_VALUE,ze=-Me,Ee=T;Ee.length=0;var Ne=t.Ellipsoid.clone(e.ellipsoid),Ve=t.Rectangle.clone(e.childRectangle),Re=Ve.north,Oe=Ve.south,Ue=Ve.east,Pe=Ve.west;for(Ue<Pe&&(Ue+=o.CesiumMath.TWO_PI),K=0;K<m.length;++K){(_=Math.round(m[K]))<=l?(ye.push(K),_=0):_>=f?(Ae.push(K),_=A):_=2*_+we,m[K]=_,(G=Math.round(x[K]))<=g?(be.push(K),G=0):G>=c?(Ie.push(K),G=A):G=2*G+Be,x[K]=G,(W=o.CesiumMath.lerp(ee,ie,v[K]/A))<Me&&(Me=W),W>He&&(He=W);var Fe=W;(Fe=o.CesiumMath.clamp(Fe,te,ne))<Te&&(Te=Fe),Fe>ze&&(ze=Fe),v[K]=W,z.longitude=o.CesiumMath.lerp(Pe,Ue,_/A),z.latitude=o.CesiumMath.lerp(Oe,Re,G/A),z.height=W,Ne.cartographicToCartesian(z,E),Ee.push(E.x),Ee.push(E.y),Ee.push(E.z)}var Se=i.BoundingSphere.fromVertices(Ee,n.Cartesian3.ZERO,3,F),De=a.OrientedBoundingBox.fromRectangle(Ve,Me,He,Ne,S),Le=a.OrientedBoundingBox.fromRectangle(Ve,Te,ze,Ne,S),Xe=new r.EllipsoidalOccluder(Ne).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(Se.center,Ee,3,Se.center,Me,P),ke=He-Me,We=new Uint16Array(m.length+x.length+v.length);for(K=0;K<m.length;++K)We[K]=m[K];var Ke=m.length;for(K=0;K<x.length;++K)We[Ke+K]=x[K];for(Ke+=x.length,K=0;K<v.length;++K)We[Ke+K]=A*(v[K]-Me)/ke;var Ye,_e=h.IndexDatatype.createTypedArray(m.length,w);if(j){var Ge=new Uint8Array(C);u.push(We.buffer,_e.buffer,Ge.buffer),Ye=Ge.buffer}else u.push(We.buffer,_e.buffer);return{vertices:We.buffer,encodedNormals:Ye,indices:_e.buffer,minimumHeight:Me,maximumHeight:He,westIndices:ye,southIndices:be,eastIndices:Ae,northIndices:Ie,boundingSphere:Se,orientedBoundingBox:De,horizonOcclusionPoint:Xe,validMinimumHeight:Te,validMaximumHeight:ze,validOrientedBoundingBox:Le}}))}));
