define(["./AttributeCompression-cd5a3a25","./Cartographic-9ee1f1bd","./Color-1274f10e","./when-7d8885d2","./Cartesian2-54f49cd5","./IndexDatatype-cb5f74b7","./Math-4ffce144","./OrientedBoundingBox-89debfbe","./createTaskProcessorWorker","./Check-737bd4ec","./FeatureDetection-07e177c7","./Cartesian4-6d2e270a","./RuntimeError-f53bcb51","./WebGLConstants-6b41cc89","./buildModuleUrl-9403d69d","./Event-1c0f5ff4","./EllipsoidTangentPlane-adf29704","./IntersectionTests-6a0482c9","./Plane-74ce87e7","./GeometryAttribute-bf27d0ff","./PolygonPipeline-68e6c052","./ComponentDatatype-94b9147c","./EllipsoidRhumbLine-fd512dba"],(function(e,a,n,r,t,i,o,s,f,d,c,u,l,h,p,g,b,C,y,m,v,I,w){"use strict";var x=new a.Cartesian3,A=new t.Ellipsoid,E=new t.Rectangle,N={min:void 0,max:void 0,indexBytesPerElement:void 0};function k(e,a,r){var t=a.length,i=2+t*s.OrientedBoundingBox.packedLength+1+function(e){for(var a=e.length,r=0,t=0;t<a;++t)r+=n.Color.packedLength+3+e[t].batchIds.length;return r}(r),o=new Float64Array(i),f=0;o[f++]=e,o[f++]=t;for(var d=0;d<t;++d)s.OrientedBoundingBox.pack(a[d],o,f),f+=s.OrientedBoundingBox.packedLength;var c=r.length;o[f++]=c;for(var u=0;u<c;++u){var l=r[u];n.Color.pack(l.color,o,f),f+=n.Color.packedLength,o[f++]=l.offset,o[f++]=l.count;var h=l.batchIds,p=h.length;o[f++]=p;for(var g=0;g<p;++g)o[f++]=h[g]}return o}var T=new a.Cartesian3,B=new a.Cartesian3,L=new a.Cartesian3,O=new a.Cartesian3,P=new a.Cartesian3,U=new a.Cartographic,F=new t.Rectangle;return f((function(f,d){var c;!function(e){var n=new Float64Array(e),r=0;N.indexBytesPerElement=n[r++],N.min=n[r++],N.max=n[r++],a.Cartesian3.unpack(n,r,x),r+=a.Cartesian3.packedLength,t.Ellipsoid.unpack(n,r,A),r+=t.Ellipsoid.packedLength,t.Rectangle.unpack(n,r,E)}(f.packedBuffer),c=2===N.indexBytesPerElement?new Uint16Array(f.indices):new Uint32Array(f.indices);var u,l,h,p=new Uint16Array(f.positions),g=new Uint32Array(f.counts),b=new Uint32Array(f.indexCounts),C=new Uint32Array(f.batchIds),y=new Uint32Array(f.batchTableColors),m=new Array(g.length),v=x,I=A,w=E,D=N.min,R=N.max,S=f.minimumHeights,M=f.maximumHeights;r.defined(S)&&r.defined(M)&&(S=new Float32Array(S),M=new Float32Array(M));var _=p.length/2,G=p.subarray(0,_),Y=p.subarray(_,2*_);e.AttributeCompression.zigZagDeltaDecode(G,Y);var V=new Float32Array(3*_);for(u=0;u<_;++u){var H=G[u],W=Y[u],z=o.CesiumMath.lerp(w.west,w.east,H/32767),Z=o.CesiumMath.lerp(w.south,w.north,W/32767),j=a.Cartographic.fromRadians(z,Z,0,U),q=I.cartographicToCartesian(j,T);a.Cartesian3.pack(q,V,3*u)}var J=g.length,K=new Array(J),Q=new Array(J),X=0,$=0;for(u=0;u<J;++u)K[u]=X,Q[u]=$,X+=g[u],$+=b[u];var ee,ae=new Float32Array(3*_*2),ne=new Uint16Array(2*_),re=new Uint32Array(Q.length),te=new Uint32Array(b.length),ie=[],oe={};for(u=0;u<J;++u)h=y[u],r.defined(oe[h])?(oe[h].positionLength+=g[u],oe[h].indexLength+=b[u],oe[h].batchIds.push(u)):oe[h]={positionLength:g[u],indexLength:b[u],offset:0,indexOffset:0,batchIds:[u]};var se=0,fe=0;for(h in oe)if(oe.hasOwnProperty(h)){(ee=oe[h]).offset=se,ee.indexOffset=fe;var de=2*ee.positionLength,ce=2*ee.indexLength+6*ee.positionLength;se+=de,fe+=ce,ee.indexLength=ce}var ue=[];for(h in oe)oe.hasOwnProperty(h)&&(ee=oe[h],ue.push({color:n.Color.fromRgba(parseInt(h)),offset:ee.indexOffset,count:ee.indexLength,batchIds:ee.batchIds}));for(u=0;u<J;++u){var le=(ee=oe[h=y[u]]).offset,he=3*le,pe=le,ge=K[u],be=g[u],Ce=C[u],ye=D,me=R;r.defined(S)&&r.defined(M)&&(ye=S[u],me=M[u]);var ve=Number.POSITIVE_INFINITY,Ie=Number.NEGATIVE_INFINITY,we=Number.POSITIVE_INFINITY,xe=Number.NEGATIVE_INFINITY;for(l=0;l<be;++l){var Ae=a.Cartesian3.unpack(V,3*ge+3*l,T);I.scaleToGeodeticSurface(Ae,Ae);var Ee=I.cartesianToCartographic(Ae,U),Ne=Ee.latitude,ke=Ee.longitude;ve=Math.min(Ne,ve),Ie=Math.max(Ne,Ie),we=Math.min(ke,we),xe=Math.max(ke,xe);var Te=I.geodeticSurfaceNormal(Ae,B),Be=a.Cartesian3.multiplyByScalar(Te,ye,L),Le=a.Cartesian3.add(Ae,Be,O);Be=a.Cartesian3.multiplyByScalar(Te,me,Be);var Oe=a.Cartesian3.add(Ae,Be,P);a.Cartesian3.subtract(Oe,v,Oe),a.Cartesian3.subtract(Le,v,Le),a.Cartesian3.pack(Oe,ae,he),a.Cartesian3.pack(Le,ae,he+3),ne[pe]=Ce,ne[pe+1]=Ce,he+=6,pe+=2}(w=F).west=we,w.east=xe,w.south=ve,w.north=Ie,m[u]=s.OrientedBoundingBox.fromRectangle(w,D,R,I);var Pe=ee.indexOffset,Ue=Q[u],Fe=b[u];for(re[u]=Pe,l=0;l<Fe;l+=3){var De=c[Ue+l]-ge,Re=c[Ue+l+1]-ge,Se=c[Ue+l+2]-ge;ie[Pe++]=2*De+le,ie[Pe++]=2*Re+le,ie[Pe++]=2*Se+le,ie[Pe++]=2*Se+1+le,ie[Pe++]=2*Re+1+le,ie[Pe++]=2*De+1+le}for(l=0;l<be;++l){var Me=l,_e=(l+1)%be;ie[Pe++]=2*Me+1+le,ie[Pe++]=2*_e+le,ie[Pe++]=2*Me+le,ie[Pe++]=2*Me+1+le,ie[Pe++]=2*_e+1+le,ie[Pe++]=2*_e+le}ee.offset+=2*be,ee.indexOffset=Pe,te[u]=Pe-re[u]}ie=i.IndexDatatype.createTypedArray(ae.length/3,ie);for(var Ge=ue.length,Ye=0;Ye<Ge;++Ye){for(var Ve=ue[Ye].batchIds,He=0,We=Ve.length,ze=0;ze<We;++ze)He+=te[Ve[ze]];ue[Ye].count=He}var Ze=k(2===ie.BYTES_PER_ELEMENT?i.IndexDatatype.UNSIGNED_SHORT:i.IndexDatatype.UNSIGNED_INT,m,ue);return d.push(ae.buffer,ie.buffer,re.buffer,te.buffer,ne.buffer,Ze.buffer),{positions:ae.buffer,indices:ie.buffer,indexOffsets:re.buffer,indexCounts:te.buffer,batchIds:ne.buffer,packedBuffer:Ze.buffer}}))}));
